(function(b){var a=/([^&=]+)=?([^&]*)/g,e=/\+/g;function d(f){return decodeURIComponent(f.replace(e," "))}b.parseParams=function(h){var l={},j;while(j=a.exec(h)){var g=d(j[1]),f=d(j[2]);if(g.substring(g.length-2)==="[]"){g=g.substring(0,g.length-2);(l[g]||(l[g]=[])).push(f)}else{l[g]=f}}return l}})(jQuery);(function(a){var b=a.ajax;if(typeof global_data!=="undefined"&&typeof global_data.user_key!=="undefined"&&global_data.user_key){a.ajaxSetup({data:{key:global_data.user_key}})}a.ajax=function(d){if(typeof d.data==="string"){d.data=a.parseParams(d.data)}return b(d)}})(jQuery);function PixelRatio(b,a){this.previewToOriginal=function(d){return Math.ceil(d*b/a)};this.originalToPreview=function(d){return Math.ceil(d*a/b)};return this}capitaliseFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};function PopupCenter(a,m,n,g,e){e=e||function(){};var l=window.screenLeft!=undefined?window.screenLeft:screen.left;var b=window.screenTop!=undefined?window.screenTop:screen.top;width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var f=((width/2)-(n/2))+l;var k=((height/2)-(g/2))+b;var j=window.open(a,m,"scrollbars=yes, width="+n+", height="+g+", top="+k+", left="+f);if(window.focus){j.focus()}var d=setInterval(function(){if(j.closed){clearInterval(d);e()}},250)}(function(J,h,r){if(J.PushStream){return}var j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var w=function(Q){return((Q<10)?"0":"")+Q};var f=function(Q){var R=w(Q.getUTCHours())+":"+w(Q.getUTCMinutes())+":"+w(Q.getUTCSeconds());return j[Q.getUTCDay()]+", "+w(Q.getUTCDate())+" "+x[Q.getUTCMonth()]+" "+Q.getUTCFullYear()+" "+R+" GMT"};var p=function(){var R=arguments[0]||{};for(var S=0;S<arguments.length;S++){var T=arguments[S];for(var Q in T){if(!T.hasOwnProperty||T.hasOwnProperty(Q)){R[Q]=T[Q]}}}return R};var M=/^[\],:{}\s]*$/,e=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,q=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g;var a=function(Q){return Q.replace(/^\s*/,"").replace(/\s*$/,"")};var z=function(Q){if(!Q||!n(Q)){return null}Q=a(Q);if(J.JSON&&J.JSON.parse){try{return J.JSON.parse(Q)}catch(R){if(g.LOG_LEVEL=="error"){throw"Invalid JSON: "+Q}else{return}}}if(M.test(Q.replace(e,"@").replace(q,"]").replace(m,""))){return(new Function("return "+Q))()}if(g.LOG_LEVEL=="error"){throw"Invalid JSON: "+Q}};var b=function(){return{_:(new Date()).getTime()}};var H=function(R){var S=R;if(typeof(R)==="object"){S="";for(var Q in R){if(!R.hasOwnProperty||R.hasOwnProperty(Q)){S+="&"+Q+"="+J.escape(R[Q])}}S=S.substring(1)}return S||""};var P=function(Q,R){return Q+((Q.indexOf("?")<0)?"?":"&")+H(R)};var y=Array.isArray||function(Q){return Object.prototype.toString.call(Q)==="[object Array]"};var n=function(Q){return Object.prototype.toString.call(Q)==="[object String]"};var t={logger:null,debug:function(){if(g.LOG_LEVEL==="debug"){t._log.apply(t._log,arguments)}},info:function(){if((g.LOG_LEVEL==="info")||(g.LOG_LEVEL==="debug")){t._log.apply(t._log,arguments)}},error:function(){t._log.apply(t._log,arguments)},_log:function(){if(!t.logger){var R=J.console;if(R&&R.log){if(R.log.apply){t.logger=R.log}else{if((typeof R.log==="object")&&Function.prototype.bind){t.logger=Function.prototype.bind.call(R.log,R)}else{if((typeof R.log==="object")&&Function.prototype.call){t.logger=function(){Function.prototype.call.call(R.log,R,Array.prototype.slice.call(arguments))}}}}}}if(t.logger){t.logger.apply(J.console,arguments)}var T=h.getElementById(g.LOG_OUTPUT_ELEMENT_ID);if(T){var U="";for(var S=0;S<arguments.length;S++){U+=arguments[S]+" "}T.innerHTML+=U+"\n";var Q=T.innerHTML.split("\n");if(Q.length>100){T.innerHTML=Q.slice(-100).join("\n")}}}};var A={_getXHRObject:function(){var U=false;try{U=new J.XMLHttpRequest()}catch(T){try{U=new J.XDomainRequest()}catch(S){try{U=new J.ActiveXObject("Msxml2.XMLHTTP")}catch(R){try{U=new J.ActiveXObject("Microsoft.XMLHTTP")}catch(Q){U=false}}}}return U},_send:function(T,S){T=T||{};T.timeout=T.timeout||30000;var V=A._getXHRObject();if(!V||!T.url){return}A.clear(T);V.onreadystatechange=function(){if(V.readyState===4){A.clear(T);if(T.afterReceive){T.afterReceive(V)}if(V.status===200){if(T.success){T.success(V.responseText)}}else{if(T.error){T.error(V.status)}}}};if(T.beforeOpen){T.beforeOpen(V)}var U={};var R=null;var W="GET";if(S){R=H(T.data);W="POST"}else{U=T.data||{}}V.open(W,P(T.url,p({},U,b())),true);if(T.beforeSend){T.beforeSend(V)}var Q=function(){try{V.abort()}catch(X){}A.clear(T);T.error(304)};if(S){V.setRequestHeader("Accept","application/json");V.setRequestHeader("Content-type","application/x-www-form-urlencoded")}else{T.timeoutId=J.setTimeout(Q,T.timeout+2000)}V.send(R);return V},_clear_script:function(Q){if(Q){Q.onerror=Q.onload=Q.onreadystatechange=null;if(Q.parentNode){Q.parentNode.removeChild(Q)}}},_clear_timeout:function(Q){if(Q.timeoutId){Q.timeoutId=J.clearTimeout(Q.timeoutId)}},clear:function(Q){A._clear_timeout(Q);A._clear_script(h.getElementById(Q.scriptId))},jsonp:function(U){U.timeout=U.timeout||30000;A.clear(U);var S=h.head||h.getElementsByTagName("head")[0];var R=h.createElement("script");var T=new Date().getTime();var Q=function(){A.clear(U);var W=new Date().getTime();U.error(((W-T)>U.timeout/2)?304:0)};var V=function(){A.clear(U);U.load()};R.onerror=Q;R.onload=R.onreadystatechange=function(W){if(!R.readyState||/loaded|complete/.test(R.readyState)){V()}};if(U.beforeOpen){U.beforeOpen({})}if(U.beforeSend){U.beforeSend({})}U.timeoutId=J.setTimeout(Q,U.timeout+2000);U.scriptId=U.scriptId||new Date().getTime();R.setAttribute("src",P(U.url,p({},U.data,b())));R.setAttribute("async","async");R.setAttribute("id",U.scriptId);S.insertBefore(R,S.firstChild)},load:function(Q){return A._send(Q,false)},post:function(Q){return A._send(Q,true)}};var B=function(Q){return(Q)?J.escape(Q):""};var C=function(Q){return(Q)?J.unescape(Q):""};var v=function(S,R){var T=S;if(n(S)){T=z(S)}var Q={id:T[R.jsonIdKey],channel:T[R.jsonChannelKey],data:T[R.jsonDataKey],tag:T[R.jsonTagKey],time:T[R.jsonTimeKey],eventid:T[R.jsonEventIdKey]||""};return Q};var o=function(Q){return(Q.backtrack)?".b"+Number(Q.backtrack):""};var s=function(Q){var S="";for(var R in Q){if(!Q.hasOwnProperty||Q.hasOwnProperty(R)){S+="/"+R+o(Q[R])}}return S};var l=function(W,U,X){var S=W.wrapper.type===I.TYPE;var T=W.useSSL;var R=(S)?((T)?"wss://":"ws://"):((T)?"https://":"http://");R+=W.host;R+=((!T&&W.port===80)||(T&&W.port===443))?"":(":"+W.port);R+=U;var Q=s(W.channels);if(W.channelsByArgument){var V={};V[W.channelsArgument]=Q.substring(1);X=p({},X,V)}else{R+=Q}return P(R,X)};var G=function(T){var S="";var R=(T.useSSL)?"https://":"http://";R+=T.host;R+=((T.port!==80)&&(T.port!==443))?(":"+T.port):"";R+=T.urlPrefixPublisher;for(var Q in T.channels){if(!T.channels.hasOwnProperty||T.channels.hasOwnProperty(Q)){S=Q;break}}R+="?id="+S;return R};var E=function(R){if(R.match(/^(\d{1,3}\.){3}\d{1,3}$/)){return R}var S=R.split(".");var Q=Math.max(S.length-1,2);return S.slice(-1*Q).join(".")};var D=function(R,Q){return function(){return R.apply(Q,arguments)}};var N=function(Q){if(Q){clearTimeout(Q)}return null};var k=function(R){t.info("["+this.type+"] message received",arguments);var Q=v(R.data,this.pushstream);this.pushstream._onmessage(Q.data,Q.id,Q.channel,Q.eventid,true)};var K=function(){this.pushstream._onopen();t.info("["+this.type+"] connection opened")};var O=function(Q){t.info("["+this.type+"] error (disconnected by server):",Q);if((this.pushstream.readyState===g.OPEN)&&(this.type===u.TYPE)&&(Q.type==="error")&&(this.connection.readyState===EventSource.CONNECTING)){return}this._closeCurrentConnection();this.pushstream._onerror({type:((Q&&(Q.type==="load"))||(this.pushstream.readyState===g.CONNECTING))?"load":"timeout"})};var I=function(Q){if(!J.WebSocket&&!J.MozWebSocket){if(g.LOG_LEVEL=="error"){throw"WebSocket not supported"}else{return}}this.type=I.TYPE;this.pushstream=Q;this.connection=null};I.TYPE="WebSocket";I.prototype={connect:function(){this._closeCurrentConnection();var R=p({},this.pushstream.extraParams(),b());var Q=l(this.pushstream,this.pushstream.urlPrefixWebsocket,R);this.connection=(J.WebSocket)?new J.WebSocket(Q):new J.MozWebSocket(Q);this.connection.onerror=D(O,this);this.connection.onclose=D(O,this);this.connection.onopen=D(K,this);this.connection.onmessage=D(k,this);t.info("[WebSocket] connecting to:",Q)},disconnect:function(){if(this.connection){t.debug("[WebSocket] closing connection to:",this.connection.URL);this.connection.onclose=null;this._closeCurrentConnection();this.pushstream._onclose()}},_closeCurrentConnection:function(){if(this.connection){try{this.connection.close()}catch(Q){}this.connection=null}},sendMessage:function(Q){if(this.connection){this.connection.send(Q)}}};var u=function(Q){if(!J.EventSource){if(g.LOG_LEVEL=="error"){throw"EventSource not supported"}else{return}}this.type=u.TYPE;this.pushstream=Q;this.connection=null};u.TYPE="EventSource";u.prototype={connect:function(){this._closeCurrentConnection();var R=p({},this.pushstream.extraParams(),b());var Q=l(this.pushstream,this.pushstream.urlPrefixEventsource,R);this.connection=new J.EventSource(Q);this.connection.onerror=D(O,this);this.connection.onopen=D(K,this);this.connection.onmessage=D(k,this);t.info("[EventSource] connecting to:",Q)},disconnect:function(){if(this.connection){t.debug("[EventSource] closing connection to:",this.connection.URL);this._closeCurrentConnection();this.pushstream._onclose()}},_closeCurrentConnection:function(){if(this.connection){try{this.connection.close()}catch(Q){}this.connection=null}}};var F=function(Q){this.type=F.TYPE;this.pushstream=Q;this.connection=null;this.url=null;this.frameloadtimer=null;this.pingtimer=null;this.iframeId="PushStreamManager_"+Q.id};F.TYPE="Stream";F.prototype={connect:function(){this._closeCurrentConnection();var Q=E(this.pushstream.host);try{h.domain=Q}catch(R){t.error("[Stream] (warning) problem setting document.domain = "+Q+" (OBS: IE8 does not support set IP numbers as domain)")}var S=p({},this.pushstream.extraParams(),b(),{streamid:this.pushstream.id});this.url=l(this.pushstream,this.pushstream.urlPrefixStream,S);t.debug("[Stream] connecting to:",this.url);this.loadFrame(this.url)},disconnect:function(){if(this.connection){t.debug("[Stream] closing connection to:",this.url);this._closeCurrentConnection();this.pushstream._onclose()}},_clear_iframe:function(){var Q=h.getElementById(this.iframeId);if(Q){Q.onload=null;if(Q.parentNode){Q.parentNode.removeChild(Q)}}},_closeCurrentConnection:function(){this._clear_iframe();if(this.connection){this.pingtimer=N(this.pingtimer);this.frameloadtimer=N(this.frameloadtimer);this.connection=null;this.transferDoc=null;if(typeof J.CollectGarbage==="function"){J.CollectGarbage()}}},loadFrame:function(Q){this._clear_iframe();try{var R=new J.ActiveXObject("htmlfile");R.open();R.write('<html><script>document.domain="'+(h.domain)+'";<\/script></html>');R.parentWindow.PushStream=g;R.close();var T=R.createElement("div");R.appendChild(T);T.innerHTML='<iframe src="'+Q+'"></iframe>';this.connection=T.getElementsByTagName("IFRAME")[0];this.connection.onload=D(O,this);this.transferDoc=R}catch(S){var U=h.createElement("IFRAME");U.style.width="1px";U.style.height="1px";U.style.border="none";U.style.position="absolute";U.style.top="-10px";U.style.marginTop="-10px";U.style.zIndex="-20";U.PushStream=g;h.body.appendChild(U);U.setAttribute("src",Q);U.onload=D(O,this);this.connection=U}this.connection.setAttribute("id",this.iframeId);this.frameloadtimer=J.setTimeout(D(O,this),this.pushstream.timeout)},register:function(Q){this.frameloadtimer=N(this.frameloadtimer);Q.p=D(this.process,this);this.connection.onload=D(this._onframeloaded,this);this.pushstream._onopen();this.setPingTimer();t.info("[Stream] frame registered")},process:function(T,R,S,Q){this.pingtimer=N(this.pingtimer);t.info("[Stream] message received",arguments);this.pushstream._onmessage(C(S),T,R,Q,true);this.setPingTimer()},_onframeloaded:function(){t.info("[Stream] frame loaded (disconnected by server)");this.connection.onload=null;this.disconnect()},setPingTimer:function(){if(this.pingtimer){N(this.pingtimer)}this.pingtimer=J.setTimeout(D(O,this),this.pushstream.pingtimeout)}};var d=function(Q){this.type=d.TYPE;this.pushstream=Q;this.connection=null;this.lastModified=null;this.etag=0;this.connectionEnabled=false;this.opentimer=null;this.messagesQueue=[];this._linkedInternalListen=D(this._internalListen,this);this.xhrSettings={timeout:this.pushstream.longPollingTimeout,data:{},url:null,success:D(this.onmessage,this),error:D(this.onerror,this),load:D(this.onload,this),beforeOpen:D(this.beforeOpen,this),beforeSend:D(this.beforeSend,this),afterReceive:D(this.afterReceive,this)}};d.TYPE="LongPolling";d.prototype={connect:function(){this.messagesQueue=[];this._closeCurrentConnection();this.connectionEnabled=true;this.xhrSettings.url=l(this.pushstream,this.pushstream.urlPrefixLongpolling);var R=E(this.pushstream.host);var Q=E(J.location.hostname);this.useJSONP=(R!==Q)||this.pushstream.longPollingUseJSONP;this.xhrSettings.scriptId="PushStreamManager_"+this.pushstream.id;if(this.useJSONP){this.pushstream.longPollingByHeaders=false;this.xhrSettings.data.callback="PushStreamManager["+this.pushstream.id+"].wrapper.onmessage"}this._internalListen();this.opentimer=J.setTimeout(D(K,this),5000);t.info("[LongPolling] connecting to:",this.xhrSettings.url)},_listen:function(){if(this._internalListenTimeout){N(this._internalListenTimeout)}this._internalListenTimeout=J.setTimeout(this._linkedInternalListen,this.pushstream.longPollingInterval)},_internalListen:function(){if(this.connectionEnabled){this.xhrSettings.data=p({},this.pushstream.extraParams(),this.xhrSettings.data);if(this.useJSONP){A.jsonp(this.xhrSettings)}else{if(!this.connection){this.connection=A.load(this.xhrSettings)}}}},disconnect:function(){this.connectionEnabled=false;if(this.connection){t.debug("[LongPolling] closing connection to:",this.xhrSettings.url);this._closeCurrentConnection();this.pushstream._onclose()}},_closeCurrentConnection:function(){this.opentimer=N(this.opentimer);if(this.connection){try{this.connection.abort()}catch(Q){}this.connection=null;this.lastModified=null;this.xhrSettings.url=null}},beforeOpen:function(R){if(this.lastModified===null){var Q=new Date();if(this.pushstream.secondsAgo){Q.setTime(Q.getTime()-(this.pushstream.secondsAgo*1000))}this.lastModified=f(Q)}if(!this.pushstream.longPollingByHeaders){this.xhrSettings.data[this.pushstream.longPollingTagArgument]=this.etag;this.xhrSettings.data[this.pushstream.longPollingTimeArgument]=this.lastModified}},beforeSend:function(Q){if(this.pushstream.longPollingByHeaders){Q.setRequestHeader("If-None-Match",this.etag);Q.setRequestHeader("If-Modified-Since",this.lastModified)}},afterReceive:function(Q){if(this.pushstream.longPollingByHeaders){this.etag=Q.getResponseHeader("Etag");this.lastModified=Q.getResponseHeader("Last-Modified")}this.connection=null},onerror:function(Q){if(this.connectionEnabled){if(Q===304){this._listen()}else{t.info("[LongPolling] error (disconnected by server):",Q);this._closeCurrentConnection();this.pushstream._onerror({type:(Q===403)?"load":"timeout"})}}},onload:function(){this._listen()},onmessage:function(U){t.info("[LongPolling] message received",U);var Q=null;var T=y(U)?U:U.split("\r\n");for(var R=0;R<T.length;R++){if(T[R]){Q=v(T[R],this.pushstream);this.messagesQueue.push(Q);if(!this.pushstream.longPollingByHeaders&&Q.time){this.etag=Q.tag;this.lastModified=Q.time}}}this._listen();while(this.messagesQueue.length>0){var S=this.messagesQueue.shift();this.pushstream._onmessage(S.data,S.id,S.channel,S.eventid,(this.messagesQueue.length===0))}}};var L=[];var g=function(R){R=R||{};this.id=L.push(this)-1;this.useSSL=R.useSSL||false;this.host=R.host||J.location.hostname;this.port=R.port||(this.useSSL?443:80);this.timeout=R.timeout||15000;this.pingtimeout=R.pingtimeout||30000;this.reconnecttimeout=R.reconnecttimeout||3000;this.checkChannelAvailabilityInterval=R.checkChannelAvailabilityInterval||60000;this.secondsAgo=Number(R.secondsAgo);this.longPollingByHeaders=(R.longPollingByHeaders===r)?true:R.longPollingByHeaders;this.longPollingTagArgument=R.longPollingTagArgument||"tag";this.longPollingTimeArgument=R.longPollingTimeArgument||"time";this.longPollingUseJSONP=R.longPollingUseJSONP||false;this.longPollingTimeout=R.longPollingTimeout||30000;this.longPollingInterval=R.longPollingInterval||100;this.reconnecttimer=null;this.urlPrefixPublisher=R.urlPrefixPublisher||"/pub";this.urlPrefixStream=R.urlPrefixStream||"/sub";this.urlPrefixEventsource=R.urlPrefixEventsource||"/ev";this.urlPrefixLongpolling=R.urlPrefixLongpolling||"/lp";this.urlPrefixWebsocket=R.urlPrefixWebsocket||"/ws";this.jsonIdKey=R.jsonIdKey||"id";this.jsonChannelKey=R.jsonChannelKey||"channel";this.jsonDataKey=R.jsonDataKey||"text";this.jsonTagKey=R.jsonTagKey||"tag";this.jsonTimeKey=R.jsonTimeKey||"time";this.jsonEventIdKey=R.jsonEventIdKey||"eventid";this.modes=(R.modes||"eventsource|websocket|stream|longpolling").split("|");this.wrappers=[];this.wrapper=null;this.onopen=null;this.onmessage=null;this.onerror=null;this.onstatuschange=null;this.channels={};this.channelsCount=0;this.channelsByArgument=R.channelsByArgument||false;this.channelsArgument=R.channelsArgument||"channels";this.extraParams=R.extraParams||this.extraParams;for(var Q=0;Q<this.modes.length;Q++){try{var T=null;switch(this.modes[Q]){case"websocket":T=new I(this);break;case"eventsource":T=new u(this);break;case"longpolling":T=new d(this);break;case"stream":T=new F(this);break}this.wrappers[this.wrappers.length]=T}catch(S){t.info(S)}}this._setState(0)};g.LOG_LEVEL="none";g.LOG_OUTPUT_ELEMENT_ID="Log4jsLogOutput";g.CLOSED=0;g.CONNECTING=1;g.OPEN=2;g.prototype={extraParams:function(){return{}},addChannel:function(R,Q){if(B(R)!==R){if(g.LOG_LEVEL=="error"){throw"Invalid channel name! Channel has to be a set of [a-zA-Z0-9]"}else{return}}t.debug("entering addChannel");if(typeof(this.channels[R])!=="undefined"){if(g.LOG_LEVEL=="error"){throw"Cannot add channel "+R+": already subscribed"}else{return}}Q=Q||{};t.info("adding channel",R,Q);this.channels[R]=Q;this.channelsCount++;if(this.readyState!==g.CLOSED){this.connect()}t.debug("leaving addChannel")},removeChannel:function(Q){if(this.channels[Q]){t.info("removing channel",Q);delete this.channels[Q];this.channelsCount--}},removeAllChannels:function(){t.info("removing all channels");this.channels={};this.channelsCount=0},_setState:function(Q){if(this.readyState!==Q){t.info("status changed",Q);this.readyState=Q;if(this.onstatuschange){this.onstatuschange(this.readyState)}}},connect:function(){t.debug("entering connect");if(!this.host){if(g.LOG_LEVEL=="error"){throw"PushStream host not specified"}else{return}}if(isNaN(this.port)){if(g.LOG_LEVEL=="error"){throw"PushStream port not specified"}else{return}}if(!this.channelsCount){if(g.LOG_LEVEL=="error"){throw"No channels specified"}else{return}}if(this.wrappers.length===0){if(g.LOG_LEVEL=="error"){throw"No available support for this browser"}else{return}}this._keepConnected=true;this._lastUsedMode=0;this._connect();t.debug("leaving connect")},disconnect:function(){t.debug("entering disconnect");this._keepConnected=false;this._disconnect();this._setState(g.CLOSED);t.info("disconnected");t.debug("leaving disconnect")},_connect:function(){this._disconnect();this._setState(g.CONNECTING);this.wrapper=this.wrappers[this._lastUsedMode++%this.wrappers.length];try{this.wrapper.connect()}catch(Q){if(this.wrapper){this.wrapper.disconnect()}}},_disconnect:function(){this.reconnecttimer=N(this.reconnecttimer);if(this.wrapper){this.wrapper.disconnect()}},_onopen:function(){this.reconnecttimer=N(this.reconnecttimer);this._setState(g.OPEN);if(this._lastUsedMode>0){this._lastUsedMode--}},_onclose:function(){this.reconnecttimer=N(this.reconnecttimer);this._setState(g.CLOSED);this._reconnect(this.reconnecttimeout)},_onmessage:function(T,U,R,Q,S){t.debug("message",T,U,R,Q,S);if(U===-2){if(this.onchanneldeleted){this.onchanneldeleted(R)}}else{if((U>0)&&(typeof(this.channels[R])!=="undefined")){if(this.onmessage){this.onmessage(T,U,R,Q,S)}}}},_onerror:function(Q){this._setState(g.CLOSED);this._reconnect((Q.type==="timeout")?this.reconnecttimeout:this.checkChannelAvailabilityInterval);if(this.onerror){this.onerror(Q)}},_reconnect:function(Q){if(this._keepConnected&&!this.reconnecttimer&&(this.readyState!==g.CONNECTING)){t.info("trying to reconnect in",Q);this.reconnecttimer=J.setTimeout(D(this._connect,this),Q)}},sendMessage:function(S,Q,R){S=B(S);if(this.wrapper.type===I.TYPE){this.wrapper.sendMessage(S);if(Q){Q()}}else{A.post({url:G(this),data:S,success:Q,error:R})}}};g.sendMessage=function(S,T,Q,R){A.post({url:S,data:B(T),success:Q,error:R})};g.register=function(Q){var R=Q.window.location.href.match(/streamid=([0-9]*)&?/);if(R[1]&&L[R[1]]){L[R[1]].wrapper.register(Q)}};g.unload=function(){for(var Q=0;Q<L.length;Q++){try{L[Q].disconnect()}catch(R){}}};J.PushStream=g;J.PushStreamManager=L;if(J.attachEvent){J.attachEvent("onunload",g.unload)}if(J.addEventListener){J.addEventListener.call(J,"unload",g.unload,false)}})(window,document);function syncTabs(m){if(typeof localStorage==="undefined"||typeof JSON==="undefined"){var j=["add","registerCallback","getRole"],a={};for(var k=0;k<j.length;k++){a[j[k]]=function(){}}return a}var n={master:{init:[],exit:[],interval:[]},slave:{init:[],exit:[],interval:[]},functions:{}};for(var h in m){n[h]=m[h]}var q={data:"syncTabs_Data",ts:"syncTabs_Ts",masterAlive:"syncTabs_MasterAlive"};var o,d=+localStorage.getItem(q.ts),p=this;function f(r,s){if(typeof n.functions[r]==="undefined"&&typeof console!=="undefined"&&typeof console.error!=="undefined"){console.error("syncTabs: function '"+r+"' not exist");return}if(typeof s==="undefined"){s=[]}else{if(typeof s!="object"){s=[s]}}n.functions[r].apply(null,s)}var e={init:function(){o="master";var t=+new Date();localStorage.setItem(q.masterAlive,t);var r=setInterval(function(){var u=+localStorage.getItem(q.masterAlive);if(u!=t){l.init();clearInterval(r);for(var v=0;v<n.master["exit"].length;v++){n.master["exit"][v].apply()}return}t=+new Date();localStorage.setItem(q.masterAlive,t)},1000);for(var s=0;s<n.master["init"].length;s++){n.master["init"][s].apply()}}};var l={init:function(){o="slave";var r=setInterval(function(){if(+new Date()-+localStorage.getItem(q.masterAlive)>3000){e.init();clearInterval(r);for(var t=0;t<n.slave["exit"].length;t++){n.slave["exit"][t].apply()}return}},1000);for(var s=0;s<n.slave["init"].length;s++){n.slave["init"][s].apply()}}};l.init();function b(){var r=localStorage.getItem(q.data);return r?JSON.parse(r):[]}this.add=function(s,v){var u=+new Date(),r=b();for(var t=r.length-1;t>=0;t--){if(u-r[t].ts>3000){r=r.splice(t+1);break}}r.push({ts:u,name:s,params:v});localStorage.setItem(q.data,JSON.stringify(r));localStorage.setItem(q.ts,u);g(u,r)};function g(u,r){if(typeof u==="undefined"){u=+localStorage.getItem(q.ts)}if(d==u){return}var s=d;d=u;if(typeof r==="undefined"){r=b()}for(var t=0;t<r.length;t++){if(r[t].ts>s){f(r[t].name,r[t].params)}}}setInterval(function(){g()},1000);this.registerCallback=function(t,r,s){if(t=="master"||t=="slave"){if(t==o&&r=="init"){s.apply()}n[t][r].push(s)}else{n[t][r]=s}};this.getRole=function(){return o};return this}var syncTabs=new syncTabs();function Realtime(d){if(typeof Object.keys==="undefined"||typeof localStorage==="undefined"||typeof JSON==="undefined"){var e=["addChannel","replaceChannel","removeChannel"],a={};for(var f=0;f<e.length;f++){a[e[f]]=function(){}}return a}var q={channels:"Realtime_channels",myChannels:"Realtime_myChannels_",ping:"Realtime_ping"};var o=null,j={},h=false,g=false,n=false,k=false;var b={};function p(){var s=localStorage.getItem(q.channels);return s?JSON.parse(s):{}}this.addChannel=function(s,r,t){if(!s){return}b[s]={scope:r,callback:t};localStorage.setItem(q.myChannels+s,+new Date());j=p();if(typeof j[s]==="undefined"){j[s]=true;localStorage.setItem(q.channels,JSON.stringify(j));syncTabs.add("addChannel",[s])}};setInterval(function(){var s=+new Date();for(var r in b){localStorage.setItem(q.myChannels+r,s)}},10000);this.replaceChannel=function(s,r){j=p();if(typeof j[s]!=="undefined"){localStorage.setItem(q.myChannels+r,+new Date());delete j[s];j[r]=true;localStorage.setItem(q.channels,JSON.stringify(j))}syncTabs.add("replaceChannel",[s,r])};this.removeChannel=function(r){j=p();if(typeof j[r]!=="undefined"){delete j[r];localStorage.setItem(q.channels,JSON.stringify(j))}syncTabs.add("removeChannel",[r])};syncTabs.registerCallback("functions","receiveData",function(s,r){if(typeof r==="undefined"||typeof b[r]==="undefined"){return}b[r]["callback"].apply(b[r]["scope"],[s,r])});function l(t){var t=(typeof t==="undefined")?true:!!t,u=+new Date(),s=0;for(var r in j){if(u-+localStorage.getItem(q.myChannels+r)>20000){localStorage.removeItem(q.myChannels+r);if(t&&h){h=false;o.disconnect()}if(t){o.removeChannel(r)}delete j[r];s++}}if(s){localStorage.setItem(q.channels,JSON.stringify(j))}if(t&&!h&&Object.keys(j).length){h=true;o.connect()}return s}function m(){var u=+localStorage.getItem(q.ping),r=+new Date,t=r-u,s=900000;if(t>s){$.ajax({type:"post",url:"/ajax/liveupdate/ping",success:function(){localStorage.setItem(q.ping,+new Date)}});pingIn=s}else{pingIn=s-t}n=setTimeout(m,pingIn)}localStorage.setItem(q.ping,+new Date);syncTabs.registerCallback("master","init",function(){if(!o){o=new PushStream({host:d.host,port:d.port,modes:"websocket"});o.onmessage=function(t,u,s){syncTabs.add("receiveData",[t,s])}}j=p();l(false);g=setInterval(function(){l()},10000);m();if(!Object.keys(j).length){return}for(var r in j){o.addChannel(r)}h=true;o.connect()});syncTabs.registerCallback("master","exit",function(){h=false;o.disconnect();o.removeAllChannels();clearInterval(g);clearInterval(n)});syncTabs.registerCallback("functions","addChannel",function(r){if(syncTabs.getRole()!="master"||typeof j[r]!=="undefined"){return}j[r]=true;if(h){h=false;o.disconnect()}o.addChannel(r);clearInterval(k);k=setTimeout(function(){if(!h){h=true;o.connect()}},500)});syncTabs.registerCallback("functions","replaceChannel",function(s,r){if(typeof b[s]!=="undefined"){b[r]=b[s];delete b[s];localStorage.removeItem(q.myChannels+s)}if(syncTabs.getRole()=="master"){delete j[s];j[r]=true;if(h){o.disconnect()}h=true;o.removeChannel(s);o.addChannel(r);o.connect()}});syncTabs.registerCallback("functions","removeChannel",function(r){if(typeof b[r]!=="undefined"){delete b[r];localStorage.removeItem(q.myChannels+r)}if(syncTabs.getRole()=="master"){delete j[r];if(h){o.disconnect()}h=true;o.removeChannel(r);o.connect()}});Realtime=this}function notifications(A,e){if(false){var t=["updateCounts","resetCount","showEvent"],s={};for(var v=0;v<t.length;v++){s[t[v]]=function(){}}return s}var x={messages:0,newsfeed:0,notification:0,thirdnotification:0,friendsfeed:0,mention:0};for(var y in e){if(typeof x[y]!=="undefined"){x[y]=e[y]}}var g=document.title,b=40,d=false,h=false,l=false,f=false,q=["shout","wallpost","post","tema","track","album"],m=$.browser.webkit?"offset":"position",o=$("#friends-live-activity"),u=o.find(".list-item:first").outerHeight()||42;this.updateCounts=function(E){for(var r in E){if(typeof x[r]==="undefined"||x[r]==E[r]){continue}x[r]=E[r];switch(r){case"messages":case"notification":var D=(E[r]>=100)?"+99":E[r];a(r,D);k();break;case"newsfeed":case"thirdnotification":var D=x[r],C=x.newsfeed+x.thirdnotification;if(D>=100){D="+99"}if(C>=100){C="+99"}a("mi",C);k();if(D&&typeof Feed2==="object"&&Feed2.getConfig("feedName")==r){$("#Feed-reload").css("display","block")}var B=$("#bubble-alert-"+r);if(B.length){B.html(D);if(D){B.removeClass("hide")}else{B.addClass("hide")}}break;case"mention":var D=x[r];if(D&&typeof Feed2==="object"&&Feed2.getConfig("feedName")==r){$("#Feed-reload").css("display","block")}break}}};this.resetCount=function(r){if(typeof x[r]==="undefined"){return}var B={counts:{}};B.counts[r]=0;syncTabs.add("receiveData",[B,A])};this.showEvent=function(r){switch(r.feedName){case"notification":case"realtime":z(r);break;case"friendsfeed":w(r);break}};function p(B,r){n();B.show();j(B,r)}function j(D,I){var F=I[m]().top;if(F>0){var E=($.browser.webkit?0:o.parent()[m]().top)+F,G=$("#main")[$.browser.msie?"offset":m]().left+338;D.css({position:"absolute",top:E+"px",left:G+"px"})}var r=$(window).height()+$(window).scrollTop(),B=D.find(".shout-live").outerHeight(true),H=D.offset().top;if(r>H&&r<B+H&&r>B+20){D.css("top",r-(B+20));var C=-(r-(B+H+28));if(C<(B-30)){D.find(".shout-arrow").css("top",C+"px")}else{D.hide()}}}function n(){$(".shout-live-box:visible").hide().css("top","0px").find(".shout-arrow").css("top","8px")}function z(B){var r="/feed-markAsRead.php?feedName="+B.feedName+"&id="+B.id+"&to="+encodeURIComponent(B.object.link);B.shortText=B.shortText.replace(/(<\/?)a(\s|>)/ig,"$1span$2");$.createNotification({content:['<img href="'+B.image.href+'" src="'+B.image.src+'"> ',"<p>",'<i class="icon '+B.actionName+'"></i> ',B.shortText,"</p>"].join(""),vertical:"bottom",limit:5,queue:true,duration:10000,link:r});$("a.notification span.important").attr("href",r)}function w(B){var r=$("#friends-live-activity");if(r.length){f=true;r.prepend(tmpl("friendlist_item",B));if(!d&&!h){r.scrollTo(0,500)}r[0].scrollTop+=42;r.find(".list-item:hidden").fadeIn(400);r.find(".list-item:gt("+(b-1)+")").remove()}}function a(r,B){if(v6.enabled){return v6.updateNotification(r,B)}el=$("#bubble-alert-"+r);if(!el.length){return}if(!B){el.animate({bottom:"+=5px"},100,null,function(){$(this).animate({bottom:"-=5px"},100,null,function(){$(this).slideUp(100)})});return}el.find("a span").html(B);el.slideDown(100,function(){$(this).animate({bottom:"+=5px"},100,null,function(){$(this).animate({bottom:"-=5px"},100)})})}function k(){var B=0;var C={friendsfeed:1,thirdnotification:1,newsfeed:1,};for(var r in x){if(r in C){continue}B+=x[r]}if(B){B="("+((B>=100)?"+99":B)+") "}else{B=""}if(document.title!=B+g){document.title=B+g}}o.on("scroll",function(){if(!f){n();f=false}}).on("mouseenter","#friends-live-activity .list-item",function(F){h=true;var E=$(this),C=E.data("type"),G=E.data("action")||"none",B=$(F.relatedTarget).is(".list-item")?0:900;if(!C||$.inArray(C,q)<0){return}var H=E.data("id"),r=E.data("owner"),D=$("#shout-live-"+C+"-"+H);E.addClass("active");clearInterval(l);l=false;if(!D.length){if(E.hasClass("active")){$.ajax({url:"/ajax/shout-live.php",type:"post",data:{type:C,id:H,owner:r,action:G},success:function(I){D=$(I).appendTo("body");if(E.hasClass("active")){p(D,E)}},complete:function(){}})}}else{setTimeout(function(){if(E.hasClass("active")){p(D,E)}},200)}}).on("mouseleave","#friends-live-activity .list-item",function(B){h=false;var r=$(this),C=$(B.relatedTarget);o.find(".list-item.active").removeClass("active");l=setTimeout(function(){if(!d){n()}},700)});$("body").on("mouseenter",".shout-live-box",function(){d=true}).on("mouseleave",".shout-live-box",function(){d=false;setTimeout(function(){if(!d&&!h){n()}},1000)}).on("click",".shout-live-box .shout-stats.like",function(D){D.preventDefault();if($(this).hasClass("disabled")){return}var C=$(this),B=C.find("a"),E=C.closest(".shout-live-box"),F=E.data("id"),r=E.data("owner");ajax("shout","vote",{uuid:F,owner:r,score:1});B.html(+B.html()+1);C.addClass("disabled applied")}).on("click",".shout-live-box .shout-stats.reshout",function(D){D.preventDefault();if($(this).hasClass("disabled")){return}var C=$(this),B=C.find("a"),E=C.closest(".shout-live-box"),F=E.data("id"),r=E.data("owner");ajax("shout","add",{parent_id:F,parent_owner:r});B.html(+B.html()+1);C.addClass("disabled applied")}).on("click",".shout-live-box .shout-stats.favorite",function(F){F.preventDefault();var D=$(this),B=D.find("a"),G=D.closest(".shout-live-box"),H=G.data("id"),r=G.data("owner"),E=+B.html();if(D.hasClass("disabled applied")){var C="favorite-del";D.removeClass("disabled applied");if(E>0){--E}}else{var C="favorite-add";D.addClass("disabled applied");++E}ajax("shout",C,{uuid:H,owner:r});B.html(E)}).on("click",".shout-live-box .shout-stats.reply",function(r){r.preventDefault();window.location.href=$(this).attr("url")}).on("click",".shout-live-box .shout-body .shout-text",function(r){var B=$(r.target);if(!B.is("a")){r.preventDefault();window.open(B.attr("url"))}});Realtime.addChannel(A,this,function(r){if(typeof r.counts!=="undefined"){this.updateCounts(r.counts)}if(typeof r.event!=="undefined"){this.showEvent(r.event)}});k();syncTabs.add("receiveData",[{counts:x},A]);notifications=this}function Feed2(a){var b={feedName:"",filterName:"",lastId:""};var d=750,g={nextPage:false,load:false},k=this,f=false;var h=/^[a-z/]+$/;if(h.test(window.location.hash.substr(1))){window.location.href=window.location.hash.substr(1)}this.setConfig=function(l,m){if(typeof b[l]!=="undefined"){b[l]=m}};for(var j in a){this.setConfig(j,a[j])}this.getConfig=function(l){return(typeof b[l]!=="undefined")?b[l]:false};function e(m){$(".Feed-load").removeClass("active");$(m).addClass("active");$(".pin-highlight").removeClass("pin-highlight");if(b.feedName=="pin"){$(m).parent().addClass("pin-highlight")}if($.inArray(b.feedName,["newsfeed","thirdnotification","favorite","mention"])!=-1){var l="mi";$('#menu .Feed-load[data-feedname="newsfeed"]').addClass("active")}else{var l=b.feedName}$('#menu .Feed-load[data-feedname="'+l+'"]').addClass("active");$(".Feed-controls:not(#Feed-controls-"+l+")").hide();$("#Feed-controls-"+l).show();if($(m).closest("#menu")){if(b.filterName){$("#Feed-controls-"+l+' .Feed-load[data-feedname="'+b.feedName+'"][data-filtername="'+b.filterName+'"]').addClass("active")}else{$("#Feed-controls-"+l+' .Feed-load[data-feedname="'+b.feedName+'"]').addClass("active")}}}this.load=function(o,n,l,m){if(typeof n==="undefined"){n=""}if(b.feedName==o&&b.filterName==n&&g.load){return}$("#Feed-list").addClass("loading");$("#Feed-error, #Feed-reload").hide();g.load=true;clearInterval(f);if(b.feedName!=o||b.filterName!=n){b.feedName=o;b.filterName=n;g.nextPage=false;e(m);if(typeof l!=="undefined"){if(history&&history.pushState){history.pushState({path:l},document.title,l)}else{window.location.hash=l}}if($(window).scrollTop()>$("#Feed-list").offset().top){if(!v6.enabled){$.scrollTo("#menu",250)}else{$.scrollTo(".v6 .tabs",250)}}}if(typeof notifications==="object"){notifications.resetCount(b.feedName)}if(b.feedName=="mention"){$("#bubble-alert-mention").addClass("hide")}$.ajax({type:"POST",dataType:"html",url:"/ajax/feed/fetch",data:{feedName:o,filterName:n},success:function(p){if(o!=b.feedName||n!=b.filterName){return}_gaq.push(["_trackPageview",window.location.pathname]);$("#Feed-list").html(p);$(".shout-quick-reply.ubertext-me").uberText({limit:512,block:true,autogrow:true});if(o==="newsfeed"){saveListsFromContext()}},error:function(p){if(o!=b.feedName||n!=b.filterName){return}if(p.status==403){window.location.reload();return}$("#Feed-list").html("");$("#Feed-error").show();f=setTimeout(function(){k.load(o,n,l)},5000)},complete:function(){if(o!=b.feedName||n!=b.filterName){return}g.load=false;$("#Feed-list").removeClass("loading")}})};this.nextPage=function(){if(g.load||g.nextPage||!b.lastId){return}g.nextPage=true;clearInterval(f);$("#Feed-error").hide();$("#Feed-loading").show();var m=b.feedName,l=b.filterName;$.ajax({type:"POST",dataType:"html",url:"/ajax/feed/fetch",data:{feedName:m,filterName:l,lastId:b.lastId},success:function(n){if(m!=b.feedName||l!=b.filterName){return}_gaq.push(["_trackPageview",window.location.pathname]);$("#Feed-list").append(n);$(".shout-quick-reply.ubertext-me").uberText({limit:512,block:true,autogrow:true});if(m==="newsfeed"){saveListsFromContext()}},error:function(n){if(m!=b.feedName||l!=b.filterName){return}if(n.status==403){window.location.reload();return}$("#Feed-error").show();f=setTimeout(function(){k.nextPage()},5000)},complete:function(){if(m!=b.feedName||l!=b.filterName){return}g.nextPage=false;$("#Feed-loading").hide()}})};$(document.body).on("click",".Feed-load",function(l){l.preventDefault();k.load($(this).data("feedname"),$(this).attr("data-filtername"),$(this).attr("href"),this)});$("#Feed-reload").on("click",function(l){l.preventDefault();k.load(b.feedName,b.filterName)});$(window).scroll(function(){if($(window).scrollTop()+d>=$(document).height()-$(window).height()){k.nextPage()}});$(window).on("popstate",function(l){if(l.originalEvent.state){window.location.replace(l.originalEvent.state.path)}});$("#Feed-controls-popular .select-toggle").click(function(){var l=$(this),m=$("#Feed-controls-popular [data-for="+l.attr("id")+"]");m.toggle();$("#Feed-controls-popular .select-list").not(m).hide()});$("#Feed-controls-popular .select-list a").click(function(){var m=$(this),n=m.closest(".select-list"),l=n.siblings("a");l.find(".label").html(m.html());n.hide()});$("#Feed-controls-popular [data-popular-set]").click(function(n){var m=$(this),o=m.attr("data-popular-set").split(":"),l=$("#popular-options");l.attr("data-"+o[0],o[1]);l.attr("data-filtername",'{"sort":"'+l.attr("data-sort")+'","attachment":"'+l.attr("data-attachment")+'","interval":"'+l.attr("data-interval")+'"}');l.trigger("click");m.closest("li").siblings("li").find("a").removeClass("active");m.addClass("active");n.preventDefault()});if(b.feedName==="newsfeed"){saveListsFromContext()}Feed2=this}var Shout=new function(){};function htmlspecialchars(d,j,h,b){var f=0,e=0,g=false;if(typeof j==="undefined"||j===null){j=2}d=d.toString();if(b!==false){d=d.replace(/&/g,"&amp;")}d=d.replace(/</g,"&lt;").replace(/>/g,"&gt;");var a={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(j===0){g=true}if(typeof j!=="number"){j=[].concat(j);for(e=0;e<j.length;e++){if(a[j[e]]===0){g=true}else{if(a[j[e]]){f=f|a[j[e]]}}}j=f}if(j&a.ENT_HTML_QUOTE_SINGLE){d=d.replace(/'/g,"&#039;")}if(!g){d=d.replace(/"/g,"&quot;")}return d}var Mustache;(function(a){if(typeof module!=="undefined"&&module.exports){module.exports=a}else{if(typeof define==="function"){define(a)}else{Mustache=a}}}((function(){var w={};w.name="mustache.js";w.version="0.7.0";w.tags=["{{","}}"];w.Scanner=v;w.Context=t;w.Writer=r;var e=/\s*/;var n=/\s+/;var l=/\S/;var j=/\s*=/;var p=/\s*\}/;var u=/#|\^|\/|>|\{|&|=|!/;function q(z,y){return RegExp.prototype.test.call(z,y)}function h(y){return!q(l,y)}var m=Array.isArray||function(y){return Object.prototype.toString.call(y)==="[object Array]"};function g(y){return y.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function o(y){return String(y).replace(/[&<>"'\/]/g,function(z){return d[z]})}w.escape=o;function v(y){this.string=y;this.tail=y;this.pos=0}v.prototype.eos=function(){return this.tail===""};v.prototype.scan=function(z){var y=this.tail.match(z);if(y&&y.index===0){this.tail=this.tail.substring(y[0].length);this.pos+=y[0].length;return y[0]}return""};v.prototype.scanUntil=function(z){var y,A=this.tail.search(z);switch(A){case-1:y=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:y="";break;default:y=this.tail.substring(0,A);this.tail=this.tail.substring(A);this.pos+=A}return y};function t(y,z){this.view=y;this.parent=z;this.clearCache()}t.make=function(y){return(y instanceof t)?y:new t(y)};t.prototype.clearCache=function(){this._cache={}};t.prototype.push=function(y){return new t(y,this)};t.prototype.lookup=function(y){var B=this._cache[y];if(!B){if(y==="."){B=this.view}else{var A=this;while(A){if(y.indexOf(".")>0){var C=y.split("."),z=0;B=A.view;while(B&&z<C.length){B=B[C[z++]]}}else{B=A.view[y]}if(B!=null){break}A=A.parent}}this._cache[y]=B}if(typeof B==="function"){B=B.call(this.view)}return B};function r(){this.clearCache()}r.prototype.clearCache=function(){this._cache={};this._partialCache={}};r.prototype.compile=function(A,y){var z=this._cache[A];if(!z){var B=w.parse(A,y);z=this._cache[A]=this.compileTokens(B,A)}return z};r.prototype.compilePartial=function(z,B,y){var A=this.compile(B,y);this._partialCache[z]=A;return A};r.prototype.compileTokens=function(B,A){var z=f(B);var y=this;return function(C,E){if(E){if(typeof E==="function"){y._loadPartial=E}else{for(var D in E){y.compilePartial(D,E[D])}}}return z(y,t.make(C),A)}};r.prototype.render=function(A,y,z){return this.compile(A)(y,z)};r.prototype._section=function(y,z,G,F){var E=z.lookup(y);switch(typeof E){case"object":if(m(E)){var A="";for(var B=0,D=E.length;B<D;++B){A+=F(this,z.push(E[B]))}return A}return E?F(this,z.push(E)):"";case"function":var H=this;var C=function(J){return H.render(J,z)};var I=E.call(z.view,G,C);return I!=null?I:"";default:if(E){return F(this,z)}}return""};r.prototype._inverted=function(y,z,B){var A=z.lookup(y);if(!A||(m(A)&&A.length===0)){return B(this,z)}return""};r.prototype._partial=function(y,z){if(!(y in this._partialCache)&&this._loadPartial){this.compilePartial(y,this._loadPartial(y))}var A=this._partialCache[y];return A?A(z):""};r.prototype._name=function(y,z){var A=z.lookup(y);if(typeof A==="function"){A=A.call(z.view)}return(A==null)?"":String(A)};r.prototype._escaped=function(y,z){return w.escape(this._name(y,z))};function k(z){var B=z[3];var y=B;var A;while((A=z[4])&&A.length){z=A[A.length-1];y=z[3]}return[B,y]}function f(A){var y={};function z(B,E,D){if(!y[B]){var C=f(E);y[B]=function(G,F){return C(G,F,D)}}return y[B]}return function(H,F,G){var C="";var E,I;for(var D=0,B=A.length;D<B;++D){E=A[D];switch(E[0]){case"#":I=G.slice.apply(G,k(E));C+=H._section(E[1],F,I,z(D,E[4],G));break;case"^":C+=H._inverted(E[1],F,z(D,E[4],G));break;case">":C+=H._partial(E[1],F);break;case"&":C+=H._name(E[1],F);break;case"name":C+=H._escaped(E[1],F);break;case"text":C+=E[1];break}}return C}}function x(D){var y=[];var C=y;var E=[];var A,B;for(var z=0;z<D.length;++z){A=D[z];switch(A[0]){case"#":case"^":A[4]=[];E.push(A);C.push(A);C=A[4];break;case"/":if(E.length===0){throw new Error("Unopened section: "+A[1])}B=E.pop();if(B[1]!==A[1]){throw new Error("Unclosed section: "+B[1])}if(E.length>0){C=E[E.length-1][4]}else{C=y}break;default:C.push(A)}}B=E.pop();if(B){throw new Error("Unclosed section: "+B[1])}return y}function a(C){var B,y,z=[];for(var A=0;A<C.length;++A){B=C[A];if(y&&y[0]==="text"&&B[0]==="text"){y[1]+=B[1];y[3]=B[3]}else{y=B;z.push(B)}}return z}function s(y){if(y.length!==2){throw new Error("Invalid tags: "+y.join(" "))}return[new RegExp(g(y[0])+"\\s*"),new RegExp("\\s*"+g(y[1]))]}w.parse=function(K,M){M=M||w.tags;var L=s(M);var B=new v(K);var I=[],G=[],E=false,N=false;function z(){if(E&&!N){while(G.length){I.splice(G.pop(),1)}}else{G=[]}E=false;N=false}var y,H,J,C;while(!B.eos()){y=B.pos;J=B.scanUntil(L[0]);if(J){for(var D=0,F=J.length;D<F;++D){C=J.charAt(D);if(h(C)){G.push(I.length)}else{N=true}I.push(["text",C,y,y+1]);y+=1;if(C==="\n"){z()}}}y=B.pos;if(!B.scan(L[0])){break}E=true;H=B.scan(u)||"name";B.scan(e);if(H==="="){J=B.scanUntil(j);B.scan(j);B.scanUntil(L[1])}else{if(H==="{"){var A=new RegExp("\\s*"+g("}"+M[1]));J=B.scanUntil(A);B.scan(p);B.scanUntil(L[1]);H="&"}else{J=B.scanUntil(L[1])}}if(!B.scan(L[1])){throw new Error("Unclosed tag at "+B.pos)}I.push([H,J,y,B.pos]);if(H==="name"||H==="{"||H==="&"){N=true}if(H==="="){M=J.split(n);L=s(M)}}I=a(I);return x(I)};var b=new r();w.clearCache=function(){return b.clearCache()};w.compile=function(z,y){return b.compile(z,y)};w.compilePartial=function(z,A,y){return b.compilePartial(z,A,y)};w.compileTokens=function(z,y){return b.compileTokens(z,y)};w.render=function(A,y,z){return b.render(A,y,z)};w.to_html=function(B,z,A,C){var y=w.render(B,z,A);if(typeof C==="function"){C(y)}else{return y}};return w}())));Mustache.escape=function(a){return htmlspecialchars(a,["ENT_COMPAT","ENT_IGNORE"],"UTF-8",false)};function GoToNumber(d,e,a,b,g){var f=false;this.setNumbers=function(k,l){clearInterval(f);k=parseInt(k);l=parseInt(l);var m=+new Date(),n=k<l,h=n?l-k:k-l,j=Math.floor(a/h);if(!j){return g.apply(b,[l])}f=setInterval(function(){if(n){k++}else{k--}var o=(n?l-k:k-l)-Math.round((a-(+new Date()-m))/j);if(o!=0){if(n){k+=o}else{k-=o}}if(k==l||(n&&k>l)||(!n&&k<l)){k=l;g.apply(b,[k]);clearInterval(f);return}g.apply(b,[k])},j)};this.setNumbers(d,e);return this}function LiveStats(f,d,b){var a={};for(var e in b["new"]){(function(){var g=$(d).find('[data-stats="'+e+'"]');if(g.length==0){return}a[e]=new GoToNumber(b.old[e],b["new"][e],60000,this,function(h){g.html(my_number_format(h))})})()}Realtime.addChannel(f,this,function(h){for(var g in b["new"]){if(g in a){a[g].setNumbers(h.old[g],h["new"][g])}}})}function LiveList(f,b,a,e){var d=false;$(b).on("mouseenter",function(){d=true}).on("mouseleave",function(){d=false});Realtime.addChannel(f,this,function(j){if(d){return}var h=$(b).children();for(var g=h.length-1;g>a-2;g--){$(h[g]).remove()}var k=$(Mustache.render(e,j)).hide().fadeIn(400);$(b).prepend(k)})}function HomePostsRealtime(a,b){if(typeof a==="undefined"||typeof b==="undefined"){return false}LiveList(a.lastComments,$("#lastCommentsBox-data"),10,$("#Mustache_lastComments").html());LiveList(a.lastPosts,$("#lastPostsBox-data"),50,$("#Mustache_lastPosts").html());LiveStats(a.stats,$("#estadisticasBox"),b);HomePostsRealtime=this}function HomeCommunitiesRealtime(a,b){if(typeof a==="undefined"||typeof b==="undefined"){return false}LiveList(a.lastComments,$("#lastCommentsBox-data"),10,$("#Mustache_lastComments").html());LiveList(a.lastTopics,$("#lastTopicsBox-data"),20,$("#Mustache_lastTopics").html());LiveStats(a.stats,$("#estadisticasBox"),b);HomeCommunitiesRealtime=this}function HomeCommunityRealtime(a){if(typeof a==="undefined"){return false}LiveList(a.lastComments,$("#lastCommentsBox-data"),10,$("#Mustache_lastComments").html());LiveList(a.lastTopics,$("#comm-thread-list"),20,$("#Mustache_lastTopicsCommunity").html());HomeCommunityRealtime=this}function TopicRealtime(a){if(typeof a==="undefined"){return false}LiveList(a.lastComments,$("#lastCommentsBox-data"),10,$("#Mustache_lastComments").html());TopicRealtime=this}$.request=(function(){var counter=0;var hide=function(element){$(element).css({left:-1000,position:"absolute",top:-1000})};var uploadCallback=function(object,options){var xml={};try{if(object.contentWindow){xml.responseText=object.contentWindow.document.body?object.contentWindow.document.body.innerHTML:null;xml.responseXML=object.contentWindow.document.XMLDocument?object.contentWindow.document.XMLDocument:object.contentWindow.document}else{if(object.contentDocument){xml.responseText=object.contentDocument.document.body?object.contentDocument.document.body.innerHTML:null;xml.responseXML=object.contentDocument.document.XMLDocument?object.contentDocument.document.XMLDocument:object.contentDocument.document}else{xml=""}}}catch(e){}if(xml){var data=parseResponse(xml,options.dataType);if(data){options.success&&options.success(data);options.complete&&options.complete(data)}}};var parseResponse=function(r,type){var data=!type;data=type=="xml"||data?r.responseXML:r.responseText;if(!data){return null}if(type==="script"){$.globalEval(data)}else{if(type=="json"){eval("data = "+data)}else{if(type=="html"){$("<div>").html(data).evalScripts()}}}return data};return function(options){var ajaxSettings=jQuery.extend(true,{},$.ajaxSettings);$.extend(ajaxSettings,options);options=ajaxSettings;var abort=function(){iframe.unbind("load");iframe.remove()};counter++;var id="request-"+counter;var form=$("<form>");form.attr("id",id);form.attr("method",options.type);form.attr("action",options.url);form.attr("target",id);hide(form);for(var name in options.data){$('<input type="hidden" name="'+name+'" value="'+options.data[name]+'">').appendTo(form)}$('<input type="submit" value="Enviar">').appendTo(form);if(options.file){form.attr("enctype","multipart/form-data");var clone=$(options.file).clone(true);$(options.file).before(clone);$(options.file).appendTo(form)}var iframe=$('<iframe id="'+id+'" name="'+id+'">');if(window.ActiveXObject){if(typeof uri=="boolean"){iframe.attr("src","javascript:false")}else{if(typeof uri=="string"){iframe.attr("src",uri)}}}iframe.load(function(){uploadCallback(this,options)});hide(iframe);form.appendTo("body");iframe.appendTo("body");form.submit();return{abort:function(){iframe.off("load").remove()}}}}());(function(m,h){var d={baseUrl:"http://www.kn3.net/",domain:null,dataSignService:null};var j;var g=("withCredentials"in new XMLHttpRequest);var p=function(){if(d.domain!==null){document.domain=d.domain}};var r=function(y){var w=d.baseUrl+y;return w};var e=function(){if(j){j.abort()}};var l=function(w,y){if(!g){w=h.extend(w,{fixCrossDomain:true})}if(d.dataSignService===null){y(w)}else{j=h.ajax({type:"post",url:d.dataSignService,data:w,dataType:"json",success:y})}};var v=function(w){w=h.extend({file:null,values:{},start:function(){},success:function(){},error:function(){},progress:function(){}},w);w.start();a(r("image/upload"),w.file,w.values,w.success,w.error,w.progress)};var o=function(w){w=h.extend({url:"",values:{},success:function(){},error:function(){}},w);if(!w.url){return}w.values=h.extend(w.values,{url:w.url});s(r("image/import"),w.values,w.success,w.error)};var t=function(w){w=h.extend({canvas:null,values:{},success:function(){},error:function(){}},w);if(!w.canvas){return null}b(r("image/save"),h(w.canvas).get(0).toDataURL(),w.values,w.success,w.error)};var f=function(w){w=h.extend({url:"",values:{},coor:{x1:0,x2:0,y1:0,y2:0},success:function(){},error:function(){}},w);if(!w.url){return}w.values=h.extend(w.values,{url:u(w.url),x1:w.coor.x1,x2:w.coor.x2,y1:w.coor.y1,y2:w.coor.y2});s(r("image/crop"),w.values,w.success,w.error)};var x=function(y,z,w){y=u(y);return y.replace(/\/([^\/]+)$/,"/"+z+"x"+w+"_$1")};var s=function(z,w,A,y){p();l(w,function(B){n({url:z,values:B,success:A,error:y})})};var b=function(z,A,w,B,y){p();l(w,function(C){n({url:z,values:h.extend(C,{data:A}),success:B,error:y})})};var a=function(A,B,w,C,z,y){p();l(w,function(D){n({url:A,values:D,file:B,success:C,error:z,progress:y})})};var u=function(y){if(typeof y==="string"){var w=y}else{var w=y.url}return w};var k=function(w){w=h.extend({url:"",values:{},file:false,success:function(){},error:function(){},progress:function(){}},w);var y=new FormData();h.each(w.values,function(A,z){y.append(A,z)});if(w.file){y.append("file",w.file[0].files[0])}j=h.ajax({url:w.url,type:"POST",dataType:"json",contentType:false,processData:false,data:y,xhr:function(){var z=h.ajaxSettings.xhr();if(w.file&&z.upload){z.upload.addEventListener("progress",function(A){w.progress(A.loaded*100/A.total)},false)}return z},success:function(z){if(z&&!z.error){w.success(z)}else{w.error(z)}},error:w.error,complete:function(z){if(w.file&&w.file.val){w.file.val("")}}})};var q=function(w){w=h.extend({url:"",values:{},file:false,success:function(){},error:function(){}},w);j=h.request({type:"post",url:w.url,file:w.file,data:w.values,dataType:"json",success:function(y){if(y&&!y.error){w.success(y)}else{w.error(y)}}})};if(g){var n=k}else{var n=q}m.Kn3Client={configure:function(w){h.extend(d,w)},upload:v,fromUrl:o,save:t,crop:f,resize:x,corsSupported:g,abort:e,thumbnail:x}}(window,jQuery));Object.keys=Object.keys||(function(){var b=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=a.length;return function(j){if(typeof j!="object"&&typeof j!="function"||j===null){throw new TypeError("Object.keys called on a non-object")}var f=[];for(var g in j){if(b.call(j,g)){f.push(g)}}if(e){for(var h=0;h<d;h++){if(b.call(j,a[h])){f.push(a[h])}}}return f}})();var Form={editing:null,lang:"es",dialog:$(".dialog-preview"),element:$("#newPost"),error:function(e,f){var d=this.getItem(e),a=d.find(".error_box"),b=f?f:a.data("text");d.addClass("error");a.html(b);gaTracker.trackEvent("Agregar.Error.Creacion",Form.type==="post"?"Post":"Tema",b)},valid:function(b){var a=this.getItem(b);a.removeClass("error")},isValid:function(b){var a=this.getItem(b);return!a.hasClass("error")},validate:function(e){var b=e?"="+e:"";if($("#resizable_post").css("visibility")!="hidden"&&!$.browser.msie){var d=$($("#iframe-editor").get(0).contentWindow.document.body).html();if(d){$(".post-create .form-item [name=cuerpo]").val($.html2bbcode(d))}}$(".post-create .form-item [name"+b+"]").each(function(h,k){switch($(this).attr("name")){case"image":case"categoria":if(!$.trim($(this).val())){Form.error(this)}else{Form.valid(this)}break;case"cuerpo":var j=$.trim($(this).val());if(!j){Form.error(this)}else{if(j.length>65000){Form.error(this,"El contenido es demasiado largo.")}else{Form.valid(this)}}break;case"titulo":var o=$.trim($(this).val()),n=65;if(!o||$(this).val()===$(this).attr("placeholder")){Form.error(this)}else{if(o.length>n){Form.error(this,"El ttulo es demasiado largo ("+n+" caracteres)")}else{if(Form.getUpperPercent(o)>50&&o.length>3){Form.error(this,"El ttulo contiene demasiadas letras maysculas")}else{Form.valid(this)}}}break;case"tags":if(!this.value){Form.error(this);return}var g=this.value.split(","),q={},m=0;for(var h=0,l=g.length;h<l;h++){var p=$.trim(g[h]).replace(/\s+/," ");if(/[\w]{3,}/.test(p)){m++;if(q[p]){q[p]++}else{q[p]=1}}else{Form.error(this,'"'+p+'" no es un tag vlido');return}}if(m<4){Form.error(this,"Ingresa 4 tags como mnimo")}else{if(m==4&&Object.keys(q).length<4){Form.error(this,"Los tags deben ser distintos entre s")}else{Form.valid(this)}}break;case"own-source":if($(this).val()==0&&!Form.countSources()){Form.error(this)}else{Form.valid(this)}break;case"image_1x1":var f=$.trim($(this).val());if(!f){Form.error(this)}else{Form.valid(this)}break}});if(!e&&Form.countErrors()){var a=null;$(".form-item.error").each(function(f){if(a==null||($(this).offset().top<$(a).offset().top)){a=this}});$(a).goTo()}},submit:function(){postSave()},showSocialVinculation:function(a){$(".dialog-preview").dialog("close");$(".modal-share.choose").dialog({width:500,modal:true,resizable:false,closeOnEscape:false,draggable:false,dialogClass:"new-modal-dialog",open:function(e,g){var b=this;var f=$('input[name="facebook-vinculation"]').val()!="false";var d=$('input[name="twitter-vinculation"]').val()!="false";$(this).parent().find("button").data("url",a);if(f){$(b).find(".fb-post").hide()}if(d){$(b).find(".tw-post").hide()}}})},showPostCreated:function(d){$(".dialog-preview").dialog("close");var a=Form.type==="post"?"post":"tema";var b=Form.editing?"El "+a+" fue guardado con xito":"El "+a+" fue agregado con xito";$(".dialog-preview").html(b).dialog({modal:true,resizable:false,draggable:false,closeOnEscape:false,dialogClass:null,width:"auto",position:"center",title:"Publicado",open:function(){$(this).parent().find(".ui-dialog-titlebar-close").hide();if(!Form.editing&&gaTracker){gaTracker.trackEvent("Agregado.Compartir.Facebook",$("#fb-check").is(":checked")?"si":"no")}},buttons:[{text:"Ir al "+a,"class":"ui-button-positive box-shadow-soft floatL ui-button-blue",click:function(){window.location.href=d}}]}).dialog({position:"center"})},originalContents:null,showPreview:function(){var b=$("input[name=titulo]").val(),a=$("textarea[name=cuerpo]").val();$.ajax({type:"post",url:"/preview.php",data:{cuerpo:$("textarea[name=cuerpo]").val()},success:function(d){var g=$("input[name=titulo]").val(),f='<h1 class="post-title">'+htmlspecialchars(g)+"</h1>"+d;if(f){$("#full-col").hide();Form.originalContents=$("#full-col");Form.originalContents.attr("id","original-contents");var e=$('<div id="full-col" class="new-preview"><div class="hreview-aggregate"><div>'+f+"</div></div></div>");$(e).insertBefore(".preview-buttons");$(".preview-buttons").show();if(Form.countErrors()===0){$("#formAlert").show().goTo()}}}})},fastPreview:function(){var b=$("input[name=titulo]").val(),a=$("textarea[name=cuerpo]").val();a=$.trim(a);if(b==""||a==""){if(b==""&&a==""){Form.error($("input[name=titulo]"),"Ingresa el ttulo del post para una vista previa");Form.error($("textarea[name=cuerpo]"),"Ingresa el cuerpo del post para una vista previa")}if(b==""&&a!=""){Form.error($("input[name=titulo]"),"Ingresa el ttulo del post para una vista previa")}if(b!=""&&a==""){if(!a){Form.error($("textarea[name=cuerpo]"),"Ingresa el cuerpo del post para una vista previa")}else{if(a.length>65000){Form.error($("textarea[name=cuerpo]"),"El cuerpo es muy largo, mximo 65000 caracteres")}}}return false}this.dialog.dialog({modal:true,resizable:false,draggable:false,title:"Previsualizacin",position:"center",buttons:{},open:function(d,e){Form.dialog.html('<div class="large-spinner"></div>').css("min-height","");$.ajax({type:"post",url:"/preview.php",data:{cuerpo:$("textarea[name=cuerpo]").val()},success:function(f){var h=$("input[name=titulo]").val(),g='<h1 class="post-title">'+htmlspecialchars(h)+"</h1>"+f;Form.dialog.dialog("close").html(g);Form.dialog.dialog({modal:true,resizable:false,draggable:false,width:720,height:500,position:"center",title:"Previsualizacin",buttons:[{text:"Cerrar","class":"ui-button-blue box-shadow-soft floatR",click:function(){$(this).dialog("close")}}],open:function(){}})}})}})},countErrors:function(){return $(".form-item.error").length},countSources:function(){return $(".source").length},getUpperPercent:function(e){var b=e.replace(/([A-Z])+/g,"").length,a=e.replace(/([a-zA-Z])+/g,"").length,d=(e.length-b)/(e.length-a)*100;return d},getItem:function(b){var a=typeof b==="string"?$("[name="+b+"]"):$(b);return a.closest(".form-item")},resetTooltips:function(){$(".tip").fadeOut();$(".lightbulb").removeClass("hover")},init:function(){$(".thumbnail-upload-button").on("click",function(g){if(g.offsetX>0){ImagePicker.open({},function(h){Form.valid("image");$(".thumbnail-upload-button").text("Cambiar imagen");$(".thumbnail-preview").attr("src",h.error);$("input[name=image]").val(h.error);this.close()})}});$("body").on("click",".image-picker-upload-button",function(){$("#image-picker-file").trigger("click")});$("body").on("click",".image-picker-import-button",function(){var g=$(this).siblings("input"),j=$.trim(g.val()),h=/^https?:\/\/.*\.(png|jpe?g|gif)/i;if(h.test(j)){if(ImagePicker.markItUpObject){ImagePicker.markItUpObject.replaceWith="";ImagePicker.callback({no:0,error:j})}else{ImagePicker["import"](j)}}else{ImagePicker.error("URL invlida")}});$("#showPreview").click(function(){Form.validate();if(Form.isValid("titulo")&&Form.isValid("cuerpo")){Form.showPreview()}});$("#publish").click(function(){Form.validate();if(!Form.countErrors()){Form.submit()}});$(".preview-buttons .back").click(function(){$(".preview-buttons").hide();$("#full-col").remove();$("#formAlert").hide();Form.originalContents.attr("id","full-col");Form.originalContents.show()});$("#fastPreview").click(function(){Form.fastPreview()});$("#saveDraft").click(function(g){g.preventDefault();Drafts.push()});$(".post-create").on("click",".icon.emoji:visible",function(){var h=$("#markItUp").get(0),g={action:"insertHtml",replaceWith:$(this).data("hotkey")};h.tagInsert(g,'<img src="'+global_data.img+"images/smiles/"+$(this).data("name")+'.gif"/>');$.markItUp({action:"insertHtml",replaceWith:" "+$(this).data("hotkey")+" "})});$(".lightbulb").click(function(g){if(!$(this).siblings(".tip").is(":visible")){Form.resetTooltips();$(this).addClass("hover");$(this).siblings(".tip").fadeIn();g.stopPropagation()}});$(".tip .close").click(function(){Form.resetTooltips()});$(document).click(function(g){if(!$(g.target).is(".tip")&&$(g.target).parents().filter(".tip").length==0){Form.resetTooltips()}});$(window).resize(function(){$(".ui-dialog-content").dialog("option","position","center")});var b=false;$(window).resize(function(){var j=$("#markItUp").get(0);var g=j.view=="html"?$("#resizable_post"):$("#markItUp");var n=$(window).scrollTop()>=$(".markItUpHeader").offset().top+$(".markItUpHeader").height();var h=$(window).scrollTop()<=g.offset().top;var l=$(window).scrollTop()>=g.offset().top+g.height()-100;var k=g.offset().left;var m=$(window).scrollLeft();if(b){$(".markItUpHeader").css("left",(k-m)+"px")}});$(window).scroll(function(){var j=$("#markItUp").get(0);var g=j.view=="html"?$("#resizable_post"):$("#markItUp");var n=$(window).scrollTop()>=$(".markItUpHeader").offset().top+$(".markItUpHeader").height();var h=$(window).scrollTop()<=g.offset().top;var l=$(window).scrollTop()>=g.offset().top+g.height()-100;var k=g.offset().left;var m=$(window).scrollLeft();if(n&&!l&&!b){b=true;$(".markItUpHeader").css("position","fixed");$(".markItUpHeader").css("top","0px");$(".markItUpHeader").css("border-top-left-radius","0px");$(".markItUpHeader").css("border-top-right-radius","0px")}else{if((h||l)&&b){b=false;$(".markItUpHeader").css("position","relative");$(".markItUpHeader").css("top","auto");$(".markItUpHeader").css("left","auto");$(".markItUpHeader").css("border-top-left-radius","5px");$(".markItUpHeader").css("border-top-right-radius","5px")}}if((!h&&!l)&&b){$(".markItUpHeader").css("left",(k-m)+"px")}if($(".ui-dialog-content").dialog("isOpen")){$(".ui-dialog-content").dialog("option","position","center")}if($(".dialog-preview").dialog("isOpen")){$(".dialog-preview").dialog("option","position","center")}$(".button-tooltip, .button-tooltip-tip").remove()});$(".markItUpHeader a").each(function(){$(this).removeAttr("title")});$(".markItUpHeader ul:first li").not("ul ul li").not(".markItUpButton10").not(".markItUpSeparator").each(function(){var k=$(this).find("a:first").text();var g={avanzado:"Vista Avanzada (Ctrl+D)",simple:"Vista simple (Ctrl+S)",link:"Insertar Link (Ctrl+K)"};k=g[k]||k;var j=$('<div class="button-tooltip">'+k+"</div>");var h=$('<div class="button-tooltip-tip"></div>');$(this).mouseenter(function(){if($(".markItUpHeader").css("position")!="fixed"){$(this).append(j);$(this).append(h);var o=parseInt($(this).css("width"));var n=parseInt(j.css("width"));j.css("position","fixed");var l=h.offset().top-$(window).scrollTop()-j.height();var m=h.offset().left-$(window).scrollLeft()-(n/2);j.css("top",l);j.css("left",m)}});$(this).mouseleave(function(){$(this).find(".button-tooltip, .button-tooltip-tip").remove()})});$(".fb-share-label").click(function(){if(!$(this).parent().find(".facebook-share-box").is(":checked")){$(this).parent().find(".facebook-share-box").attr("checked",true);$(this).parent().find("span").addClass("checked")}else{$(this).parent().find(".facebook-share-box").removeAttr("checked");$(this).parent().find("span").removeClass("checked")}});$(".tw-share-label").click(function(){if(!$(this).parent().find(".twitter-share-box").is(":checked")){$(this).parent().find(".twitter-share-box").attr("checked",true);$(this).parent().find("span").addClass("checked")}else{$(this).parent().find(".twitter-share-box").removeAttr("checked");$(this).parent().find("span").removeClass("checked")}});$(".thumbnail-container .ver-ejemplo").click(function(){$(".modal-ejemplo.choose").dialog({width:765,modal:true,resizable:false,draggable:false,dialogClass:"new-modal-dialog",open:ModalImage.onOpenModal,buttons:[{text:lang.Ok,"class":"btn a wide floatR",click:function(){$(this).dialog("close")}}]})});$(".form-item :input[name]:not(:hidden, input:checkbox)").on("blur",function(){if($(this).val()){Form.validate(this.name)}}).on("focus",function(){Form.valid(this.name)});$('label[for="markItUp"]').on("click",function(){$("#markItUp").get(0).setFocus()});$(".modal-video").on("keyup input",".new-modal-dialog-url-input",function(h){var g=$(".modal-video");var j=$(this).val().match(/(?:v=|v\/|embed\/)([-_a-z0-9]+)/i)||$(this).val().match(/vimeo.com\/([-_a-z0-9]+)/i)||[];if(j[1]){g.parent().find(".floatR").button("enable")}else{g.parent().find(".floatR").button("disable")}});$(".new-modal").on("keydown",".new-modal-dialog-url-input",function(h){if(h.which==13){var g=$(this).closest(".new-modal");if(!g.parent().find(".floatR").button("option","disabled")){g.parent().find(".floatR").click()}h.preventDefault()}});$("body").on("keyup input",".modal-link .new-modal-dialog-url-input",function(h){var g=$(".modal-link");if($(this).val().match(/^(?:(ftp|https?):\/\/[-\w]+(?:\.\w[-\w]*)+|(?:[a-z0-9](?:[-a-z0-9]*[a-z0-9])?\.)+(?:com\b|edu\b|biz\b|gov\b|in(?:t|fo)\b|mil\b|net\b|org\b|[a-z][a-z]\b))(?::\d+)?(?:\/[^.!,?;"'<>()\[\]{}\s\x7F-\xFF]*(?:[.!,?]+[^.!,?;"'<>()\[\]{}\s\x7F-\xFF]+)*)?$/)){g.parent().find(".floatR").button("enable")}else{g.parent().find(".floatR").button("disable")}});$(".modal-swf").on("keyup input",".new-modal-dialog-url-input",function(j){var g=$(".modal-swf");var h=/http:\/\/(?:\S+\.swf\b)/.test($(this).val());if(h){g.parent().find(".floatR").button("enable")}else{g.parent().find(".floatR").button("disable")}});var d=parseInt($("#markItUp").attr("tabindex"))-1;var a=parseInt($("#markItUp").attr("tabindex"))+1;$("#markItUp").on("keydown",function(g){if(g.shiftKey&&g.which==9){$("*[tabindex="+d+"]").focus()}});function f(h){if(typeof h.selectionStart=="number"){h.selectionStart=h.selectionEnd=h.value.length}else{if(typeof h.createTextRange!="undefined"){h.focus();var g=h.createTextRange();g.collapse(false);g.select()}}}$("*[tabindex="+d+"]").on("keydown",function(g){if($("#resizable_post").css("visibility")!="hidden"){if(!g.shiftKey&&g.which==9){g.preventDefault();$("#iframe-editor").get(0).contentWindow.postMessage("focuseditor","*")}}});$("*[tabindex="+a+"]").on("keydown",function(g){if($("#resizable_post").css("visibility")!="hidden"){if(g.shiftKey&&g.which==9){g.preventDefault();$("#iframe-editor").get(0).contentWindow.postMessage("focuseditor","*")}}});window.onmessage=function(h){h=h||event;var g;if(h.data=="tabback"){g=d}else{if(h.data=="tabforward"){g=a}}if(g){$("*[tabindex="+g+"]").focus();$("#iframe-editor").removeClass("focus")}};new onDelayedKeyup(".modal-image-from-url .new-modal-dialog-url-input",function(){var g=$(".modal-image-from-url");g.parent().find(".floatR").button("disable");var j=g.find(".new-modal-dialog-url-input").val();if(g.parent().find(".floatR .ui-button-text .analyzing-pic").length==0){g.parent().find(".floatR .ui-button-text").append($('<div class="analyzing-pic" />'));g.parent().find(".floatR .ui-button-text").css("color","silver")}var h=new Image();h.onload=function(){g.parent().find(".floatR .analyzing-pic").remove();g.parent().find(".floatR .ui-button-text").css("color","white");if(h.width){g.parent().find(".floatR").button("enable")}else{g.parent().find(".floatR").button("disable")}};h.onerror=function(){g.parent().find(".floatR .analyzing-pic").remove();g.parent().find(".floatR .ui-button-text").css("color","white");g.parent().find(".floatR").button("disable")};h.src=j},1000);$("button").click(function(g){g.preventDefault()});var e=$("#from-my-pc-label");e.click(function(g){g.stopPropagation()});e.on("mouseenter",function(){$(this).addClass("hover")});e.on("mouseleave",function(){$(this).removeClass("hover")});$(".markItUpButton10-1").empty();$(".markItUpButton10-1").append(e);$(".markItUpButton10 ul").on("mousenter mouseover",function(){DndFileUploadManager.startDrag(true)}).on("mouseleave mouseout",function(){DndFileUploadManager.endDrag(true)});$("#markItUp").trigger("input.highlightTextarea")}};function onDelayedKeyup(a,d,e){this.input=$(a);this.timeout=null;var b=this;this.input.on("keyup",function(g){if(b.timeout){clearTimeout(b.timeout);b.timeout=null}var f=function(){d();clearTimeout(b.timeout);b.timeout=null};b.timeout=setTimeout(f,e)})}var DndFileUploadManager={bbCodeContainer:null,wysiwygContainer:null,targetEl:null,thumbInputSelector:"#thumb-from-pc-input",thumbSelector:".empty-thumbnail",rteSelector:"#markItUp",targetElSelector:".file-upload-input-container",bbCodeContainerSelector:".highlightTextarea",wysiwygContainerSelector:"#resizable_post",errorMessage:"Error al subir imagenes.",isSimpleMode:function(){return $(DndFileUploadManager.rteSelector).get(0).view=="html"},hasTarget:function(a){return a.find(DndFileUploadManager.targetElSelector).length!=0},setTarget:function(a){a.append(DndFileUploadManager.targetEl)},draggingOverTarget:false,startDrag:function(a){if(DndFileUploadManager.isSimpleMode()&&!DndFileUploadManager.hasTarget(DndFileUploadManager.wysiwygContainer)){DndFileUploadManager.setTarget(DndFileUploadManager.wysiwygContainer)}else{if(!DndFileUploadManager.isSimpleMode()&&!DndFileUploadManager.hasTarget(DndFileUploadManager.bbCodeContainer)){DndFileUploadManager.setTarget($(DndFileUploadManager.bbCodeContainerSelector))}}DndFileUploadManager.targetEl.show();if(!a){$(DndFileUploadManager.thumbSelector).addClass("ezdz-enter");ImageThumb.show_drop_text()}var b=!!navigator.userAgent.match(/Trident.*rv\:11\./);if(b){DndFileUploadManager.targetEl.css("height","98%")}},endDrag:function(a){DndFileUploadManager.targetEl.hide();if(!a){$(DndFileUploadManager.thumbSelector).removeClass("ezdz-enter");ImageThumb.show_normal_text()}},drop:function(g){var f=[{files:g.dataTransfer.files}];if(DndFileUploadManager.containsFiles(g)){if($(g.target).is(DndFileUploadManager.thumbSelector)){if(g.dataTransfer.files&&g.dataTransfer.files[0].name.match(/^.*\.(png|jpe?g|gif)/i)){ImageThumb.upload_image("upload",{file:f,success:ImageThumb.handlerSuccessUpload})}else{Form.error($(".empty-thumbnail"),"El formato de la imagen es incorrecto.")}}else{if($(g.target).is(DndFileUploadManager.targetElSelector)||$(g.target).is(DndFileUploadManager.targetElSelector+" p")||$(g.target).is(DndFileUploadManager.rteSelector)){if(g.dataTransfer.files){ModalImage.startLoading();var d=g.dataTransfer.files.length;var b=g.dataTransfer.files.length;var h=false;for(var a=0;a<d;a++){if(g.dataTransfer.files[a].name.match(/^.*\.(png|jpe?g|gif)/i)){f=[{files:[g.dataTransfer.files[a]]}];Kn3Client.upload({values:{app:"images"},error:function(j){b--;h=true;if(!b){ModalImage.stopLoading();Form.error("cuerpo",DndFileUploadManager.errorMessage)}},file:f,success:function(e){b--;if(!b){ModalImage.stopLoading();if(h){setTimeout(function(){Form.error("cuerpo",DndFileUploadManager.errorMessage)},500)}}ModalImage.confirm(e.url)}})}else{b--;h=true;if(!b){ModalImage.stopLoading();Form.error("cuerpo",DndFileUploadManager.errorMessage)}}}}}}}},containsFiles:function(b){if(b.dataTransfer.types){for(var a=0;a<b.dataTransfer.types.length;a++){if(b.dataTransfer.types[a]=="Files"){return true}}}return false},init:function(){DndFileUploadManager.targetEl=$(DndFileUploadManager.targetElSelector);DndFileUploadManager.bbCodeContainer=$(DndFileUploadManager.bbCodeContainerSelector);DndFileUploadManager.wysiwygContainer=$(DndFileUploadManager.wysiwygContainerSelector);$(DndFileUploadManager.rteSelector+","+DndFileUploadManager.targetElSelector+","+DndFileUploadManager.targetElSelector+" p,"+DndFileUploadManager.thumbSelector).filedrop({allowedfiletypes:["image/jpeg","image/png","image/gif"],allowedfileextensions:[".jpg",".jpeg",".png",".gif"],maxfiles:25,maxfilesize:20,dragOver:function(){DndFileUploadManager.draggingOverTarget=true},dragEnter:function(a){if(DndFileUploadManager.containsFiles(a)){DndFileUploadManager.startDrag()}},dragLeave:function(){if(DndFileUploadManager.draggingOverTarget){DndFileUploadManager.endDrag()}},docEnter:function(a){DndFileUploadManager.draggingOverTarget=false;if(DndFileUploadManager.containsFiles(a)){DndFileUploadManager.startDrag()}},docLeave:function(a){DndFileUploadManager.endDrag()},drop:function(a){DndFileUploadManager.drop(a);DndFileUploadManager.endDrag()}})}};var Tags={updateValues:function(){var a=[];$(".fake-textarea .tag").each(function(b,d){a.push($(this).data("value"))});$("input[name=tags]").val(a.join(", "))},closeAutocomplete:function(){$(".tag-autocomplete").html("");Tags.unbindScroll()},focus:function(){$(".tag-input").focus()},blur:function(){$(".fake-textarea").removeClass("focus");var a=$(".tag-autocomplete .suggested-tag.active");if($(".fake-textarea .tag").length<10){if(a.length>0){Tags.add(a.data("value"))}else{Tags.add($(".tag-input").val())}}else{$(".tag-input").val("")}this.closeAutocomplete();$(".tag-suggest").hide()},add:function(b){if($(".fake-textarea .tag").length<10){var a=false;b=b.toString();$.each(b.split(","),function(e,f){if($(".fake-textarea .tag").length<10){f=$.trim(f);if(f){var d=tmpl("tag_tmpl",{tag:htmlspecialchars(f)});$(d).insertBefore(".tag-input-wrapper")}}else{if(!a){a=true;$(".tag-input").val("");$(".tag-input").css("color","black");Form.error($(".fake-textarea"),"El mximo de tags permitido es 10")}}});$(".tag-input").val("");this.updateValues()}else{$(".tag-input").val("");$(".tag-input").css("color","black");$(".tag-input").trigger("blur");Form.error($(".fake-textarea"),"El mximo de tags permitido es 10")}},query:function(a){if(!this.busy&&a){this.busy=true;this.lastInput=a;$.getScript("http://suggestqueries.google.com/complete/search?client=firefox&q="+encodeURIComponent(a)+"&hl=es&jsonp=Tags.autocomplete")}},autocomplete:function(b){this.busy=false;if($(".tag-input").val().length&&$(".tag-input").val()==this.lastInput){var e=b[1],a=e.length>6?6:e.length,d="";for(i=0,c=a;i<c;i++){if(/[\w]{3,}/.test(e[i])){d+=tmpl("tag_suggest_tmpl",{tag:e[i],highlighted:e[i].replace(b[0],"<strong>"+b[0]+"</strong>")})}}$(".tag-autocomplete").html(d);$(".tag-autocomplete").css("top",$(".tag-input-wrapper")[0].getBoundingClientRect().top+$(".tag-input-wrapper").height());$(".tag-autocomplete").css("left",$(".tag-input-wrapper")[0].getBoundingClientRect().left);this.bindToScroll()}else{if($(".tag-input").val()!=this.lastInput){this.query($(".tag-input").val())}}},positionAutocomplete:function(a){$(".tag-autocomplete").css("top",$(".tag-input-wrapper")[0].getBoundingClientRect().top+$(".tag-input-wrapper").height());$(".tag-autocomplete").css("left",$(".tag-input-wrapper")[0].getBoundingClientRect().left)},bindToScroll:function(){$(window).on("scroll",this.positionAutocomplete)},unbindScroll:function(){$(window).off("scroll",this.positionAutocomplete)},init:function(){Tags.initialized=true;Array.prototype.filter=Array.prototype.filter||function(e,f){var a=[],b;for(var d=0,g=this.length;d<g;d++){if(d in this&&e.call(f,b=this[d],d,this)){a.push(b)}}return a};Array.prototype.indexOf=Array.prototype.indexOf||function(b,a){if(a===undefined){a=0}if(a<0){a+=this.length}if(a<0){a=0}for(var d=this.length;a<d;a++){if(a in this&&this[a]===b){return a}}return-1};Array.prototype.diff=Array.prototype.diff||function(b){return this.filter(function(a){return!(b.indexOf(a)>-1)})};$(".fake-textarea").on("click",".tag strong",function(){$(this).parent().remove();Tags.focus();Form.valid("tags");Tags.updateValues()}).on("click",function(){Tags.focus();Form.valid("tags")}).on("blur",".tag-input",function(a){if(this.value&&$(".tag-autocomplete .suggested-tag.active").length>0){Tags.blur();Tags.closeAutocomplete()}}).on("keydown",".tag-input",function(e){var a=e.keyCode||e.charCode,g=$(".tag-autocomplete .suggested-tag.active"),f=$(".tag-autocomplete");if(a==13&&g.length){Tags.add(g.data("value"));e.preventDefault();Tags.focus();Tags.closeAutocomplete();return}if(a==27){this.value="";Tags.focus();Tags.closeAutocomplete()}if(a==13||a==188){e.preventDefault();if(this.value){Tags.add(this.value);Tags.focus();Tags.closeAutocomplete()}return}if((a==38||a==40)&&f.children().length){e.preventDefault();var g=f.find(".suggested-tag.active"),b=g.next(),d=g.prev();if(!b.length){b=f.children(":first")}if(!d.length){d=f.children(":last")}g.removeClass("active");if(a==38){d.addClass("active")}else{if(a==40){b.addClass("active")}}return}if(a==8&&!this.value.length){$(".fake-textarea .tag:last strong").trigger("click");Tags.focus();return}}).on("keyup",".tag-input",function(b){var a=b.keyCode||b.charCode;if(this.value.length&&(/[a-z0-9\s]/i.test(String.fromCharCode(a))||a==8)){Tags.query(this.value);return}else{if(!this.value.length){Tags.closeAutocomplete()}}}).on("focus",".tag-input",function(){$(".fake-textarea").addClass("focus")});$("body").on("click",function(a){var b=$(a.target);if(!b.is(".fake-textarea")&&!b.is(".tag-suggest")&&!b.is(".suggested-tag")&&!b.closest(".fake-textarea").length&&!b.closest(".tag-suggest").length){Tags.blur()}});$("#categoria-select, #source-input").on("focus",function(a){Tags.blur()});$(".tags-cont").on("click",".suggested-tag",function(){Tags.add($(this).data("value"));$(this).next().remove();$(this).remove();Tags.focus();Tags.closeAutocomplete();if(!$(".tags-cont .suggested-tag").length){$(".tag-suggest").hide()}});$("input[name=tags]").val()&&Tags.add($("input[name=tags]").val())}};var Drafts={input:$('input[name="borrador_id"]'),output:$("#responseDraft, #responseDraftBottom"),interval:null,cache:"",htmlCache:"",placeHolderTitle:"Nuevo borrador sin ttulo",same:function(){var a=$("#markItUp").get(0);if(a.view=="html"){var d=$($("#iframe-editor").get(0).contentWindow.document.body).html();if(d!=Drafts.htmlCache){Drafts.htmlCache=d;$("textarea[name=cuerpo]").val($.html2bbcode(d))}}var b=Form.element.serialize();if(b===this.cache){return true}else{this.cache=b;return false}},required:function(){var a=$("textarea[name=cuerpo]").val().length;if(!a){return false}return true},push:function(){if(Drafts.same()||!Drafts.required()){return}if(!$("input[name=titulo]").val()){$("input[name=titulo]").val(Drafts.placeHolderTitle).trigger("input.charCount");$("input[name=titulo]").val(Drafts.placeHolderTitle).trigger("keyup")}Drafts.id=Drafts.input.val();Drafts.output.text("Guardando en borradores...").css("color","#999999");var a=Form.type==="topic"?"/comunidades":"";$.ajax({type:"POST",dataType:"json",url:a+"/borradores-"+(Drafts.id?"guardar":"agregar")+".php",data:Form.element.serialize(),success:function(b){if(b.status==1){Drafts.output.text("Autoguardado en borradores.");setTimeout(function(){Drafts.output.text("")},2000);if(!Drafts.id){Drafts.input.val(b.data);Drafts.cache=Form.element.serialize()}}else{if(b.status==0){Drafts.output.html(b.data).css("color","red")}}}})},init:function(){this.interval=setInterval(function(){Drafts.push()},20000);this.cache=Form.element.serialize();$("#titulo-input").on("input keyup",function(a){if($("#titulo-input").val()===Drafts.placeHolderTitle){$("#titulo-input").val("");$("#titulo-input").attr("placeholder",Drafts.placeHolderTitle)}});if($("#titulo-input").val()===Drafts.placeHolderTitle){$("#titulo-input").val("");$("#titulo-input").attr("placeholder",Drafts.placeHolderTitle)}}};var Sources={data:null,restore:function(){for(var a=0,b=this.data.length;a<b;a++){this.add(this.data[a].url,this.data[a].id)}},add:function(a,b){$(tmpl("source_tmpl",{url:a,id:b})).appendTo(".sources-added");$("#source-input").val("")},check:function(a){$("#source-input, #source-add").addClass("ui-state-disabled");$.ajax({type:"POST",url:"/ajax/source/data-add",data:{url:a},dataType:"json",success:function(b){if(b.status){Sources.add(b.data.url,b.data.id)}else{this.error(b)}},complete:function(){$("#source-input, #source-add").removeClass("ui-state-disabled")},error:function(b){Form.error("own-source",b.data);$("#source-input").val("")}})},init:function(){this.restore();$(".sources-added").on("click",".source-delete",function(){$(this).parent().slideUp(200,function(){$(this).remove()})});$("#source-add").on("click",function(){var b=$.trim($("#source-input").val()).replace("http://","").replace("https://","");var a=$.map($(".sources-added .source span"),function(d,e){return $(d).text().replace("http://","")});if(!b){Form.error("own-source","El formato de la URL es incorrecto")}else{if(a.indexOf(b)!==-1){Form.error("own-source","Ya se agreg esa URL a las fuentes")}else{Sources.check(b)}}});$("#source-input").on("focus",function(){Form.valid("own-source")})}};var ImagePicker={modal:$(".image-picker.choose"),markItUpObject:null,open:function(a,d){if(a.external){this.external=true}if(a.markItUpObject){this.markItUpObject=a.markItUpObject}if(d){ImagePicker.callback=d}var b=$.extend({width:551,modal:true,resizable:false,buttons:[{text:"Cancelar","class":"floatR",click:ImagePicker.close}]},a);this.modal.dialog(b).dialog("open")},close:function(){ImagePicker.modal.dialog("close");ImagePicker.callback=null;ImagePicker.markItUpObject=null;ImagePicker.loading(false);ImagePicker.modal.find("input").val("");$("#image-picker-error").hide()},upload:function(a){this.loading(true);Kn3.upload(a,function(b){ImagePicker.loading(false);if(ImagePicker.callback){ImagePicker.callback(b);ImagePicker.callback=null}})},"import":function(a){this.loading(true);Kn3["import"](a,function(b){ImagePicker.loading(false);if(ImagePicker.callback){ImagePicker.callback(b)}})},error:function(a){$("#image-picker-error").text(a).stop().slideDown(200);setTimeout(function(){$("#image-picker-error").stop().slideUp(200)},4000)},loading:function(a){ImagePicker.modal.toggleClass("loading",a)}};var PostShare={check:function(a,b){a.find("input").attr("checked","checked");a.find("."+b+"-fake-input").addClass("checked")},unCheck:function(a,b){a.find("input").removeAttr("checked");a.find("."+b+"-fake-input").removeClass("checked")},disable:function(a){a.data("disabled",true);a.find("label").append($('<div class="analyzing-pic" />'));a.find("label").css("color","silver");a.find("label").css("opacity","0.5")},disableInput:function(a){a.data("disabled",true);a.siblings("label").css("opacity","0.5")},enable:function(a){a.data("disabled",false);a.find("label .analyzing-pic").remove();a.find("label").css("color","white");a.find("label").css("opacity","1")},enableInput:function(a){a.data("disabled",false);a.siblings("label").css("opacity","1")},isFbLinked:function(){return $('input[name="facebook-vinculation"]').val()!="false"},isTwLinked:function(){return $('input[name="twitter-vinculation"]').val()!="false"},setFbLink:function(a){$('input[name="facebook-vinculation"]').val(a?"true":"false")},setTwLink:function(a){$('input[name="twitter-vinculation"]').val(a?"true":"false")},getSocialOptions:function(a){$.ajax({type:"GET",dataType:"json",url:"/social_options.php",success:a})},init:function(){$(".modal-share.choose").on("click","button",function(d){var a=$(this).parent();var b={vinculation_offer:!a.find("#dont-show-again").is(":checked")};if(a.find('input[name="facebook"]').is(":checked")){b.facebook=true}if(a.find('input[name="twitter"]').is(":checked")){b.twitter=true}b.url=$(this).data("url");$.ajax({type:"POST",url:"/social_go_to_post.php",data:b,dataType:"json",success:function(e){window.location.href=b.url}})});$(".share").on("click",".fb-post input",function(d){var a=$(this),b=a.data("disabled")||false,f=a.is(":checked");if(!PostShare.isFbLinked()){if(f){PostShare.unCheck(a.parent(),"fb")}else{PostShare.check(a.parent(),"fb")}if(!b){PostShare.disableInput(a);if(f){associateFacebookAccount(function(e){PostShare.enableInput(a);PostShare.setFbLink(e);if(e){PostShare.check(a.parent(),"fb")}else{PostShare.unCheck(a.parent(),"fb")}})}}}});$(".share").on("click",".tw-post input",function(d){var a=$(this),b=a.data("disabled")||false,f=a.is(":checked");if(!PostShare.isTwLinked()){if(f){PostShare.unCheck(a.parent(),"tw")}else{PostShare.check(a.parent(),"tw")}if(!b){PostShare.disableInput(a);if(f){associateTwitterAccount(function(e){PostShare.enableInput(a);PostShare.setTwLink(e);if(e){PostShare.check(a.parent(),"tw")}else{PostShare.unCheck(a.parent(),"tw")}})}}}});$(".modal-share").on("click",".fb-post",function(d){var a=$(this),b=a.data("disabled")||false,f=a.find("input").is(":checked");if(f){PostShare.unCheck(a,"fb")}else{PostShare.check(a,"fb")}if(!b){PostShare.disable(a);if(f){associateFacebookAccount(function(e){PostShare.enable(a);PostShare.setFbLink(e);if(e){PostShare.check(a,"fb")}else{PostShare.unCheck(a,"fb")}})}else{Facebook.unlink(function(){PostShare.enable(a);PostShare.setFbLink(false);PostShare.unCheck(a,"fb")})}}});$(".modal-share").on("click",".tw-post",function(d){var a=$(this),b=a.data("disabled")||false,f=a.find("input").is(":checked");if(f){PostShare.unCheck(a,"tw")}else{PostShare.check(a,"tw")}if(!b){PostShare.disable(a);if(f){associateTwitterAccount(function(e){PostShare.enable(a);PostShare.setTwLink(e);if(e){PostShare.check(a,"tw")}else{PostShare.unCheck(a,"tw")}})}else{$.ajax({type:"POST",url:"/twitter_unlink.php",success:function(e){PostShare.enable(a);switch(e){case"0":alert("Hubo en error al procesar tu solicitud, intntalo nuevamente");break;case"1":PostShare.unCheck(a,"tw")}}})}}})}};function PostCreate(b){var a=$.extend({kn3:{baseUrl:"http://www.kn3.net/",domain:"taringa.net"}},b);Kn3Client.configure($.extend(a.kn3,{dataSignService:"/ajax/kn3-signdata.php"}));Array.prototype.getUnique=function(){var f={},e=[];for(var g=0,d=this.length;g<d;++g){if(f.hasOwnProperty(this[g])){continue}e.push(this[g]);f[this[g]]=1}return e};return this}function postSave(a){var b=$('form[name="newpost"]').serialize();if(a){b+="&recaptcha_challenge_field="+encodeURIComponent($("#recaptcha_challenge_field").val())+"&recaptcha_response_field="+encodeURIComponent($("#recaptcha_response_field").val())}$(".dialog-preview").dialog("close").html('<div class="large-spinner"></div>').dialog({modal:true,resizable:false,draggable:false,width:"300",height:"auto",position:"center",title:Form.editing?"Guardando":"Publicando",buttons:{}});$.ajax({type:"POST",url:$('form[name="newpost"]').data("action"),data:b,dataType:"json",success:function(d){var h=d.data;switch(d.status){case 0:var f='<div class="error-icon"></div><div class="error-message">'+h+"</div>";$(".dialog-preview").html(f).dialog("close").dialog({modal:true,resizable:false,draggable:false,width:"auto",height:"auto",dialogClass:"new-modal-dialog",position:"center",title:"Error",open:ModalImage.onOpenModal,buttons:[{text:"Ok","class":"ui-button-blue box-shadow-soft long floatR",click:function(){$(this).dialog("close")}}]}).dialog({position:"center"});break;case 1:gaTracker.trackPageview("/agregar/agregado/");tracker.pushData("post",{category:h.category,categoryName:h.categoryName});tracker.pushEvent(h.action);window.onbeforeunload=function j(){};var e=$('input[name="vinculation_offer"]').val()!="false";var g=$('input[name="facebook"]').is(":checked");var k=$('input[name="twitter"]').is(":checked");if(((!g&&!PostShare.isFbLinked())||(!k&&!PostShare.isTwLinked()))&&e){Form.showSocialVinculation(h.absoluteUrl)}else{Form.showPostCreated(h.relativeUrl)}break;case 2:$.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){Recaptcha.create(h.relativeUrl,$(".dialog-preview")[0],{theme:"white",lang:Form.lang,callback:Recaptcha.focus_response_field});$(".dialog-preview").prepend("Ingresa el cdigo de la imagen:")});$(".dialog-preview").dialog({modal:true,resizable:false,draggable:false,width:"auto",position:"center",title:"Cdigo de la imagen",buttons:[{text:"Agregar","class":"ui-button-positive box-shadow-soft floatL",click:function(){postSave(true)}},{text:"Cancelar","class":"ui-button-cancel floatR",click:function(){$(this).dialog("close")}}]}).dialog({position:"center"});break;case 3:var f='<div class="error-icon"></div><div class="error-message">'+h+"</div>";$(".dialog-preview").html(f).dialog("close").dialog({modal:true,resizable:false,draggable:false,width:"auto",position:"center",dialogClass:"new-modal-dialog",title:"Error",open:ModalImage.onOpenModal,buttons:[{text:"Ok","class":"ui-button-blue box-shadow-soft long floatR",click:function(){postSave()}}]}).dialog({position:"center",});break}},error:function(f){var e;if(f.status==404){e="Parece que tu conexion a internet esta fallando, no se puede acceder al servidor"}else{if(500){e="Hubo un error al procesar lo solicitado"}}var d='<div class="error-icon"></div><div class="error-message">'+e+"</div>";$(".dialog-preview").html(d).dialog("close").dialog({modal:true,resizable:false,draggable:false,width:"auto",height:"auto",position:"center",dialogClass:"new-modal-dialog",title:"Error",open:ModalImage.onOpenModal,buttons:[{text:"Ok","class":"ui-button-blue box-shadow-soft long floatR",click:function(){$(this).dialog("close")}}]})}})}var ImageThumb={minWidth:320,minHeight:320,thumb_panes:[".thumbnail-preview",".empty-thumbnail",".thumbnail-choose-source",".thumbnail-url-container",".thumbnail-upload-progress",".images-from-post-container"],preview_1_1_width:$(".step.crop .cropPreviews .preview_1_1").width(),preview_1_1_height:$(".step.crop .cropPreviews .preview_1_1").height(),preview_1_1_img:$(".step.crop .cropPreviews .preview_1_1 img"),preview_1_1_coors:{x1:0,x2:0,y1:0,y2:0},preview_4_3_width:$(".step.crop .cropPreviews .preview_4_3").width(),preview_4_3_height:$(".step.crop .cropPreviews .preview_4_3").height(),preview_4_3_img:$(".step.crop .cropPreviews .preview_4_3 img"),preview_4_3_coors:{x1:0,x2:0,y1:0,y2:0},jcrop_api:null,timerSimulateLoading:"",image:{},preview:{},pixel:{},modal:$(".thumbnail-picker-modal"),progressIndicator:$(".thumbnail-upload-progress"),error:function(a){ImageThumb.show_pane(".empty-thumbnail");Form.error($(".thumb-container"),a)},clear_error:function(){Form.valid($(".thumb-container"))},thumb_url:function(a){if(a!==undefined){$(".thumbnail-preview").attr("src",a)}return $(".thumbnail-preview").attr("src")},show_pane:function(b){for(var a=0;a<ImageThumb.thumb_panes.length;a++){$(ImageThumb.thumb_panes[a]).toggle(b==ImageThumb.thumb_panes[a])}$("#thumb-remove").toggle(b==".thumbnail-preview");$("#thumb-restart .select-image").toggle(b==".images-from-post-container");$("#thumb-restart").toggle(b!=".thumbnail-preview"&&b!=".empty-thumbnail");ImageThumb.clear_error()},reset_state:function(){if(ImageThumb.thumb_url()){ImageThumb.show_pane(".thumbnail-preview")}else{ImageThumb.show_pane(".empty-thumbnail")}},thumb_uploaded:function(a){ImageThumb.thumb_url(a.url);ImageThumb.reset_state()},handlerSuccessUpload:function(d){ImageThumb.image=d;ImageThumb.reset_progress_interval();if(ImageThumb.image.width<ImageThumb.minWidth||ImageThumb.image.height<ImageThumb.minHeight){var b="La imagen es muy pequea.<br>(Dimensiones mnimas requeridas: "+ImageThumb.minWidth+"x"+ImageThumb.minHeight+")";if(gaTracker){gaTracker.trackEvent("Agregar.Error.Thumbnail",Form.type==="post"?"Post":"Tema",b)}ImageThumb.error(b);return}var a=new Image();a.onload=function(){ImageThumb.preview={url:a.src,width:a.width,height:a.height};ImageThumb.pixel=new PixelRatio(ImageThumb.image.width,ImageThumb.preview.width);ImageThumb.crop_image_modal()};a.onerror=function(){var e="Error al subir la imagen";if(gaTracker){gaTracker.trackEvent("Agregar.Error.Thumbnail",Form.type==="post"?"Post":"Tema",e)}ImageThumb.error(e)};a.src=Kn3Client.thumbnail(ImageThumb.image.url,510,420)},crop_image_modal:function(){ImageThumb.show_pane(".empty-thumbnail");ImageThumb.modal.find(".step.crop .toCrop .imgToCrop, .step.crop .cropPreviews .cropPreview img").attr("src",ImageThumb.preview.url).css({width:ImageThumb.preview.width,height:ImageThumb.preview.height});if(ImageThumb.jcrop_api){ImageThumb.jcrop_api.destroy()}var b,a,e,d;if(ImageThumb.preview.width>ImageThumb.preview.height){a=(ImageThumb.preview.width-ImageThumb.preview.height)/2;x2=a+ImageThumb.preview.height;d=0;y2=ImageThumb.preview.height}else{a=0;x2=ImageThumb.preview.width;d=(ImageThumb.preview.height-ImageThumb.preview.width)/2;y2=d+ImageThumb.preview.width}ImageThumb.modal.find(".step.crop .toCrop .imgToCrop").Jcrop({aspectRatio:1,minSize:[ImageThumb.pixel.originalToPreview(ImageThumb.minWidth),ImageThumb.pixel.originalToPreview(ImageThumb.minHeight)],bgOpacity:0.25,onChange:ImageThumb.handlerShowPreview,onSelect:ImageThumb.handlerShowPreview,setSelect:[a,d,x2,y2]},function(){ImageThumb.jcrop_api=this});ImageThumb.helperChangeStep("crop");ImageThumb.modal.dialog({modal:true,resizable:false,draggable:false,dialogClass:"crop-dialog new-modal-dialog",width:769,height:537,title:"Recortar imagen",position:"center",buttons:[{text:"Cancelar","class":"ui-button-white box-shadow-soft floatL",click:function(){ImageThumb.helperCloseModal()}},{text:"Finalizar recorte","class":"ui-button-blue box-shadow-soft floatR",click:function(){ImageThumb.stepSave()}}]}).dialog({position:"center"})},stepImport:function(a){ImageThumb.stepProgress("Importando imagen",true);Kn3Client.fromUrl({url:a,values:{temp:true},success:ImageThumb.handlerSuccessUpload,error:function(b){ImageThumb.reset_progress_interval();ImageThumb.error(b.message)}})},stepProgress:function(d,a){ImageThumb.helperSetProgress(0);ImageThumb.show_pane(".thumbnail-upload-progress");a=!!a;ImageThumb.progressIndicator.find(".title-label").text(d);if(a){var b=0;ImageThumb.timerSimulateLoading=setInterval(function(){if(b==100){b=0}ImageThumb.helperSetProgress(b++)},25)}},stepSave:function(){var a,b;ImageThumb.helperCloseModal();ImageThumb.stepProgress("Cortando imagenes",true);ImageThumb.helperCrop(ImageThumb.image.url,ImageThumb.pixel.previewToOriginal(coords.x),ImageThumb.pixel.previewToOriginal(coords.x2),ImageThumb.pixel.previewToOriginal(coords.y),ImageThumb.pixel.previewToOriginal(coords.y2),function(d){a=d;var e=(a.height-(3*a.width/4))/2;ImageThumb.helperCrop(a.url,0,a.width,0,a.height-(e*2),function(f){b=f;$("input[name=image_1x1]").val(a.url);$("input[name=image_4x3]").val(b.url);$(".thumbnail-preview").attr("src",Kn3Client.thumbnail(b.url,154,116));ImageThumb.reset_progress_interval();ImageThumb.show_pane(".thumbnail-preview")})})},helperCrop:function(d,b,a,f,e,g){Kn3Client.crop({url:d,coor:{x1:Math.round(b),x2:Math.round(a),y1:Math.round(f),y2:Math.round(e)},success:function(h){g(h)},error:function(){ImageThumb.show_pane(".empty-thumbnail");ImageThumb.reset_progress_interval();ImageThumb.error("Error al cortar la imagen")}})},handlerShowPreview:function(e){coords=e;var f=ImageThumb.preview_1_1_width/coords.w,d=ImageThumb.preview_1_1_height/coords.h,b=$(".step.crop .imgToCrop").width(),a=$(".step.crop .imgToCrop").height();ImageThumb.preview_1_1_img.css({width:Math.round(f*b)+"px",height:Math.round(d*a)+"px",marginLeft:"-"+Math.round(f*coords.x)+"px",marginTop:"-"+Math.round(d*coords.y)+"px"});ImageThumb.preview_4_3_img.css({width:Math.round(f*b)+"px",height:Math.round(d*a)+"px",marginLeft:"-"+Math.round(f*coords.x)+"px",marginTop:"-"+Math.round(d*coords.y)+"px"})},helperSetProgress:function(a){a=Math.round(a);ImageThumb.update_progress_bar(a)},helperCloseModal:function(){Kn3Client.abort();if(ImageThumb.jcrop_api){ImageThumb.jcrop_api.destroy()}ImageThumb.reset_progress_interval();ImageThumb.modal.dialog("close")},helperChangeStep:function(a){ImageThumb.reset_progress_interval();ImageThumb.modal.children().hide();ImageThumb.modal.children("."+a).show()},valid_url:function(a){return(/^https?:\/\/.*\.(png|jpe?g|gif)/i).test(a)?a:null},validate_url:function(a){if(ImageThumb.valid_url(a)){ImageThumb.clear_error();return a}ImageThumb.error("La URL es invlida.");$("#thumb-url-input").val("");return null},update_progress_bar:function(a){ImageThumb.progressIndicator.find("#thumb-progress-bar > div").width(a.toString()+"%")},reset_progress_interval:function(){if(ImageThumb.timerSimulateLoading){clearInterval(ImageThumb.timerSimulateLoading)}},upload_image:function(b,a){ImageThumb.stepProgress("Subiendo imagen",true);Kn3Client[b]($.extend({values:{temp:true},error:function(e){ImageThumb.reset_progress_interval();var d;if(e.message.indexOf("5mb")==-1){d="Error al subir la imagen."}else{d=e.message}ImageThumb.error(d);if(gaTracker){gaTracker.trackEvent("Agregar.Error.Thumbnail",Form.type==="post"?"Post":"Tema",d)}}},a))},extract_images:function(d){var b=[],a=$(d).val(),f=[/\[img=(.*?)\]/ig,/\[img\](.*?)\[\/img\]/ig];for(var e=0;e<f.length;e++){while(match=f[e].exec(a)){if(match[1]){b.push(match[1])}}}return b},show_images_from_input:function(d){if($("#resizable_post").css("visibility")!="hidden"&&!$.browser.msie){var g=$($("#iframe-editor").get(0).contentWindow.document.body).html();if(g){$(".post-create .form-item [name=cuerpo]").val($.html2bbcode(g))}}var a=ImageThumb.extract_images(d);a=a.getUnique();var f=0;var b=[];if(a.length===0){ImageThumb.error("No se encontraron imgenes en el post");return}for(var e=0;e<a.length;e++){(function(j){var h=new Image();h.onload=function(){if(this.width>ImageThumb.minWidth&&this.height>ImageThumb.minHeight){b.push(this.src)}f++;if(f===a.length){if(!b.length){ImageThumb.error("No se encontraron imgenes vlidas en el post");return}ImageThumb.show_pane(".images-from-post-container");if($(".images-from-post-container").data("jsp")){$(".images-from-post-container").data("jsp").destroy()}$(".images-from-post-container").html(Mustache.render($("#Mustache_images_from_post").html(),b));$(".images-from-post-container").jScrollPane({verticalDragMaxHeight:70,verticalGutter:0})}};h.src=j}(a[e]))}},show_normal_text:function(){if($(".empty-thumbnail .dropzone-text-container .dropzone-text-normal").length==0){$(".empty-thumbnail .dropzone-text-container div").replaceWith($(".dropzone-texts .dropzone-text-normal").clone())}},show_drop_text:function(){if($(".empty-thumbnail .dropzone-text-container .dropzone-text-over").length==0){$(".empty-thumbnail .dropzone-text-container div").replaceWith($(".dropzone-texts .dropzone-text-over").clone())}},init:function(a){$(".empty-thumbnail").click(function(b){ImageThumb.show_pane(".thumbnail-choose-source")});$("#thumb-from-url").click(function(){ImageThumb.show_pane(".thumbnail-url-container")});$("#thumb-url-input-cancel, #thumb-restart .thumb-cancel-x").click(function(){ImageThumb.reset_state()});$("#thumb-remove").click(function(){$(".thumbnail-preview").attr("src","");$("input[name=image_1x1]").val("");$("input[name=image_4x3]").val("");ImageThumb.reset_state()});$("#thumb-upload-cancel").click(function(){ImageThumb.helperCloseModal();ImageThumb.reset_state()});$("#thumb-url-input").on("blur",function(){if($(this).val()!=""){ImageThumb.validate_url($.trim($(this).val()))}}),$("#thumb-url-input-ok").click(function(){var b=ImageThumb.validate_url($.trim($("#thumb-url-input").val()));if(!b){return}ImageThumb.upload_image("fromUrl",{url:b,success:ImageThumb.handlerSuccessUpload})});$("#thumb-from-pc-input").change(function(d){var b=$(this).val();if(b!==""){if(b.match(/^.*\.(png|jpe?g|gif)/i)){ImageThumb.upload_image("upload",{file:$(this),success:ImageThumb.handlerSuccessUpload})}else{Form.error(this,"El formato de la imagen es incorrecto.")}}});$("#thumb-from-post").click(function(){ImageThumb.show_images_from_input("textarea[name=cuerpo]")});$(".thumb-container").on("click",".images-from-post-container img",function(){ImageThumb.upload_image("fromUrl",{url:this.src,success:ImageThumb.handlerSuccessUpload})});ImageThumb.thumb_url(a);ImageThumb.reset_state()}};(function(a){a.fn.goTo=function(){a("html, body").animate({scrollTop:a(this).offset().top+"px"},"fast");return this}})(jQuery);(function(b){function a(d,e){return d.replace("%chars%",e)}b.fn.charCount=function(e){var h={afterEl:null,warningThreshold:0,template:"(%chars% restantes)",onlyFromThreshold:false,emulateMaxLength:false};e=b.extend({},h,e);var d=b(this).attr("maxlength");if(b(this).is("textarea")){b(this).removeAttr("maxlength");e.emulateMaxLength=true}var f=b(this).val().length||0;if(d){var j=b('<span class="charCount">'+a(e.template,d-f)+"</span>");var g=e.afterEl||b(this);if(!e.onlyFromThreshold){g.after(j)}b(this).on("keyup input.charCount",function(){var l=b(this).val().length;var k=d-l;var m=k<=e.warningThreshold;if(e.emulateMaxLength&&l>d){var n=b(this).val().slice(0,d);b(this).val(n)}if(!e.onlyFromThreshold||m&&k>=0){j.text(a(e.template,k))}if(e.onlyFromThreshold&&m&&k>=0){j.text(a(e.template,k));if(g.siblings(".charCount").length==0){g.after(j)}}if(m){j.css("color","#ff0000")}else{j.css("color","#999")}})}return this}})(jQuery);(function(a){a.fn.extend({scrollFixed:function(b){var d=a.extend({topSpacing:0,absoluteTopSpacing:null,parent:null},b);if(!d.absoluteTopSpacing){d.absoluteTopSpacing=d.topSpacing}var f=a(window),e=a(document);return this.each(function(){var h=a(this),o=d.parent?d.parent:h.parent(),k=a("<div></div>"),j=false,p=h.height(),n=h.offset().top,l=o.height(),m=o.offset().top;k.css("height",p);k.insertAfter(h);h.css("position","absolute");function g(q){var q=(typeof q!=="undefined"&&q===true);if(e.scrollTop()+d.topSpacing>n&&l+m-e.scrollTop()-p>0){if(!j){j=true;h.css({position:"fixed",top:d.topSpacing})}}else{if(j||q){j=false;if(l+m-e.scrollTop()-p>0){h.css({position:"absolute",top:""})}else{h.css({position:"absolute",top:l+m-p+d.absoluteTopSpacing})}}}}f.on("scroll",g);setInterval(function(){var q=false;if(h.height()!=p){p=h.height();k.css("height",p);q=true}if(k.offset().top!=n){n=k.offset().top;q=true}if(o.height()!=l){l=o.height();q=true}if(o.offset().top!=m){m=o.offset().top;q=true}if(q){g(true)}},1000)})}})})(jQuery);$(".fixme").scrollFixed({topSpacing:-15,parent:$($(".fixme").data("parent"))});$(".fixme-post").scrollFixed({topSpacing:5,absoluteTopSpacing:-50,parent:$($(".fixme-post").data("parent"))});$(".mobile-banner").on("click",function(){var d=$('link[rel=alternate][media="only screen and (max-width: 640px)"]'),b=document.domain.match(/[^\.]+\.[a-z]+$/)[0],a;if(d.length){a=d.attr("href")}else{a="http://m."+b}document.cookie="classic=0; path=/; domain="+b;location.href=a});$(document).ready(function(){if($("body").hasClass("section-post")){var d=0;var a=$(".social-side-bar");var b=$(".post-content").offset().top;$(".social-side-bar").css({marginTop:b-80});breakpointFixed=$(".icon-mensajes.share-bt").offset().top;$(window).on("scroll resize",function(){var f=$(window).scrollTop();var l=$(window).height();var h=$(".container-post").offset().left;var g=a.width();var j=$(".social-bar.top").offset().top;var k=$(".social-bar--bottom").offset().top;var e=$(".social-bar.top").height();if(f>=breakpointFixed-10){a.css({top:"-160px",marginTop:"0",position:"fixed",left:h-g})}else{a.css({top:"0",marginTop:b-80,position:"absolute",left:"0"})}if(f>=j+e){$(".social-side-bar a:nth-last-child(3)").css({transition:"all .25s .05s linear",opacity:"1",zIndex:"1"});$(".social-side-bar a:nth-last-child(2)").css({transition:"all .25s .10s linear",opacity:"1",zIndex:"1"});$(".social-side-bar a:nth-last-child(1)").css({transition:"all .25s .15s linear",opacity:"1",zIndex:"1"})}else{$(".social-side-bar a:nth-last-child(3)").css({transition:"all .25s .15s linear",opacity:"0",zIndex:"-1"});$(".social-side-bar a:nth-last-child(2)").css({transition:"all .25s .10s linear",opacity:"0",zIndex:"-1"});$(".social-side-bar a:nth-last-child(1)").css({transition:"all .25s .05s linear",opacity:"0",zIndex:"-1"})}if(f>=k-l){a.fadeOut("fast")}else{a.fadeIn("fast")}d=f})}});if(typeof nga==="undefined"){function nga(){}}var gaTracker={uniqueTracks:[],postId:null,postTitle:null,postCategory:null,homeV6Tab:null,homeV6Country:null,homeV6Category:null,globalCategory:null,geoFilter:null,shoutId:null,shoutType:null,error:null,trackEvent:function(d,b,a,f,g){var e="";if($(".v6 header").length>0){e="V6."}d=e+d;a=String(a);if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log(d+" - "+b+" - "+a||null)}_gaq.push(["_trackEvent",d,b,a||null,f||null,g||null]);nga("send","event",d,b,a||null,f||null);tracker.pushEvent(d)},trackPageview:function(a){_gaq.push(["_trackPageview",a]);nga("send","pageview",{page:a})},trackEventUnique:function(f,e,a,g,h,d){var b=d||(f+e);if(!this.uniqueTracks[b]){this.uniqueTracks[b]=true;this.trackEvent(f,e,a,g,h)}},getShoutType:function(b){var a="TEXT";if($(b).hasClass("image")){a="IMAGE"}else{if($(b).hasClass("video")){a="VIDEO"}else{if($(b).hasClass("link")){a="LINK"}}}return a},logPostRecentList:function(d,a,b){if(d>0){this.trackEvent(this.geoFilter+"."+this.globalCategory+".Posts.Recientes."+d,a+".Posicion",b)}else{this.trackEvent(this.geoFilter+"."+this.globalCategory+".Posts.Recientes",a+".Posicion",b)}},logTopPostsList:function(d,a,b){this.trackEvent(this.geoFilter+"."+this.globalCategory+".Top.Posts."+d,a+".Posicion",b)},logTopUsersList:function(d,a,b){this.trackEvent(this.geoFilter+"."+this.globalCategory+".Top.Usuarios."+d,a+".Posicion",b)},logFeaturedPostsList:function(d,a,b){this.trackEvent(this.geoFilter+"."+this.globalCategory+".Destacados."+d,a+".Posicion",b)},logRecentCommentsList:function(d,a,b){position=$("#lastCommentsBox-data .list-element").index($(d).closest("div.list-element"));position=position+1;this.trackEvent(this.geoFilter+"."+this.globalCategory+a,position+".Posicion",b)},logDropDownFilters:function(a,b){this.trackEvent(this.geoFilter+"."+this.globalCategory+a,b)}};$("#topsPostBox .time-tops-filter li").click(function(){period="Boton."+$(this).children("a").html();gaTracker.logDropDownFilters(".Top.Posts.Selector",period)});$("#topsUserBox .time-tops-filter li").click(function(){period="Boton."+$(this).children("a").html();gaTracker.logDropDownFilters(".Top.Usuarios.Selector",period)});$("#trendsPostBox .time-tops-filter li").click(function(){period="Boton."+$(this).children("a").html();gaTracker.logDropDownFilters(".Top.Destacados.Selector",period)});$(".show-paises-lista").click(function(){gaTracker.trackEvent(gaTracker.geoFilter+"."+gaTracker.globalCategory+".Paises","Desplegar")});$("#paises-lista li a").click(function(){var a=$(this).attr("data-country");gaTracker.trackEvent(gaTracker.geoFilter+"."+gaTracker.globalCategory+".Paises","Pais."+a)});$("#nav .notext").click(function(){gaTracker.trackEvent(gaTracker.geoFilter+"."+gaTracker.globalCategory+".Paises","Pais.Default")});$("#topsUserBox .not-following").click(function(){gaTracker.trackEvent(gaTracker.geoFilter+"."+gaTracker.globalCategory+".Top.Usuarios","Boton.Follow")});$("#topsUserBox .unfollowing").click(function(){gaTracker.trackEvent(gaTracker.geoFilter+"."+gaTracker.globalCategory+".Top.Usuarios","Boton.Unfollow")});$(".irCielo").click(function(){gaTracker.trackEvent("IrAlCielo","Boton.IrAlCielo")});$(".player-post").on("click",function(){gaTracker.trackEvent(gaTracker.geoFilter+"."+gaTracker.globalCategory+".GPlus","Boton.GPLUS")});$(".ga-create-post").click(function(){gaTracker.trackEvent("Posts.CrearPost","AbrirCreador")});$("#resultados-borradores a.borradores").on("click",function(){gaTracker.trackEvent("Posts.CrearPost","AbrirBorrador")});$("#resultados-borradores a.eliminados").on("click",function(){gaTracker.trackEvent("Posts.CrearPost","AbrirPostBajado")});$(".bt-prev").click(function(){gaTracker.trackEvent("Posts.CrearPost","PrevisualizarTotal");gaTracker.trackEventUnique("Posts.CrearPost","PrevisualizarUnico")});$(".bt-guar").click(function(){gaTracker.trackEvent("Posts.CrearPost","GuardarEnBorradores")});$("#body_comm").keypress(function(){if(gaTracker.postId){gaTracker.trackEventUnique("Posts.ComentarEscribir",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1)}});$("#comment-button-text").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.ComentarClick",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1)}});$("#point-bar a").click(function(){var a=$(this).attr("points");if(a<=10&&a>=0){gaTracker.trackEvent("Posts.DarPuntosVeces",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1);gaTracker.trackEvent("Posts.DarPuntosPromedio",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,a)}});$(".share-t").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1)}});$(".favorite-post-post").click(function(){gaTracker.trackEvent("Posts.Favoritos",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1)});$(".follow-post-post").click(function(){gaTracker.trackEvent("Posts.Seguir",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1)});$(".flag-post-post").click(function(){gaTracker.trackEvent("Posts.Denunciar",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1)});$(window).scroll(function(){if(gaTracker.postId){if($("#comments").is(":in-viewport")){gaTracker.trackEventUnique("Posts.ScrollAComments",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1)}}});$(".delete-post-button").click(function(){gaTracker.trackEvent("Posts.Borrar",gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1)});$(".top .taringa.sharer-button, .fixed .taringa.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","TA_top",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$(".top .twitter.sharer-button, .fixed .twitter.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","TW_top",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$(".top .google.sharer-button, .fixed .google.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","GP_top",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$(".top .facebook.sharer-button, .fixed .facebook.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","FB_top",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$(".bottom .taringa.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","TA_abajo",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$(".bottom .twitter.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","TW_abajo",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$(".bottom .google.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","GP_abajo",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$(".bottom .facebook.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","FB_abajo",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$(".email.sharer-button").click(function(){if(gaTracker.postId){gaTracker.trackEvent("Posts.Compartir","MAIL_abajo",gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)}});$("#sidebar .related .box-item").click(function(){item=$(this).attr("item");gaTracker.trackEvent("Recomendaciones.Abrir","Side"+item,gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)});$(".post-box.tops-medium .post-box-item").click(function(){item=$(this).attr("item");gaTracker.trackEvent("Recomendaciones.Abrir","PreComment"+item,gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)});$(".post-box.tops-large .post-box-item").click(function(){item=$(this).attr("item");gaTracker.trackEvent("Recomendaciones.Abrir","Abajo"+item,gaTracker.postCategory+gaTracker.postId+gaTracker.postTitle,1)});$("#my-shout-body-mi").focus(function(){gaTracker.trackEventUnique("Shouts.CrearShout","FocoEnInput")});$("#my-shout-body-mi").keydown(function(){gaTracker.trackEventUnique("Shouts.CrearShout","EmpiezaEscribir")});$(".my-shout-attach-image li a").click(function(){if($(this).attr("data-method")=="url"){gaTracker.trackEvent("Shouts.CrearShout","SubirImagenDesdeURL.Abrir")}});$(".my-shout-attach-options .video").click(function(){gaTracker.trackEvent("Shouts.CrearShout","AgregarVideo.Abrir")});$(".my-shout-attach-options .link").click(function(){gaTracker.trackEvent("Shouts.CrearShout","AgregarLink.Abrir")});$(".privacy-shout-0").click(function(){gaTracker.trackEvent("Shouts.CrearShout","CambiarPrivacidad","Todos")});$(".privacy-shout-1").click(function(){gaTracker.trackEvent("Shouts.CrearShout","CambiarPrivacidad","QuienSigo")});$(".privacy-shout-2").click(function(){gaTracker.trackEvent("Shouts.CrearShout","CambiarPrivacidad","Nadie")});$("#facebook-share").click(function(){if($(this).hasClass("ui-state-disabled")){gaTracker.trackEvent("Shouts.CrearShout","CambiarFB","Desactivar")}else{gaTracker.trackEvent("Shouts.CrearShout","CambiarFB","Activar")}});$("#twitter-share").click(function(){if($(this).hasClass("ui-state-disabled")){gaTracker.trackEvent("Shouts.CrearShout","CambiarTW","Desactivar")}else{gaTracker.trackEvent("Shouts.CrearShout","CambiarTW","Activar")}});$(".my-shout-add").click(function(){gaTracker.trackEvent("Shouts.CrearShout","CompartirClick")});$("#Feed-list a.avatar").click(function(){var a=$("#Feed-list .shout .activity-header a").html();gaTracker.trackEvent("ShoutFeed.Ver","UserFeed",a,1)});$("#Feed-list .activity-header a").click(function(a){var b=$(this).html();gaTracker.trackEvent("ShoutFeed.Ver","UserFeed",b,1)});$("#pins li").click(function(){var a=$(this).find("a").attr("data-filtername");gaTracker.trackEvent("ShoutFeed.Ver","Pins",a,1)});$("#tags-trendsBox li").click(function(){var a=$(this).find("a").attr("data-filtername");gaTracker.trackEvent("ShoutFeed.Ver","Hashtags",a,1)});$(".s-action-list .action-favorite").click(function(){if(!$(this).children("i").hasClass("favorite-color")){var a=gaTracker.getShoutType($(this).closest("div.activity-element"));var b=$(this).parent(".s-action-list").attr("data-id");gaTracker.trackEvent("Shouts.Favoritos",a,b,1)}});$(".s-action-list .action-vote").click(function(){var a=gaTracker.getShoutType($(this).closest("div.activity-element"));var b=$(this).parent(".s-action-list").attr("data-id");gaTracker.trackEvent("Shouts.MeGusta",a,b,1)});$(".s-action-list .action-reshout").click(function(){var a=gaTracker.getShoutType($(this).closest("div.activity-element"));var b=$(this).parent(".s-action-list").attr("data-id");gaTracker.trackEvent("Shouts.ReShout",a,b,1)});$(".s-action-list .action-activity").click(function(){var a=gaTracker.getShoutType($(this).closest("div.activity-element"));var b=$(this).parent(".s-action-list").attr("data-id");gaTracker.trackEvent("Shouts.VerActividad",a,b,1)});$("#body_comm").keypress(function(){if(gaTracker.shoutId){gaTracker.trackEventUnique("Shouts.ComentarEscribir",gaTracker.shoutType,gaTracker.shoutId,1)}});$("#comment-button-text").click(function(){if(gaTracker.shoutId){gaTracker.trackEvent("Shouts.ComentarClick",gaTracker.shoutType,gaTracker.shoutId,1)}});$(".v6-container nav ul li").click(function(){position=$(this).parent().children().index(this);switch(position){case 0:gaTracker.trackEvent("Home."+gaTracker.homeV6Country+".SelectorTipo","MasDestacado");break;case 1:gaTracker.trackEvent("Home."+gaTracker.homeV6Country+".SelectorTipo","EnAscenso");break;case 2:gaTracker.trackEvent("Home."+gaTracker.homeV6Country+".SelectorTipo","Recientes");break}});$(".taringa-musica li img").click(function(){albumTitle=$(this).attr("alt");gaTracker.trackEvent("Home.Musica","Tapa",albumTitle)});$(".taringa-musica li h4").click(function(){albumTitle=$(this).parent("li").find("img").attr("alt");gaTracker.trackEvent("Home.Musica","Nombre",albumTitle)});$(".taringa-musica li a.play").click(function(){albumTitle=$(this).parent("li").find("img").attr("alt");gaTracker.trackEvent("Home.Musica","Play",albumTitle)});$(".taringa-musica a.mas").click(function(){gaTracker.trackEvent("Home.Musica","MasMusica")});$(".shouts ul li a").click(function(){gaTracker.trackEvent("Home.Shout","VerShout")});$(".v6 .ico-notificaciones").click(function(){gaTracker.trackEvent("Perfil.BotonNotificaciones","BotonNotificaciones",location.pathname)});$(".v6 .ico-mensajes").click(function(){gaTracker.trackEvent("Perfil.BotonMensajes","BotonMensajes",location.pathname)});$(".v6 .ico-favoritos").click(function(){gaTracker.trackEvent("Perfil.BotonFavoritos","BotonFavoritos",location.pathname)});$(".v6-category ol li a").click(function(){if($(this).html()=="Todas las categoras"){analytics_cat="Home"}else{analytics_cat=$(this).html().replace(/ /g,"-")}gaTracker.trackEvent("Home.CambioCat",analytics_cat)});$(".v6-country li a").click(function(){var a=$(this).attr("data-country")!=0?$(this).attr("data-country"):"Global";gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Paises","Pais."+a)});$(".list-comentarios-recientes ul li a").on("click",function(){var a=$(this).attr("href");position=$("#lastCommentsBox li").index($(this).closest("li"));position=position+1;gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Comentarios.Recientes",position+".Posicion",a)});$(".list-top-posts ul li a").click(function(){var b="";var a=$(this).closest("ul").attr("class");console.log(a);switch(a){case"top-today":b="Today";break;case"top-yesterday":b="Yesterday";break;case"top-week":b="Week";break;case"top-month":b="Month";break;case"top-all":b="All";break}position=$("."+a+" li").index($(this).closest("li"));position=position+1;gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Top.Posts."+b,position+".Posicion",$(this).attr("href"))});$(".list-top-posts .action-select ol li a").click(function(){period=$(this).html();gaTracker.homeV6Category=gaTracker.homeV6Category=="General"?"Home":gaTracker.homeV6Category;gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Top.Posts.Selector","Boton."+period)});$("body").on("click",".v6 .content-left li div.meta a.usuario",function(){position=$(".v6 .content-left ul li").index($(this).closest("li"));position=position+1;var a="Destacados";switch(gaTracker.homeV6Tab){case"trending-hotness":a="Destacados";break;case"trending-momentum":a="Ascenso";break;case"recent":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a+".Autor",position+".Posicion","Autores")});$("body").on("click",".v6 .content-left li div.social-media a",function(){position=$(".v6 .content-left ul li").index($(this).closest("li"));position=position+1;share=$(this).attr("class");var a="Destacados";switch(gaTracker.homeV6Tab){case"trending-hotness":a="Destacados";break;case"trending-momentum":a="Ascenso";break;case"recent":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a+".Share."+share,position+".Posicion","Home.Social")});$(".content-left .list-l ul li h3, .content-left .list-l ul li a.avatar").bind("mousedown",function(b){if((b.which==2)){position=$(".v6-content .list-l ul li").index($(this).closest("li"));position=position+1;link=$(this).parent("li").find("h3 > a").html();var a="Destacados";switch($("nav.tabs ul li.active a").html()){case"Lo ms destacado":a="Destacados";break;case"En ascenso":a="Ascenso";break;case"Lo ms reciente":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a,position+".Posicion",link)}});$(".v6 .content-left li div.meta a.usuario").bind("mousedown",function(b){if((b.which==2)){position=$(".v6 .content-left ul li").index($(this).closest("li"));position=position+1;var a="Destacados";switch(gaTracker.homeV6Tab){case"trending-hotness":a="Destacados";break;case"trending-momentum":a="Ascenso";break;case"recent":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a+".Autor",position+".Posicion","Autores")}});$(".content-left .list-l ul li a.comentarios").bind("mousedown",function(b){if((b.which==2)){position=$(".v6-content .list-l ul li").index($(this).closest("li"));position=position+1;link=$(this).closest("li").find("h3 > a").html();var a="Destacados";switch($("nav.tabs ul li.active a").html()){case"Lo ms destacado":a="Destacados";break;case"En ascenso":a="Ascenso";break;case"Lo ms reciente":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a+".Comentarios",position+".Posicion",link)}});$(".content-left .list-l ul li a.category").bind("mousedown",function(b){if((b.which==2)){position=$(".v6-content .list-l ul li").index($(this).closest("li"));position=position+1;link=$(this).closest("li").find("h3 > a").html();var a="Destacados";switch($("nav.tabs ul li.active a").html()){case"Lo ms destacado":a="Destacados";break;case"En ascenso":a="Ascenso";break;case"Lo ms reciente":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a+".Categoria",position+".Posicion",link)}});$(".list-top-posts ul li a").bind("mousedown",function(b){if((b.which==2)){var d="";var a=$(this).closest("ul").attr("class");console.log(a);switch(a){case"top-today":d="Today";break;case"top-yesterday":d="Yesterday";break;case"top-week":d="Week";break;case"top-month":d="Month";break;case"top-all":d="All";break}position=$("."+a+" li").index($(this).closest("li"));position=position+1;gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Top.Posts."+d,position+".Posicion",$(this).attr("href"))}});$(".v6 .list-importante li").bind("mousedown",function(a){if((a.which===2)){position=$(".v6 .list-importante ul li").index($(this).closest("li"));position=position+1;title=$(this).find("h3").html();gaTracker.trackEvent("Sticky.Click",title,position)}});$(".list-comentarios-recientes ul li a").bind("mousedown",function(b){if((b.which==2)){var a=$(this).attr("href");position=$("#lastCommentsBox li").index($(this).closest("li"));position=position+1;gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Comentarios.Recientes",position+".Posicion",a)}});$(".v6 .content-left li.patrocinado").click(function(){position=$(".v6 .content-left ul li").index($(this).closest("li"));position=position+1;title=$(this).find("h3 > a").html();gaTracker.trackEvent("Patrocinado.Click",title,position)});$("#lastPostsBox div.list .list-element").click(function(){if($(this).hasClass("patrocinado")){position=$("#lastPostsBox div.list .list-element").index($(this).closest(".list-element"));position=position+1;title=$(this).children("a").html();gaTracker.trackEvent("Patrocinado.Click",title,position)}});$(".v6 .list-importante li").on("click",function(){position=$(".v6 .list-importante ul li").index($(this).closest("li"));position=position+1;title=$(this).find("h3").html();gaTracker.trackEvent("Sticky.Click",title,position)});$("#lastPostsBox div.list .list-element").click(function(){if($(this).children("i.sticky").length>0){position=$("#lastPostsBox div.list .list-element").index($(this).closest(".list-element"));position=position+1;title=$(this).children("a").html();gaTracker.trackEvent("Sticky.Click",title,position)}});$("body").on("click",".content-left .list-l ul li h3, .content-left .list-l ul li a.avatar",function(){position=$(".v6-content .list-l ul li").index($(this).closest("li"));position=position+1;link=$(this).parent("li").find("h3 > a").html();var a="Destacados";switch($("nav.tabs ul li.active a").html()){case"Lo ms destacado":a="Destacados";break;case"En ascenso":a="Ascenso";break;case"Lo ms reciente":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a,position+".Posicion",link)});$("body").on("click",".content-left .list-l ul li a.comentarios",function(){position=$(".v6-content .list-l ul li").index($(this).closest("li"));position=position+1;link=$(this).closest("li").find("h3 > a").html();var a="Destacados";switch($("nav.tabs ul li.active a").html()){case"Lo ms destacado":a="Destacados";break;case"En ascenso":a="Ascenso";break;case"Lo ms reciente":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a+".Comentarios",position+".Posicion",link)});$("body").on("click",".content-left .list-l ul li a.category",function(){position=$(".v6-content .list-l ul li").index($(this).closest("li"));position=position+1;link=$(this).closest("li").find("h3 > a").html();var a="Destacados";switch($("nav.tabs ul li.active a").html()){case"Lo ms destacado":a="Destacados";break;case"En ascenso":a="Ascenso";break;case"Lo ms reciente":a="Recientes";break}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Posts."+a+".Categoria",position+".Posicion",link)});$(".top-usuarios ul li a:first-child").click(function(){position=$(".top-usuarios ul li").index($(this).closest("li"));position=position+1;period=$(".top-usuarios ol li.active a").attr("data-category");period=period.substr(0,1).toUpperCase()+period.substr(1);link=$(this).attr("href");gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Top.Usuarios."+period,position+".Posicion",link)});$(".top-usuarios ul li a.bt").click(function(){if($(this).html()!="Seguir"){eventText="Boton.Follow"}else{eventText="Boton.Unfollow"}gaTracker.trackEvent(gaTracker.homeV6Country+"."+gaTracker.homeV6Category+".Top.Usuarios",eventText)});$(".nav-user .ico-shout").click(function(){gaTracker.trackEvent("Shouts.BotonEscribir","BotonEscribir",location.pathname)});$("#facebook-widget").click(function(){gaTracker.trackEvent("Facebook.Like","Social","Home.Social")});$("#twitter-widget-0").click(function(){gaTracker.trackEvent("Twitter.Like","Social","Home.Social")});(function(d){var b=d("link[rel=canonical]").attr("href");function e(f){d.ajax({dataType:"json",url:"http://cdn.api.twitter.com/1/urls/count.json?url="+encodeURIComponent(f)+"&callback=?",success:function(g){d(".twitter.sharer-counter").html(my_number_format(g.count))}})}function a(f){d.ajax({dataType:"json",url:"http://graph.facebook.com/?id="+encodeURIComponent(f)+"&callback=?",success:function(g){d(".facebook.sharer-counter").html(typeof g.shares==="undefined"?0:my_number_format(g.shares))}})}if(d(".twitter.sharer-counter").length){e(b)}if(d(".facebook.sharer-counter").length){a(b)}})(jQuery);(function(b){var a=b("#widget_elecciones .select-provincia select");b("#widget_elecciones .view-more-list a, #menu-section-elecciones-2013 a").attr("href",a.find("[value="+a.val()+"]").data("href"));b("#widget_elecciones .select-provincia select").on("change",function(){var d=b(this).val();b("#widget_elecciones").addClass("loading");createCookie("elecciones-provincia",d,365);b("#widget_elecciones .view-more-list a, #menu-section-elecciones-2013 a").attr("href",b(this).find("[value="+d+"]").data("href"));b.ajax({type:"POST",dataType:"html",url:"/ajax/elecciones/home",data:{provincia:b(this).val()},success:function(e){b("#widget_elecciones .result").html(e);b("#widget_elecciones").removeClass("error")},error:function(e){b("#widget_elecciones .error").html("Hubo un error al procesar lo solicitado<br>Reintentando...");b("#widget_elecciones").addClass("error");setTimeout(function(){b("#widget_elecciones .select-provincia select").trigger("change")},3000)},complete:function(){b("#widget_elecciones").removeClass("loading")}})})})(jQuery);(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(e){e.timeago=function(j){if(j instanceof Date){return a(j)}else{if(typeof j==="string"){return a(e.timeago.parse(j))}else{if(typeof j==="number"){return a(new Date(j))}else{return a(e.timeago.datetime(j))}}}};var h=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:60000,allowFuture:false,localeTitle:false,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(p){var q=this.settings.strings;var m=q.prefixAgo;var u=q.suffixAgo;if(this.settings.allowFuture){if(p<0){m=q.prefixFromNow;u=q.suffixFromNow}}var s=Math.abs(p)/1000;var j=s/60;var r=j/60;var t=r/24;var n=t/365;function l(v,x){var w=e.isFunction(v)?v(x,p):v;var y=(q.numbers&&q.numbers[x])||x;return w.replace(/%d/i,y)}var o=s<45&&l(q.seconds,Math.round(s))||s<90&&l(q.minute,1)||j<45&&l(q.minutes,Math.round(j))||j<90&&l(q.hour,1)||r<24&&l(q.hours,Math.round(r))||r<42&&l(q.day,1)||t<30&&l(q.days,Math.round(t))||t<45&&l(q.month,1)||t<365&&l(q.months,Math.round(t/30))||n<1.5&&l(q.year,1)||l(q.years,Math.round(n));var k=q.wordSeparator||"";if(q.wordSeparator===undefined){k=" "}return e.trim([m,o,u].join(k))},parse:function(k){var j=e.trim(k);j=j.replace(/\.\d+/,"");j=j.replace(/-/,"/").replace(/-/,"/");j=j.replace(/T/," ").replace(/Z/," UTC");j=j.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(j)},datetime:function(k){var j=h.isTime(k)?e(k).attr("datetime"):e(k).attr("title");return h.parse(j)},isTime:function(j){return e(j).get(0).tagName.toLowerCase()==="time"}});var f={init:function(){var k=e.proxy(d,this);k();var j=h.settings;if(j.refreshMillis>0){setInterval(k,j.refreshMillis)}},update:function(j){e(this).data("timeago",{datetime:h.parse(j)});d.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:h.parse(h.isTime(this)?e(this).attr("datetime"):e(this).attr("title"))});d.apply(this)}};e.fn.timeago=function(l,j){var k=l?f[l]:f.init;if(!k){throw new Error("Unknown function name '"+l+"' for timeago")}this.each(function(){k.call(this,j)});return this};function d(){var k=b(this);var j=h.settings;if(!isNaN(k.datetime)){if(j.cutoff==0||g(k.datetime)<j.cutoff){e(this).text(a(k.datetime))}}return this}function b(j){j=e(j);if(!j.data("timeago")){j.data("timeago",{datetime:h.datetime(j)});var k=e.trim(j.text());if(h.settings.localeTitle){j.attr("title",j.data("timeago").datetime.toLocaleString())}else{if(k.length>0&&!(h.isTime(j)&&j.attr("title"))){j.attr("title",k)}}}return j.data("timeago")}function a(j){return h.inWords(g(j))}function g(j){return(new Date().getTime()-j.getTime())}document.createElement("abbr");document.createElement("time")}));jQuery.timeago.settings.strings={prefixAgo:"hace",prefixFromNow:"dentro de",suffixAgo:"",suffixFromNow:"",seconds:"%d s",minute:"1 m",minutes:"%d m",hour:"1 h",hours:"%d h",day:"1 dia",days:"%d das",weeks:"%d sem",month:"1 mes",months:"%d meses",year:"1 ao",years:"%d aos"};var Suggest=function(){var a=this;a.requesting=false;a.tmpl={search:'<li data-suggest="$1"><a href="#">$1</a></li>',hashtag:'<li data-suggest="$1"><a href="#">$1</a></li>',user:'<li data-suggest="$1"><a href="#">$1</a></li>'};a.complete=function(n,g){var h=$(n).siblings("button");var k=$(n).parent().siblings(".box-results").children("ul").first();var j=n.val();var f=g.attr("data-suggest");var l=$.getCaret(n[0]);var d=j.substr(0,l).split(" ").pop();var e=l-d.length;var m=j.substr(0,e);var b=j.substr(l);if(g.hasClass("item-user")&&f[0]!="@"){f="@"+f}if(g.hasClass("item-hashtag")&&f[0]!="#"){f="#"+f}n.val(m+f+" "+b).focus();h.trigger("click");$(k).parent().addClass("hide")};a.init=function(){$("#v6search").each(function(){if(typeof localStorage==="undefined"){return}var b=$(this);var d=$(this).parent().siblings(".box-results").children("ul").first();$(d).empty();b.bind("keydown",function(h){var f=h.keyCode;var e=d.children();var g=d.find(".active");if($.inArray(f,[13,38,40])===-1||!e.length){return}switch(f){case 13:if(!g.length){return}a.complete(b,g);break;case 38:if(!g.length||d.find("li:first").hasClass("active")){g=d.find("li:last")}else{g=g.prevAll("li:first")}break;case 40:if(!g.length||d.find("li:last").hasClass("active")){g=d.find("li:first")}else{g=g.nextAll("li:first")}break;default:return}e.removeClass("active");g.addClass("active");h.preventDefault();return false}).bind("keyup",function(g){var o=g.keyCode;if($.inArray(o,[38,40])!==-1){return}if(a.requesting){a.requesting.abort();a.requesting=false}var n=b.val();var k=$.getCaret(b[0]);var l=n.substr(0,k).split(" ").pop();var j=l[0];var h=0;if(!n||!l){$(d).parent().addClass("hide");return}var f,e;if(j=="#"){e=localStorage.hashtag||"";f=l.substr(1)}else{e=localStorage.mention||"";if(j=="@"){f=l.substr(1)}else{if(!a.requesting){f=l;a.requesting=$.ajax({url:"http://suggestqueries.google.com/complete/search?client=youtube&q="+encodeURIComponent(l)+"&hl=es",dataType:"jsonp",cache:true,success:function(q){var r="";var p=q[1].length>4?4:q[1].length;for(i=0,c=p;i<c;++i){r+=a.tmpl.search.replace(/\$1/g,q[1][i][0])}if(r){d.prepend(r);$(d).parent().removeClass("hide")}a.requesting=false}})}}}if(f&&(j.match(/[\@\#]/))){var m=j=="#"?a.tmpl.hashtag:a.tmpl.user;(e.match(RegExp("(?:^|,)("+f+"[^,]*)","gi"))||[]).map(function(q){if(++h<5){var p=q.replace(",","");$(m.replace(/\$1/g,p)).appendTo(d);$(d).parent().removeClass("hide")}})}if(!d.children().length){$(d).parent().addClass("hide")}}).bind("blur",function(){setTimeout(function(){$(d).parent().addClass("hide")},150)}).bind("focus",function(){b.trigger("keyup")})});$("body").on("click",".box-results ul li",function(){var e=$(this);var f=e.parent("ul");var b=$("#v6search");var d=b.siblings("button");a.complete(b,e)})};a.init()};var PostsList=function(b){var a=this;a.page=1;a.loading=false;a.scrollEnabled=true;a.getPostIds=function(e){var d={};e.each(function(f,g){d[$(g).data("post-id")]=1});return d};a.onScroll=function(){if(!a.scrollEnabled||a.loading){return}var e=parseInt($("body").css("padding-top"));var f=500;if($(window).scrollTop()+b.winHeight<=b.contentLeft.height()+e-f){return}a.loading=true;b.contentLeft.find(".loading").show();var d=++(a.page);$.ajax({type:"get",url:"/ajax/home-posts.php",dataType:"json",data:{page:d,cat:parseInt(b.contentLeft.find(".list-l").data("cat")),tab:b.contentLeft.find(".list-l").data("tab")},success:function(j){if(!j||j.status!=1||!j.data){console.error("Error cargando posts: ");console.log(j);return}nga("send","pageview","/v6/pagina"+d);_gaq.push(["_trackPageview","/v6/pagina"+d]);var g=a.getPostIds(b.contentLeft.find(".list-l li"));var h=$(j.data).find(".list-l li").filter(function(){return!($(this).data("post-id")in g)});b.contentLeft.find("ul").append(h);a.postsAdded(h);$.when(h.hide().fadeIn("slow")).done(function(){a.loading=false;b.contentLeft.find(".loading").hide();b.docHeight=$(document).height();a.scrollEnabled=h.length>0})}})};a.visitTabs=function(d){$(".v6 .tabs ul li").each(function(h,f){var g=$(f).find("a");var e=g.data("tag");if(e){d(g)}})};a.pushState=function(d){if(!history.pushState){return}history.pushState({tab:d.data("tab")},"",d.attr("href"))};a.onPopState=function(d){if(d.state){a.visitTabs(function(e){if(e.data("tab")==d.state.tab){a.tabClicked(e)}})}};a.tabClicked=function(d){if(!a.scrollEnabled||a.loading){return}if(d.parent().hasClass("active")){return}var f=b.contentLeft.find(".list-l");var e=d.data("tab");a.page=0;f.find("ul").empty();f.data("tab",e);a.visitTabs(function(g){var h=g.data("tab")==e;g.parent().toggleClass("active",h);f.toggleClass(g.data("class"),h)});a.onScroll(b);if(e=="recent"){$(".list-recent-posts").hide()}else{$(".list-recent-posts").show()}};a.postsAdded=function(d){d.find(".timeago").timeago();d.find(".comentarios").each(function(e,f){$(f).attr("title",$(f).find("span").text()+" Comentarios")});d.find(".label-category").each(function(e,f){$(f).attr("title","Categora "+$(f).text())})};a.init=function(){if(b.contentLeft.length==0){return}var d=null;a.visitTabs(function(f){f.click(function(g){g.preventDefault();a.tabClicked($(this));a.pushState($(this))});var e=f.data("tag").split(",");f.data("tab",e[0]);f.data("class",e[1]);if(f.parent().hasClass("active")){d=f}});if(d&&history.pushState){history.replaceState({tab:d.data("tab")},"",window.location);window.onpopstate=a.onPopState}};a.init()};var HomePage=function(){var a=this;a.layout={sidebar:$(".sidebar"),topPosts:$(".list-top-posts"),topPostsHeader:$(".list-top-posts .header"),topPostsContent:$(".list-top-posts ul"),content:$(".v6-container"),contentLeft:$(".content-left"),contentRight:$(".content-right")};a.toggleEstadisticas=function(){var b=$(this);b.prev().toggleClass("active");b.toggleClass("active")};a.actionIn=function(){$(this).find("ol").show()};a.actionOut=function(){$(this).find("ol").hide()};a.actionSelect=function(){var d=$(this);var b=$(this).parent().parent().parent();b.find("li.active").removeClass("active");d.parent().addClass("active");b.find("ol").hide();b.find("span").html(d.text())};a.actionMinMax=function(){var b=$(this);b.find("span").toggleClass("active");b.parent().find("ul").slideToggle()};a.fixLayout=function(){a.layout.winHeight=$(window).height();a.layout.docHeight=$(document).height();a.fixSidebar(a.layout);a.fixTopPosts(a.layout)};a.fixSidebar=function(d){var b=a.layout.sidebar.outerHeight();var e=a.layout.content.outerWidth()+a.layout.content.offset().left-a.layout.sidebar.outerWidth();if($(window).scrollTop()>b-d.winHeight+parseInt($("body").css("padding-top"))&&e-$(window).scrollLeft()>0){d.sidebar.css({left:e-$(window).scrollLeft(),right:"auto",position:"fixed",bottom:0,top:"auto"})}else{d.sidebar.css({position:"absolute",left:"auto",right:"0",top:0,bottom:"auto"})}};a.fixTopPosts=function(b){var e=a.layout.contentRight.width();var d=b.contentRight.offset().left-$(window).scrollLeft();if($(window).scrollTop()>=b.topPostsTop){b.topPostsHeader.css({position:"fixed",top:0,left:d,width:e,border:"solid 1px #d0d1d3"});b.topPostsContent.css({"padding-top":a.layout.topPostsHeader.height()});if($(window).scrollTop()+$(window).height()>=b.topPostsBottom){if($(window).height()<b.topPosts.outerHeight()){b.topPosts.css({position:"fixed",bottom:0,left:d,width:e})}else{b.topPosts.css({position:"fixed",top:0,left:d,width:e})}}else{b.topPosts.attr("style","")}}else{b.topPostsHeader.attr("style","");b.topPostsContent.css("padding-top","");b.topPosts.attr("style","");a.layout.topPostsTop=a.layout.topPosts.offset().top;a.layout.topPostsBottom=a.layout.topPostsTop+a.layout.topPosts.outerHeight()}};a.changeTopUsersCategory=function(d){var b=$(d.currentTarget).data("category");$(".top-usuarios").children("ul").each(function(e,f){$(f).toggle(b==$(f).data("category"))})};a.changeTopsPeriod=function(b){var d=$(b).html();$(".list-top-posts ul").hide();switch(d){case"Hoy":$(".top-today").show();break;case"Ayer":$(".top-yesterday").show();break;case"Semana":$(".top-week").show();break;case"Mes":$(".top-month").show();break;case"Todos":$(".top-all").show();break}};a.changeShoutsList=function(d){var b=$(d).attr("class");$(".shouts ul").hide();$(".shouts ul."+b).show()};a.followUser=function(d){var b=$(d).parent().hasClass("siguiendo");if(b){notifica.ajax(Array("action=unfollow","type=user","obj="+$(d).data("userid")),null,null,true,false);$(d).parent().removeClass("siguiendo");$(d).text("Seguir")}else{notifica.ajax(Array("action=follow","type=user","obj="+$(d).data("userid")),null,null,true,false);$(d).parent().addClass("siguiendo");$(d).text("Siguiendo")}};a.realtimeStats=function(){var d=$(".estadisticas");if(d.length==0){return}var b=d.data("channel");if(b){LiveStats(b,d,$(".estadisticas").data("initial"))}};a.realtimeComments=function(){var b=$("#lastCommentsBox");if(b.length!==1){return}var e=b.data("channel");if(!e){return}var d=false;$(b).on("mouseenter",function(){d=true}).on("mouseleave",function(){d=false});Realtime.addChannel(e,b,function(h){if(d){return}var g='<li><a href="%LINK%"><img src="%AVATAR%" class="thumb"><h3>%TITLE%</h3></a></li>';var f=g.replace("%LINK%",h.link).replace("%AVATAR%",h.author.avatar||($("html").data("imghost")+"img/32_avatar_mantenimiento.gif")).replace("%TITLE%",htmlspecialchars(h.title));var j=$(f).hide().fadeIn(400);b.prepend(j);b.children().slice(10).remove()})};a.initCountryDropdown=function(){$("[data-v6-country]").click(function(){var b=$(this).attr("data-v6-country");eraseCookie("pais_home");createCookie("pais_home",b,1);b=readCookie("pais_home");if(b){window.location=$(".v6-category li.active a").attr("href")}})};a.init=function(){if($(".content-left").length===0){return}jQuery.timeago.settings.localeTitle=true,$("aside .estadisticas .bt-slide").click(a.toggleEstadisticas);$(".action-select").hover(a.actionIn,a.actionOut);$(".action-select li a").click(a.actionSelect);$(".action-minmax").click(a.actionMinMax);$(".v6_topUsersCategory").click(a.changeTopUsersCategory);$(".list-recent-posts a.ver").on("click",function(d){d.preventDefault();$('.v6-content .tabs li a[data-tag="recent,list-reciente"]').trigger("click")});a.realtimeComments();a.realtimeStats();a.initCountryDropdown();$("footer p.subir").click(function(){$("body,html").animate({scrollTop:0},800);return false});var b=new PostsList(a.layout);b.postsAdded($(".v6 .list-l li"));a.layout.topPostsTop=a.layout.topPosts.offset().top;a.layout.topPostsBottom=a.layout.topPostsTop+a.layout.topPosts.outerHeight();a.fixLayout();$(window).scroll(function(){a.fixLayout();b.onScroll(a.layout)});$(window).resize(a.fixLayout)}};TopsTool=function(a,d){var b=this;this.root=a;this.$=function(e){return b.root.find(e)};this.render_items_large=function(g,e){if(!g){return}var j='<a href="%URL%"><img src="%THUMB%"/></a><p><a href="%URL%">%TITLE%</a></p>';for(var f in g){var m=g[f][0];if(!m||!m.title){continue}var h=$(j.replace("%TITLE%",m.title).replace("%THUMB%",m.thumb).replace(new RegExp("%URL%","g"),m.url));var l=e.find('.panel-content[data-type="'+f+'"]');l.removeClass("hide").append(h);l.parent().find(".loading").remove()}};this.panels={"panel-posts":{init:function(e){$.ajax({type:"get",url:"/ajax/top-posts.php",dataType:"json",data:{amount:1},success:function(f){if(!f||f.status!=1){return}b.render_items_large(f.data,e)}})}},"panel-comunidad":{init:function(e){$.ajax({type:"get",url:"/ajax/top-communities.php",dataType:"json",data:{amount:1},success:function(f){if(!f||f.status!=1){return}b.render_items_large(f.data,e)}})}},"panel-temas":{init:function(e){$.ajax({type:"get",url:"/ajax/top-temas.php",dataType:"json",data:{amount:4},success:function(n){if(!n||n.status!=1){return}for(var g in n.data){var f=(g=="replies")?"resp":"votos";var m=e.find('.panel-content[data-type="'+g+'"]');var l='<p><span class="count">%COUNTER%<small>'+f+'</small></span><a href="%URL%">%TITLE%</a></p>';for(var h in n.data[g]){h=n.data[g][h];var j=$(l.replace("%TITLE%",h.title).replace("%COUNTER%",h.counter).replace(new RegExp("%URL%","g"),h.url));m.removeClass("hide").append(j)}m.parent().find(".loading").remove()}}})}},"panel-usuarios":{init:function(e){$.ajax({type:"get",url:"/ajax/top-usuarios.php",dataType:"json",data:{amount:7},success:function(m){if(!m||m.status!=1){return}for(var g in m.data){var l=e.find('.panel-content[data-type="'+g+'"]');var j='<p><span class="users">%COUNTER% </span><a href="%URL%">%NICK%</a></p>';for(var f in m.data[g]){f=m.data[g][f];var h=$(j.replace("%NICK%",f.nick).replace("%COUNTER%",f.counter).replace(new RegExp("%URL%","g"),f.url));l.removeClass("hide").append(h)}l.parent().find(".loading").remove()}}})}}};this.initPanel=function(e){$("#"+e+" .panel-content").each(function(f,g){$(g).after($('<div class="loading"/>'));$(g).addClass("hide")});b.panels[e].init($("#"+e))};this.showSubmenu=function(h){var f=h.data("panel");for(var g in b.panels){b.$('.subnav li a[data-panel="'+g+'"]').toggleClass("active",g===f);b.$("#"+g).toggleClass("active",g===f)}var e=b.panels[f];if(!e.initialized&&e.init){e.initialized=true;b.initPanel(f)}};this.opened=function(){b.showSubmenu($(".subnav a.active"))};this.init=function(){b.$(".subnav a").on("hover",function(g){g.preventDefault();b.showSubmenu($(this))});var f=function(g){return!g.hasClass("show")};var e=function(g){g.addClass("show")};$(".v6 .nav-principal > ul > li > a.drop-panels").click(function(g){d.toolClicked(g,$(this).parent(),b.opened,f,e)})};this.init()};var ProfileTool=function(b){var a=this;a.dirty=true;a.opened=function(){var d=$("#tool-profile").find("ul");if(!a.dirty){return}a.dirty=false};$(".tool-profile").click(function(d){b.toolClicked(d,"#tool-profile",a.opened)})};var FavoritesTool=function(b){var a=this;a.dirty=true;a.opened=function(){var d=$("#tool-favoritos").find("ul");if(!a.dirty||d.hasClass("loading")){return}d.addClass("loading");$.ajax({type:"POST",url:"/ajax/favorites/recent",data:gget("postid",true)+gget("key"),success:function(e){b.ajaxHandler(e,a,null,d)}})};a.renderers={post:function(d){return('<li><a href="%HREF%"><img src="%IMGSRC%"><h5><strong>%TITLE%</strong></h5><p>%POINTS% puntos | %COMMENTS% comentarios</p></a></li>').replace("%COMMENTS%",d.comments).replace("%POINTS%",d.score).replace("%IMGSRC%",d.thumb).replace("%TITLE%",d.title).replace(new RegExp("%HREF%","g"),d.canonical)},tema:function(d){return('<li><a href="%HREF%"><img src="%IMGSRC%"><h5><strong>%TITLE%</strong></h5><p>%COMMENTS% comentarios</p></a></li>').replace("%COMMENTS%",d.comments).replace("%IMGSRC%",d.thumb).replace("%TITLE%",d.title).replace(new RegExp("%HREF%","g"),d.canonical)},track:function(d){return('<li><a href="%HREF%"><img src="%IMGSRC%"><h5><strong>%TITLE%</strong></h5><p>%COMMENTS% comentarios</p></a></li>').replace("%COMMENTS%",d.comments).replace("%IMGSRC%",d.cover).replace("%TITLE%",d.name).replace(new RegExp("%HREF%","g"),d.canonical)},album:function(d){return('<li><a href="%HREF%"><img src="%IMGSRC%"><h5><strong>%TITLE%</strong></h5></a></li>').replace("%IMGSRC%",d.cover).replace("%TITLE%",d.name).replace(new RegExp("%HREF%","g"),d.canonical)}};a.parse=function(f){var e=$("#tool-favoritos").find("ul");e.empty();for(var d=0;d<f.length;d++){var g=f[d];if(!(g.type in a.renderers)||!("object"in g)||!g.object){continue}$(a.renderers[g.type](g.object)).appendTo(e)}};$(".ico-favoritos").click(function(d){b.toolClicked(d,"#tool-favoritos",a.opened)})};var MPsTool=function(b){var a=this;a.dirty=true;a.opened=function(){var d=$("#tool-mensajes").find("ul");if(!a.dirty||d.hasClass("loading")){return}d.addClass("loading");mensajes.ajax(Array("action=last","imageSize=48"),function(e){b.ajaxHandler(e,a,"messages",d)})};a.parse=function(h){var f=$("#tool-mensajes").find("ul");f.empty();var g='<li %UNREAD%><a href="%READ_HREF%"><img src="%IMGSRC%"/><span class="noti-icon ico-point"/><h5><strong class="ico-usuario">%FROM%</strong></h5><p>%SUBJECT%</p></a></li>';for(var e=0;e<h.length;e++){var j=h[e];var d=g.replace("%UNREAD%",j.unread==="unread"?'class="unread"':"").replace("%SUBJECT%",j.subject).replace("%IMGSRC%",j.avatar).replace("%FROM%",j.nick).replace(new RegExp("%FROM_HREF%","g"),"/"+j.nick).replace(new RegExp("%READ_HREF%","g"),"/mensajes/leer/"+j.id);d=$(d);d.appendTo(f)}};$(".ico-mensajes").click(function(d){b.toolClicked(d,"#tool-mensajes",a.opened)})};var NotificationsTool=function(b){var a=this;a.dirty=true;a.opened=function(){var d=$("#tool-notificaciones").find("ul");if(!a.dirty||d.hasClass("loading")){return}d.addClass("loading");notifica.ajax(Array("action=last","template=false","imageSize=48"),function(e){b.ajaxHandler(e,a,"notification",d)})};a.imageCode=function(e){if(e.image["code"]){return e.image["code"]}var d='<img src="%IMGSRC%" href="%HREF%"/>';return d.replace("%IMGSRC%",e.image["src"]).replace("%HREF%",e.image["href"])};a.icon=function(d){var e;if(d.indexOf("new-favorite")>=0){e="ico-favoritos"}else{if(d.indexOf("new-follower")>=0){e="ico-tesigue"}else{if(d.indexOf("user-rank")>=0){e="ico-cambiorango"}else{if(d.indexOf("new-comment")>=0){e="ico-comments"}else{if(d.indexOf("new-reply")>=0){e="ico-commentsrespond"}else{if(d.indexOf("new-score")>=0){e="ico-puntos"}else{if(d.indexOf("new-wallpost")>=0){e="ico-escribioperfil"}else{if(d.indexOf("new-medal")>=0){e="ico-medalla"}else{if(d.indexOf("new-mention")>=0){e="ico-commentsrespond"}}}}}}}}}if(!e){return""}return'<span class="noti-icon '+e+'"/>'};a.parse=function(j){var k=$("#tool-notificaciones").find("ul");k.empty();var l='<li %UNREAD%><a href="%HREF%">%IMG%%ICON%<h5></h5></a></li>';var m=$("#tool-notificaciones a.mas").attr("href");for(var f=0;f<j.length;f++){var d=j[f];var h=$("<h5>"+d.shortText.replace(new RegExp("@<a","g"),'<a class="ico-usuario"')+"</h5>");var e=h.find("a.important").attr("href")||h.find("a").attr("href")||m;h.find("a").each(function(o,p){var n=$("<strong/>").append($(p).html()).attr("class",$(p).attr("class")+" elipsis");$(p).replaceWith(n)});var g=l.replace("%HREF%",e).replace("%UNREAD%",d.event.statusView!=="read"?'class="unread"':"").replace("%IMG%",a.imageCode(d)).replace("%ICON%",a.icon(d.actionName));g=$(g);g.find("h5").replaceWith(h);g.appendTo(k)}};$(".ico-notificaciones").click(function(d){b.toolClicked(d,"#tool-notificaciones",a.opened)})};var ShoutTool=function(a,d){var b=this;this.root=a;this.$=function(e){return b.root.find(e)};this.errorMsg="Hubo un problema al publicar el shout. Por favor intntalo de nuevo ms tarde.";this.submitLock={};this.opened=function(){b.$("textarea").focus()};this.hideOptions=function(){b.$(".info-privacy").addClass("hide")};this.reset=function(){b.clearAttachment();b.showPane("");b.submitLock={};b.updateSubmitState()};this._panes=["#shout-pane-link","#shout-pane-preview",".shout-enviado"];this.showPane=function(f){for(var e=0;e<b._panes.length;e++){b.$(b._panes[e]).removeClass("hide");b.$(b._panes[e]).toggle(f===b._panes[e])}b.$(".shout-attachment-button").toggle(f!=="#shout-pane-preview");b.$(".botones, form").toggle(f!==".shout-enviado")};this.getSelectedPrivacy=function(){return b.$("#shout-privacy-options li.active").first().text()};this.updatePrivacyHint=function(){b.$(".ico-lock").attr("title","Opciones de privacidad ("+b.getSelectedPrivacy()+")")};this.showPrivacyOptions=function(f){f.stopPropagation();b.$("#shout-privacy-options").toggleClass("hide");b.updatePrivacyHint()};this.selectPrivacy=function(){$(this).siblings().removeClass("active");$(this).addClass("active");b.$("#shout-privacy-options").addClass("hide")};this.showUploadOptions=function(f){f.stopPropagation();b.$("#shout-upload-options").toggleClass("hide")};this.setSubmitLock=function(f,e){b.submitLock[f]=true;b.updateSubmitState();if(e){b.toggleSpinner(true)}};this.clearSubmitLock=function(e){delete b.submitLock[e];b.updateSubmitState()};this.imageUploadCallback=function(e){if(!e||e.no!=0){return b.error((e&&e.error)?e.error:"Hubo un problema al subir la imagen. Por favor intntalo de nuevo ms tarde.")}b.clearSubmitLock("ajax");if(gaTracker){gaTracker.trackEvent("Shouts.CrearShout","SubirImagenDesdePC.Completo")}e.url=e.error;b.setAttachment("image",e);b.showPane("#shout-pane-preview")};this.uploadImage=function(e){if(!e.val().match(/^.*\.(png|jpe?g|gif)/i)){return}b.setSubmitLock("ajax",true);Kn3.upload(e,b.imageUploadCallback)};this.showFileSelect=function(e,f){e.unbind("change");e.on("change",function(h){e.unbind("change");var g=e.val();if(g){f(e)}});e.show().trigger("click").hide()};this.uploadImageSelected=function(f){if($(f.target).prop("tagName")==="INPUT"){f.stopPropagation();return}b.$("#shout-upload-options").addClass("hide");var g=$(this).data("upload-from");if(g==="url"){b.showAttachLinkPane("image","URL de la imagen")}else{b.showFileSelect($(this).children("input"),b.uploadImage)}};this.ready=function(){return!b.$("textarea").hasClass("v6-error")&&!b.$("#shout-submit").hasClass("ui-state-disabled")};this.submit=function(f){f.stopPropagation();if(!b.ready()){return}var h={key:global_data.user_key,body:$.trim(b.$("textarea").val()),privacy:b.$("#shout-privacy-options li.active").data("privacy")};if(h.body.length>255){return}var g=["image","video","link"];h.attachment_type=g.indexOf(b.attachmentType)+1;h.attachment=b.attachment||"";if(!h.body&&h.attachment_type==0){return}b.setSubmitLock("ajax",true);$.ajax({type:"POST",url:"/ajax/shout/add",data:$.param(h),success:b.submitted,error:function(e){b.error(b.errorMsg)}})};this.toggleSpinner=function(e){b.$("button").toggleClass("loading",e)};this.updateSubmitState=function(){var e=Object.keys(b.submitLock).length==0;if(e){b.toggleSpinner(false)}b.$("button").each(function(){$(this).toggleClass("ui-state-disabled",!e);$(this).css("pointer-events",e?"auto":"none")})};this.setBody=function(f){var e=b.$("textarea");e.val($("<div/>").html(f).text());return e},this.error=function(e){b.reset();if(typeof e!=="string"){e="Ocurri un error :("}b.setBody(e).addClass("v6-error");b.setSubmitLock("error")};this.clearError=function(){if(b.$("textarea").hasClass("v6-error")){b.setBody("").removeClass("v6-error")}b.clearSubmitLock("error")};this.submitted=function(e){if(!e||e.substring(0,1)==="{"){var f=e?$.parseJSON(e).data:b.errorMsg;if(gaTracker){gaTracker.trackEvent("Shouts.CrearShout","CompartirError",f)}return b.error(f)}if(gaTracker){gaTracker.trackEvent("Shouts.CrearShout","CompartirOk")}b.reset();b.setBody("");b.showPane(".shout-enviado");setTimeout(function(){b.reset();d.hideTools()},2000)};this.showAttachLinkPane=function(f,g){b.showPane("#shout-pane-link");var e=b.$("#shout-pane-link input");e.attr("placeholder",g);e.val("").focus();b.attachmentType=f};this.clearAttachment=function(){b.attachmentType=b.attachment=null;return b.$("#shout-pane-preview-content").empty()};this.setAttachment=function(g,h){var f={link:function(){var j='<h2>%TITLE%</h2><p>%DESCRIPTION%</p><p><a href="%URL%">%URL%</a></p>';return{view:$(j.replace("%TITLE%",h.title).replace("%DESCRIPTION%",h.description).replace(new RegExp("%URL%","g"),h.url)),attachment:h.id}},video:function(){var j=$(h.html);j.find("iframe").add(j.filter("iframe")).attr("width","240").attr("height","180");return{view:j,attachment:h.url}},image:function(){return{view:$('<img style="max-width:240px;max-height:240px"/>').attr("src",h.url),attachment:h.url}}};var e=f[g]();b.clearAttachment().append(e.view);b.attachmentType=g;b.attachment=e.attachment};this.submitUrl=function(){if(gaTracker){if(b.attachmentType==="video"){gaTracker.trackEvent("Shouts.CrearShout","AgregarVideo.AgregarURL")}if(b.attachmentType==="link"){gaTracker.trackEvent("Shouts.CrearShout","AgregarLink.AgregarURL")}if(b.attachmentType==="image"){gaTracker.trackEvent("Shouts.CrearShout","SubirImagenDesdeURL.Completo")}}if(!b.ready()){return false}var e=$.trim(b.$("#shout-pane-link input").val());if(e===""||e.split(".").length<2){return false}var f={url:e};f["is"+capitaliseFirstLetter(b.attachmentType)]=1;b.setSubmitLock("ajax",true);$.ajax({type:"POST",url:"/ajax/shout/attach",data:$.param(f),dataType:"json",success:function(g){if(g.status==0){return b.error(g.data)}b.clearSubmitLock("ajax");if(gaTracker){if(b.attachmentType==="video"){gaTracker.trackEvent("Shouts.CrearShout","AgregarVideo.AgregarURLOk")}if(b.attachmentType==="link"){gaTracker.trackEvent("Shouts.CrearShout","AgregarLink.AgregarURLOk")}if(b.attachmentType==="image"){gaTracker.trackEvent("Shouts.CrearShout","SubirImagenDesdeURL.Completo")}}b.setAttachment(g.data["type"],g.data);b.showPane("#shout-pane-preview")},error:function(){b.error("Hubo un problema al adjuntar. Por favor intntalo de nuevo ms tarde.")}})};this.createUploadButton=function(){var e=$('<button type="button"/>');e.css({position:"absolute",top:0,right:0,bottom:0,left:0,width:"100%",height:"100%",padding:0,margin:0,cursor:"pointer",opacity:0,"font-size":0,"z-index":9999,filter:"alpha(opacity:0)"});e.on("mouseenter",function(g){$(this).parent().addClass("active")});e.on("mouseleave",function(g){$(this).parent().removeClass("active")});var f=$('<input name="file" id="'+b.root.attr("id")+'-file-input" type="file" accept="image/*"/>').hide();$('#shout-upload-options li[data-upload-from="pc"]').append(e).append(f)};this.init=function(){b.$("#shout-attach-link").click(function(){b.showAttachLinkPane("link","URL del link")});b.$("#shout-attach-video").click(function(){b.showAttachLinkPane("video","URL del video")});b.$("#shout-pane-link input").bind("blur",b.submitUrl);b.$(".add").click(b.submitUrl);b.$(".ico-lock").click(b.showPrivacyOptions);b.$(".ico-camera").click(b.showUploadOptions);b.$(".close").click(b.reset);b.$("#shout-privacy-options li").click(b.selectPrivacy);b.$("#shout-upload-options li").click(b.uploadImageSelected);b.$("#shout-submit").click(b.submit);b.$("textarea").keyup(function(){b.clearError()});b.createUploadButton();b.root.click(b.hideOptions);b.updatePrivacyHint();b.reset();if(typeof b.$(".ubertext-me").uberText!=="undefined"){b.$(".ubertext-me").uberText({limit:255,block:false,autogrow:true,show:-50,onPositive:function(e,f,g){$(e).css("color","#999");b.clearSubmitLock("shout_length")},onNegative:function(e,f,g){$(e).css("color","red");b.setSubmitLock("shout_length")}})}$(".ico-shout").click(function(f){d.toolClicked(f,"#tool-shout",b.opened)})};this.init()};var Header=function(){var a=this;a.ajaxHandler=function(f,b,h,d){if(h){v6.updateNotification(h,0)}b.dirty=false;d.removeClass("loading");if(typeof f!=="object"){try{f=JSON.parse(f)}catch(g){console.trace("could not parse ajax response: "+f);return}}if(("status"in f)&&("data"in f)){if(f.status!=1){console.trace("status is not 1: "+f);return}f=f.data}b.parse(f)};a.isPopupHidden=function(b){return b.hasClass("hide")};a.showPopup=function(b){b.removeClass("hide")};a.toolClicked=function(j,d,f,h,b){j.preventDefault();j.stopPropagation();h=h||a.isPopupHidden;b=b||a.showPopup;d=$(d);var g=h(d);a.hideTools();if(g){b(d);if(f){f()}}};a.hideTools=function(){$(".tools, #tool-shout").addClass("hide");$(".v6 .nav-principal > ul > li").removeClass("show")};a.init=function(){$("body").click(a.hideTools);a.notifications=new NotificationsTool(a);a.mps=new MPsTool(a);a.favorites=new FavoritesTool(a);a.shouts=new ShoutTool($("#tool-shout"),a);a.tops=new TopsTool($(".v6 .tops"),a);a.profile=new ProfileTool(a);$("#tool-shout, .tools").click(function(b){b.stopPropagation()})};a.init()};var v6={enabled:$(".v6 nav.header").length>0,returnFalse:function(a){a.preventDefault()},updateNotification:function(a,d){var b=(d>99)?("+"+d):(""+d);$("#counter-"+a).html(b).css("display",d==0?"none":"");if(a==="notification"){v6.header.notifications.dirty=true}else{if(a==="messages"){v6.header.mps.dirty=true}}},enable:function(){createCookie("NewHomeEnabled","enabled");window.location=window.location},disable:function(){createCookie("NewHomeEnabled","disabled",15);window.location=window.location},initLogout:function(){$("#v6_logout").click(function(){$(".user-name").addClass("loading");var a=$(this).attr("data-securechannel");$.ajax({type:"POST",url:"/ajax/user/logout",timeout:5000,complete:function(){Cookie.unset("tid");Cookie.unset("taringa_user_id");if(window.location.pathname=="/cuenta"){window.location.href="/"}else{window.location.reload()}}});if(typeof Realtime!=="undefined"){Realtime.removeChannel(a)}})},initSocialMedia:function(){var f={twitter:"tws",facebook:"fbs"};function d(g){return f[g]}function e(g){var h=g.data("social");g.removeClass("share-off");createCookie(d(h),"true",365)}function a(g){var h=g.data("social");g.addClass("share-off");createCookie(d(h),"false",365)}function b(g){if(g.hasClass("share-off")){e(g)}else{a(g)}}$(".facebook-share").click(function(){var g=$(this);if(g.hasClass("associate")){associateFacebookAccount(function(h){if(h){$(".facebook-share").removeClass("associate");e(g)}});return}b(g)});$(".twitter-share").click(function(){var g=$(this);if(g.hasClass("associate")){associateTwitterAccount(function(h){if(h){$(".twitter-share").removeClass("associate");e(g)}});return}b(g)});$(".shouts a.like").live("click",function(){if($(this).hasClass("disabled")||!global_data.user_key){return false}var h=$(this),j=h.closest("li"),k=j.attr("data-id"),g=j.attr("data-owner");h.addClass("disabled");h.html(parseInt(h.html())+1);ajax("shout","vote",{uuid:k,owner:g,score:1},{})})},homepage:new HomePage(),init:function(){$('[href="#"]').click(v6.returnFalse);new Suggest();v6.header=new Header();v6.initLogout();v6.initSocialMedia();v6.homepage.init()}};if(v6.enabled){$(document).ready(v6.init)}$(document).ready(function(){$(".timeago").timeago();if(typeof $().tipsy!=="undefined"){$(".hastipsy").tipsy()}});(function(b,a){if(!b(".v6 .widget").length){return}b(".close-window").on("click",function(){a.close()})})(jQuery,window);(function(h,b){if(!h(".v6 .widget.template-rewards-join").length){return}var g=h(".rewards-join");var f=new function(){function n(q){var p=h('<span class="error-mje"></span>');p.html(q);return p}function m(q,r){var p=g.find("[name="+q+"]");if(p.next().hasClass("error-mje")){p.next().remove()}p.addClass("error");n(r).insertAfter(p)}function o(p){g.find(".submit-button + .error-mje").remove();n(p).addClass("generic").insertAfter(".submit-button")}function k(q,p){p=p||null;if(p){m(p,q)}else{o(q)}}function l(){g.find(".error-mje").remove();g.find(".error").removeClass("error")}return{show:k,hide:l}};function d(){g.addClass("loading-form");g.find(".submit-button .submit").attr("disabled",true)}function e(){g.removeClass("loading-form");g.find(".submit-button .submit").removeAttr("disabled")}function j(k){g.hide();h(".show-message."+k).show()}function a(l){var k=false;h.each(l.find("[data-requiered=true]"),function(){var m=h(this);if(!h.trim(m.val())){f.show("Este campo es obligatorio",m.attr("name"));k=true}});if(k){h(l.find("input.error, select.error")[0]).focus();return}d();f.hide();h.ajax({type:"POST",url:"/ajax/rewards/join",data:l.serialize(),dataType:"json",success:function(m){switch(m.status){case 0:f.show(m.data.message,m.data.field);e();break;case 1:b.location.href=m.data;break;case 2:j("verify-email");e();break}},error:function(m){f.show("Hubo un error. Intente ms tarde.");e()}})}g.on("keypress change","input.error,select.error",function(l){var k=h(this);k.removeClass("error");if(k.next().hasClass("error-mje")){k.next().remove()}});g.find(".terminos > span").on("click",function(){var l=h(this),k=!l.hasClass("selected");l.toggleClass("selected",k);l.find("input").attr("checked",k);g.find(".submit-button").toggleClass("disabled",!k);g.find(".submit-button input").attr("disabled",!k)});g.on("submit",function(l){l.preventDefault();var k=h(this);a(k)})})(jQuery,window);(function(e,a){if(!e(".v6 .widget.template-rewards-xapo").length){return}var d=e(".xapo-demo");function b(){e.ajax({type:"POST",url:"/ajax/rewards/validate-phone",dataType:"json",success:function(f){switch(f.status){case 0:alert(f.data);break;case 1:a.location.href=f.data;break}},error:function(f){alert("Hubo un error. Intente ms tarde.")}})}d.find(".pin-box input").on("keypress",function(h){var g=e(this),f=h.which||h.keyCode,j=String.fromCharCode(f);if(!j.match(/^[0-9]{1}$/)){h.preventDefault();return}if(g.attr("name")=="pin4"){return}g.next().focus()});d.find(".pin-box input[name=pin4]").on("keyup",function(f){if(d.find(".pin-box input[name=pin4]").val().length){d.submit()}});d.on("submit",function(h){h.preventDefault();var g=e(this),f="";e.each(g.find(".pin-box input"),function(){f+=e(this).val()});if(f!="4444"){alert("Pin invalido.\nEl pin valido para esta demo es 4444");g.find(".pin-box input").val("");g.find(".pin-box input[name=pin1]").focus();return}b()});e(".xapo-demo input[name=pin1]").focus()})(jQuery,window);(function(b){window.AccountConfig=function(e){var d=b.extend({kn3:{baseUrl:"http://www.kn3.net/",domain:"taringa.net"}},e);Kn3Client.configure(b.extend(d.kn3,{dataSignService:"/ajax/kn3-signdata.php"}));b("#upload_avatar").on("change",function(g){var f=b(this);if(!f.val()){return}new a(f)})};function a(f){var e="avatares";function d(l){b(".avatar-loading").removeClass("hide");Kn3Client.upload({file:l,values:{temp:true,app:e},start:function(){},success:k,error:g,progress:function(m){}})}function h(n,m,l,p,o){Kn3Client.crop({url:n,values:{app:e},coor:{x1:m,x2:l,y1:p,y2:o},success:j,error:g})}function k(p){var n=b('<img class="avatar-crop">'),l=b(".avatar-preview img"),m=Kn3Client.resize(p.url,510,420);var o={x1:0,x2:0,y1:0,y2:0};n.on("load",function(){b(".avatar-loading").addClass("hide");console.log("load image");b(".crop-dialog").dialog(nDialog_cfg,{width:"auto"}).dialog("option","buttons",[{text:lang.Guardar,"class":"ui-button-positive box-shadow-soft floatL",click:function(){b(".avatar-loading").removeClass("hide");b(".crop-dialog").dialog("close");var t={x1:r.previewToOriginal(o.x1),x2:r.previewToOriginal(o.x2),y1:r.previewToOriginal(o.y1),y2:r.previewToOriginal(o.y2)};var u=t.x2-t.x1,v=t.y2-t.y1;if(u!=v){if(u<v){t.y2-=v-u}else{t.x2-=u-v}}h(p.url,t.x1,t.x2,t.y1,t.y2)}},{text:lang.Cancelar,"class":"ui-state-default floatR",click:function(){b(this).dialog("close")}}]).html(n).dialog("open");var q=n.width(),s=n.height(),r=new PixelRatio(p.width,n.width());if(q>s){o.x1=(q-s)/2;o.x2=o.x1+s;o.y1=0;o.y2=s}else{o.x1=0;o.x2=q;o.y1=(s-q)/2;o.y2=o.y1+q}n.Jcrop({aspectRatio:1,sideHandles:false,setSelect:[o.x1,o.y1,o.x2,o.y2],minSize:[r.originalToPreview(250),r.originalToPreview(250)],onChange:function(v){var u=120/v.w,t=120/v.h;l.css({width:Math.round(u*n.width())+"px",height:Math.round(t*n.height())+"px",marginLeft:"-"+Math.round(u*v.x)+"px",marginTop:"-"+Math.round(t*v.y)+"px"});o.x1=v.x;o.x2=v.x2;o.y1=v.y;o.y2=v.y2}})});n.attr("src",m);l.attr("src",m)}function j(l){b.ajax({type:"post",url:"/cuenta.php",data:{ajax:1,save:10,url:l.url},success:function(m){b(".avatar-loading").addClass("hide")}})}function g(l){b(".avatar-loading").addClass("hide");var m="Error al subir la imagen";if(l.message){switch(l.message){case"Min height 250":case"Min width 250":m="El tamao minimo de la imagen debe ser de 250x250";break;case"Not animated images allowed":m="No se permiten imagenes animadas (.gif)";break}}mydialog.alert(m,"Error")}d(f)}})(jQuery);(function(g,d){function f(h){h.success=h.success||function(){};h.error=h.error||function(){};g.ajax({type:"POST",dataType:"json",url:"/social_options.php",success:h.success,error:h.error})}function e(h,j){j=j||function(){};f({success:function(k){switch(k.status){case 1:if(typeof k.data[h]!=="undefined"&&k.data[h].activated){j(true)}else{j(false)}break;default:j(false)}},error:function(k){j(false)}})}function b(k){k=k||function(){};var j=window.open("/twitter_link.php","Vincular mi cuenta con Twitter","width=850,height=450,scrollbars=NO,resizable=NO"),h=setInterval(function(){if(j.closed){clearInterval(h);e("twitter",k)}},250)}function a(h){h=h||function(){};Facebook.link(function(){e("facebook",h)},function(){h(false)})}d.isSocialActivated=e;d.associateTwitterAccount=b;d.associateFacebookAccount=a})(jQuery,window);