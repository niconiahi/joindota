if(!window.console){window.console={log:function(){},info:function(){},error:function(){}};}var lang=Array();lang['Aceptar']='Aceptar';lang['Cancelar']='Cancelar';lang['Guardar']='Guardar';lang['Reintentar']='Reintentar';lang["Borrar"]='Borrar';lang["Destruir"]='Destruir';lang['Enviar Denuncia']='Enviar denuncia';lang["Recomendar"]='Recomendar';lang['Recomendar post']="Recomendar post";lang['Recomendar tema']="Recomendar tema";lang['Recomendar Compartir']='Recomendar';lang['Ir a la home']='Ir a la home';lang['ver_mas']='Ver más';lang['ver_menos']='Ver menos';lang['close-preview']='Cerrar previsualización';if(/taringa\.net$/i.test(document.domain)){lang['domain']='taringa.net';}else{lang['domain']='poringa.net';}lang['cuenta_url']='/cuenta/';lang['buscar_url']='/buscar/';lang['mi_url']='/mi';lang['loading']='Cargando...';lang['reactivating']='Reactivando...';lang['Reactivar Post pregunta']='¿Estas seguro que deseas reactivar este Post ?';lang['El post fue eliminado satisfactoriamente']='El post fue eliminado satisfactoriamente';lang['El post fue reactivado satisfactoriamente']='El post fue reactivado satisfactoriamente';lang['Error al reactivar el post, intentalo de nuevo']='Error al reactivar el post, intentalo de nuevo';lang['Error al eliminar el post, intenta de nuevo']='Error al eliminar el post, intenta de nuevo';lang['Reactivar Post']='Reactivar Post';lang['regex_agregar_post']=/http:\/\/(.+?\.)?(taringa|poringa)\.net\/(agregar\/?|edicion\.form\.php\?id=[0-9]+)/;lang['regex_domain']=/poringa/.test(document.domain)?'poringa.net':'taringa.net';lang['shout_borrado_cuerpo']='El shout fue eliminado con éxito';lang['shout_borrado_title']='Shout Eliminado';lang['shout_reactivado_cuerpo']='El shout fue reactivado con éxito';lang['shout_reactivado_title']='Shout reactivado';lang['wallpost_borrado_cuerpo']='La publicaci&oacute;n fue eliminada con éxito';lang['wallpost_borrado_title']='Publicaci&oacute;n Eliminada';lang['mostrar-swf']='Mostrar SWF';lang['ocultar-swf']='Ocultar SWF';lang['pagina']='pagina';lang['try-again']="Hubo un error. Intente nuevamente";lang['Notificaciones']='Notificaciones';lang['Seguidores']='Seguidores';lang['borrar-post-title']='Borrar Post';lang['Borrar Post']='Borrar Post';lang['Ir a la Home']='Ir a la Home';lang['borrar-post-sure']='Te pregunto de nuevo... &iquest;Seguro que deseas borrar este post?';lang['borrar-post']='&iquest;Seguro que deseas borrar este post?';lang['borrar-comunidad']='&iquest;Realmente deseas eliminar la comunidad?<br />Esta opci&oacute;n no tiene retorno, es un camino de ida';lang['borrar-comunidad-sure']='Te pregunto de nuevo. &iquest;Realmente deseas eliminar la comunidad?';lang['borrar-comunidad-sure-youre-sure']='Una &uacute;ltima vez, &iquest;estas seguro que quieres eliminar la comunidad?<br />Este es el &uacute;ltimo paso y es el punto de no retorno';lang['Eliminando']='Eliminando';lang['comunidad-eliminada-title']='La comunidad ha sido eliminada';lang['comunidad-eliminada']='La comunidad ha sido eliminada.<br />Has dejado muchos usuarios hu&eacute;rfanos :(';lang['comu_url']='/comunidades/';lang['Elegir una subcategor&iacute;a']='Elegir una subcategor&iacute;a';lang['borrar-post-causas']={100:'Post duplicado (Aclarar post original)',101:'Publicado en Categoría incorrecta',102:'Contiene imágenes no aptas (Violencia, pornografía, etc.)',103:'Contenido para Taringa! Comunidades http://www.taringa.net/comunidades',104:'Contenido para Mi Taringa! http://www.taringa.net/mi',105:'Contiene virus, código malicioso o intento de fraude',106:'Contiene links prohibidos (Descargas, acortadores, referers, spam etc.)',107:'Contiene imágenes de menores con contenido sexual',108:'Contenido discriminatorio u ofensivo',109:'Contiene información personal mia o de terceros',110:'La fuente es incorrecta o no está presente (Aclarar fuente original)',111:'Contenido no disponible (Imagenes o links rotos)',112:'Discusión agresiva o no apta en comentarios',113:'Título en mayúsculas o llamativo',114:'Viola derechos de propiedad intelectual/copyright http://www.taringa.net/takedown-notice.php',115:'Otros motivos (Aclarar)'};lang['Cargando Formulario de denuncias']='Cargando Formulario de denuncias';lang['Formulario de denuncias']='Formulario de denuncias';lang['Enviar denuncia']='Enviar denuncia';lang['Negrita']="Negrita (Ctrl+B)";lang['Cursiva']="Cursiva (Ctrl+I)";lang['Subrayado']="Subrayado";lang['Alineacion']="Alineaci&oacute;n";lang['Alinear']="Alinear";lang['Alinear a la izquierda']="Alinear a la izquierda";lang['Centrar']="Centrar";lang['Alinear a la derecha']="Alinear a la derecha";lang['Color']="Color";lang['Rojo oscuro']="Rojo oscuro";lang['Rojo']="Rojo";lang['Naranja']="Naranja";lang['Marron']="Marr&oacute;n";lang['Amarillo']="Amarillo";lang['Verde']="Verde";lang['Oliva']="Oliva";lang['Cyan']="Cyan";lang['Gris']="Gris";lang['Azul']="Azul";lang['Azul oscuro']="Azul oscuro";lang['Indigo']="Indigo";lang['Violeta']="Violeta";lang['Negro']="Negro";lang['Tamano']="Tama&ntilde;o";lang['Miniatura']="Miniatura";lang['Pequena']="Peque&ntilde;a";lang['Normal']="Normal";lang['Grande']="Grande";lang['Enorme']="Enorme";lang['Insertar video de YouTube']="Insertar video (Ctrl+Y)";lang['Insertar video de Google Video']="Insertar video de Google Video";lang['Insertar archivo SWF']="Insertar archivo SWF (Ctrl+H)";lang['Insertar Imagen']="Agregar Imagen";lang['Insertar Link']="link";lang['Insertar Emoticon']="Insertar Emoticon";lang['Lista']="Lista (Ctrl+L)";lang['Citar']="Citar (Ctrl+Q)";lang['Ingrese la URL que desea postear']="Ingrese la URL que desea postear";lang['Fuente']="Fuente";lang['Agregar video']="Agregar video";lang['Agregar animacion']="Agregar animación";lang['Agregar link']="Agregar link";lang['Agregar imagen URL']="Agregar Imagen";lang['Ok']="Ok";lang['ingrese el id de yt']="Ingrese la URL de YouTube:\nEjemplo:\nhttp://www.youtube.com/watch?v=CACqDFLQIXI";lang['ingrese el id de gv']="Ingrese el ID del video de Google:\n\nEjemplo:\nSi la URL de su video es:\nhttp://video.google.com/videoplay?docid=-5331378923498461236\nEl ID es: -5331378923498461236";lang['ingrese el id de gv IE']="Ingrese el ID del video de Google:\nPor ejemplo: -5331378923498461236";lang['ingrese la url de swf']="Ingrese la URL del archivo swf";lang['ingrese la url de img']="Ingrese la URL de la imagen";lang['ingrese la url de url']="Ingrese la URL que desea postear";lang['ingrese el txt a citar']="Ingrese el texto a citar";lang['ingrese solo el id de gv']="Ingrese solo el ID de GoogleVideo";lang['Cambiar vista']="Cambiar vista";lang['Simple']='simple';lang['Advanced']='avanzado';lang['Ingrese el texto a citar']="Ingrese el texto a citar";lang['Ingrese la URL']="Ingrese la URL";lang['Desde computadora']="Desde mi computadora";lang['Desde URL']="De internet (URL) (Ctrl+U)";lang['error procesar']='Error al intentar procesar lo solicitado';lang['posts url categorias']='posts';lang['comunidades url']='comunidades';lang['html tema confirma borrar']="Seguro que deseas borrar este tema?";lang['Borrar tema']='Borrar tema';lang['Causa']='Causa';lang['Borrando...']='Borrando...';lang['Tema borrado']='Tema borrado';lang['El tema fue eliminado satisfactoriamente']='El tema fue eliminado satisfactoriamente';lang['Reactivar tema']='Reactivar tema';lang['Realmente deseas reactivar este tema']='Realmente deseas reactivar este tema';lang['Tema reactivado']='Tema reactivado';lang['El tema fue reactivado satisfactoriamente']='El tema fue reactivado satisfactoriamente';lang['mas de 1 año']='Hace 1 año';lang['mas de 1 mes']='Hace 1 mes';lang['mas de 1 dia']='Hace 1 d&iacute;a';lang['mas de 1 hora']='Hace 1 hora';lang['mas de 1 minuto']='Hace instantes';lang['mas de x años']='Hace $1 años';lang['mas de x meses']='Hace $1 meses';lang['mas de x dias']='Hace $1 d&iacute;as';lang['mas de x horas']='Hace $1 horas';lang['mas de x minuto']='Hace $1 minutos';lang['hace mucho tiempo']='Hace mucho tiempo';lang['hace instantes']='Hace instantes';lang['Ingresar']='Identificarme';lang['FACEBOOK_APP_ID']='143125965710465';lang['Cambios aceptados']='Los cambios fueron aceptados y serán aplicados en los próximos minutos.'
lang['Perfil completo al']='Perfil completo al';lang['Borrar favorito']='Borrar favorito';lang['Agregar favorito']='Agregar favorito';lang['Regi&oacute;n']='Regi&oacute;n';lang['Ir a %s.com']='Ir a %s.com';lang['El archivo es demasiado pesado']='El archivo es demasiado pesado';lang['La extension del archivo no es valida']='La extension del archivo no es valida';lang['La imagen no pudo ser enviada']='La imagen no pudo ser enviada';lang['Hubo un error al subir la imagen']='Hubo un error al subir la imagen';lang['limite_votos_negativos']='Hoy parece que no tienes un buen día, piensa en un arco iris y alegrate';lang['limite_votos_negativos_title']='Ops..';function getlang(key){if(typeof lang[key]!='undefined'){return lang[key];}return key;}function getIframeSelectionText(iFrameSelector){var frame=$(iFrameSelector).get(0);var frameWindow=frame.contentWindow;var frameDocument=frameWindow.document;if(frameWindow.getSelection){var isIE11=!!navigator.userAgent.match(/Trident.*rv\:11\./);if(isIE11){var contents=frameWindow.getSelection().getRangeAt(0).extractContents();var result='';for(var i=0;i<contents.childNodes.length;i++){result+=contents.childNodes[i].textContent;if(contents.childNodes[i].textContent&&contents.childNodes[i].tagName=='P'){result+="\n";}}return result;}else{return frameWindow.getSelection().toString();}}else if(frameDocument.selection&&frameDocument.selection.createRange){return frameDocument.selection.createRange().text;}}function number_format(a,b,e,f){a=a;b=b;var c=function(i,g){g=Math.pow(10,g);return(Math.round(i*g)/g).toString()};a=!isFinite(+a)?0:+a;b=!isFinite(+b)?0:Math.abs(b);f=typeof f==="undefined"?",":f;e=typeof e==="undefined"?".":e;var d=b>0?c(a,b):c(Math.round(a),b);c=c(Math.abs(a),b);var h;if(c>=1E3){c=c.split(/\D/);h=c[0].length%3||3;c[0]=d.slice(0,h+(a<0))+c[0].slice(h).replace(/(\d{3})/g,f+"$1");d=c.join(e)}else d=d.replace(".",e);a=d.indexOf(e);if(b>=1&&a!==-1&&d.length-a-1<b)d+=(new Array(b-(d.length-a-1))).join(0)+"0";else if(b>=1&&a===-1)d+=e+(new Array(b)).join(0)+"0";return d};function my_number_format(numero){return number_format(numero,0,',','.');}function strip_tags(input,allowed){allowed=(((allowed||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join('');var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return input.replace(commentsAndPhpTags,'').replace(tags,function($0,$1){return allowed.indexOf('<'+$1.toLowerCase()+'>')>-1?$0:'';});}function empty(a,b){var c;if(a===""||!b&&(a===0||a==="0")||a===null||a===false||typeof a==="undefined")return true;if(typeof a=="object"){for(c in a)return false;return true}return false};window.Socialite=function(a,b,c){var d={},e={},f={},g={},h={},i={},j={},k=a.setTimeout,l=encodeURIComponent,m=typeof b.getElementsByClassName=="function";return e.appendScript=function(a,d,f){if(g[a]||h[a]===c)return!1;var j=g[a]=b.createElement("script");return j.async=!0,j.src=h[a],j.onload=j.onreadystatechange=function(){if(e.hasLoaded(a))return;var b=j.readyState;if(!b||b==="loaded"||b==="complete")i[a]=!0,j.onload=j.onreadystatechange=null,f!==c?typeof f=="function"&&f():e.activateCache(a)},d&&(j.id=d),b.body.appendChild(j),!0},e.hasLoaded=function(a){return typeof a!="string"?!1:i[a]===!0},e.removeScript=function(a){return e.hasLoaded(a)?(b.body.removeChild(g[a]),g[a]=i[a]=!1,!0):!1},e.createIframe=function(a,d){var f=b.createElement("iframe");return f.style.cssText="overflow: hidden; border: none;",f.setAttribute("allowtransparency","true"),f.setAttribute("frameborder","0"),f.setAttribute("scrolling","no"),f.setAttribute("src",a),d!==c&&(m?f.onload=f.onreadystatechange=function(){f.onload=f.onreadystatechange=null,e.activateInstance(d)}:k(function(){e.activateInstance(d)},10)),f},e.activateInstance=function(a){if(a.loaded)return;a.loaded=!0,a.container.className+=" socialite-loaded"},e.activateCache=function(a){if(j[a]!==c)for(var b=0;b<j[a].length;b++)e.activateInstance(j[a][b])},e.copyDataAttributes=function(a,b){var c,d=a.attributes;for(c=0;c<d.length;c++){var e=d[c].name,f=d[c].value;e.indexOf("data-")===0&&f.length&&b.setAttribute(e,f)}},e.getDataAttributes=function(a,b,c){var d,e="",f={},g=a.attributes;for(d=0;d<g.length;d++){var h=g[d].name,i=g[d].value;h.indexOf("data-")===0&&i.length&&(b===!0&&(h=h.substring(5)),c?f[h]=i:e+=l(h)+"="+l(i)+"&")}return c?f:e},e.getElements=function(a,b){if(m)return a.getElementsByClassName(b);var c=0,d=[],e=a.getElementsByTagName("*"),f=e.length;for(c=0;c<f;c++){var g=" "+e[c].className+" ";g.indexOf(" "+b+" ")!==-1&&d.push(e[c])}return d},d.activate=function(a,b){d.load(null,a,b)},d.load=function(a,g,h){a=typeof a=="object"&&a!==null&&a.nodeType===1?a:b;if(g===c||g===null){var i=e.getElements(a,"socialite"),k=i,l=i.length;if(!l)return;if(typeof k.item!==c){k=[];for(var m=0;m<l;m++)k[m]=i[m]}d.load(a,k,h);return}if(typeof g=="object"&&g.length){for(var n=0;n<g.length;n++)d.load(a,g[n],h);return}if(typeof g!="object"||g.nodeType!==1)return;if(typeof h!="string"||f[h]===c){h=null;var o=g.className.split(" ");for(var p=0;p<o.length;p++)if(f[o[p]]!==c){h=o[p];break}if(typeof h!="string")return}typeof f[h]=="string"&&(h=f[h]);if(typeof f[h]!="function")return;var q=b.createElement("div"),r=b.createElement("div");q.className="socialised "+h,r.className="socialite-button";var s=g.parentNode;s===null?(s=a===b?b.body:a,s.appendChild(q)):s.insertBefore(q,g),q.appendChild(r),r.appendChild(g),g.className=g.className.replace(/\bsocialite\b/,""),j[h]===c&&(j[h]=[]);var t={elem:g,button:r,container:q,parent:s,loaded:!1};j[h].push(t),f[h](t,e)},d.extend=function(a,b,d){if(typeof a!="string"||typeof b!="function")return!1;a=a.indexOf(" ")>0?a.split(" "):[a];if(f[a[0]]!==c)return!1;for(var e=1;e<a.length;e++)f[a[e]]=a[0];return d!==c&&typeof d=="string"&&(h[a[0]]=d),f[a[0]]=b,!0},d}(window,window.document),function(a,b,c,d){c.extend("twitter tweet",function(c,e){var f=c.elem,g=" "+f.className+" ";if(g.indexOf(" tweet ")!==-1)f.className="twitter-tweet";else{var h=b.createElement("a"),i=f.getAttribute("data-type"),j=["share","follow","hashtag","mention"],k=0;for(var l=1;l<4;l++)if(i===j[l]||g.indexOf(" "+j[l]+" ")!==-1)k=l;h.className="twitter-"+j[k]+"-button",f.getAttribute("href")!==d&&h.setAttribute("href",f.href),e.copyDataAttributes(f,h),c.button.replaceChild(h,f)}var m=a.twttr;typeof m=="object"&&typeof m.widgets=="object"&&typeof m.widgets.load=="function"?(m.widgets.load(),e.activateInstance(c)):(e.hasLoaded("twitter")&&e.removeScript("twitter"),e.appendScript("twitter","twitter-wjs",!1)&&(a.twttr={_e:[function(){e.activateCache("twitter")}]}))},"//platform.twitter.com/widgets.js"),c.extend("googleplus",function(c,d){var e=c.elem,f=b.createElement("div");f.className="g-plusone",d.copyDataAttributes(e,f),c.button.replaceChild(f,e),typeof a.gapi=="object"&&typeof a.gapi.plusone=="object"&&typeof gapi.plusone.render=="function"?(a.gapi.plusone.render(c.button,d.getDataAttributes(f,!0,!0)),d.activateInstance(c)):d.hasLoaded("googleplus")||d.appendScript("googleplus")},"//apis.google.com/js/plusone.js"),c.extend("facebook",function(a,c){var d=a.elem,e=b.createElement("div"),f=b.getElementById("fb-root");if(!f&&!c.hasLoaded("facebook"))f=b.createElement("div"),f.id="fb-root",b.body.appendChild(f),e.className="fb-like",c.copyDataAttributes(d,e),a.button.replaceChild(e,d),c.appendScript("facebook","facebook-jssdk");else{var g="//www.facebook.com/plugins/like.php?";g+=c.getDataAttributes(d,!0);var h=c.createIframe(g,a);a.button.replaceChild(h,d)}},"//connect.facebook.net/en_US/all.js#xfbml=1"),c.extend("linkedin",function(c,d){var e=c.elem,f=e.attributes,g=b.createElement("script");g.type="IN/Share",d.copyDataAttributes(e,g),c.button.replaceChild(g,e),typeof a.IN=="object"&&typeof a.IN.init=="function"?(a.IN.init(),d.activateInstance(c)):d.hasLoaded("linkedin")||d.appendScript("linkedin")},"//platform.linkedin.com/in.js"),c.extend("pinit",function(a,c){var e=a.elem,f=b.createElement("a");f.className="pin-it-button",e.getAttribute("href")!==d&&f.setAttribute("href",e.href);var g=e.getAttribute("data-count-layout")||"horizontal";f.setAttribute("count-layout",g),a.button.replaceChild(f,e),c.hasLoaded("pinit")&&c.removeScript("pinit"),c.appendScript("pinit")},"//assets.pinterest.com/js/pinit.js"),c.extend("spotify-play",function(a,b){var c=a.elem,d="https://embed.spotify.com/?",e=parseInt(c.getAttribute("data-width"),10),f=parseInt(c.getAttribute("data-height"),10);c.removeAttribute("data-width"),c.removeAttribute("data-height"),d+="uri="+c.getAttribute("href")+"&",d+=b.getDataAttributes(c,!0);var g=b.createIframe(d,a);g.style.width=(isNaN(e)?300:e)+"px",g.style.height=(isNaN(f)?380:f)+"px",a.button.replaceChild(g,c),b.activateInstance(a)},"")}(window,window.document,window.Socialite);(function(a){a.fn.lazyload=function(c){var b={placeHolder:'blank.gif',effect:'show',effectSpeed:0,sensitivity:0};if(c)a.extend(b,c);this.each(function(){if(a(this).attr('src')!=b.placeHolder)a(this).attr('src',b.placeHolder);a(this).one('dl',function(){if(a(this).attr('orig')&&a(this).attr('orig')!=a(this).attr('src'))a(this).hide().attr('src',a(this).attr('orig'))[b.effect](b.effectSpeed)})});var d=this;a(window).bind('scroll',function(){a(d).filter('[src$="'+b.placeHolder+'"]').each(function(){if((a(window).height()+a(window).scrollTop()>a(this).offset().top-b.sensitivity)&&(a(window).width()+a(window).scrollLeft()>a(this).offset().left-b.sensitivity)&&(a(window).scrollTop()<a(this).offset().top+a(this).height()+b.sensitivity)&&(a(window).scrollLeft()<a(this).offset().left+a(this).width()+b.sensitivity))a(this).trigger('dl')})});a(window).trigger('scroll');return this}})(jQuery);(function(d){var k=d.scrollTo=function(a,i,e){d(window).scrollTo(a,i,e)};k.defaults={axis:'xy',duration:parseFloat(d.fn.jquery)>=1.3?0:1};k.window=function(a){return d(window)._scrollable()};d.fn._scrollable=function(){return this.map(function(){var a=this,i=!a.nodeName||d.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!i)return a;var e=(a.contentWindow||a).document||a.ownerDocument||a;return d.browser.safari||e.compatMode=='BackCompat'?e.body:e.documentElement})};d.fn.scrollTo=function(n,j,b){if(typeof j=='object'){b=j;j=0}if(typeof b=='function')b={onAfter:b};if(n=='max')n=9e9;b=d.extend({},k.defaults,b);j=j||b.speed||b.duration;b.queue=b.queue&&b.axis.length>1;if(b.queue)j/=2;b.offset=p(b.offset);b.over=p(b.over);return this._scrollable().each(function(){var q=this,r=d(q),f=n,s,g={},u=r.is('html,body');switch(typeof f){case'number':case'string':if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(f)){f=p(f);break}f=d(f,this);case'object':if(f.is||f.style)s=(f=d(f)).offset()}d.each(b.axis.split(''),function(a,i){var e=i=='x'?'Left':'Top',h=e.toLowerCase(),c='scroll'+e,l=q[c],m=k.max(q,i);if(s){g[c]=s[h]+(u?0:l-r.offset()[h]);if(b.margin){g[c]-=parseInt(f.css('margin'+e))||0;g[c]-=parseInt(f.css('border'+e+'Width'))||0}g[c]+=b.offset[h]||0;if(b.over[h])g[c]+=f[i=='x'?'width':'height']()*b.over[h]}else{var o=f[h];g[c]=o.slice&&o.slice(-1)=='%'?parseFloat(o)/100*m:o}if(/^\d+$/.test(g[c]))g[c]=g[c]<=0?0:Math.min(g[c],m);if(!a&&b.queue){if(l!=g[c])t(b.onAfterFirst);delete g[c]}});t(b.onAfter);function t(a){r.animate(g,j,b.easing,a&&function(){a.call(this,n,b)})}}).end()};k.max=function(a,i){var e=i=='x'?'Width':'Height',h='scroll'+e;if(!d(a).is('html,body'))return a[h]-d(a)[e.toLowerCase()]();var c='client'+e,l=a.ownerDocument.documentElement,m=a.ownerDocument.body;return Math.max(l[h],m[h])-Math.min(l[c],m[c])};function p(a){return typeof a=='object'?a:{top:a,left:a}}})(jQuery);(function($){$.belowthefold=function(element,settings){var fold=$(window).height()+$(window).scrollTop();return fold<=$(element).offset().top-settings.threshold;};$.abovethetop=function(element,settings){var top=$(window).scrollTop();return top>=$(element).offset().top+$(element).height()-settings.threshold;};$.rightofscreen=function(element,settings){var fold=$(window).width()+$(window).scrollLeft();return fold<=$(element).offset().left-settings.threshold;};$.leftofscreen=function(element,settings){var left=$(window).scrollLeft();return left>=$(element).offset().left+$(element).width()-settings.threshold;};$.inviewport=function(element,settings){return!$.rightofscreen(element,settings)&&!$.leftofscreen(element,settings)&&!$.belowthefold(element,settings)&&!$.abovethetop(element,settings);};$.extend($.expr[':'],{"below-the-fold":function(a,i,m){return $.belowthefold(a,{threshold:0});},"above-the-top":function(a,i,m){return $.abovethetop(a,{threshold:0});},"left-of-screen":function(a,i,m){return $.leftofscreen(a,{threshold:0});},"right-of-screen":function(a,i,m){return $.rightofscreen(a,{threshold:0});},"in-viewport":function(a,i,m){return $.inviewport(a,{threshold:0});}});})(jQuery);;(function($){$.notificationOptions={click:function(){},content:'',duration:5000,fadeIn:400,fadeOut:400,limit:false,queue:false,slideUp:200,horizontal:'right',vertical:'top'};var Notification=function(options){var that=this;var htmlElement=$(['<a href="'+options.link+'" data-href="'+options.link+'" class="notification" style="display:none">','<div class="close"></div>',options.content,'</a>'].join(''));this.getHtmlElement=function(){return htmlElement;};this.hide=function(){htmlElement.addClass('hiding');htmlElement.animate({opacity:.01},options.fadeOut,function(){var queued=queue.shift();if(queued){$.createNotification(queued);}}).slideUp(options.slideUp,function(){$(this).remove();});};this.show=function(board){htmlElement[options.vertical=='top'?'appendTo':'prependTo'](board);htmlElement.fadeIn(options.fadeIn);};htmlElement.on('mousedown',function(event){if(!$(event.target).hasClass('close')){options.click.call(that,event);}});htmlElement.on('click',function(event){if($(event.target).hasClass('close')){event.preventDefault();that.hide();}});htmlElement.on('mouseenter',function(event){htmlElement.addClass('hover');});htmlElement.on('mouseleave',function(event){if(htmlElement.hasClass('pending')){that.hide();}htmlElement.removeClass('hover');});htmlElement.find('span, img').on('mouseenter',function(event){var elem=$(this);elem.closest('.notification').attr('href',elem.attr('href'));}).on('mouseleave',function(event){var notification=$(this).closest('.notification');notification.attr('href',notification.attr('data-href'));});if(options.duration){setTimeout(function(){if(htmlElement.hasClass('hover')){htmlElement.addClass('pending');}else{that.hide();}},options.duration);}return this;};var queue=[];$.createNotification=function(options){options=$.extend({},$.notificationOptions,options||{});var board=$('.notification-board.'+options.horizontal+'.'+options.vertical);if(!board.length){board=$('<div class="notification-board '+options.horizontal+' '+options.vertical+'" />');board.appendTo('body');}if(options.limit&&board.children('.notification:not(.hiding)').length>=options.limit){if(options.queue){queue.push(options);}return;}var notification=new Notification(options)
notification.show(board);return notification;};})(jQuery);(function($){var uid='ar'+ +new Date,defaults=autoResize.defaults={onResize:function(){},onBeforeResize:function(){return 123},onAfterResize:function(){return 555},animate:{duration:200,complete:function(){}},extraSpace:50,minHeight:'original',maxHeight:500,minWidth:'original',maxWidth:500};autoResize.cloneCSSProperties=['lineHeight','textDecoration','letterSpacing','fontSize','fontFamily','fontStyle','fontWeight','textTransform','textAlign','direction','wordSpacing','fontSizeAdjust','paddingTop','paddingLeft','paddingBottom','paddingRight','width'];autoResize.cloneCSSValues={position:'absolute',top:-9999,left:-9999,opacity:0,overflow:'hidden'};autoResize.resizableFilterSelector=['textarea:not(textarea.'+uid+')','input:not(input[type])','input[type=text]','input[type=password]','input[type=email]','input[type=url]'].join(',');autoResize.AutoResizer=AutoResizer;$.fn.autoResize=autoResize;function autoResize(config){this.filter(autoResize.resizableFilterSelector).each(function(){new AutoResizer($(this),config);});return this;}function AutoResizer(el,config){if(el.data('AutoResizer')){el.data('AutoResizer').destroy();}config=this.config=$.extend({},autoResize.defaults,config);this.el=el;this.nodeName=el[0].nodeName.toLowerCase();this.originalHeight=el.height();this.previousScrollTop=null;this.value=el.val();if(config.maxWidth==='original')config.maxWidth=el.width();if(config.minWidth==='original')config.minWidth=el.width();if(config.maxHeight==='original')config.maxHeight=el.height();if(config.minHeight==='original')config.minHeight=el.height();if(this.nodeName==='textarea'){el.css({resize:'none',overflowY:'hidden'});}el.data('AutoResizer',this);config.animate.complete=(function(f){return function(){config.onAfterResize.call(el);return f.apply(this,arguments);};}(config.animate.complete));this.bind();}AutoResizer.prototype={bind:function(){var check=$.proxy(function(){this.check();return true;},this);this.unbind();this.el.bind('keyup.autoResize',check).bind('change.autoResize',check).bind('paste.autoResize',function(){setTimeout(function(){check();},0);});if(!this.el.is(':hidden')){this.check(null,true);}},unbind:function(){this.el.unbind('.autoResize');},createClone:function(){var el=this.el,clone=this.nodeName==='textarea'?el.clone():$('<span/>');this.clone=clone;$.each(autoResize.cloneCSSProperties,function(i,p){clone[0].style[p]=el.css(p);});clone.removeAttr('name').removeAttr('id').addClass(uid).attr('tabIndex',-1).css(autoResize.cloneCSSValues);if(this.nodeName==='textarea'){clone.height('auto');}else{clone.width('auto').css({whiteSpace:'nowrap'});}},check:function(e,immediate){if(!this.clone){this.createClone();this.injectClone();}var config=this.config,clone=this.clone,el=this.el,value=el.val();if(value===this.prevValue){return true;}this.prevValue=value;if(this.nodeName==='input'){clone.text(value);var cloneWidth=clone.width(),newWidth=(cloneWidth+config.extraSpace)>=config.minWidth?cloneWidth+config.extraSpace:config.minWidth,currentWidth=el.width();newWidth=Math.min(newWidth,config.maxWidth);if((newWidth<currentWidth&&newWidth>=config.minWidth)||(newWidth>=config.minWidth&&newWidth<=config.maxWidth)){config.onBeforeResize.call(el);config.onResize.call(el);el.scrollLeft(0);if(config.animate&&!immediate){el.stop(1,1).animate({width:newWidth},config.animate);}else{el.width(newWidth);config.onAfterResize.call(el);}}return;}clone.width(el.width()).height(0).val(value).scrollTop(10000);var scrollTop=clone[0].scrollTop;if(this.previousScrollTop===scrollTop){return;}this.previousScrollTop=scrollTop;if(scrollTop+config.extraSpace>=config.maxHeight){el.css('overflowY','');scrollTop=config.maxHeight;immediate=true;}else if(scrollTop<=config.minHeight){scrollTop=config.minHeight;}else{el.css('overflowY','hidden');scrollTop+=config.extraSpace;}config.onBeforeResize.call(el);config.onResize.call(el);if(config.animate&&!immediate){el.stop(1,1).animate({height:scrollTop},config.animate);}else{el.height(scrollTop);config.onAfterResize.call(el);}},destroy:function(){this.unbind();this.el.removeData('AutoResizer');this.clone.remove();delete this.el;delete this.clone;},injectClone:function(){(autoResize.cloneContainer||(autoResize.cloneContainer=$('<arclones/>').appendTo('body'))).append(this.clone);}};})(jQuery);(function(l){l.fn.blurjs=function(e){function O(){this.a=this.b=this.g=this.r=0;this.next=null}var y=document.createElement("canvas"),P=!1,H=l(this).selector.replace(/[^a-zA-Z0-9]/g,"");if(y.getContext){var e=l.extend({source:"body",radius:5,overlay:"",offset:{x:0,y:0},optClass:"",cache:!1,cacheKeyPrefix:"blurjs-",draggable:!1,debug:!1},e),R=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],S=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return this.each(function(){var A=l(this),I=l(e.source),B=I.css("backgroundImage").replace(/"/g,"").replace(/url\(|\)$/ig,"");ctx=y.getContext("2d");tempImg=new Image;tempImg.onload=function(){if(P)j=tempImg.src;else{y.style.display="none";y.width=tempImg.width;y.height=tempImg.height;ctx.drawImage(tempImg,0,0);var j=y.width,q=y.height,k=e.radius;if(!(isNaN(k)||1>k)){var k=k|0,M=y.getContext("2d"),l;try{try{l=M.getImageData(0,0,j,q)}catch(L){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),l=M.getImageData(0,0,j,q)}catch(T){throw alert("Cannot access local image"),Error("unable to access local image data: "+T);}}}catch(U){throw alert("Cannot access image"),Error("unable to access image data: "+U);}var c=l.data,u,z,a,d,f,J,g,h,i,v,w,x,m,n,o,r,s,t,C;u=k+k+1;var K=j-1,N=q-1,p=k+1,D=p*(p+1)/2,E=new O,b=E;for(a=1;a<u;a++)if(b=b.next=new O,a==p)var Q=b;b.next=E;b=a=null;J=f=0;var F=R[k],G=S[k];for(z=0;z<q;z++){m=n=o=g=h=i=0;v=p*(r=c[f]);w=p*(s=c[f+1]);x=p*(t=c[f+2]);g+=D*r;h+=D*s;i+=D*t;b=E;for(a=0;a<p;a++)b.r=r,b.g=s,b.b=t,b=b.next;for(a=1;a<p;a++)d=f+((K<a?K:a)<<2),g+=(b.r=r=c[d])*(C=p-a),h+=(b.g=s=c[d+1])*C,i+=(b.b=t=c[d+2])*C,m+=r,n+=s,o+=t,b=b.next;a=E;b=Q;for(u=0;u<j;u++)c[f]=g*F>>G,c[f+1]=h*F>>G,c[f+2]=i*F>>G,g-=v,h-=w,i-=x,v-=a.r,w-=a.g,x-=a.b,d=J+((d=u+k+1)<K?d:K)<<2,m+=a.r=c[d],n+=a.g=c[d+1],o+=a.b=c[d+2],g+=m,h+=n,i+=o,a=a.next,v+=r=b.r,w+=s=b.g,x+=t=b.b,m-=r,n-=s,o-=t,b=b.next,f+=4;J+=j}for(u=0;u<j;u++){n=o=m=h=i=g=0;f=u<<2;v=p*(r=c[f]);w=p*(s=c[f+1]);x=p*(t=c[f+2]);g+=D*r;h+=D*s;i+=D*t;b=E;for(a=0;a<p;a++)b.r=r,b.g=s,b.b=t,b=b.next;d=j;for(a=1;a<=k;a++)f=d+u<<2,g+=(b.r=r=c[f])*(C=p-a),h+=(b.g=s=c[f+1])*C,i+=(b.b=t=c[f+2])*C,m+=r,n+=s,o+=t,b=b.next,a<N&&(d+=j);f=u;a=E;b=Q;for(z=0;z<q;z++)d=f<<2,c[d]=g*F>>G,c[d+1]=h*F>>G,c[d+2]=i*F>>G,g-=v,h-=w,i-=x,v-=a.r,w-=a.g,x-=a.b,d=u+((d=z+p)<N?d:N)*j<<2,g+=m+=a.r=c[d],h+=n+=a.g=c[d+1],i+=o+=a.b=c[d+2],a=a.next,v+=r=b.r,w+=s=b.g,x+=t=b.b,m-=r,n-=s,o-=t,b=b.next,f+=j}M.putImageData(l,0,0)}if(!1!=e.overlay)ctx.beginPath(),ctx.rect(0,0,tempImg.width,tempImg.width),ctx.fillStyle=e.overlay,ctx.fill();var j=y.toDataURL();if(e.cache)try{e.debug&&console.log("Cache Set"),localStorage.setItem(e.cacheKeyPrefix+H+"-"+B+"-data-image",j)}catch(V){console.log(V)}}q=I.css("backgroundAttachment");k="fixed"==q?"":"-"+(A.offset().left-I.offset().left-e.offset.x)+"px -"+(A.offset().top-I.offset().top-e.offset.y)+"px";A.css({"background-image":'url("'+j+'")',"background-repeat":I.css("backgroundRepeat"),"background-position":k,"background-attachment":q});!1!=e.optClass&&A.addClass(e.optClass);e.draggable&&(A.css({"background-attachment":"fixed","background-position":"0 0"}),A.draggable())};Storage.prototype.cacheChecksum=function(j){var q="",k;for(k in j)var l=j[k],q="[object Object]"==l.toString()?q+(l.x.toString()+l.y.toString()+",").replace(/[^a-zA-Z0-9]/g,""):q+(l+",").replace(/[^a-zA-Z0-9]/g,"");this.getItem(e.cacheKeyPrefix+H+"-"+B+"-options-cache")!=q&&(this.removeItem(e.cacheKeyPrefix+H+"-"+B+"-options-cache"),this.setItem(e.cacheKeyPrefix+H+"-"+B+"-options-cache",q),e.debug&&console.log("Settings Changed, Cache Emptied"))};var L=null;e.cache&&(localStorage.cacheChecksum(e),L=localStorage.getItem(e.cacheKeyPrefix+H+"-"+B+"-data-image"));null!=L?(e.debug&&console.log("Cache Used"),P=!0,tempImg.src=L):(e.debug&&console.log("Source Used"),tempImg.src=B)})}}})(jQuery);(function($,undefined){$.fn.imagesLoaded=function(callback){var $this=this,$images=$this.find('img').add($this.filter('img')),len=$images.length,blank='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';function triggerCallback(){callback.call($this,$images);}function imgLoaded(event){if(--len<=0&&event.target.src!==blank){setTimeout(triggerCallback);$images.unbind('load error',imgLoaded);}}if(!len){triggerCallback();}$images.bind('load error',imgLoaded).each(function(){if(this.complete||typeof this.complete==="undefined"){var src=this.src;this.src=blank;this.src=src;}});return $this;};})(jQuery);(function(a){a.Jcrop=function(b,c){function i(a){return Math.round(a)+"px"}function j(a){return d.baseClass+"-"+a}function k(){return a.fx.step.hasOwnProperty("backgroundColor")}function l(b){var c=a(b).offset();return[c.left,c.top]}function m(a){return[a.pageX-e[0],a.pageY-e[1]]}function n(b){typeof b!="object"&&(b={}),d=a.extend(d,b),a.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){typeof d[b]!="function"&&(d[b]=function(){})})}function o(a,b,c){e=l(D),bc.setCursor(a==="move"?a:a+"-resize");if(a==="move")return bc.activateHandlers(q(b),v,c);var d=_.getFixed(),f=r(a),g=_.getCorner(r(f));_.setPressed(_.getCorner(f)),_.setCurrent(g),bc.activateHandlers(p(a,d),v,c)}function p(a,b){return function(c){if(!d.aspectRatio)switch(a){case"e":c[1]=b.y2;break;case"w":c[1]=b.y2;break;case"n":c[0]=b.x2;break;case"s":c[0]=b.x2}else switch(a){case"e":c[1]=b.y+1;break;case"w":c[1]=b.y+1;break;case"n":c[0]=b.x+1;break;case"s":c[0]=b.x+1}_.setCurrent(c),bb.update()}}function q(a){var b=a;return bd.watchKeys(),function(a){_.moveOffset([a[0]-b[0],a[1]-b[1]]),b=a,bb.update()}}function r(a){switch(a){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function s(a){return function(b){return d.disabled?!1:a==="move"&&!d.allowMove?!1:(e=l(D),W=!0,o(a,m(b)),b.stopPropagation(),b.preventDefault(),!1)}}function t(a,b,c){var d=a.width(),e=a.height();d>b&&b>0&&(d=b,e=b/a.width()*a.height()),e>c&&c>0&&(e=c,d=c/a.height()*a.width()),T=a.width()/d,U=a.height()/e,a.width(d).height(e)}function u(a){return{x:a.x*T,y:a.y*U,x2:a.x2*T,y2:a.y2*U,w:a.w*T,h:a.h*U}}function v(a){var b=_.getFixed();b.w>d.minSelect[0]&&b.h>d.minSelect[1]?(bb.enableHandles(),bb.done()):bb.release(),bc.setCursor(d.allowSelect?"crosshair":"default")}function w(a){if(d.disabled)return!1;if(!d.allowSelect)return!1;W=!0,e=l(D),bb.disableHandles(),bc.setCursor("crosshair");var b=m(a);return _.setPressed(b),bb.update(),bc.activateHandlers(x,v,a.type.substring(0,5)==="touch"),bd.watchKeys(),a.stopPropagation(),a.preventDefault(),!1}function x(a){_.setCurrent(a),bb.update()}function y(){var b=a("<div></div>").addClass(j("tracker"));return g&&b.css({opacity:0,backgroundColor:"white"}),b}function be(a){G.removeClass().addClass(j("holder")).addClass(a)}function bf(a,b){function t(){window.setTimeout(u,l)}var c=a[0]/T,e=a[1]/U,f=a[2]/T,g=a[3]/U;if(X)return;var h=_.flipCoords(c,e,f,g),i=_.getFixed(),j=[i.x,i.y,i.x2,i.y2],k=j,l=d.animationDelay,m=h[0]-j[0],n=h[1]-j[1],o=h[2]-j[2],p=h[3]-j[3],q=0,r=d.swingSpeed;c=k[0],e=k[1],f=k[2],g=k[3],bb.animMode(!0);var s,u=function(){return function(){q+=(100-q)/r,k[0]=Math.round(c+q/100*m),k[1]=Math.round(e+q/100*n),k[2]=Math.round(f+q/100*o),k[3]=Math.round(g+q/100*p),q>=99.8&&(q=100),q<100?(bh(k),t()):(bb.done(),bb.animMode(!1),typeof b=="function"&&b.call(bs))}}();t()}function bg(a){bh([a[0]/T,a[1]/U,a[2]/T,a[3]/U]),d.onSelect.call(bs,u(_.getFixed())),bb.enableHandles()}function bh(a){_.setPressed([a[0],a[1]]),_.setCurrent([a[2],a[3]]),bb.update()}function bi(){return u(_.getFixed())}function bj(){return _.getFixed()}function bk(a){n(a),br()}function bl(){d.disabled=!0,bb.disableHandles(),bb.setCursor("default"),bc.setCursor("default")}function bm(){d.disabled=!1,br()}function bn(){bb.done(),bc.activateHandlers(null,null)}function bo(){G.remove(),A.show(),A.css("visibility","visible"),a(b).removeData("Jcrop")}function bp(a,b){bb.release(),bl();var c=new Image;c.onload=function(){var e=c.width,f=c.height,g=d.boxWidth,h=d.boxHeight;D.width(e).height(f),D.attr("src",a),H.attr("src",a),t(D,g,h),E=D.width(),F=D.height(),H.width(E).height(F),M.width(E+L*2).height(F+L*2),G.width(E).height(F),ba.resize(E,F),bm(),typeof b=="function"&&b.call(bs)},c.src=a}function bq(a,b,c){var e=b||d.bgColor;d.bgFade&&k()&&d.fadeTime&&!c?a.animate({backgroundColor:e},{queue:!1,duration:d.fadeTime}):a.css("backgroundColor",e)}function br(a){d.allowResize?a?bb.enableOnly():bb.enableHandles():bb.disableHandles(),bc.setCursor(d.allowSelect?"crosshair":"default"),bb.setCursor(d.allowMove?"move":"default"),d.hasOwnProperty("trueSize")&&(T=d.trueSize[0]/E,U=d.trueSize[1]/F),d.hasOwnProperty("setSelect")&&(bg(d.setSelect),bb.done(),delete d.setSelect),ba.refresh(),d.bgColor!=N&&(bq(d.shade?ba.getShades():G,d.shade?d.shadeColor||d.bgColor:d.bgColor),N=d.bgColor),O!=d.bgOpacity&&(O=d.bgOpacity,d.shade?ba.refresh():bb.setBgOpacity(O)),P=d.maxSize[0]||0,Q=d.maxSize[1]||0,R=d.minSize[0]||0,S=d.minSize[1]||0,d.hasOwnProperty("outerImage")&&(D.attr("src",d.outerImage),delete d.outerImage),bb.refresh()}var d=a.extend({},a.Jcrop.defaults),e,f=navigator.userAgent.toLowerCase(),g=/msie/.test(f),h=/msie [1-6]\./.test(f);typeof b!="object"&&(b=a(b)[0]),typeof c!="object"&&(c={}),n(c);var z={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},A=a(b),B=!0;if(b.tagName=="IMG"){if(A[0].width!=0&&A[0].height!=0)A.width(A[0].width),A.height(A[0].height);else{var C=new Image;C.src=A[0].src,A.width(C.width),A.height(C.height)}var D=A.clone().removeAttr("id").css(z).show();D.width(A.width()),D.height(A.height()),A.after(D).hide()}else D=A.css(z).show(),B=!1,d.shade===null&&(d.shade=!0);t(D,d.boxWidth,d.boxHeight);var E=D.width(),F=D.height(),G=a("<div />").width(E).height(F).addClass(j("holder")).css({position:"relative",backgroundColor:d.bgColor}).insertAfter(A).append(D);d.addClass&&G.addClass(d.addClass);var H=a("<div />"),I=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),J=a("<div />").width("100%").height("100%").css("zIndex",320),K=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=_.getFixed();d.onDblClick.call(bs,a)}).insertBefore(D).append(I,J);B&&(H=a("<img />").attr("src",D.attr("src")).css(z).width(E).height(F),I.append(H)),h&&K.css({overflowY:"hidden"});var L=d.boundary,M=y().width(E+L*2).height(F+L*2).css({position:"absolute",top:i(-L),left:i(-L),zIndex:290}).mousedown(w),N=d.bgColor,O=d.bgOpacity,P,Q,R,S,T,U,V=!0,W,X,Y;e=l(D);var Z=function(){function a(){var a={},b=["touchstart","touchmove","touchend"],c=document.createElement("div"),d;try{for(d=0;d<b.length;d++){var e=b[d];e="on"+e;var f=e in c;f||(c.setAttribute(e,"return;"),f=typeof c[e]=="function"),a[b[d]]=f}return a.touchstart&&a.touchend&&a.touchmove}catch(g){return!1}}function b(){return d.touchSupport===!0||d.touchSupport===!1?d.touchSupport:a()}return{createDragger:function(a){return function(b){return d.disabled?!1:a==="move"&&!d.allowMove?!1:(e=l(D),W=!0,o(a,m(Z.cfilter(b)),!0),b.stopPropagation(),b.preventDefault(),!1)}},newSelection:function(a){return w(Z.cfilter(a))},cfilter:function(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,a},isSupported:a,support:b()}}(),_=function(){function h(d){d=n(d),c=a=d[0],e=b=d[1]}function i(a){a=n(a),f=a[0]-c,g=a[1]-e,c=a[0],e=a[1]}function j(){return[f,g]}function k(d){var f=d[0],g=d[1];0>a+f&&(f-=f+a),0>b+g&&(g-=g+b),F<e+g&&(g+=F-(e+g)),E<c+f&&(f+=E-(c+f)),a+=f,c+=f,b+=g,e+=g}function l(a){var b=m();switch(a){case"ne":return[b.x2,b.y];case"nw":return[b.x,b.y];case"se":return[b.x2,b.y2];case"sw":return[b.x,b.y2]}}function m(){if(!d.aspectRatio)return p();var f=d.aspectRatio,g=d.minSize[0]/T,h=d.maxSize[0]/T,i=d.maxSize[1]/U,j=c-a,k=e-b,l=Math.abs(j),m=Math.abs(k),n=l/m,r,s,t,u;return h===0&&(h=E*10),i===0&&(i=F*10),n<f?(s=e,t=m*f,r=j<0?a-t:t+a,r<0?(r=0,u=Math.abs((r-a)/f),s=k<0?b-u:u+b):r>E&&(r=E,u=Math.abs((r-a)/f),s=k<0?b-u:u+b)):(r=c,u=l/f,s=k<0?b-u:b+u,s<0?(s=0,t=Math.abs((s-b)*f),r=j<0?a-t:t+a):s>F&&(s=F,t=Math.abs(s-b)*f,r=j<0?a-t:t+a)),r>a?(r-a<g?r=a+g:r-a>h&&(r=a+h),s>b?s=b+(r-a)/f:s=b-(r-a)/f):r<a&&(a-r<g?r=a-g:a-r>h&&(r=a-h),s>b?s=b+(a-r)/f:s=b-(a-r)/f),r<0?(a-=r,r=0):r>E&&(a-=r-E,r=E),s<0?(b-=s,s=0):s>F&&(b-=s-F,s=F),q(o(a,b,r,s))}function n(a){return a[0]<0&&(a[0]=0),a[1]<0&&(a[1]=0),a[0]>E&&(a[0]=E),a[1]>F&&(a[1]=F),[Math.round(a[0]),Math.round(a[1])]}function o(a,b,c,d){var e=a,f=c,g=b,h=d;return c<a&&(e=c,f=a),d<b&&(g=d,h=b),[e,g,f,h]}function p(){var d=c-a,f=e-b,g;return P&&Math.abs(d)>P&&(c=d>0?a+P:a-P),Q&&Math.abs(f)>Q&&(e=f>0?b+Q:b-Q),S/U&&Math.abs(f)<S/U&&(e=f>0?b+S/U:b-S/U),R/T&&Math.abs(d)<R/T&&(c=d>0?a+R/T:a-R/T),a<0&&(c-=a,a-=a),b<0&&(e-=b,b-=b),c<0&&(a-=c,c-=c),e<0&&(b-=e,e-=e),c>E&&(g=c-E,a-=g,c-=g),e>F&&(g=e-F,b-=g,e-=g),a>E&&(g=a-F,e-=g,b-=g),b>F&&(g=b-F,e-=g,b-=g),q(o(a,b,c,e))}function q(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var a=0,b=0,c=0,e=0,f,g;return{flipCoords:o,setPressed:h,setCurrent:i,getOffset:j,moveOffset:k,getCorner:l,getFixed:m}}(),ba=function(){function f(a,b){e.left.css({height:i(b)}),e.right.css({height:i(b)})}function g(){return h(_.getFixed())}function h(a){e.top.css({left:i(a.x),width:i(a.w),height:i(a.y)}),e.bottom.css({top:i(a.y2),left:i(a.x),width:i(a.w),height:i(F-a.y2)}),e.right.css({left:i(a.x2),width:i(E-a.x2)}),e.left.css({width:i(a.x)})}function j(){return a("<div />").css({position:"absolute",backgroundColor:d.shadeColor||d.bgColor}).appendTo(c)}function k(){b||(b=!0,c.insertBefore(D),g(),bb.setBgOpacity(1,0,1),H.hide(),l(d.shadeColor||d.bgColor,1),bb.isAwake()?n(d.bgOpacity,1):n(1,1))}function l(a,b){bq(p(),a,b)}function m(){b&&(c.remove(),H.show(),b=!1,bb.isAwake()?bb.setBgOpacity(d.bgOpacity,1,1):(bb.setBgOpacity(1,1,1),bb.disableHandles()),bq(G,0,1))}function n(a,e){b&&(d.bgFade&&!e?c.animate({opacity:1-a},{queue:!1,duration:d.fadeTime}):c.css({opacity:1-a}))}function o(){d.shade?k():m(),bb.isAwake()&&n(d.bgOpacity)}function p(){return c.children()}var b=!1,c=a("<div />").css({position:"absolute",zIndex:240,opacity:0}),e={top:j(),left:j().height(F),right:j().height(F),bottom:j()};return{update:g,updateRaw:h,getShades:p,setBgColor:l,enable:k,disable:m,resize:f,refresh:o,opacity:n}}(),bb=function(){function k(b){var c=a("<div />").css({position:"absolute",opacity:d.borderOpacity}).addClass(j(b));return I.append(c),c}function l(b,c){var d=a("<div />").mousedown(s(b)).css({cursor:b+"-resize",position:"absolute",zIndex:c}).addClass("ord-"+b);return Z.support&&d.bind("touchstart.jcrop",Z.createDragger(b)),J.append(d),d}function m(a){var b=d.handleSize,e=l(a,c++).css({opacity:d.handleOpacity}).addClass(j("handle"));return b&&e.width(b).height(b),e}function n(a){return l(a,c++).addClass("jcrop-dragbar")}function o(a){var b;for(b=0;b<a.length;b++)g[a[b]]=n(a[b])}function p(a){var b,c;for(c=0;c<a.length;c++){switch(a[c]){case"n":b="hline";break;case"s":b="hline bottom";break;case"e":b="vline right";break;case"w":b="vline"}e[a[c]]=k(b)}}function q(a){var b;for(b=0;b<a.length;b++)f[a[b]]=m(a[b])}function r(a,b){d.shade||H.css({top:i(-b),left:i(-a)}),K.css({top:i(b),left:i(a)})}function t(a,b){K.width(Math.round(a)).height(Math.round(b))}function v(){var a=_.getFixed();_.setPressed([a.x,a.y]),_.setCurrent([a.x2,a.y2]),w()}function w(a){if(b)return x(a)}function x(a){var c=_.getFixed();t(c.w,c.h),r(c.x,c.y),d.shade&&ba.updateRaw(c),b||A(),a?d.onSelect.call(bs,u(c)):d.onChange.call(bs,u(c))}function z(a,c,e){if(!b&&!c)return;d.bgFade&&!e?D.animate({opacity:a},{queue:!1,duration:d.fadeTime}):D.css("opacity",a)}function A(){K.show(),d.shade?ba.opacity(O):z(O,!0),b=!0}function B(){F(),K.hide(),d.shade?ba.opacity(1):z(1),b=!1,d.onRelease.call(bs)}function C(){h&&J.show()}function E(){h=!0;if(d.allowResize)return J.show(),!0}function F(){h=!1,J.hide()}function G(a){a?(X=!0,F()):(X=!1,E())}function L(){G(!1),v()}var b,c=370,e={},f={},g={},h=!1;d.dragEdges&&a.isArray(d.createDragbars)&&o(d.createDragbars),a.isArray(d.createHandles)&&q(d.createHandles),d.drawBorders&&a.isArray(d.createBorders)&&p(d.createBorders),a(document).bind("touchstart.jcrop-ios",function(b){a(b.currentTarget).hasClass("jcrop-tracker")&&b.stopPropagation()});var M=y().mousedown(s("move")).css({cursor:"move",position:"absolute",zIndex:360});return Z.support&&M.bind("touchstart.jcrop",Z.createDragger("move")),I.append(M),F(),{updateVisible:w,update:x,release:B,refresh:v,isAwake:function(){return b},setCursor:function(a){M.css("cursor",a)},enableHandles:E,enableOnly:function(){h=!0},showHandles:C,disableHandles:F,animMode:G,setBgOpacity:z,done:L}}(),bc=function(){function f(b){M.css({zIndex:450}),b?a(document).bind("touchmove.jcrop",k).bind("touchend.jcrop",l):e&&a(document).bind("mousemove.jcrop",h).bind("mouseup.jcrop",i)}function g(){M.css({zIndex:290}),a(document).unbind(".jcrop")}function h(a){return b(m(a)),!1}function i(a){return a.preventDefault(),a.stopPropagation(),W&&(W=!1,c(m(a)),bb.isAwake()&&d.onSelect.call(bs,u(_.getFixed())),g(),b=function(){},c=function(){}),!1}function j(a,d,e){return W=!0,b=a,c=d,f(e),!1}function k(a){return b(m(Z.cfilter(a))),!1}function l(a){return i(Z.cfilter(a))}function n(a){M.css("cursor",a)}var b=function(){},c=function(){},e=d.trackDocument;return e||M.mousemove(h).mouseup(i).mouseout(i),D.before(M),{activateHandlers:j,setCursor:n}}(),bd=function(){function e(){d.keySupport&&(b.show(),b.focus())}function f(a){b.hide()}function g(a,b,c){d.allowMove&&(_.moveOffset([b,c]),bb.updateVisible(!0)),a.preventDefault(),a.stopPropagation()}function i(a){if(a.ctrlKey||a.metaKey)return!0;Y=a.shiftKey?!0:!1;var b=Y?10:1;switch(a.keyCode){case 37:g(a,-b,0);break;case 39:g(a,b,0);break;case 38:g(a,0,-b);break;case 40:g(a,0,b);break;case 27:d.allowSelect&&bb.release();break;case 9:return!0}return!1}var b=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),c=a("<div />").css({position:"absolute",overflow:"hidden"}).append(b);return d.keySupport&&(b.keydown(i).blur(f),h||!d.fixedSupport?(b.css({position:"absolute",left:"-20px"}),c.append(b).insertBefore(D)):b.insertBefore(D)),{watchKeys:e}}();Z.support&&M.bind("touchstart.jcrop",Z.newSelection),J.hide(),br(!0);var bs={setImage:bp,animateTo:bf,setSelect:bg,setOptions:bk,tellSelect:bi,tellScaled:bj,setClass:be,disable:bl,enable:bm,cancel:bn,release:bb.release,destroy:bo,focus:bd.watchKeys,getBounds:function(){return[E*T,F*U]},getWidgetSize:function(){return[E,F]},getScaleFactor:function(){return[T,U]},getOptions:function(){return d},ui:{holder:G,selection:K}};return g&&G.bind("selectstart",function(){return!1}),A.data("Jcrop",bs),bs},a.fn.Jcrop=function(b,c){var d;return this.each(function(){if(a(this).data("Jcrop")){if(b==="api")return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else this.tagName=="IMG"?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d)}):(a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d))}),this},a.Jcrop.Loader=function(b,c,d){function g(){f.complete?(e.unbind(".jcloader"),a.isFunction(c)&&c.call(f)):window.setTimeout(g,50)}var e=a(b),f=e[0];e.bind("load.jcloader",g).bind("error.jcloader",function(b){e.unbind(".jcloader"),a.isFunction(d)&&d.call(f)}),f.complete&&a.isFunction(c)&&(e.unbind(".jcloader"),c.call(f))},a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();if(jQuery){(function(a){a.extend(a.fn,{uploadify:function(b){a(this).each(function(){var f=a.extend({id:a(this).attr("id"),uploader:"uploadify.swf",script:"uploadify.php",expressInstall:null,folder:"",height:30,width:120,cancelImg:"cancel.png",wmode:"opaque",scriptAccess:"sameDomain",fileDataName:"Filedata",method:"POST",queueSizeLimit:999,simUploadLimit:1,queueID:false,displayData:"percentage",removeCompleted:true,onInit:function(){},onSelect:function(){},onSelectOnce:function(){},onQueueFull:function(){},onCheck:function(){},onCancel:function(){},onClearQueue:function(){},onError:function(){},onProgress:function(){},onComplete:function(){},onAllComplete:function(){}},b);a(this).data("settings",f);var e=location.pathname;e=e.split("/");e.pop();e=e.join("/")+"/";var g={};g.uploadifyID=f.id;g.pagepath=e;if(f.buttonImg){g.buttonImg=escape(f.buttonImg)}if(f.buttonText){g.buttonText=escape(f.buttonText)}if(f.rollover){g.rollover=true}g.script=f.script;g.folder=escape(f.folder);if(f.scriptData){var h="";for(var d in f.scriptData){h+="&"+d+"="+f.scriptData[d]}g.scriptData=escape(h.substr(1))}g.width=f.width;g.height=f.height;g.wmode=f.wmode;g.method=f.method;g.queueSizeLimit=f.queueSizeLimit;g.simUploadLimit=f.simUploadLimit;if(f.hideButton){g.hideButton=true}if(f.fileDesc){g.fileDesc=f.fileDesc}if(f.fileExt){g.fileExt=f.fileExt}if(f.multi){g.multi=true}if(f.auto){g.auto=true}if(f.sizeLimit){g.sizeLimit=f.sizeLimit}if(f.checkScript){g.checkScript=f.checkScript}if(f.fileDataName){g.fileDataName=f.fileDataName}if(f.queueID){g.queueID=f.queueID}if(f.onInit()!==false){a(this).css("display","none");a(this).after('<div id="'+a(this).attr("id")+'Uploader"></div>');swfobject.embedSWF(f.uploader,f.id+"Uploader",f.width,f.height,"9.0.24",f.expressInstall,g,{quality:"high",wmode:f.wmode,allowScriptAccess:f.scriptAccess},{},function(i){if(typeof(f.onSWFReady)=="function"&&i.success){f.onSWFReady()}});if(f.queueID==false){a("#"+a(this).attr("id")+"Uploader").after('<div id="'+a(this).attr("id")+'Queue" class="uploadifyQueue"></div>')}else{a("#"+f.queueID).addClass("uploadifyQueue")}}if(typeof(f.onOpen)=="function"){a(this).bind("uploadifyOpen",f.onOpen)}a(this).bind("uploadifySelect",{action:f.onSelect,queueID:f.queueID},function(k,i,j){if(k.data.action(k,i,j)!==false){var l=Math.round(j.size/1024*100)*0.01;var m="KB";if(l>1000){l=Math.round(l*0.001*100)*0.01;m="MB"}var n=l.toString().split(".");if(n.length>1){l=n[0]+"."+n[1].substr(0,2)}else{l=n[0]}if(j.name.length>20){fileName=j.name.substr(0,20)+"..."}else{fileName=j.name}queue="#"+a(this).attr("id")+"Queue";if(k.data.queueID){queue="#"+k.data.queueID}a(queue).append('<div id="'+a(this).attr("id")+i+'" class="uploadifyQueueItem"><div class="cancel"><a href="javascript:jQuery(\'#'+a(this).attr("id")+"').uploadifyCancel('"+i+'\')"><img src="'+f.cancelImg+'" border="0" /></a></div><span class="fileName">'+fileName+" ("+l+m+')</span><span class="percentage"></span><div class="uploadifyProgress"><div id="'+a(this).attr("id")+i+'ProgressBar" class="uploadifyProgressBar"><!--Progress Bar--></div></div></div>')}});a(this).bind("uploadifySelectOnce",{action:f.onSelectOnce},function(i,j){i.data.action(i,j);if(f.auto){if(f.checkScript){a(this).uploadifyUpload(null,false)}else{a(this).uploadifyUpload(null,true)}}});a(this).bind("uploadifyQueueFull",{action:f.onQueueFull},function(i,j){if(i.data.action(i,j)!==false){alert("The queue is full.  The max size is "+j+".")}});a(this).bind("uploadifyCheckExist",{action:f.onCheck},function(n,m,l,k,p){var j=new Object();j=l;j.folder=(k.substr(0,1)=="/")?k:e+k;if(p){for(var i in l){var o=i}}a.post(m,j,function(s){for(var q in s){if(n.data.action(n,s,q)!==false){var r=confirm("Do you want to replace the file "+s[q]+"?");if(!r){document.getElementById(a(n.target).attr("id")+"Uploader").cancelFileUpload(q,true,true)}}}if(p){document.getElementById(a(n.target).attr("id")+"Uploader").startFileUpload(o,true)}else{document.getElementById(a(n.target).attr("id")+"Uploader").startFileUpload(null,true)}},"json")});a(this).bind("uploadifyCancel",{action:f.onCancel},function(n,j,m,o,i,l){if(n.data.action(n,j,m,o,l)!==false){if(i){var k=(l==true)?0:250;a("#"+a(this).attr("id")+j).fadeOut(k,function(){a(this).remove()})}}});a(this).bind("uploadifyClearQueue",{action:f.onClearQueue},function(k,j){var i=(f.queueID)?f.queueID:a(this).attr("id")+"Queue";if(j){a("#"+i).find(".uploadifyQueueItem").remove()}if(k.data.action(k,j)!==false){a("#"+i).find(".uploadifyQueueItem").each(function(){var l=a(".uploadifyQueueItem").index(this);a(this).delay(l*100).fadeOut(250,function(){a(this).remove()})})}});var c=[];a(this).bind("uploadifyError",{action:f.onError},function(m,i,l,k){if(m.data.action(m,i,l,k)!==false){var j=new Array(i,l,k);c.push(j);a("#"+a(this).attr("id")+i).find(".percentage").text(" - "+k.type+" Error");a("#"+a(this).attr("id")+i).find(".uploadifyProgress").hide();a("#"+a(this).attr("id")+i).addClass("uploadifyError")}});if(typeof(f.onUpload)=="function"){a(this).bind("uploadifyUpload",f.onUpload)}a(this).bind("uploadifyProgress",{action:f.onProgress,toDisplay:f.displayData},function(k,i,j,l){if(k.data.action(k,i,j,l)!==false){a("#"+a(this).attr("id")+i+"ProgressBar").animate({width:l.percentage+"%"},250,function(){if(l.percentage==100){a(this).closest(".uploadifyProgress").fadeOut(250,function(){a(this).remove()})}});if(k.data.toDisplay=="percentage"){displayData=" - "+l.percentage+"%"}if(k.data.toDisplay=="speed"){displayData=" - "+l.speed+"KB/s"}if(k.data.toDisplay==null){displayData=" "}a("#"+a(this).attr("id")+i).find(".percentage").text(displayData)}});a(this).bind("uploadifyComplete",{action:f.onComplete},function(l,i,k,j,m){if(l.data.action(l,i,k,unescape(j),m)!==false){a("#"+a(this).attr("id")+i).find(".percentage").text(" - Completed");if(f.removeCompleted){a("#"+a(l.target).attr("id")+i).fadeOut(250,function(){a(this).remove()})}a("#"+a(l.target).attr("id")+i).addClass("completed")}});if(typeof(f.onAllComplete)=="function"){a(this).bind("uploadifyAllComplete",{action:f.onAllComplete},function(i,j){if(i.data.action(i,j)!==false){c=[]}})}})},uploadifySettings:function(f,j,c){var g=false;a(this).each(function(){if(f=="scriptData"&&j!=null){if(c){var i=j}else{var i=a.extend(a(this).data("settings").scriptData,j)}var l="";for(var k in i){l+="&"+k+"="+i[k]}j=escape(l.substr(1))}g=document.getElementById(a(this).attr("id")+"Uploader").updateSettings(f,j)});if(j==null){if(f=="scriptData"){var b=unescape(g).split("&");var e=new Object();for(var d=0;d<b.length;d++){var h=b[d].split("=");e[h[0]]=h[1]}g=e}}return g},uploadifyUpload:function(b,c){a(this).each(function(){if(!c){c=false}document.getElementById(a(this).attr("id")+"Uploader").startFileUpload(b,c)})},uploadifyCancel:function(b){a(this).each(function(){document.getElementById(a(this).attr("id")+"Uploader").cancelFileUpload(b,true,true,false)})},uploadifyClearQueue:function(){a(this).each(function(){document.getElementById(a(this).attr("id")+"Uploader").clearFileUploadQueue(false)})}})})(jQuery)};(function($){$.fn.sizeLimit=function(opts){opts=$.extend({size:255,sizeShow:250},opts||{});this.each(function(){var size=0,limitSize=false,limitShow=false,id=$(this).attr('id'),counter=$('span[data-sizelimit='+id+']'),button=$('a[data-sizelimit='+id+'], button[data-sizelimit='+id+']');$(this).bind('keypress keyup focus blur',function(){var newSize=$(this).val().length;if(newSize===size)return;size=newSize;var limit=(size>opts.size);if(limit!==limitSize){limitSize=limit;if(limit){$(counter).addClass('negative').removeClass('positive');button.button('disable');}else{$(counter).addClass('positive').removeClass('negative');button.button('enable');}}var limit=(size>opts.sizeShow);if(limit!==limitShow){limitShow=limit;if(limit)$(counter).show().addClass('positive');else
$(counter).hide();}if(limitShow){$(counter).html(opts.size-size);}});});};})(jQuery);(function($){$.fn.easyupload=function(options){options=$.extend({uploader:'/uploadify/uploadify.swf',wmode:'transparent',onSWFReady:function(){var uploader='#'+this.id;setTimeout(function(){$(uploader+'EasyUpload').show();if(options.zIndex){$(uploader+'EasyUpload').css('zIndex',options.zIndex);}},1000);},auto:true,scriptAccess:'always',sizeLimit:3145728,fileDataName:'file',buttonImg:'',expressInstall:null,cancelImg:'',folder:'',onAllComplete:function(){},onCancel:function(){},onCheck:function(){},onClearQueue:function(){},onComplete:function(){},onError:function(){},onSelectOnce:function(){}},options||{});return this.each(function(){var uploaderId=Math.floor(Math.random()*1000);options.width=$(this).innerWidth();options.height=$(this).innerHeight();$('<div id="uploader'+uploaderId+'"></div>').insertAfter(this).data('view',this).uploadify(options);});}})(jQuery);(function($){$.fn.tooltip=function(opts){opts=$.extend({className:'tooltip',content:'title',mousein:function(){},mouseout:function(){},align:'center',offset:[0,0],inDelay:100,outDelay:100},opts||{});var mouseOutCallback=function(obj){var tooltip=$.data(obj,'tooltip');if(tooltip&&!$.data(tooltip[0],'hover')){opts.mouseout(obj);tooltip.hide();}}
this.live('mouseenter',function(){var obj=this;setTimeout(function(){if(!$.data(obj,'tooltip')){var title;if(typeof opts.content=='string'&&$(obj).attr(opts.content)!='undefined'&&$(obj).attr(opts.content)!=''){title=$(obj).attr(opts.content);}else if(typeof opts.content=='function'){title=opts.content(obj);}var tooltip=$('<div class="'+opts.className+'">'+title+'</div>').appendTo(document.body);$.data(obj,'tooltip',tooltip);tooltip.hover(function(){$.data(this,'hover',true);},function(){$.removeData(this,'hover');setTimeout(function(){mouseOutCallback(obj);},opts.outDelay);});}else{var tooltip=$.data(obj,'tooltip').show();}tooltip.css({display:'block',position:'absolute',zIndex:99999});var pos=$.extend({},$(obj).offset(),{width:obj.offsetWidth,height:obj.offsetHeight});if(opts.align=='left'){left=pos.left;}else if(opts.align=='center'){left=pos.left+pos.width/2-tooltip[0].offsetWidth/2;}else if(opts.align=='right'){left=pos.left+pos.width-tooltip[0].offsetWidth;}left+=opts.offset[0];tooltip.css({bottom:$('body').height()+parseInt($('body').css('padding-top'),10)-pos.top+opts.offset[1],left:left});opts.mousein(obj);},opts.inDelay);}).live('mouseleave',function(){var obj=this;setTimeout(function(){mouseOutCallback(obj);},opts.outDelay);});}})(jQuery);$.elemScroll=function(selector,direction){var at=$(selector+':in-viewport:first'),to;if(at){if(direction=='n'){to=at.next(':visible');}else{to=at.prev(':visible');}}if(!to.length){to=$(selector+':visible:first');if(!to.length){if(direction=='n'){to=$(selector+':visible:first');}else{to=$(selector+':visible:last');}}}if(to){if(to.offset()){$.scrollTo(to.offset().top,0);}}}
jQuery.extend({handleError:function(){},createUploadIframe:function(id,uri){var frameId='jUploadFrame'+id;var iframeHtml='<iframe id="'+frameId+'" name="'+frameId+'" style="position:absolute; top:-9999px; left:-9999px"';if(window.ActiveXObject){if(typeof uri=='boolean'){iframeHtml+=' src="'+'javascript:false'+'"';}else if(typeof uri=='string'){iframeHtml+=' src="'+uri+'"';}}iframeHtml+=' />';jQuery(iframeHtml).appendTo(document.body);return jQuery('#'+frameId).get(0);},createUploadForm:function(id,fileElementId,data){var formId='jUploadForm'+id;var fileId='jUploadFile'+id;var form=jQuery('<form  action="" method="POST" name="'+formId+'" id="'+formId+'" enctype="multipart/form-data"></form>');if(data){for(var i in data){jQuery('<input type="hidden" name="'+i+'" value="'+data[i]+'" />').appendTo(form);}}var oldElement=jQuery('#'+fileElementId);var newElement=jQuery(oldElement).clone();jQuery(oldElement).attr('id',fileId);jQuery(oldElement).before(newElement);jQuery(oldElement).appendTo(form);jQuery(form).css('position','absolute');jQuery(form).css('top','-1200px');jQuery(form).css('left','-1200px');jQuery(form).appendTo('body');return form;},ajaxFileUpload:function(s){s=jQuery.extend({},jQuery.ajaxSettings,s);var id=new Date().getTime()
var form=jQuery.createUploadForm(id,s.fileElementId,(typeof(s.data)=='undefined'?false:s.data));var io=jQuery.createUploadIframe(id,s.secureuri);var frameId='jUploadFrame'+id;var formId='jUploadForm'+id;if(s.global&&!jQuery.active++){jQuery.event.trigger("ajaxStart");}var requestDone=false;var xml={}
if(s.global)jQuery.event.trigger("ajaxSend",[xml,s]);var uploadCallback=function(isTimeout){var io=document.getElementById(frameId);try{if(io.contentWindow){xml.responseText=io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null;xml.responseXML=io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document;}else if(io.contentDocument){xml.responseText=io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null;xml.responseXML=io.contentDocument.document.XMLDocument?io.contentDocument.document.XMLDocument:io.contentDocument.document;}}catch(e){jQuery.handleError(s,xml,null,e);}if(xml||isTimeout=="timeout"){requestDone=true;var status;status=isTimeout!="timeout"?"success":"error";if(status!="error"){var data=jQuery.uploadHttpData(xml,s.dataType);if(s.success)s.success(data,status);if(s.global)jQuery.event.trigger("ajaxSuccess",[xml,s]);}if(s.global)jQuery.event.trigger("ajaxComplete",[xml,s]);if(s.global&&! --jQuery.active)jQuery.event.trigger("ajaxStop");if(s.complete)s.complete(xml,status);jQuery(io).unbind()
setTimeout(function(){try{jQuery(io).remove();jQuery(form).remove();}catch(e){jQuery.handleError(s,xml,null,e);}},100)
xml=null}}
if(s.timeout>0){setTimeout(function(){if(!requestDone)uploadCallback("timeout");},s.timeout);}try{var form=jQuery('#'+formId);jQuery(form).attr('action',s.url);jQuery(form).attr('method','POST');jQuery(form).attr('target',frameId);if(form.encoding){jQuery(form).attr('encoding','multipart/form-data');}else{jQuery(form).attr('enctype','multipart/form-data');}jQuery(form).submit();}catch(e){jQuery.handleError(s,xml,null,e);}jQuery('#'+frameId).load(uploadCallback);return{abort:function(){}};},uploadHttpData:function(r,type){var data=!type;data=type=="xml"||data?r.responseXML:r.responseText;if(type=="script")jQuery.globalEval(data);if(type=="json")eval("data = "+data);if(type=="html")jQuery("<div>").html(data).evalScripts();return data;}});(function(){var cache={};this.tmpl=function tmpl(str,data){var fn=!/\W/.test(str)?cache[str]=cache[str]||tmpl(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return data?fn(data):fn;};})();(function($){$.fn.uberText=function(params){var defaults={autogrow:true,limit:0,counter:'',block:false,remaining:true,show:0,lines:0,onPositive:function(){},onNegative:function(){}}
params=$.extend({},defaults,params);return $(this).each(function(i,elem){var elem=$(elem);if(elem.is(':text, textarea')&&elem.hasClass('ubertext-me')){var lineHeight=parseInt($(elem).css('line-height')),width=parseInt($(elem).css('width')),counter=params.counter||'#counter-'+$(elem).attr('id');if(isNaN(lineHeight))lineHeight=15;elem.removeClass('ubertext-me').addClass('ubertext');if(params.autogrow){elem.css({resize:'none',overflow:'hidden'})};elem.bind('keyup',function(e){var len=$(this).val().length;if(counter&&$(counter)){if(params.remaining){var num=params.limit-len;}else{var num=len;}$(counter).text(num);if(params.show<0){params.show=params.limit+params.show;}$(counter)[len>=params.show?'show':'hide']();}if(len>params.limit){params.onNegative(counter,elem,params);}else{params.onPositive(counter,elem,params);}if(params.autogrow){var lines=($(this).val().match(/\n/g)||'').length,chars=($(this).val().match(/[^\n\r]/g)||'1').length,charLines=Math.ceil((chars*7.55)/width),totalLines=lines+charLines;if(params.lines&&params.lines>totalLines){totalLines=params.lines}elem.css('height',lineHeight*(totalLines)+'px');};}).bind('keypress',function(e){var len=$(this).val().length+1,key=e.keyCode;if(len>params.limit&&params.block&&key!=8&&key!=46){return false;}}).bind('focus',function(e){$(this).trigger('keypress');}).trigger('keyup');}});}})(jQuery);var Feed={last:'',fetchLock:false,fetchOffset:750,fetchId:null,visitor:'',public:0,print:function(objects){$('#newsfeed').append(objects.responseText);},fetch:function(callback){if(this.last!==false&&!this.fetchLock){this.fetchLock=true;$('#loading-feed').show();$.ajax({type:'post',url:'/ajax/newsfeed/fetch',data:{last:this.last,public:this.public,fetchId:this.fetchId,visitor:this.visitor},success:function(){_gaq.push(['_trackPageview',window.location.pathname]);},complete:function(r){Feed.print(r);$('#loading-feed').hide();Feed.fetchLock=false;if(callback){callback();}}});this.last=false;}},trends:function(){ajax('shout','trends',{last:'a'},{success:function(r){$('#newsfeed').html('');for(var i=0,c=r.data.length;i<c;++i){if(r.data[i].template&&$('#'+r.data[i].template).length){$(tmpl(r.data[i].template,r.data[i])).appendTo('#newsfeed');}}}});},viewTrends:function(el){Feed.fetchLock=true;$('#shout-trends-filter').show();$(el).parent().siblings().removeClass('active').find('span').remove();$(el).parent().addClass('active').append('<span />');$('#newsfeed').hide();$('#trendsShoutFeed').show();},viewRecents:function(el){Feed.fetchLock=false;$('#shout-trends-filter').hide();$(el).parent().siblings().removeClass('active').find('span').remove();$(el).parent().addClass('active').append('<span />');$('#trendsShoutFeed').hide();$('#newsfeed').html('').show();Feed.public=0;Feed.last='';Feed.fetch();},viewPublics:function(el){Feed.fetchLock=false;$('#shout-trends-filter').hide();$(el).parent().siblings().removeClass('active').find('span').remove();$(el).parent().addClass('active').append('<span />');$('#trendsShoutFeed').hide();$('#newsfeed').html('').show();Feed.public=1;Feed.last='';Feed.fetch();},periodFilter:function(parent,tab,callerid){if($('#'+tab).css('display')=='block'){return;}$('#shout-trends-filter > span').html($('#'+callerid).html());$('#trendsShoutFeed-filter > li > a.active').removeClass('active');$('#trendsShoutFeed-filter > li > a.'+tab).addClass('active');$('#trendsShoutFeed-filter').hide();$('#'+parent+' > div.list:visible').hide();$('#'+tab).show();},_resetUi:function(){$(".tabs li").removeClass("active");$("li.pin-highlight").removeClass("pin-highlight");$(".cont-filterH a").removeClass("active");$(".cont-filterH").hide();},_setBinds:function(){$("[data-fetch]").click(function(e){e.preventDefault();Feed._resetUi();$('#newsfeed').html("");Feed.fetchId=$(this).attr("data-fetch");Feed.last='';Feed.fetch();Feed._ajaxClick(this);if(history&&history.pushState){var url=$(this).attr("href");history.replaceState({path:url},document.title,url);}return false;});},_ajaxClick:function(object){switch(Feed.fetchId.split("|")[0]){case"pin":$("li.pin-highlight").removeClass("pin-highlight");$(object).closest("li").addClass("pin-highlight");$(object).siblings("strong").hide();break;case"trend":$(".tabs a[data-fetch=trend|15m]").parent().addClass("active");$(".cont-filterH.trend").show();$(".cont-filterH.trend a[data-fetch="+Feed.fetchId+"]").addClass("active");break;case"public":$(".tabs a[data-fetch=public]").parent().addClass("active");break;default:$(".tabs a[data-fetch=recent]").parent().addClass("active");$(".cont-filterH.recent").show();$(".cont-filterH.recent a[data-fetch="+Feed.fetchId+"]").addClass("active");break;};},ready:function(){Feed._setBinds();}}
function goToRef(ref){if(ref){document.location.href=ref;}}var timelib={current:false,iupd:15,timetowords:function(x){if(!this.current)return r;var r=false;var t={s:{year:lang['mas de 1 año'],month:lang['mas de 1 mes'],day:lang['mas de 1 dia'],hour:lang['mas de 1 hora'],minute:lang['mas de 1 minuto'],second:lang['hace instantes']},p:{year:lang['mas de x años'],month:lang['mas de x meses'],day:lang['mas de x dias'],hour:lang['mas de x horas'],minute:lang['mas de x minuto'],second:lang['hace instantes']}};var n=this.current-x;var d={year:31536000,month:2678400,day:86400,hour:3600,minute:60,second:1};for(k in d){if(n>=d[k]){var c=Math.floor(n/d[k]);if(c==1)r=t.s[k];else if(c>1){r=t.p[k].replace('$1',c);}else r=lang['hace mucho tiempo'];break;}}return r?r:lang['hace instantes'];},upd:function(){setTimeout(function(){if(timelib.current){timelib.current=timelib.current+timelib.iupd;$('[ts]').each(function(){$(this).html(timelib.timetowords($(this).attr('ts')));});}timelib.upd()},this.iupd*1000);},sleep:function(milliseconds){var start=new Date().getTime();for(var i=0;i<1e7;i++){if((new Date().getTime()-start)>milliseconds){break;}}}}
window.curry=function(fn){return function(arg1){return function(arg2){return fn(arg1,arg2)}}}
window.Cookie={get:function(name){var nameEQ=name+'=';var ca=document.cookie.split(';');for(var i=0;i<ca.length;++i){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1,c.length);}if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length);}}return null;},set:function(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires='; expires='+date.toGMTString();}else{var expires='';}document.cookie=name+'='+value+expires+'; path=/;';return Cookie;},unset:function(name){return Cookie.set(name,'',-1);}};window.Facebook={_initialized:false,_appId:null,_userId:null,init:function(config){Facebook._appId=config.appId;Facebook._userId=config.userId;FB.init({appId:Facebook._appId,cookie:true,xfbml:true});Facebook._initialized=true;Facebook.renew();Facebook.events();},load:function(){},renew:function(){if(Facebook._userId&&!Cookie.get('fb::renew('+Facebook._userId+')')){FB.getLoginStatus(function(response){if(response.status==='connected'&&Facebook._userId==response.authResponse.userID){$.ajax({type:'post',url:'/ajax/facebook/renew',data:response.authResponse,complete:function(){Cookie.set('fb::renew('+Facebook._userId+')',1,15);}});}});}},link:function(callback,errorCallback){if(!Facebook._initialized){return;}callback=callback||function(){};errorCallback=errorCallback||function(){};FB.login(function(response){if(response.status==='connected'){$.ajax({type:'post',url:'/ajax/facebook/link',data:response.authResponse,success:callback});}else{errorCallback();}},{scope:'email,user_birthday,user_location,publish_stream'});},unlink:function(callback){if(!Facebook._initialized){return;}callback=callback||function(){};$.ajax({type:'post',url:'/ajax/facebook/unlink',success:callback});},login:function(callback){if(!Facebook._initialized){return;}callback=callback||function(){};FB.login(function(response){if(response.status==='connected'){if($('form[name=login] input[name=redirect]').length){var redirect=$('form[name=login] input[name=redirect]').val();}else{var redirect=window.location.pathname;}$.ajax({type:'post',url:'/registro/login-submit.php',data:$.extend(response.authResponse,{'connect':'facebook','redirect':redirect}),dataType:'json',success:function(response){callback(response);if(response.status==1){if(response.data){gaTracker.trackEvent('Usuario.Login','FacebookConnect','Login');location.href=response.data;}else{window.location.reload();}}}});}},{scope:'email,user_birthday,user_location,publish_stream'});},events:function(){FB.Event.subscribe('edge.create',function(){gaTracker.trackEvent('Home.Like','Taringa','Social.Action');});}};if(typeof window.fbAsyncInit==='undefined'){window.fbAsyncInit=curry(Facebook.init)({appId:lang['FACEBOOK_APP_ID'],userId:null});}function fb_init(){if(FB._apiKey===null){FB.init({appId:lang['FACEBOOK_APP_ID'],cookie:true});}}var fb_access_token=false,fbInitialized=false;function facebook_ready(){if(typeof fix_facebook_ready!=='undefined'){FB.init({appId:lang['FACEBOOK_APP_ID'],cookie:true});fbInitialized=true;return;}FB.signin=function(act,el){fb_init();FB.Event.subscribe('auth.login',function(){FB.callback(act,el);});FB.login(function(r){if(r.authResponse&&r.authResponse.accessToken){fb_access_token=r.authResponse.accessToken;createCookie('fbat',fb_access_token,1);}if(!r.authResponse&&r.status=='connected'){FB.getLoginStatus();}else if(r.authResponse){FB.callback(act,el);}},{scope:'email,user_birthday,user_location,publish_stream,offline_access'});};FB.unlink=function(){fb_init();$.ajax({type:'post',url:'/social-ajax.php',data:'cmd=Facebook::Account::unlink',dataType:'json',success:FB.link_cb});};FB.callback=function(act,el){fb_init()
switch(act){case'register':if(fb_access_token){$.getScript('https://graph.facebook.com/me?access_token='+fb_access_token+'&callback=FB.register_cb');}break;case'link':$.ajax({type:'post',url:'/social-ajax.php',data:'cmd=Facebook::Account::link',dataType:'json',success:FB.link_cb});break;case'link_nocb':$.ajax({type:'post',url:'/social-ajax.php',data:'cmd=Facebook::Account::link',dataType:'json'});$('input[name=facebook]').attr('onclick','');break;case'login':login.connect(el);break;case'mi':$.ajax({type:'post',url:'/social-ajax.php',data:'cmd=Facebook::Account::link',dataType:'json',success:function(r){if(typeof r.error!='undefined'&&r.error!=''){alert(r.error);}}});$('#facebook-share').removeAttr('onclick');break;case'share':$.ajax({type:'post',url:'/social-ajax.php',data:'cmd=Facebook::Account::link',dataType:'json',success:function(r){if(typeof r.error!='undefined'&&r.error!=''){alert(r.error);}}});facebookShare();$('.face-share').attr('onclick','facebookShare(this)');break;default:login_ajax('home','facebook');}}
FB.link_cb=function(r){fb_init();if(typeof r.error!=='undefined'&&r.error!==''){alert(r.error);}else{window.location.reload();}}
FB.register_cb=function(r){fb_init();$('#mydialog.registro').addClass('unsocial');$('div.social-connect').remove();if(typeof r.first_name!='undefined'){$('#name').val(r.first_name);$('#name').trigger('blur');}if(typeof r.last_name!='undefined'){$('#lastname').val(r.last_name);$('#lastname').trigger('blur');}if(typeof r.email!='undefined'){$('#email').val(r.email);$('#email').trigger('blur');}if(typeof r.birthday!='undefined'){var birthday=r.birthday.split('/');var dia=parseInt(birthday[1]);var mes=parseInt(birthday[0]);$('#dia').val(dia);$('#mes').val(mes);$('#anio').val(birthday[2]);$('#anio').trigger('blur');}if(typeof r.link!='undefined'){var username=r.link.split('/')[3];if(isNaN(username)&&username.substr(0,11)!='profile.php'){$('#nick').val(username);$('#nick').trigger('blur');$('#password').focus();}else{$('#nick').focus();}}}
if(FB&&FB.Event&&FB.Event.subscribe){FB.Event.subscribe('edge.create',function(targetUrl){_gaq.push(['_trackSocial','facebook','like',targetUrl]);});FB.Event.subscribe('edge.remove',function(targetUrl){_gaq.push(['_trackSocial','facebook','unlike',targetUrl]);});FB.Event.subscribe('message.send',function(targetUrl){_gaq.push(['_trackSocial','facebook','send',targetUrl]);});}}function fb_fast_connect(){fb_init();FB.login(function(r){if(r.status=="connected"){if(r.authResponse&&r.authResponse.accessToken){createCookie('fbat',r.authResponse.accessToken,1);$.ajax({type:"post",url:"/registro/login-submit.php",dataType:"json",data:"connect=facebook&redirect="+window.location.pathname,success:function(r){var status=parseInt(r.status),url=r.data;if(status==1){if(!url){url="/";}location.href=url;}}});}}},{scope:"email,user_birthday,user_location,publish_stream,offline_access"});}var googlePlus={link:function(){var googlePlus_window=window.open('/google-plus-link.php','Vincular','width=850,height=450,scrollbars=NO,resizable=NO'),googlePlus_interval=setInterval(function(){if(googlePlus_window.closed){clearInterval(googlePlus_interval);window.location.reload();}},250);},unlink:function(){$.ajax({type:'POST',url:'/google-plus-unlink.php',success:function(h){switch(h){case"0":alert("<?php echo _('Hubo en error al procesar tu solicitud, int&eacute;ntalo nuevamente'); ?>");break;case"1":window.location.reload();}}});}}
window.twttr=window.twttr||{_e:[],ready:function(f){this._e.push(f);}};twttr.ready(function(twttr){twttr.events.bind('tweet',function(event){var targetUrl=event.target.baseURI;_gaq.push(['_trackSocial','twitter','tweet',targetUrl]);});twttr.events.bind('follow',function(event){gaTracker.trackEvent('Home.Follow','Taringa','Social.Action');});});function facebook_welcome(el){fb_init();FB.login(function(r){if(r.status==='connected'){$.ajax({url:'https://graph.facebook.com/me',dataType:'jsonp',data:{'access_token':r.authResponse.accessToken},cache:false,success:function(r){$('.wecome_facebook').hide();fb_init();$.ajax({type:'post',url:'/social-ajax.php',data:'cmd=Facebook::Account::link',dataType:'json'});if(typeof r.bio!='undefined'){$(el).find('#welcome-bio').val(r.bio).trigger('blur');}if(typeof r.gender!='undefined'){if(r.gender=='male'){$(el).find('#male').attr('checked','checked').trigger('blur');}else{$(el).find('#female').attr('checked','checked').trigger('blur');}}if(typeof r.id!='undefined'){$('.avatar-loading').removeClass('hide');$.ajax({url:'/ajax/avatar-social.php',type:'post',dataType:'json',data:{'serviceId':r.id,'service':'facebook'},cache:false,success:function(r){switch(r.status){case 1:$('#welcome_avatar').attr('src',r.data);$('.avatar-loading').addClass('hide');break;case 0:break;}}});}}});}},{scope:'email,user_birthday,user_location,publish_stream,offline_access'});}function hide_untrusted_swf(){$('.content-safe embed.swf-untrusted[src$=".swf"]').each(function(){if($(this).next().hasClass('swfplay'))return false;obj=$(this).hide().after('<a class="swfplay">'+lang['mostrar-swf']+'</a>').next('a.swfplay').click(function(){$(this).html($(this).html()===lang['mostrar-swf']?lang['ocultar-swf']:lang['mostrar-swf']).prev('embed').toggle();});});}var fixpos=$.browser.webkit?'offset':'position';var Avatar={object:{type:null,id:null},server:null,url:{crop:null,upload:null},upload:function(elem){$('.avatar-loading').removeClass('hide');document.domain=lang['domain'];$.ajaxFileUpload({url:Avatar.url.upload,fileElementId:$(elem).attr('id'),dataType:'json',success:function(r){$('.avatar-loading').addClass('hide');if(r.no==10){$('.crop-dialog').dialog(nDialog_cfg,{width:'auto'}).dialog('option','buttons',[{text:lang['Guardar'],'class':'ui-button-positive box-shadow-soft floatL',click:function(){$('.avatar-loading').removeClass('hide');$('.crop-dialog').dialog('close');$.getScript(Avatar.url.crop+'&crop='+$('img.avatar-crop').attr('data-crop'));}},{text:lang['Cancelar'],'class':'ui-state-default floatR',click:function(){$(this).dialog('close');}}]).html('<img class="avatar-crop hide" src="'+r.error+'" />').dialog('open');$('img.avatar-crop').bind('load',function(){var w=$(this).width(),h=$(this).height(),x0,x1,y0,y1;if(w>h){x1=(w-h)/2;x2=x1+h;y1=0;y2=h;}else{x1=0;x2=w;y1=(h-w)/2;y2=y1+w;}$(this).attr('data-crop',''+w+','+h+','+x2+','+y2).Jcrop({aspectRatio:1,sideHandles:false,setSelect:[x1,y1,x2,y2],onChange:function(obj){$('.avatar-preview img').attr('src',r.error);var rx=120/obj.w,ry=120/obj.h;$('.avatar-preview img').css({width:Math.round(rx*$('img.avatar-crop').width())+'px',height:Math.round(ry*$('img.avatar-crop').height())+'px',marginLeft:'-'+Math.round(rx*obj.x)+'px',marginTop:'-'+Math.round(ry*obj.y)+'px'});$('img.avatar-crop').attr('data-crop',''+obj.w+','+obj.h+','+obj.x+','+obj.y);}}).removeClass('hide');$('.crop-dialog').dialog({position:'center'});});}else if(r.no==0){$('#welcome_avatar, .avatar-preview img').attr('src',r.error);Avatar.save();}}});},cropCallback:function(r){Avatar.save();$('.avatar-loading').addClass('hide');},save:function(){switch(Avatar.object.type){case'community':$.post('/comunidades/comunidad-upload-imagen.php','s='+Avatar.server+gget('key')+'&cid='+Avatar.object.id);break;default:$.post('/cuenta.php','ajax=1&save=10&s='+Avatar.server+gget('key'));}}}
var nAvatar={object:{type:null,id:null},server:null,url:{crop:null,upload:null},upload:function(elem){$('.avatar-loading').removeClass('hide');$('.modal-image').dialog('close');document.domain=lang['domain'];$.ajaxFileUpload({url:Avatar.url.upload,fileElementId:$(elem).attr('id'),dataType:'json',success:function(r){$('.avatar-loading').addClass('hide');if(r.no==10){$('.crop-dialog').dialog(nDialog_cfg,{width:'auto'}).dialog('option','buttons',[{text:lang['Guardar'],'class':'ui-button-positive box-shadow-soft floatL',click:function(){$('.avatar-loading').removeClass('hide');$('.crop-dialog').dialog('close');$.getScript(Avatar.url.crop+'&crop='+$('img.avatar-crop').attr('data-crop'));}},{text:lang['Cancelar'],'class':'ui-state-default floatR',click:function(){$(this).dialog('close');}}]).html('<img class="avatar-crop hide" src="'+r.error+'" />').dialog('open');$('img.avatar-crop').bind('load',function(){var w=$(this).width(),h=$(this).height(),x0,x1,y0,y1;if(w>h){x1=(w-h)/2;x2=x1+h;y1=0;y2=h;}else{x1=0;x2=w;y1=(h-w)/2;y2=y1+w;}$(this).attr('data-crop',''+w+','+h+','+x2+','+y2).Jcrop({aspectRatio:1,sideHandles:false,setSelect:[x1,y1,x2,y2],onChange:function(obj){$('.avatar-preview img').attr('src',r.error);var rx=120/obj.w,ry=120/obj.h;$('.avatar-preview img').css({width:Math.round(rx*$('img.avatar-crop').width())+'px',height:Math.round(ry*$('img.avatar-crop').height())+'px',marginLeft:'-'+Math.round(rx*obj.x)+'px',marginTop:'-'+Math.round(ry*obj.y)+'px'});$('img.avatar-crop').attr('data-crop',''+obj.w+','+obj.h+','+obj.x+','+obj.y);}}).removeClass('hide');$('.crop-dialog').dialog({position:'center'});});}else if(r.no==0){$('#welcome_avatar').attr('src',r.error);Avatar.save();}}});},crop:function(image){$('.avatar-loading').removeClass('hide');$('.modal-image').dialog('close');document.domain=lang['domain'];$('.crop-dialog').dialog(nDialog_cfg,{width:'auto'}).dialog('option','buttons',[{text:lang['Guardar'],'class':'ui-button-positive box-shadow-soft floatL',click:function(){$('.avatar-loading').removeClass('hide');$('.crop-dialog').dialog('close');$.getScript(Avatar.url.crop+'&crop='+$('img.avatar-crop').attr('data-crop'));}},{text:lang['Cancelar'],'class':'ui-state-default floatR',click:function(){$(this).dialog('close');}}]).html('<img class="avatar-crop hide" src="'+image+'" />').dialog('open');$('img.avatar-crop').bind('load',function(){var w=$(this).width(),h=$(this).height(),x0,x1,y0,y1;if(w>h){x1=(w-h)/2;x2=x1+h;y1=0;y2=h;}else{x1=0;x2=w;y1=(h-w)/2;y2=y1+w;}$(this).attr('data-crop',''+w+','+h+','+x2+','+y2).Jcrop({aspectRatio:1,sideHandles:false,setSelect:[x1,y1,x2,y2],onChange:function(obj){$('.avatar-preview img').attr('src',image);var rx=120/obj.w,ry=120/obj.h;$('.avatar-preview img').css({width:Math.round(rx*$('img.avatar-crop').width())+'px',height:Math.round(ry*$('img.avatar-crop').height())+'px',marginLeft:'-'+Math.round(rx*obj.x)+'px',marginTop:'-'+Math.round(ry*obj.y)+'px'});$('img.avatar-crop').attr('data-crop',''+obj.w+','+obj.h+','+obj.x+','+obj.y);}}).removeClass('hide');$('.crop-dialog').dialog({position:'center'});});},cropCallback:function(r){Avatar.save();$('.avatar-loading').addClass('hide');},save:function(){switch(Avatar.object.type){case'community':$.post('/comunidades/comunidad-upload-imagen.php','s='+Avatar.server+gget('key')+'&cid='+Avatar.object.id);break;default:$.post('/cuenta.php','ajax=1&save=10&s='+Avatar.server+gget('key'));}},openUploader:function(object){this.markItUpObject=object;$('.modal-image.choose').dialog({width:'auto',modal:true,resizable:false,buttons:[{text:lang['Aceptar'],'class':'ui-button-positive floatL',disabled:true},{text:lang['Cancelar'],'class':'floatR',click:ModalImage.close}]}).dialog('open');}}
var Kn3={_cache:{},_callback:function(){},_genurl:function(values){var obj=this;key=$.param(values);if(!obj._cache[key]){$.ajax({type:'post',url:'/ajax/kn3/genurl',data:values,async:false,dataType:'json',success:function(r){obj._cache[key]=r.data}});}return obj._cache[key];},"import":function(url,callback){var obj=this,url=obj._genurl({action:'import',url:url,callback:'Kn3._callback'});obj._callback=callback;$.ajax({url:url,cache:true,dataType:'script'});},upload:function(elem,callback,opts){if(typeof opts==='undefined'){var opts={};}var obj=this,url=obj._genurl($.extend(opts,{action:'upload'}));obj._callback=callback;document.domain=lang['domain'];$.ajaxFileUpload({url:url,fileElementId:$(elem).attr('id'),dataType:'json',success:callback});},getThumbnail:function(str){var parts=str.split("/"),thumbnail;parts[parts.length-1]="tn_"+parts[parts.length-1];thumbnail=parts.join("/");return thumbnail;},getOriginal:function(str){var parts=str.split("/"),original;parts[parts.length-1]=parts[parts.length-1].replace("tn","");original=parts.join("/");return original;}}
function elShow(elementId,state){if(!state){$('#'+elementId).hide();}else{$('#'+elementId).show();}}var Comments={flagComment:false,lastPage:false,showComment:true,objectType:'',objectId:false,objectOwner:false,parentComment:false,pageSize:20,add:function(objType,objId){if(this.flagComment){return;}var textarea=$('#body_comm');var text=textarea.val();if(text==''||text==textarea.attr('title')){textarea.focus();return;}var objOwner=Comments.objectOwner;if(!objOwner){objOwner=0;}$('.myComment .error .loading-icon').show();$('.myComment button').addClass('ui-state-disabled');this.flagComment=true;$.ajax({type:'POST',url:'/ajax/comments/add',data:'comment='+encodeURIComponent(text)+'&objectId='+objId+'&objectOwner='+objOwner+'&objectType='+objType+'&show='+Comments.lastPage,success:function(h){switch(h.charAt(0)){case'0':if(gaTracker&&(objType=='post'||objType=='shout')){if(objType=='post'){gaTracker.trackEvent('Posts.ComentarFallo',h.substring(3));}else{gaTracker.trackEvent('Shouts.ComentarFallo',h.substring(3));}}$('.myComment .error .loading-icon').hide();$('.myComment button').removeClass('ui-state-disabled');$('.myComment .error').html(h.substring(3)).show('slow');break;case'1':if(gaTracker&&(objType=='post'||objType=='shout')){if(objType=='post'){gaTracker.trackEvent('Posts.ComentarOk',gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1);}else{gaTracker.trackEvent('Shouts.ComentarOk',gaTracker.shoutType,gaTracker.shoutId,1);}}$('.myComment .error .loading-icon').hide();$('.myComment button').removeClass('ui-state-disabled');textarea.val('');Comments.flagComment=false;var comm_count=$('#comments .title span.count').html();$('#comments .title span.count').html((parseInt(comm_count)+1));$('.comments-empty').remove();$('<div id="comments-new" style="disply:none;">'+h.substring(3)+'</div>').appendTo('#comments-content');$('#comments-new').slideDown('fast',function(){$('#comments #comments-content #comments-new').removeAttr('id');});break;case'2':if(gaTracker&&(objType=='post'||objType=='shout')){if(objType=='post'){gaTracker.trackEvent('Posts.ComentarOk',gaTracker.postCategory,gaTracker.postId+gaTracker.postTitle,1);}else{gaTracker.trackEvent('Shouts.ComentarOk',gaTracker.shoutType,gaTracker.shoutId,1);}}$('.myComment .error .loading-icon').hide();$('.myComment button').removeClass('ui-state-disabled');textarea.val('');Comments.flagComment=false;var comm_count=$('#comments .title span.count').html();$('#comments .title span.count').html((parseInt(comm_count)+1));$('.comments-empty').remove();$('<div id="comments-new" class="mensaje-ok" style="padding:20px 0px 20px 5px;disply:none;">'+h.substring(3)+'</div>').appendTo('#comments-content');$('#comments-new').slideDown('fast',function(){$('#comments #comments-content #comments-new').removeAttr('id');});break;case'3':$('.myComment .error .loading-icon').hide();$('.myComment button').removeClass('ui-state-disabled');textarea.val('');Comments.flagComment=false;var comm_count=$('#comments .title span.count').html();$('#comments .title span.count').html((parseInt(comm_count)+1));$('.comments-empty').remove();$('<div id="comments-new" style="padding:20px 0px 20px 5px;disply:none;">'+h.substring(3)+'</div>').appendTo('#comments-content');$('#comments-new').slideDown('fast',function(){$('#comments #comments-content #comments-new').removeAttr('id');});$('.myComment').remove();break;}},error:function(){this.flagObjectComment=false;$('.myComment .error .loading-icon').hide();$('.myComment button').removeClass('ui-state-disabled');$('.myComment .error').html(lang['try-again']).show('slow');}});},quickAdd:function(obj,objType,objId,objOwner){var list=$(obj).closest('.activity-element').children('.quick-reply'),counter=list.prevAll('.shout-footer').find('.action-quick-reply-toggle .action-number span'),comment=$('textarea#quick-reply-'+objId).val(),spinner=list.children('.shout-spinner');if(!comment){$('textarea#quick-reply-'+objId).focus();return;}spinner.show().siblings().hide();$.ajax({type:'POST',url:'/ajax/comments/add',data:'comment='+encodeURIComponent(comment)+'&objectId='+objId+'&objectOwner='+objOwner+'&objectType='+objType+'&show='+Comments.lastPage,complete:function(){spinner.hide().siblings().show().filter('textarea').val('').trigger('keyup');list.hide();counter.text(+counter.text()+1);$('.ubertext-counter-shout-footer').hide();}});},del:function(comId,autorId){$('.div_cmnt_'+comId).find('li.iconDelete a').attr('onclick','');$.ajax({type:'POST',url:'/ajax/comments/del',data:'objectType='+this.objectType+'&objectId='+this.objectId+'&objectOwner='+this.objectOwner+'&comId='+comId+'&autorId='+autorId,success:function(h){switch(h.charAt(0)){case'0':mydialog.alert('Error',h.substring(3));$('.div_cmnt_'+comId).find('li.iconDelete a').attr('onclick','Comments.del('+comId+','+autorId+')');break;case'1':var comm_count=$('#comments .title span.count').html();$('#comments .title span.count').html((parseInt(comm_count)-1));if(h.length>10){$('.div_cmnt_'+comId).find('.comment-content').html(h.substring(3));$('.cmnt_btn_block_'+comId).on('click',function(){bloquear(autorId,true,'comentarios-suggest',true,comId);});$('.cmnt_btn_cancel_'+comId).on('click',function(){$('.div_cmnt_'+comId).parent('.comment-replies-container').fadeOut('normal',function(){$(this).remove();});});}else{$('.div_cmnt_'+comId).parent('.comment-replies-container').fadeOut('normal',function(){$(this).remove();});}$('.tipsy:visible').hide();break;}}});},update:function(comId,autorId,status){$.ajax({type:'POST',url:'/ajax/comments/update',data:'objectType='+this.objectType+'&objectId='+this.objectId+'&objectOwner='+this.objectOwner+'&comId='+comId+'&autorId='+autorId+'&status='+status,success:function(h){switch(h.charAt(0)){case'0':mydialog.alert('Error',h.substring(3));break;case'1':$('.div_cmnt_'+comId).find('.admin-fotopost').hide();break;}}});},vote:function(obj,comid,userid,score,sig,parentId){var obj=$('.div_cmnt_'+comid+' '+(score==1?'.addLike':'.addUnlike'));ajax('comments','vote',{id:comid,objectType:this.objectType,objectId:this.objectId,objectOwner:this.objectOwner,owner:userid,score:score,sig:sig,parentId:parentId},{success:function(r){if(r.data=='negative'){mydialog.alert(lang['limite_votos_negativos'],lang['limite_votos_negativos_title'],function(){this.close();});}}});var rel;if(score==1){rel=obj.parent('li').next('li').children('a');}else{rel=obj.parent('li').prev('li').children('a');}obj.attr('onclick','').children('i').addClass('hover');rel.attr('onclick','').addClass('ui-state-disabled');var container=$('.div_cmnt_'+comid+' span.comment-votes-extra-container');var total=parseInt(container.data('votes-total'));var positive=parseInt(container.data('votes-positivo'));var negative=parseInt(container.data('votes-negativo'));if(score==1){positive+=1;}else if(score==-1){negative+=1;}total=positive-negative;var span_text='';if(total==0){container.hide();span_text='0';}else{if(total<0){container.removeClass('thumb-up positivo');container.addClass('thumb-down negativo');span_text=String(total);}else{container.removeClass('thumb-down negativo');container.addClass('thumb-up positivo');span_text='+'+String(total);}container.show();}container.html(span_text);var title_text='+'+String(positive)+' / -'+String(negative);container.attr('title',title_text);container.data('votes-total',total);container.data('votes-positivo',positive);container.data('votes-negativo',negative);},page:function(page){if(page==null){page=1;}var page=parseInt(page);var currentPage=$('.nav-pages li.active a:first').html();if(currentPage==null){currentPage=0;}else{currentPage=parseInt($('.nav-pages li.active a:first').html().replace(/[^0-9]/,''));}if(page===currentPage){return;}$.scrollTo('.nav-pages');$('#comments-content').css('opacity',0.4);return $.ajax({type:'post',url:'/ajax/comments/page',data:{objectType:this.objectType,id:this.objectId,objectOwner:this.objectOwner,p:page},success:function(r){_gaq.push(['_trackPageview',window.location.pathname]);var status=parseInt(r.charAt(0)),data=r.substr(3);if(status==1){$('#comments-container, div#comments').html(data);hide_untrusted_swf();location.hash=lang['pagina']+'-'+page;if(typeof classificationComments!=='undefined'){classificationComments();}}else{mydialog.alert('Ops!',data);}},error:function(){this.success('0: '+lang['try-again']);},complete:function(){$('#comments-content').css('opacity',1);}});},replyBox:function(obj,parentId,message){$('div.replyBox').html('').hide();message=message||'';this.parentComment=parentId;var replybox=$(obj).closest('.comment-replies-container').find('div.replyBox'),html=$('#replyBox').html();replybox.html(html).show();var textarea=replybox.find('textarea');if(textarea.length){textarea.markItUp(bbcodeReplyComment).uberText({limit:500,show:-50,autogrow:true,lines:2});textarea.emoticons();textarea.focus();if(message){textarea.val(message+' ');}}},replyAdd:function(objType,objId){var textarea=$('.replyBox:visible').find('textarea');var text=textarea.val();if(text==''||text==textarea.attr('title')){textarea.focus();return;}var objOwner=Comments.objectOwner;if(!objOwner){objOwner=0;}$('.myComment .error .loading-icon').show();$('.myComment button').addClass('ui-state-disabled');this.flagComment=true;this.lastPage=true;var parentOwner=$('.div_cmnt_'+Comments.parentComment).attr('data-owner');var signature=$('.div_cmnt_'+Comments.parentComment).attr('data-signature');$.ajax({type:'POST',url:'/ajax/comments/add',data:{comment:text,objectId:objId,objectType:objType,objectOwner:objOwner,show:Comments.lastPage,parent:Comments.parentComment,parentOwner:parentOwner,signature:signature},success:function(h){switch(h.charAt(0)){case'0':break;case'1':textarea.val('');Comments.flagComment=false;$('.comments-empty').remove();$('.div_cmnt_'+Comments.parentComment).parent('.comment-replies-container').find('div.comment-replies').append(h.substring(3));$('#comments-new').slideDown('fast',function(){$('#comments #comments-content #comments-new').removeAttr('id');});$('.div_cmnt_'+Comments.parentComment).parent('.comment-replies-container').find('div.replyBox').html('').hide();break;}},complete:function(){$('.myComment button').removeClass('ui-state-disabled');}});},replyDel:function(replyId,autorId,parentId){$.ajax({type:'POST',url:'/ajax/comments/del',data:'objectType='+this.objectType+'&objectId='+this.objectId+'&objectOwner='+this.objectOwner+'&comId='+replyId+'&autorId='+autorId+'&parent='+parentId,success:function(h){switch(h.charAt(0)){case'0':mydialog.alert('Error',h.substring(3));break;case'1':if(h.length>10){$('.div_cmnt_'+replyId).find('.comment-content').html(h.substring(3));$('.cmnt_btn_block_'+replyId).on('click',function(){bloquear(autorId,true,'comentarios-suggest',true,replyId);});$('.cmnt_btn_cancel_'+replyId).on('click',function(){$('.div_cmnt_'+replyId).fadeOut('normal',function(){$(this).remove();});});}else{$('.div_cmnt_'+replyId).fadeOut('normal',function(){$(this).remove();});}$('.tipsy:visible').hide();break;}}});},getReplies:function(obj,commentId){var commentObjectId='.div_cmnt_'+commentId,commentObject=$('.div_cmnt_'+commentId),replyPage=parseInt(commentObject.attr('data-reply-page'));commentObject.next('.more-replies').addClass('ui-state-disabled');$.ajax({type:'post',url:'/ajax/comments/get-replies',data:{objectType:this.objectType,objectId:this.objectId,objectOwner:this.objectOwner,commentId:commentId,page:replyPage},dataType:'json',success:function(h){if(h.status==1){commentObject.attr('data-reply-page',replyPage+1);var loadMoreObject=commentObject.next('.more-replies'),replyContainer=loadMoreObject.next('.comment-replies');$.each(h.data,function(){replyContainer.prepend(tmpl('comment_reply_template',this));});loadMoreObject.removeClass('ui-state-disabled');var replyTotalCount=commentObject.attr('data-reply-count'),replyPrintedCount=replyContainer.find('.comment').length;loadMoreObject.find('a').html('Cargar '+(replyTotalCount-replyPrintedCount)+' m&aacute;s');if(replyTotalCount<=replyPrintedCount){loadMoreObject.hide();}$('.more-replies ~ .comment-replies .comment:first-child').css({borderTop:'1px solid #ebebeb'});}}});},view:function(id,obj){var action=$(obj).attr('name'),c_comment=$('.div_cmnt_'+id),comment_container=$('.div_cmnt_'+id+' .comment-text .comment-content');if(action=='show'){if(comment_container.text().trim()==''){$.ajax({type:'POST',url:'/ajax/comments/view',data:'comid='+id+'&objectId='+this.objectId+'&objectType='+this.objectType+'&objectOwner='+this.objectOwner,success:function(h){switch(h.charAt(0)){case'0':break;case'1':c_comment.find('.show-comment-post').attr('name','hide');comment_container.html(h.substring(3));c_comment.removeClass('deleted-comment');action=false;break;}},error:function(){}});}else{c_comment.find('.show-comment-post').attr('name','hide');c_comment.removeClass('deleted-comment');}c_comment.find('.show-comment-post .default-button-text').hide();c_comment.find('.show-comment-post .success-button-text').show();}else{c_comment.find('.show-comment-post').attr('name','show');c_comment.addClass('deleted-comment');c_comment.find('.show-comment-post .success-button-text').hide();c_comment.find('.show-comment-post .default-button-text').show();}}}
function artNav(next){var artNavElem=$('.cover.c-300 .albumImage'),elem=$(artNavElem).filter(':visible'),newelem=next?$(elem).next():$(elem).prev();if($(newelem).is('a')){$(elem).hide();$(newelem).show();$('.cover .edit-bt a:hidden').show();if($(newelem).prev().is(':first')||$(newelem).next().is(':last')){$('.cover .edit-bt a:eq('+(next?1:0)+')').hide();}}}function actualizar_comentarios(cat,nov){$('#lastCommentsBox-data').css('opacity',0.4);$.ajax({type:'POST',url:'/ajax/comment/last',cache:false,data:'cat='+cat+'&nov='+nov,success:function(h){$('#lastCommentsBox-data').html(h);},complete:function(){$('#lastCommentsBox-data').css('opacity',1);}});}var Block={block:function(type,id,cb,obj){var action=obj.attr('name');var datastring='';if(action=='block'){datastring='user='+id+'&bloqueado=1';}else{datastring='user='+id;}$.ajax({type:'POST',url:'/ajax/user/block',data:datastring+gget('key'),success:function(h){cb(h,obj);}});},userInprofileContext:function(h,obj){var action=obj.attr('name');if(action=='block'){obj.attr('name','uBlock');obj.removeClass('block-user-profile');obj.addClass('uBlock-user-profile');}else{obj.attr('name','block');obj.removeClass('uBlock-user-profile');obj.addClass('block-user-profile');}obj.find('span.default-button-text').toggle();obj.find('span.success-button-text').toggle();},userInmpContext:function(h,obj){var action=obj.attr('name');if(action=='block'){bButtons=$('a[name=block]');bButtons.each(function(){$(this).attr('name','unblock');$(this).find('span.default-button-text').toggle();$(this).find('span.success-button-text').toggle();});}else{bButtons=$('a[name=unblock]');bButtons.each(function(){$(this).attr('name','block');$(this).find('span.default-button-text').toggle();$(this).find('span.success-button-text').toggle();});}}}
function user_menu_show(param){if(param){$('.my-account-links').show();$('#mensajes-box').hide();$('#notifications-box').hide();$('#favorites-box').hide();}else{$('.my-account-links').hide();}}var Hovercard={cache:{},lock:{},callback:function(obj){var uid=$(obj).attr('data-uid'),template;if(!Hovercard.cache[uid]){template='';if(!Hovercard.lock[uid]){Hovercard.lock[uid]=true;$.ajax({type:'POST',url:'/ajax/mentions/user',data:'uid='+uid,dataType:'json',success:function(r){if(r.status==1){template=tmpl('hovercard',r.data);$('.hovercard-'+uid).html(template);$('.ui-btn').button();Hovercard.cache[uid]=template;}}});}}else{template=Hovercard.cache[uid];}return'<div class="hovercard-'+uid+' tooltip-hovercard">'+template+'</div>';}}
function borrar_act(actid,perfilid,el){$.ajax({type:'POST',url:'/ajax/ultima_actividad-borrar.php',data:'actid='+actid+'&perfilid='+perfilid+gget('key'),success:function(h){switch(h.charAt(0)){case'0':mydialog.alert('Error',h.substring(3));break;case'1':$(el).parent().parent().fadeOut('normal',function(){if($(this).siblings('div').length==0){var datesep=$(this).parent();$(this).remove();$(datesep).delay(700).fadeOut('slow',function(){$(this).remove;});}else{$(this).remove();}});break;}},error:function(){mydialog.error_500("borrar_act('"+actid+"')");}});}function filtrar_ultima_actividad(filtercode,perfilid){$.ajax({type:'POST',url:'/ajax/ultima_actividad-filtrar.php',data:'filter='+filtercode+'&perfilid='+perfilid,success:function(h){switch(h.charAt(0)){case'0':mydialog.alert('Error',h.substring(3));break;case'1':var filteredAct=h.substring(3,h.length);$('#last-activity-container').html(filteredAct);break;}},error:function(){mydialog.error_500("filtrar_ultima_actividad('"+filtercode+"')");}});}var loadScrollTimes=0;function more_ultima_actividad(lastkey,perfilid,mtimes){$('#last-activity-view-more').remove();$('<div id="loading-feed"></div>').appendTo('#full-col');var lastulid=$('#last-activity-container .date-sep:last').attr('id');var filterval=$('#last-activity-filter').val();$.ajax({type:'POST',url:'/ajax/ultima_actividad-more.php',data:'lastkey='+lastkey+'&perfilid='+perfilid+'&filter='+filterval+'&lastul='+lastulid+'&mtimes='+mtimes,success:function(h){switch(h.charAt(0)){case'0':mydialog.alert('Error',h.substring(3));break;case'1':var moreAct=h.substring(3,h.length);var htmlToPrevdiv=[];var nmoreAct=[];var iteratora=0;var length=$(moreAct).size();;for(var a=0;a<length;a++){if($(moreAct).eq(a).attr('class')=='sep'){htmlToPrevdiv[iteratora]=$('<div>').append($(moreAct).eq(a).clone()).remove().html();}else{nmoreAct[iteratora]=$('<div>').append($(moreAct).eq(a).clone()).remove().html();}iteratora++;}$('#loading-feed').remove();$('#'+lastulid).append(htmlToPrevdiv.join(''));$('#last-activity-container').append(nmoreAct.join(''));$('.shout-quick-reply.ubertext-me').uberText({limit:512,block:true,autogrow:true});++loadScrollTimes;break;}},error:function(){mydialog.error_500("filtrar_ultima_actividad('"+filtercode+"')");}});}var nav={suggesting:false,current:-1,hover:false,go:function(y){nav.items=$('ul.mentionsuggest li');if(y==='up'&&nav.current!=-1){if(nav.current===0){$('ul.mentionsuggest').hide();nav.suggesting=false;}nav.current--;}else if(y==='down'){if(nav.current===nav.items.length){nav.current=0;}else{nav.current++;}}else{nav.current=nav.items.length-1;}nav.items.removeClass('active').eq(nav.current).addClass('active');}};var mi={initUploadfy:function(){$('.shout-box .uploadfy:visible').uploadify({'uploader':'/uploadify/uploadify.swf','script':kn3UploadUrl,'buttonImg':'','expressInstall':null,'cancelImg':'','folder':'','auto':true,'scriptAccess':'always','fileDesc':'Imagenes soportadas (*.gif;*.jpeg;*.jpg;*.png)','fileExt':'*.gif;*.jpeg;*.jpg;*.png','sizeLimit':10485760,'fileDataName':'file','simUploadLimit':1,'wmode':'transparent','onAllComplete':function(){if(gaTracker){gaTracker.trackEvent('Shouts.CrearShout','SubirImagenDesdePC.Completo');}},'onCancel':function(){},'onCheck':function(){},'onClearQueue':function(){},'onComplete':function(event,ID,fileObj,response,data){var el=$(event.target).closest('.shout-box');$(el).data('inUpload',false);if($(el).data('in')=='menu')$('#compose-navitem, #compose-box').removeClass('noHideForce');$(el).find('.my-shout-attach-options').hide();response=$.parseJSON(response);switch(response['no']){case 0:$(el).data('inPreview',true);var data={'url':response['error']};$(el).find('.my-shout-attach').html(tmpl('template_attach_image_preview',data));$(el).children('.my-shout-content-mi').children('.my-shout-attach').addClass('loading-i');$(el).data('attach-data',{'type':'image','url':data['url']});$(el).children('.my-shout-content-mi').children('.my-shout-attach').removeClass('loading-i');break;case 6:mi.attach.showError(el,getlang('El archivo es demasiado pesado'));break;case 7:mi.attach.showError(el,getlang('La extension del archivo no es valida'));break;default:mi.attach.showError(el,getlang('La imagen no pudo ser enviada'));}},'onError':function(event,ID,fileObj,errorObj){var el=$(event.target).closest('.shout-box');if($(el).data('in')=='menu')$('#compose-navitem, #compose-box').removeClass('noHideForce');$(el).find('.my-shout-attach-options').hide();$(el).data('inUpload',false);mi.attach.showError(el,getlang('Hubo un error al subir la imagen'));},'onInit':function(){},'onOpen':function(){},'onProgress':function(event,ID,fileObj,data){var el=$(event.target).closest('.shout-box');mi.attach.progressBar(el,data['percentage']);},'onQueueFull':function(){},'onSelect':function(event,ID,fileObj){var el=$(event.target).closest('.shout-box');if($(el).data('in')=='menu')$('#compose-navitem, #compose-box').addClass('noHideForce');if($(el).find('.my-shout-attach-image').is(':visible'))$('body').click();var actual=(typeof $(el).data('actual')==='undefined')?false:$(el).data('actual');var inUpload=(typeof $(el).data('inUpload')!=='undefined'&&$(el).data('inUpload'));var inPreview=(typeof $(el).data('inPreview')!=='undefined'&&$(el).data('inPreview'));var inSubmit=(typeof $(el).data('inSubmit')!=='undefined'&&$(el).data('inSubmit'));if(inSubmit||inUpload||inPreview)return false;$(el).addClass('with-attach');if(actual)$(el).find('.my-shout-attach').removeClass('attach-'+actual);if(actual=='link')$(el).find('.my-shout-attach').removeClass('link-shout-content');$(el).find('.my-shout-attach').addClass('attach-image');$(el).find('.my-shout-attach-options a[data-type="image"]').addClass('hover');$(el).data('actual','image');$(el).data('imageId',ID);$(el).data('inUpload',true);$(el).find('.my-shout-attach').html(tmpl('template_attach_progress')).show();mi.attach.progressBar(el,0);return false;},'onSelectOnce':function(){if(gaTracker){gaTracker.trackEvent('Shouts.CrearShout','SubirImagenDesdePC.Abrir');}},'onSWFReady':function(){}});},submit:function(el){var inUpload=(typeof $(el).data('inUpload')!=='undefined'&&$(el).data('inUpload'));var inSubmit=(typeof $(el).data('inSubmit')!=='undefined'&&$(el).data('inSubmit'));if(inUpload||inSubmit)return;var params={'key':global_data.user_key,'body':$.trim($(el).find('.body').val()),'privacy':$(el).find('.privacy-shout').data('privacy')};if(params['body'].length>255){return;}var attachData=(typeof $(el).data('attach-data')!=='undefined')?$(el).data('attach-data'):false;if(!attachData){params['attachment_type']=0;params['attachment']='';var template='feed_shout_text';}else{switch(attachData['type']){case'image':params['attachment_type']=1;params['attachment']=attachData['url'];var template='feed_shout_image';break;case'video':params['attachment_type']=2;params['attachment']=attachData['url'];var template='feed_shout_video';break;case'link':params['attachment_type']=3;params['attachment']=attachData['id'];var template='feed_shout_link';break;}}var shoutFrom=$(el).data('in');switch(shoutFrom){case'wall':params['wall']=$(el).data('wall');var ajaxUrl='/ajax/wall/add-post';break;default:var ajaxUrl='/ajax/shout/add';break;}if(!params['body']&&params['attachment_type']==0)return;$(el).data('inSubmit',true);$(el).find('.my-shout-add').addClass('ui-state-disabled');var element=el;var self=this;$.ajax({type:'POST',url:ajaxUrl,data:$.param(params),success:function(data){var response=data.substring(0,1);if(response=='{'){var errorData=$.parseJSON(data);mi.attach.showError(el,errorData['data']);if(gaTracker){gaTracker.trackEvent('Shouts.CrearShout','CompartirError',errorData.data);}return;}$(element).data('inSubmit',false);$(element).find('.my-shout-add').removeClass('ui-state-disabled');switch(shoutFrom){case'wall':$(data).prependTo('#last-activity-container').hide().slideDown('fast');mi.reset(element);$.scrollTo($('#last-activity-container'));break;case'menu':$(element).hide();$('#compose-box .shout-box-submit').show();setTimeout(function(){$('#compose-box').fadeOut('fast',function(){$('#compose-navitem').removeClass('active');$('#compose-box .shout-box-submit').hide();$(element).show();mi.reset(element);});},3000);if(gaTracker){gaTracker.trackEvent('Shouts.CrearShout','CompartirOk');}break;default:$(data).prependTo('#shouts, #newsfeed, #last-activity-container, #Feed-list').hide().slideDown('fast');mi.reset(element);$.scrollTo($('#shouts, #newsfeed, #last-activity-container, #Feed-list'));if(gaTracker){gaTracker.trackEvent('Shouts.CrearShout','CompartirOk');}break;}$('.ui-mention-highlighter').html('');},error:function(){},complete:function(){$(element).data('inSubmit',false);$(element).find('.my-shout-add').removeClass('ui-state-disabled');}});},reset:function(el){this.attach.remove(el);$(el).find('.body').val('');},undo:function(id){var el=$('.shout-box[data-in="mi"]');ajax('shout','undo',{id:id},{success:function(r){$(el).find('.body').val(r.data.body);mi.attach.input(el,r.data.attach.type)
$(el).find('.my-shout-attach-options').hide();mi.attach.show(el,{data:r.data.attach});}});},attach:{input:function(el,type){var actual=(typeof $(el).data('actual')==='undefined')?false:$(el).data('actual');var inUpload=(typeof $(el).data('inUpload')!=='undefined'&&$(el).data('inUpload'));var inPreview=(typeof $(el).data('inPreview')!=='undefined'&&$(el).data('inPreview'));var inSubmit=(typeof $(el).data('inSubmit')!=='undefined'&&$(el).data('inSubmit'));if(inSubmit||inUpload||inPreview)return;$(el).addClass('with-attach');if(actual)$(el).find('.my-shout-attach').removeClass('attach-'+actual);if(actual=='link')$(el).find('.my-shout-attach').removeClass('link-shout-content');$(el).find('.my-shout-attach').addClass('attach-'+type);$(el).find('.my-shout-attach-options a').removeClass('hover');$(el).find('.my-shout-attach-options a[data-type="'+type+'"]').addClass('hover');$(el).data('actual',type);$(el).find('.my-shout-attach').html(tmpl('template_attach_'+type+'_input')).show();$(el).find('.my-shout-attach form').bind('submit',function(){mi.attach.submitUrl(el,type);return false;});$(el).find('.my-shout-attach form input[name="url"]').bind('blur',function(){mi.attach.submitUrl(el,type);return false;});},remove:function(el){var actual=(typeof $(el).data('actual')==='undefined')?false:$(el).data('actual');var inSubmit=(typeof $(el).data('inSubmit')!=='undefined'&&$(el).data('inSubmit'));if(inSubmit)return;if(actual)$(el).find('.my-shout-attach').removeClass('attach-'+actual);if(actual=='link')$(el).find('.my-shout-attach').removeClass('link-shout-content');$(el).data('actual',false);$(el).data('inUpload',false);$(el).data('inPreview',false);$(el).removeClass('with-attach');$(el).find('.my-shout-attach').html('').hide();$(el).find('.my-shout-attach-options a').removeClass('hover');$(el).find('.my-shout-attach-options').show();$(el).data('attach-data',false);},cancel:function(el){if($(el).data('actual')=='image'){var id=$(el).data('imageId');$(el).find('.my-shout-attach-options .uploadfy').uploadifyCancel(id);}clearInterval(this.submitUrlProgressBarTimer);this.remove(el);},submitUrlProgressBarTimer:false,submitUrlProgressBar:function(el){$(el).find('.my-shout-attach').html(tmpl('template_attach_progress')).show();this.progressBar(el,0);var perc=0;this.submitUrlProgressBarTimer=setInterval(function(){perc++;mi.attach.progressBar(el,perc);if(perc==100)perc=0;},10);},submitUrl:function(el,type){if(type=='video'){if(gaTracker){gaTracker.trackEvent('Shouts.CrearShout','AgregarVideo.AgregarURL');}}if(type=='link'){if(gaTracker){gaTracker.trackEvent('Shouts.CrearShout','AgregarLink.AgregarURL');}}var inUpload=(typeof $(el).data('inUpload')!=='undefined'&&$(el).data('inUpload'));if(inUpload)return false;var url_el=$(el).find('.my-shout-attach input[name="url"]');var url=$.trim($(url_el).val());if(url==''||url.split('.').length<2)return false;var params={'url':url};if(type=='image')params['isImage']=1;else if(type=='video')params['isVideo']=1;var inUpload=Math.floor(Math.random()*99999);$(el).data('inUpload',inUpload);this.submitUrlProgressBar(el);$.ajax({type:'POST',url:'/ajax/shout/attach',data:$.param(params),dataType:'json',success:function(data){if($(el).data('inUpload')!==inUpload)return;$(el).data('inUpload',false);clearInterval(mi.attach.submitUrlProgressBarTimer);switch(data['status']){case 0:mi.attach.showError(el,data['data']);break;case 1:if(gaTracker){if(type=='image'){gaTracker.trackEvent('Shouts.CrearShout','SubirImagenDesdeURL.Completo');}else if(type=='video'){gaTracker.trackEvent('Shouts.CrearShout','AgregarVideo.AgregarURLOk');}else if(type=='link'){gaTracker.trackEvent('Shouts.CrearShout','AgregarLink.AgregarURLOk');}}mi.attach.show(el,data);}$(el).find('.my-shout-attach-options').hide();if(data['type']!=='image')$(el).find('.attach-'+data['type']).show();},error:function(){if($(el).data('inUpload')!==inUpload)return;$(el).data('inUpload',false);$(el).find('.my-shout-attach-options').hide();clearInterval(mi.attach.submitUrlProgressBarTimer);mi.attach.showError(el,'El servidor no responde');}});},show:function(el,data){data=data['data'];html=tmpl('template_attach_'+data['type']+'_preview',data);$(el).data('inPreview',true);$(el).find('.my-shout-attach').html(html);switch(data['type']){case'image':case'video':$(el).data('attach-data',{'type':data['type'],'url':data['url']});break;case'link':$(el).data('attach-data',{'type':data['type'],'id':data['id']});$('#compose-box').find('.modal-wrapper').addClass('p-link');break;}},progressBar:function(el,percentage){$(el).find('.my-shout-attach-progressBar').progressbar({'value':percentage});},showError:function(el,message){var data={'message':message};$(el).find('.my-shout-attach').show().html(tmpl('template_attach_error',data));$(el).find('.my-shout-attach-options').hide();}}};$(document).on('click','.wall-action-vote.pointer',function(){if($(this).hasClass('ui-state-disabled')||!global_data.user_key){return false;}var object=$(this),parent=object.closest('div.w-action-list'),nlabel=object.find('div.action-number span'),id=parent.attr('data-id'),wallId=parent.attr('data-wall');object.addClass('done ui-state-disabled');object.find('i').addClass('s-like-color');nlabel.html(parseInt(nlabel.html())+1);ajax('wall','vote-post',{id:id,wallId:wallId,score:1},{});});function getWallPostActivity(list,objId,wall,page){var data={id:objId,wall:wall,page:!page?1:page};list.css('paddingBottom','30px').show().children('.activity-spinner').css('display','block');$.ajax({url:'/ajax/wall/activity-get',type:'post',data:data,dataType:'json',success:function(actions){list.css('paddingBottom','0px');list.children('.activity-spinner').hide();var len=actions.length;if(len>0){var html='';for(i=0;i<len;++i){html+=tmpl('action_log_item',actions[i]);}list.append(html).show();if(len==50){list.css('paddingBottom','30px');list.children('.activity-see-more').css('display','block');}else{list.css('paddingBottom','0px');list.children('.activity-spinner').hide();}}else{list.css('paddingBottom','0px');list.children('.activity-see-more').hide();list.children('.emptyData').show();}}});}$(".w-action-activity").live("click",function(){var list=$(this).closest(".shout-footer").next(".list");if(list.is(":visible")){list.hide();}else{if(!list.children('.list-element').length){var parentObject=$(this).closest(".w-action-list");list.children('.emptyData').hide();getWallPostActivity(list,parentObject.attr("data-id"),parentObject.attr("data-wall"),1);}else{list.show();}}});$('.w-activity-see-more').live('click',function(event){event.preventDefault();var button=$(this),spinner=$(this).next('.activity-spinner'),list=button.parent(),page=+button.attr('page'),parentObject=list.prev().children('.w-action-list');button.hide();spinner.show();getWallPostActivity(list,parentObject.attr("data-id"),parentObject.attr("data-owner"),page+1);button.attr('page',page+1)})
var wall={deleteObject:function(objType,objId,wallId,owner,refresh){$('#deleteWallObject-dialog').dialog({width:300,resizable:false,modal:true,buttons:[{text:lang['Aceptar'],"class":'ui-button-positive box-shadow-soft floatL',click:function(){ajax('wall','post-delete',{objType:objType,id:objId,wallId:wallId,owner:owner},{success:function(r){if(r.status==1){$('#deleteWallObject-dialog').dialog('close');mydialog.alert(lang['wallpost_borrado_cuerpo'],lang['wallpost_borrado_title'],function(){if(refresh){history.back();}else{$('#wPost'+objId).fadeOut('slow');}});}}});}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]});}}
var mensajes={cache:{},retry:Array(),ajax:function(param,cb,obj){if(obj&&obj.hasClass('loading-icon')){return;}mensajes.retry.push(param);mensajes.retry.push(cb);$.ajax({url:'/ajax/mp/last',type:'post',dataType:'json',data:param.join('&')+gget('key'),cache:false,success:function(r){if(r.status==1){if(obj){obj.removeClass('loading-icon');}cb(r.data);}else{if(obj){obj.removeClass('loading-icon');}cb(r.data);}}});},last:function(){if($('#compose-box').hasClass('noHideForce'))return false;var c=parseInt($('#mensajes-navitem > .bubble > a > span').html());if($('#mensajes-box').css('display')!='none'){$('#mensajes-box').hide();$('#mensajes-navitem').removeClass('active');}else{if(($('#mensajes-box').css('display')=='none'&&c>0)||typeof mensajes.cache.last=='undefined'){$('#mensajes-navitem').children('i').addClass('loading-icon');$('.navitem').removeClass('active');$('#mensajes-navitem').addClass('active');mensajes.ajax(Array('action=last'),function(data){mensajes.cache.last=data;$('#mensajes-navitem').children('.bubble').remove();mensajes.show();},$('#mensajes-navitem'));if(typeof notifications!=='undefined'){notifications.resetCount('messages');}}else{mensajes.show();}}},show:function(){if(typeof mensajes.cache.last!='undefined'){$('.navitem').removeClass('active');$('.navpanel').hide();$('#mensajes-navitem').addClass('active').children('i').removeClass('loading-icon');$('#mensajes-list').html(tmpl("lastmessages_tmpl",{data:mensajes.cache.last}));$('#mensajes-box').show().find('a[title]').tipsy({gravity:'s'});}}}
function set_checked(obj){document.getElementById(obj).checked=true;}function is_checked(obj){return document.getElementById(obj)&&document.getElementById(obj).checked;}function gget(data,sin_amp){var r=data+'=';if(!sin_amp)r='&'+r;switch(data){case'key':if(global_data.user_key!='')return r+global_data.user_key;break;case'postid':if(global_data.postid!='')return r+global_data.postid;break;case'comid':if(global_data.comid!='')return r+global_data.comid;break;case'temaid':if(global_data.temaid!='')return r+global_data.temaid;break;}return'';}function el(id){if(document.getElementById)return document.getElementById(id);else if(window[id])return window[id];return null;}function keypress_intro(e){tecla=(document.all)?e.keyCode:e.which;return(tecla==13);}function onfocus_input(o){if($(o).val()==$(o).attr('title')){$(o).val('');$(o).removeClass('onblur_effect');}}function onblur_input(o){if($(o).val()==$(o).attr('title')||$(o).val()==''){$(o).val($(o).attr('title'));$(o).addClass('onblur_effect');}}function shout_delete(id,owner){$('#deleteShout-dialog').dialog({width:300,resizable:false,modal:true,buttons:[{text:lang['Aceptar'],"class":'ui-button-positive box-shadow-soft floatL',click:function(){ajax('shout','delete',{id:id,owner:owner},{success:function(r){if(r.status==1){$('#deleteShout-dialog').dialog('close');mydialog.alert(lang['shout_borrado_cuerpo'],lang['shout_borrado_title'],function(){window.location.href=lang['mi_url'];});}}});}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]});}function shout_reactivate(id,owner){$('#activateShout-dialog').dialog({width:300,resizable:false,modal:true,buttons:[{text:lang['Aceptar'],"class":'ui-button-positive box-shadow-soft floatL',click:function(){ajax('shout','reactivate',{id:id,owner:owner},{success:function(r){if(r.status==1){$('#activateShout-dialog').dialog('close');mydialog.alert(lang['shout_reactivado_cuerpo'],lang['shout_reactivado_title'],function(){window.location.reload();});}}});}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]});}function shout_report(shoutId,owner){$.ajax({type:'POST',url:'/ajax/shout-report-form-modal.php',data:{'id':shoutId,'owner':owner},success:function(h){$('#action-dialogs .reportShout-dialog').html(h);nDialog_cfg.width=450;$('#action-dialogs .reportShout-dialog').dialog(nDialog_cfg);$('.reportShout-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-positive box-shadow-soft floatL',click:function(){$('#flag-shout-form').submit();$(this).dialog("close");}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.reportShout-dialog').dialog('open');}});}function comment_report(commentId,owner,parentId,parentOwner,commentType){$.ajax({type:'POST',url:'/ajax/comment-report-form-modal.php',data:{'id':commentId,'owner':owner,'type':commentType,'parentOwner':parentOwner,'parentId':parentId},success:function(h){$('#action-dialogs').append('<div id="comment-report" class="test-report"></div>');$('.test-report').html(h);$('.test-report').dialog({modal:true,resizable:false,width:'auto',height:350,title:'Denunciar comentario',close:function(){$('#comment-report').remove();},buttons:[{text:'Denunciar',"class":'ui-button-positive box-shadow-soft floatL',click:function(){comment_report_send(commentId,owner,commentType,parentId,parentOwner);$(this).dialog("close");$(this).remove();}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');$(this).remove();}}]});$('.test-report').dialog('open');}});}function comment_report_send(commentId,owner,type,parentId,parentOwner){$.ajax({type:'POST',dataType:'json',url:'/ajax/comment-add-report.php',data:{'commentId':commentId,'owner':owner,'type':type,'parentOwner':parentOwner,'parentId':parentId,'cuerpo':$('#cuerpo').val(),'razon':$('#razon').val()},success:function(response){mydialog.alert(response.data,"Denunciar comentario",function(){},'lightbox-denunciar-rta');},error:function(){}});}function show_parent_reply(commentId,parentId){var parent='#comments-featured .div_cmnt_'+parentId,comment='#comments-featured .div_cmnt_'+commentId;$(parent).slideToggle();$(comment).find('.respuesta').toggle();if(!$(comment).hasClass('comment-replies')){$(comment).addClass('comment-replies');$('#comments-featured .div_cmnt_'+commentId).find('img').first().attr({"class":'lazy avatar-32'}).css("display","block");}else{$('#comments-featured .div_cmnt_'+commentId).removeClass('comment-replies');$('#comments-featured .div_cmnt_'+commentId).find('img').first().attr({"class":'lazy avatar-48'}).css("display","block");}}var shout={vote:function(obj,score){var uuid=$(obj).attr('data-id'),owner=$(obj).attr('data-owner');if(owner==global_data.user){return false;}c_score=$(obj).prev('li').children('.counter').html();c_score=parseInt(c_score)+1;$(obj).prev('li').children('.counter').html(c_score);$(obj).attr('onclick','return false');$(obj).prev('li').show();$(obj).find('i').removeClass('s-like').addClass('s-like-color');ajax('shout','vote',{uuid:uuid,owner:owner,score:score},{});}}
var suggested={updateUserFeed:function(userid,el){$.ajax({type:'post',url:'/ajax/suggest/updatefeed',data:{uid:userid},dataType:'html',success:function(r){$('#newsfeed').html('');Feed.last='';Feed.fetch();el.parent().html(r);$('.ui-btn').button();}});}}
var notifica={cache:{},retry:Array(),ajax:function(param,cb,obj,nowait,process_response){if(obj&&obj.hasClass('loading-icon'))return;notifica.retry.push(param);notifica.retry.push(cb);var error=param[0]!='action=count';if(obj){obj.addClass('loading-icon');}if(nowait!==undefined&&nowait){if(obj){obj.removeClass('loading-icon');}if(cb)cb(obj);}else{nowait=false;}if(process_response!==undefined&&process_response){$.ajax({url:'/notificaciones-ajax.php',dataType:'json',type:'post',data:param.join('&')+gget('key'),cache:false,success:function(r){if($.trim(r)=='')return;var response_code=r.status;switch(response_code){case 0:if(cb)cb(obj,r,true);break;default:break;}}});}else{$.ajax({url:'/notificaciones-ajax.php',type:'post',data:param.join('&')+gget('key'),cache:false,success:function(r){if(!nowait){if(obj){obj.removeClass('loading-icon');if(cb)cb(obj,r);}else{if(cb)cb(r);}}}});}},last:function(){if($('#compose-box').hasClass('noHideForce'))return false;var c=parseInt($('#notifications-navitem > .bubble > a > span').html()),notifications_box=$('#notifications-box'),notifications_navitem=$('#notifications-navitem');if($(notifications_box).css('display')!='none'){$(notifications_box).hide();$(notifications_navitem).removeClass('active');}else{if(($(notifications_box).css('display')=='none'&&c>0)||typeof notifica.cache.last=='undefined'){$(notifications_navitem).children('i').addClass('loading-icon');$('.navitem').removeClass('active');$(notifications_navitem).addClass('active');notifica.ajax(Array('action=last'),function(obj,r){notifica.cache['last']=r;notifica.show();},$(notifications_navitem));}else{notifica.show();}}},show:function(){if(typeof notifica.cache.last!='undefined'){$('.navitem').removeClass('active');$('.navpanel').hide();$('#notifications-navitem').addClass('active');$('#notifications-navitem').children('i').removeClass('loading-icon');$('#notifications-box').show().children().children('div.list').html(notifica.cache.last);$('#notifications-box a[title][title!=""]').tipsy({gravity:'s'});if(typeof notifications==='undefined'){menuPopupAlert('notifications-navitem',0);ajaxCheck.add('notifications',0);}if(typeof notifications!=='undefined'){notifications.resetCount('notification');}}},userMenuPopup:function(obj){var id=$(obj).attr('userid');var cache_id='following_'+id,list=$(obj).children('ul');$(list).children('li.check').hide();if(this.cache[cache_id]==1){$(list).children('li.follow').hide();$(list).children('li.unfollow').show();}else{$(list).children('li.unfollow').hide();$(list).children('li.follow').show();}},userMenuHandle:function(r){var x=r.split('-');if(x.length==3&&x[0]==0){var cache_id='following_'+x[1];notifica.cache[cache_id]=parseInt(x[0]);}else if(x.length==4){mydialog.alert(lang['Notificaciones'],x[4]);}},userIntemaContext:function(obj,r){var followersCounter=$('#user-metadata-post .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},userInpostContext:function(obj,r){var followersCounter=$('#user-metadata-post .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},userInfollowersContext:function(obj,r){var action=obj.attr('name');if(action=='follow'){notifica.updateFollowButton(obj);}else{notifica.updateUnfollowButton(obj);}},userInfollowMonitorContext:function(obj,r){var followersCounter=$('#user-metadata-post span.followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;obj.attr('name','unfollow');obj.find('span').removeClass('add_follow');obj.find('span').addClass('remove_follow');}else{updatedFollowers=parseInt(actualFollowers)-1;obj.attr('name','follow');obj.find('span').removeClass('remove_follow');obj.find('span').addClass('add_follow');}followersCounter.data('val',updatedFollowers);obj.find('span.ui-button-text > span.default-button-text').toggle();obj.find('span.ui-button-text > span.success-button-text').toggle();$('#user-metadata-post span.followers-count').hide().html(number_format(updatedFollowers)).show();},userInalbumContext:function(obj,r){var followersCounter=$('#user-metadata-post .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},userIntrackContext:function(obj,r){var followersCounter=$('#user-metadata-post .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},postInfollowMonitorContext:function(obj,r){var followersCounter=$('#user-metadata-post span.followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;obj.attr('name','unfollow');obj.find('span').removeClass('add_follow');obj.find('span').addClass('remove_follow');}else{updatedFollowers=parseInt(actualFollowers)-1;obj.attr('name','follow');obj.find('span').removeClass('remove_follow');obj.find('span').addClass('add_follow');}followersCounter.data('val',updatedFollowers);obj.find('span.ui-button-text > span.default-button-text').toggle();obj.find('span.ui-button-text > span.success-button-text').toggle();$('#user-metadata-post span.followers-count').hide().html(number_format(updatedFollowers)).show();},temaInfollowMonitorContext:function(obj,r){var followersCounter=$('#user-metadata-post span.followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;obj.attr('name','unfollow');obj.find('span').removeClass('add_follow');obj.find('span').addClass('remove_follow');}else{updatedFollowers=parseInt(actualFollowers)-1;obj.attr('name','follow');obj.find('span').removeClass('remove_follow');obj.find('span').addClass('add_follow');}followersCounter.data('val',updatedFollowers);obj.find('span.ui-button-text > span.default-button-text').toggle();obj.find('span.ui-button-text > span.success-button-text').toggle();$('#user-metadata-post span.followers-count').hide().html(number_format(updatedFollowers)).show();},comunidadInfollowMonitorContext:function(obj,r){var followersCounter=$('#user-metadata-post span.followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;obj.attr('name','unfollow');obj.find('span').removeClass('add_follow');obj.find('span').addClass('remove_follow');}else{updatedFollowers=parseInt(actualFollowers)-1;obj.attr('name','follow');obj.find('span').removeClass('remove_follow');obj.find('span').addClass('add_follow');}followersCounter.data('val',updatedFollowers);obj.find('span.ui-button-text > span.default-button-text').toggle();obj.find('span.ui-button-text > span.success-button-text').toggle();$('#user-metadata-post span.followers-count').hide().html(number_format(updatedFollowers)).show();},updateFollowButton:function(obj){if(!obj.hasClass('just-clicked')){obj.addClass('just-clicked');obj.addClass('ui-button-positive');obj.attr('name','unfollow');obj.find('span.ui-button-text > span.unfollow-button-text').removeClass('disabled').hide();obj.find('span.ui-button-text > span.follow-button-text').hide();obj.find('span.ui-button-text > span.following-button-text').show();obj.mouseleave(function(){if(!$(this).hasClass('just-clicked')){if($(this).find('span.ui-button-text > span.follow-button-text').is(":visible")){}else{$(this).find('span.ui-button-text > span.follow-button-text').hide();$(this).find('span.ui-button-text > span.unfollow-button-text').hide();$(this).find('span.ui-button-text > span.following-button-text').show();}}$(this).removeClass('just-clicked');});obj.mouseenter(function(){if($(this).hasClass('just-clicked')){}else{$(this).find('span.ui-button-text > span.unfollow-button-text').show();$(this).find('span.ui-button-text > span.follow-button-text').hide();$(this).find('span.ui-button-text > span.following-button-text').hide();}});}},updateUnfollowButton:function(obj){if(!obj.hasClass('just-clicked')){obj.addClass('just-clicked');obj.removeClass('ui-button-positive');obj.attr('name','follow');obj.find('span.ui-button-text > span.unfollow-button-text').addClass('disabled').hide();obj.find('span.ui-button-text > span.follow-button-text').show();obj.find('span.ui-button-text > span.following-button-text').hide();obj.mouseleave(function(){if(!$(this).hasClass('just-clicked')){}$(this).removeClass('just-clicked');});obj.unbind('mouseenter');}},updateProfileFollowButton:function(obj){if(!obj.hasClass('just-clicked')){obj.addClass('just-clicked');obj.removeClass('ui-button-blue');obj.addClass('ui-button-positive');obj.attr('name','unfollow');obj.find('span.ui-button-text > span.unfollow-button-text').removeClass('disabled').hide();obj.find('span.ui-button-text > span.follow-button-text').hide();obj.find('span.ui-button-text > span.following-button-text').show();obj.mouseleave(function(){if(!$(this).hasClass('just-clicked')){if($(this).find('span.ui-button-text > span.follow-button-text').is(":visible")){}else{$(this).find('span.ui-button-text > span.follow-button-text').hide();$(this).find('span.ui-button-text > span.unfollow-button-text').hide();$(this).find('span.ui-button-text > span.following-button-text').show();}}$(this).removeClass('just-clicked');});obj.mouseenter(function(){if($(this).hasClass('just-clicked')){}else{$(this).find('span.ui-button-text > span.unfollow-button-text').show();$(this).find('span.ui-button-text > span.follow-button-text').hide();$(this).find('span.ui-button-text > span.following-button-text').hide();}});}},updateProfileUnfollowButton:function(obj){if(!obj.hasClass('just-clicked')){obj.addClass('just-clicked');obj.removeClass('ui-button-positive');obj.addClass('ui-button-blue');obj.attr('name','follow');obj.find('span.ui-button-text > span.unfollow-button-text').addClass('disabled').hide();obj.find('span.ui-button-text > span.follow-button-text').show();obj.find('span.ui-button-text > span.following-button-text').hide();obj.mouseleave(function(){if(!$(this).hasClass('just-clicked')){}$(this).removeClass('just-clicked');});obj.unbind('mouseenter');}},userInnewprofileContext:function(obj,r,onlyProcessResponse){if(onlyProcessResponse!==undefined&&onlyProcessResponse){var action=obj.attr('name');if(action=='unfollow'){var followersProfileBox=$('#followers-profile-box ul.avatar-list');followersProfileBox.append(tmpl("follower_tmpl",r.data));}else{$('#followers-profile-box ul.avatar-list > li[data-uid='+r.data.id+']').fadeOut('slow').remove();}}else{var followersCounter=$('.followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateProfileFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateProfileUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();}},userInprofileContext:function(obj,r,onlyProcessResponse){if(onlyProcessResponse!==undefined&&onlyProcessResponse){var action=obj.attr('name');if(action=='unfollow'){var followersProfileBox=$('#followers-profile-box ul.avatar-list');followersProfileBox.append(tmpl("follower_tmpl",r.data));}else{$('#followers-profile-box ul.avatar-list > li[data-uid='+r.data.id+']').fadeOut('slow').remove();}}else{var followersCounter=$('.followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();}},userIntopContext:function(obj,r){var action=obj.attr('name');if(action=='follow'){notifica.updateFollowButton(obj);}else{notifica.updateUnfollowButton(obj);}},userInsugtopContext:function(obj,r){var action=obj.attr('name');if(action=='follow'){notifica.updateFollowButton(obj);notifica.removeSuggestedUser(obj);}else{notifica.updateUnfollowButton(obj);}},removeSuggestedUser:function(obj){obj.fadeOut();},userInMonitorContext:function(obj,r){var followersCounter=$('monitor-data-stats .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},postInpostContext:function(obj,r){var followersCounter=$('#post-data-stats .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},shoutInshoutContext:function(obj,r){var action=obj.attr('name');if(action=='follow'){notifica.updateFollowButton(obj);}else{notifica.updateUnfollowButton(obj);}},temaIntemaContext:function(obj,r){var followersCounter=$('#post-data-stats .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},comunidadIncomunityContext:function(obj,r){var followersCounter=$('#comunity-data-stats .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},albumInalbumContext:function(obj,r){var followersCounter=$('#post-data-stats .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},trackIntrackContext:function(obj,r){var followersCounter=$('#post-data-stats .followers-count .data-followers-count');var actualFollowers=parseInt(followersCounter.data('val'));var action=obj.attr('name');var updatedFollowers=actualFollowers;if(action=='follow'){updatedFollowers=parseInt(actualFollowers)+1;notifica.updateFollowButton(obj);}else{updatedFollowers=parseInt(actualFollowers)-1;notifica.updateUnfollowButton(obj);}followersCounter.data('val',updatedFollowers);followersCounter.hide().html(my_number_format(updatedFollowers)).show();},icomunidadHandle:function(r){var x=r.split('-');if(x.length==3&&x[0]==0){$('a.follow_comunidad, a.unfollow_comunidad').toggle();$('li.comunidad_seguidores').html(number_format(parseInt(x[2]))+' '+lang['Seguidores']);}else if(x.length==4){mydialog.alert(lang['Notificaciones'],x[3]);}},temaIcomunidadHandle:function(r){var x=r.split('-');if(x.length==3&&x[0]==0){$('div.followBox > a.follow_tema, a.unfollow_tema').toggle();$('span.tema_notifica_count').html(number_format(parseInt(x[2]))+' '+lang['Seguidores']);}else if(x.length==4)mydialog.alert(lang['Notificaciones'],x[3]);},ruserInAdminHandle:function(r){var x=r.split('-');if(x.length==3&&x[0]==0)$('.ruser'+x[1]).toggle();else if(x.length==4)mydialog.alert(lang['Notificaciones'],x[3]);},listInAdminHandle:function(r){var x=r.split('-');if(x.length==3&&x[0]==0){$('.list'+x[1]).toggle();$('.list'+x[1]+':first').parent('div').parent('li').children('div:first').fadeTo(0,$('.list'+x[1]+':first').css('display')=='none'?0.5:1);}else if(x.length==4)mydialog.alert(lang['Notificaciones'],x[3]);},spamPostHandle:function(r){var x=r.split('-');if(x.length==2){$('#action-dialogs .sharePost-dialog-error > p').html(x[1]);$('.sharePost-dialog-error').dialog(nDialog_cfg);$('.sharePost-dialog-error').dialog('open');$('.post-share-list .number-share-t').html(number_format(parseInt($('.post-share-list .number-share-t').html().replace(".",""))-1,0,',','.'));}},spamTemaHandle:function(r){var x=r.split('-');if(x.length==2){$('#action-dialogs .shareTema-dialog-error > p').html(x[1]);$('.shareTema-dialog-error').dialog(nDialog_cfg);$('.shareTema-dialog-error').dialog('open');$('.post-share-list .number-share-t').html(number_format(parseInt($('.post-share-list .number-share-t').html().replace(".",""))-1,0,',','.'));}},spamAlbumHandle:function(r){var x=r.split('-');if(x.length==2){$('#action-dialogs .shareAlbum-dialog-error > p').html(x[1]);$('.shareAlbum-dialog-error').dialog(nDialog_cfg);$('.shareAlbum-dialog-error').dialog('open');$('.post-share-list .number-share-t').html(number_format(parseInt($('.post-share-list .number-share-t').html().replace(".",""))-1,0,',','.'));}},spamTrackHandle:function(r){var x=r.split('-');if(x.length==2){$('#action-dialogs .shareTrack-dialog-error > p').html(x[1]);$('.shareTrack-dialog-error').dialog(nDialog_cfg);$('.shareTrack-dialog-error').dialog('open');$('.post-share-list .number-share-t').html(number_format(parseInt($('.post-share-list .number-share-t').html().replace(".",""))-1,0,',','.'));}},follow:function(type,id,cb,obj,process_response){var action=obj.attr('name');var nowait=true;if(process_response==undefined){process_response=false;}if(false&&lS.isSupported&&localStorage.following!==null){localStorage.removeItem('following');}this.ajax(Array('action='+action,'type='+type,'obj='+id),cb,obj,nowait,process_response);},unfollow:function(type,id,cb,obj){if(false&&lS.isSupported&&localStorage.following!==null){localStorage.removeItem('following');}this.ajax(Array('action=unfollow','type='+type,'obj='+id),cb,obj);},spam:function(id,cb){this.ajax(Array('action=spam','postid='+id),cb);},c_spam:function(id,cb){this.ajax(Array('action=c_spam','temaid='+id),cb);},album_spam:function(id,cb){this.ajax(Array('action=album_spam','albumid='+id),cb);},track_spam:function(id,cb){this.ajax(Array('action=track_spam','trackid='+id),cb);},share:function(elem,object){var button=$(elem),dialogWindow=$('#shareContainer').empty().append($('.share-dialog').clone(true));dialogWindow.dialog({autoOpen:false,width:480,title:lang['Recomendar '+object],modal:true,resizable:false,draggable:false,dialogClass:'recomendar-post',buttons:[{text:lang['Recomendar'],'class':'floatL btn ui-button-positive',click:function(){$.ajax({url:'/notificaciones-ajax.php',cache:false,type:'post',data:{action:'spam',key:global_data.user_key,url:window.location.href,body:$('.shareMessage:visible').val(),privacy:$(this).find('.select-list .selected a').attr('data-value')}});$(this).dialog('close');$('.number-share-t.unrated').removeClass('unrated').html(number_format(parseInt($('.number-share-t:eq(0)').html().replace(".",""))+1,0,',','.'));}},{text:lang['Cancelar'],'class':'floatR btn g',click:function(){$(this).dialog("destroy");}}]}).dialog('open');},sharePost:function(id){$('#action-dialogs .sharePost-dialog').dialog(nDialog_cfg);$('.sharePost-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-positive box-shadow-soft floatL',click:function(){notifica.spam(id);$(this).dialog("close");$('.post-share-list .number-share-t').html(number_format(parseInt($('.post-share-list .number-share-t').html().replace(".",""))+1,0,',','.'));}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.sharePost-dialog').dialog('open');},shareTema:function(id){$('#action-dialogs .shareTema-dialog').dialog(nDialog_cfg);$('.shareTema-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-positive box-shadow-soft floatL',click:function(){notifica.c_spam(id,notifica.spamTemaHandle);$(this).dialog("close");$('.post-share-list .number-share-t').html(number_format(parseInt($('.post-share-list .number-share-t').html().replace(".",""))+1,0,',','.'));}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.shareTema-dialog').dialog('open');},shareAlbum:function(id){$('#action-dialogs .shareAlbum-dialog').dialog(nDialog_cfg);$('.shareAlbum-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-positive box-shadow-soft floatL',click:function(){notifica.album_spam(id,notifica.spamAlbumHandle);$(this).dialog("close");$('.post-share-list .number-share-t').html(number_format(parseInt($('.post-share-list .number-share-t').html().replace(".",""))+1,0,',','.'));}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.shareAlbum-dialog').dialog('open');},shareTrack:function(id){$('#action-dialogs .shareTrack-dialog').dialog(nDialog_cfg);$('.shareTrack-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-positive box-shadow-soft floatL',click:function(){notifica.track_spam(id,notifica.spamTrackHandle);$(this).dialog("close");$('.post-share-list .number-share-t').html(number_format(parseInt($('.post-share-list .number-share-t').html().replace(".",""))+1,0,',','.'));}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.shareTrack-dialog').dialog('open');},check:function(){notifica.ajax(Array('action=count'),notifica.popup);},popup:function(r){var c=parseInt($('div.alertas > a > span').html());if(r!=c&&r>0){if(!$('div.alertas').length)$('div.userInfoLogin > ul > li.monitor').append('<div class="alertas"><a><span></span></a></div>');$('div.alertas > a > span').html(r);$('div.alertas').animate({top:'-=5px'},100,null,function(){$('div.alertas').animate({top:'+=5px'},100)});}else if(r==0)$('div.alertas').remove();},filter:function(x,obj){var cls;switch(x){case'fav':cls='.post-favorite';break;case'comment-own':cls='.post-comment-own';break;case'points':cls='.post-points';break;case'newfriend':cls='.friend-new';break;case'post':cls='.friend-post';break;case'thread':cls='.friend-thread';break;case'comment':cls='.post-comment';break;case'threadc':cls='.com-thread';break;case'reply':cls='.com-reply';break;case'shoutr':cls='.shoutr';break;case'spam':cls='.post-spam';break;case'shoutr':cls='.shoutr';break;case'medal':cls='.medal';break;case'comment-album':cls='.album-comment-own';break;case'comment-track':cls='.track-comment-own';break;case'comment-wallpost':cls='.wallpost-comment-own';break;case'new-wallpost':cls='.wallpost-new-own';break;}if(cls){$(cls).toggle();var v=$(obj).attr('checked')?1:0;document.cookie='monitor['+x+']='+v+';expires=Thu, 26 Jul 2012 16:12:48 GMT;path=/;';}}}
var Favorite={done:false,add:function(objType,objId,obj){if(obj.attr('name')==='unfavorite'){return;}obj.attr('name','unfavorite');obj.button('disable');obj.find('span.ui-button-text span').text("Agregado a Favoritos");obj.css({"opacity":0.55});var favsCount=$('#fav_counter');favsCount=favsCount.html(number_format(parseInt(favsCount.html().replace('.',''))+1,0,',','.'));$.ajax({type:'POST',url:'/ajax/favorite/add',data:'objId='+objId+'&objType='+objType,success:function(h){switch(h.status){case 0:break;case 1:break;}}});},del:function(){},show:function(){if($('#favorites-box:visible').length){$('#favorites-box').hide();}else{$('.navitem').removeClass('active');$('.navpanel').hide();$('#favorites-navitem').addClass('active');$('#favorites-box').show();}},open:function(){if($('#compose-box').hasClass('noHideForce')){return false;}$('.navitem').removeClass('active');if(this.done){Favorite.show();}else{$('#favorites-navitem').children('i').addClass('loading-icon');var self=this;ajax('favorites','last',{},{success:function(r){$('#favorites-navitem').children('i').removeClass('loading-icon');$('#favorites-list').html(tmpl("lastfavorites_tmpl",{data:r.data}));self.done=true;self.show();}});}},last:function(){if($('#compose-box').hasClass('noHideForce')){return false;}$('.navitem').removeClass('active');if(this.done){Favorite.show();}else{$('#favorites-navitem').children('i').addClass('loading-icon');var self=this;$.ajax({type:'POST',url:'/ajax/favorite/lasts',data:gget('postid',true)+gget('key'),success:function(r){$('#favorites-navitem').children('i').removeClass('loading-icon');$('#favorites-list').html(r);self.done=true;self.show();}});}}}
function borrar_post(aceptar){if(!aceptar){$('#action-dialogs .delPost-dialog').dialog(nDialog_cfg);$('.delPost-dialog .respuesta-borrar').html(lang['borrar-post']);$('.delPost-dialog').dialog({title:lang['borrar-post-title']});$('.delPost-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-negative box-shadow-soft floatL',click:function(){borrar_post(2);}},{text:lang["Cancelar"],"class":'ui-button-cancel box-shadow-soft floatR',click:function(){$(this).dialog('close');}}]);$('.delPost-dialog').dialog('open');}else if(aceptar==2){$('#action-dialogs .delPost-dialog').dialog(nDialog_cfg);$('.delPost-dialog .respuesta-borrar').html(lang['borrar-post-sure']);$('.delPost-dialog').dialog({title:lang['borrar-post-title']});$('.delPost-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-negative box-shadow-soft floatL',click:function(){borrar_post(3);}},{text:lang["Cancelar"],"class":'ui-button-cancel box-shadow-soft floatR',click:function(){$(this).dialog('close');}}]);$('.delPost-dialog').dialog('open');}else{$.ajax({type:'POST',url:'/post.borrar.php',data:gget('postid',true)+gget('key'),success:function(h){switch(h.charAt(0)){case'0':$('.delPost-dialog .respuesta-borrar').html(h.substring(3));$('.delPost-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-cancel box-shadow-soft floatL',click:function(){$(this).dialog('close');}}]);break;case'1':$('.delPost-dialog .respuesta-borrar').html(h.substring(3));$('.delPost-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-positive box-shadow-soft floatL',click:function(){$(this).dialog('close');window.location.reload();}},{text:lang['Ir a la home'],"class":'ui-button-cancel box-shadow-soft floatR',click:function(){$(this).dialog('close');location.href="/";}}]);break;}},error:function(){$('.delPost-dialog .respuesta-borrar').html(lang['try-again']);$('.delPost-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-cancel box-shadow-soft floatL',click:function(){$(this).dialog('close');}}]);},complete:function(){}});}}var votar_post_votado=false;function nshow_votar_post(force_hide){if(votar_post_votado)return;if(!force_hide&&$('#point-bar > ul').css('display')=='none')$('#point-bar > ul, .give-points .masdiez').show();else
$('#point-bar > ul, .give-points .masdiez').hide();}function nvotar_post(puntos,x){if(votar_post_votado)return;votar_post_votado=true;$('.post-points').addClass('ui-state-disabled');$.ajax({type:'POST',url:'/ajax/post/vote',data:'puntos='+puntos+'&x='+x+gget('postid'),success:function(h){var pointbar_actual_width=$('#point-bar').width();$('#point-bar').width(pointbar_actual_width);$('#point-bar > ul, .give-points .masdiez').hide();switch(h.charAt(0)){case'0':$('.post-points').removeClass('ui-state-disabled');$('#points-text').addClass('error').html(h.substring(3)).show();break;case'1':$('.post-points').removeClass('ui-state-disabled');$('#points-text').addClass('success').html(h.substring(3)).show();$("#postTotalScore strong").html(number_format(parseInt($("#postTotalScore strong").html().replace(".",""))+puntos,0,',','.'));break;}},error:function(){votar_post_votado=false;}});}function nviewmore_authorprofile(showmore){if(showmore){$('#post-author-box > .author > .view-more-content').show();$('#post-author-box > .read-more > .show-more').hide();$('#post-author-box > .read-more > .show-less').show();}else{$('#post-author-box > .author > .view-more-content').hide();$('#post-author-box > .read-more > .show-more').show();$('#post-author-box > .read-more > .show-less').hide();}}function flagPost(authorid,postid){if(postid!=global_data.postid){return false;}var posttitle=$('.post-title').html();var authornick=$('#post-author-box a[rel="author"]').html();posttitle=encodeURIComponent(posttitle);$.ajax({type:'POST',url:'/denuncia-form-modal.php',data:'anick='+authornick+'&aid='+authorid+'&id='+postid+'&t='+posttitle,success:function(h){$('#action-dialogs .flagPost-dialog').html(h);nDialog_cfg.width=450;$('#action-dialogs .flagPost-dialog').dialog(nDialog_cfg);$('.flagPost-dialog').dialog("option","buttons",[{text:'Denunciar',"class":'ui-button-positive box-shadow-soft floatL',click:function(){$('#flag-post-form').submit();$(this).dialog("close");}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.flagPost-dialog').dialog('open');},error:function(){}});}function nTopsTabs(parent,tab,callerid){if($('#'+tab).css('display')=='block')return;$('#'+parent+' > div > div.time-tops-filter > span').html($('#'+callerid).html());$('#'+parent+'-filter > li > a.active').removeClass('active');$('#'+parent+'-filter > li > a.'+tab).addClass('active');$('#'+parent+'-filter').hide();$('#'+parent+' > div.list:visible').hide();$('#'+tab).show();}function follow(state,data,callback){var errorContainer=data.errorContainer;delete(data.errorContainer);data.action=state?'follow':'unfollow';data.key=global_data.user_key;$.ajax({url:'/notificaciones-ajax.php',type:'POST',dataType:'json',data:data,cache:false,success:function(response){if(response&&response.status===0&&errorContainer){$(errorContainer).html(response.data);}if(typeof callback=='function'){callback(response);}}})};var comm={joinCommunity:function(comid){$.ajax({type:'POST',url:'/comunidades/miembro-add.php',cache:false,data:{comid:comid,key:global_data.user_key,aceptar:1},success:function(response){if(response.charAt(0)==0){mydialog.alert(response.substring(3),'Oops!');}else{window.location.reload();}}});},leaveCommunity:function(comid){mydialog.confirm('¿Realmente deseas abandonar la comunidad?','Abandonar comunidad',function(){$.ajax({type:'POST',url:'/comunidades/miembro-del.php',cache:false,data:{comid:comid,key:global_data.user_key},success:function(response){if(response.charAt(0)==0){mydialog.alert(response.substring(3),'Oops!');}else{window.location.reload();}}});});}};var com={joinCommunity:function(comid){$.ajax({type:'POST',url:'/comunidades/miembro-add.php',cache:false,data:{comid:comid,key:global_data.user_key,aceptar:1},success:function(h){switch(h.charAt(0)){case'0':mydialog.alert(h.substr(3),'Ops!');break;default:window.location.reload();break;}}});},leaveCommunity:function(comid){$('#joinComunity-dialogs .abandonar').dialog({modal:true,resizable:false,draggable:false,buttons:[{tabindex:1,text:lang['Aceptar'],'class':'ui-button-positive box-shadow-soft floatL',click:function(){$.ajax({type:'POST',url:'/comunidades/miembro-del.php',cache:false,data:{comid:comid,key:global_data.user_key},success:function(h){window.location.reload();}});}},{tabindex:2,text:lang['Cancelar'],'class':'ui-button-neutral floatR',click:function(){$(this).dialog("close");}}]});$('#joinComunity-dialogs .abandonar').dialog('open');},tema_votar:function(voto,obj){var noajax=false;if(obj){if($(obj).hasClass('ui-state-disabled')){return false;};var rel;if(voto==-1){rel=$(obj).prev();}else{rel=$(obj).next();}$(obj).addClass('ui-button-positive');$(obj).button('option','disabled',true);rel.button('option','disabled',true);}var votesCount=$('#post-data-stats .votes-count > span');var actualVotes=$('#post-data-stats .votes-count > span').data('val');if(!gget('key')){noajax=true;}var updatedVotes=parseInt(actualVotes)+voto;votesCount.hide().html(number_format(updatedVotes)).attr('data-val',updatedVotes).show();if(!noajax){$.ajax({type:'POST',url:'/ajax/community/thread-vote',data:'voto='+voto+gget('temaid')+gget('key'),success:function(h){},error:function(){}});}},comunidad_editar:function(submit){var form=$('#add_comunidad');if(submit===true){form.submit();return true;}form.find('input[name=background-url]').val($('#background-preview').attr('src'));form.find('input[name=background-repeat]').val($('#background-repeat').is(':checked'));form.find('input[name=background-color]').val($('#colorSelector').find('div').css('background-color'));this.comunidad_editar(true);},comunidad_eliminar:function(acepto){$('#action-dialogs .comunidad-dialog').dialog(nDialog_cfg);switch(acepto){case 0:$('.comunidad-dialog').html(lang['borrar-comunidad']);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button-negative box-shadow-soft floatL',click:function(){com.comunidad_eliminar(1);}},{text:lang['Cancelar'],"class":'ui-button-cancel box-shadow-soft floatR',click:function(){$(this).dialog("close");}}]);break;case 1:$('.comunidad-dialog').html();$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button-negative box-shadow-soft floatL',click:function(){com.comunidad_eliminar(2);}},{text:lang['Cancelar'],"class":'ui-button box-shadow-soft floatR',click:function(){$(this).dialog("close");}}]);break;case 2:$('.comunidad-dialog').html(lang['borrar-comunidad-sure-youre-sure']);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button-negative box-shadow-soft floatL',click:function(){com.comunidad_eliminar(3);}},{text:lang['Cancelar'],"class":'ui-button box-shadow-soft floatR',click:function(){$(this).dialog("close");}}]);break;case 3:$('.comunidad-dialog').html(lang['Eliminando']+'...');$.ajax({type:'POST',url:'/comunidades/comunidad-eliminar.php',data:gget('comid',true)+gget('key'),success:function(h){$('.comunidad-dialog').html(lang['comunidad-eliminada-title'],lang['comunidad-eliminada']);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Ir a la home'],"class":'ui-button box-shadow-soft floatL',click:function(){document.location.href=lang['comu_url'];}}]);},error:function(){mydialog.error_500("com.comunidad_eliminar(3)");},complete:function(){}});break;}$('.comunidad-dialog').dialog('open');},comunidad_reactivar:function(acepto){$('#action-dialogs .comunidad-dialog').dialog(nDialog_cfg);$('.comunidad-dialog').dialog({title:'Reactivar Comunidad'});switch(acepto){case 0:$('.comunidad-dialog').html('&iquest;Realmente deseas reactivar la comunidad?');$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button-negative box-shadow-soft floatL',click:function(){com.comunidad_reactivar(1);}},{text:lang['Cancelar'],"class":'ui-button box-shadow-soft floatR',click:function(){$(this).dialog("close");}}]);break;case 1:$('.comunidad-dialog').html('Reactivando...');$.ajax({type:'POST',url:'/comunidades/comunidad-reactivar.php',data:gget('comid',true)+gget('key'),success:function(h){$('.comunidad-dialog').html('La comunidad ha sido reactivada');$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button-negative box-shadow-soft floatL',click:function(){$(this).dialog('close');}}]);},error:function(){mydialog.error_500("com.comunidad_reactivar(1)");},complete:function(){}});break;}$('.comunidad-dialog').dialog('open');},del_tema:function(confirm){var causa="";if(!confirm){$('#action-dialogs .comunidad-dialog').dialog(nDialog_cfg);$('.comunidad-dialog').html(lang['Borrar tema']);$.ajax({type:'GET',url:'/comunidades/denuncia-publica-form.php',data:'',success:function(h){$('.comunidad-dialog').dialog({title:lang['Borrar tema']});$('.comunidad-dialog').html(lang['html tema confirma borrar']+'<br /><br />'+lang['Causa']+': <input type="text" id="icausa_status" value="Causa del borrado" title="Causa del borrado" onfocus="onfocus_input(this)" onblur="onblur_input(this)" onkeypress="if(keypress_intro(event)) com.del_tema(true)" />');$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button box-shadow-soft floatL',click:function(){com.del_tema(true);}},{text:lang['Cancelar'],"class":'ui-state-default floatR',click:function(){$(this).dialog('close');}}]);$('#icausa_status').focus();$('.comunidad-dialog').dialog('open');}});}else{if($('#icausa_status').val()==''||$('#icausa_status').val()==$('#icausa_status').attr('title')){$('#icausa_status').focus();return;}causa=encodeURIComponent($('#icausa_status').val());$('.comunidad-dialog').html(lang['Borrando...']);$.ajax({type:'POST',url:'/comunidades/tema-borrar.php',data:'causa='+causa+gget('temaid')+gget('key'),success:function(h){if(h.charAt(0)==0){$('.comunidad-dialog').html('Error',h.substring(2));$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button floatL',click:function(){$(this).dialog('close');}}]);}else if(h.charAt(0)==1){$('.comunidad-dialog').html(lang['Tema borrado'],lang['El tema fue eliminado satisfactoriamente'],true);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button floatL',click:function(){window.location.reload();}}]);}},error:function(){$('.comunidad-dialog').html("Error en la solicitud");$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button floatL',click:function(){$(this).dialog('close');}}]);},complete:function(){}});}},react_tema:function(confirm){if(!confirm){$('#action-dialogs .comunidad-dialog').dialog(nDialog_cfg);$('.comunidad-dialog').dialog({title:lang['Reactivar tema']});$('.comunidad-dialog').html(lang['Realmente deseas reactivar este tema']);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button box-shadow-soft floatL',click:function(){com.react_tema(true);}},{text:lang['Cancelar'],"class":'ui-state-default floatR',click:function(){$(this).dialog('close');}}]);$('.comunidad-dialog').dialog('open');}else{$('.comunidad-dialog').html(lang['reactivating']);$.ajax({type:"POST",url:'/comunidades/tema-reactivar.php',data:'causa='+encodeURIComponent($('#icausa_status').val())+gget('temaid')+gget('key'),success:function(h){if(h.charAt(0)==0){$('.comunidad-dialog').html('Error'+h.substring(2));$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button floatL',click:function(){$(this).dialog('close');}}]);}else if(h.charAt(0)==1){$('.comunidad-dialog').html(lang['Tema reactivado'],lang['El tema fue reactivado satisfactoriamente'],true);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button floatL',click:function(){window.location.reload();}}]);}},error:function(){mydialog.error_500("com.react_tema('"+confirm+"')");},complete:function(){}});}},error_logo:function(o){o.src=global_data.img+'images/avatar.gif';},ir_a_categoria:function(cat){if(cat!='root'&&cat!='linea')if(cat==-1)document.location.href='/'+lang['comunidades url']+'/';else
document.location.href='/'+lang['comunidades url']+'/home/'+cat+'/';},updateMemberCounter:function(numberUpdate,obj){var membersCounter=$('#comunity-data-stats .members-count > span');var actualMembers=parseInt(membersCounter.data('val'));var updatedMembers=actualMembers+numberUpdate;membersCounter.data('val',updatedMembers);membersCounter.hide().html(number_format(updatedMembers)).show();var action=obj.attr('name');if(action=='join'){obj.attr('name','leave');obj.removeClass('join-comunidad-comunity');obj.addClass('leave-comunidad-comunity');}else{obj.attr('name','join');obj.removeClass('leave-comunidad-comunity');obj.addClass('join-comunidad-comunity');}obj.find('span.ui-button-text > span.default-button-text').toggle();obj.find('span.ui-button-text > span.success-button-text').toggle();},join_comunity:function(obj){var action=obj.attr('name');if(action=='join'){$.ajax({type:'POST',url:'/comunidades/miembro-add.php',cache:false,data:gget('comid',true)+gget('key')+'&aceptar=1',success:function(h){switch(h.charAt(0)){case'0':mydialog.alert(h.substr(3),'Ops!');break;default:com.updateMemberCounter(1,obj);window.location.reload();break;}},error:function(){}});}else{$('#joinComunity-dialogs .abandonar').dialog({modal:true,resizable:false,draggable:false,buttons:[{tabindex:1,text:lang['Aceptar'],'class':'ui-button-positive box-shadow-soft floatL',click:function(){com.updateMemberCounter(-1,obj);$.ajax({type:'POST',url:'/comunidades/miembro-del.php',cache:false,data:gget('comid',true)+gget('key'),success:function(h){window.location.reload();},error:function(){}});}},{tabindex:2,text:lang['Cancelar'],'class':'ui-button-neutral floatR',click:function(){$(this).dialog("close");}}]});$('#joinComunity-dialogs .abandonar').dialog('open');}},actualizar_respuestas:function(cat){$('#lastCommentsBox-data').css('opacity',0.4);if(gget('comid'))var params=gget('comid',true);if(cat)var params=cat;$.ajax({type:'POST',url:'/ajax/replies/last',cache:false,data:params,success:function(h){$('#lastCommentsBox-data').html(h.substring(3));$('#lastCommentsBox-data').css('opacity',1);},error:function(){$('#lastCommentsBox-data').css('opacity',1);}});},crear_shortname_key:function(val){$('#preview_shortname').html(val).removeClass('error').removeClass('ok');$('#msg_crear_shortname').html('');},crear_shortname_check_cache:new Array(),crear_shortname_check:function(val){if(val=='')return;for(i=0;i<this.crear_shortname_check_cache.length;i++){if(this.crear_shortname_check_cache[i][0]===val){if(this.crear_shortname_check_cache[i][1]==='1'){$('#preview_shortname').removeClass('error').addClass('ok');$('#msg_crear_shortname').html(this.crear_shortname_check_cache[i][2]).removeClass('error').addClass('ok');}else{$('#preview_shortname').removeClass('ok').addClass('error');$('#msg_crear_shortname').html(this.crear_shortname_check_cache[i][2]).removeClass('ok').addClass('error');}return;}}$('.gif_cargando#shortname').css('display','block');$.ajax({type:'POST',url:'/comunidades/shortname_check.php',data:'shortname='+encodeURIComponent(val),success:function(h){com.crear_shortname_check_cache[com.crear_shortname_check_cache.length]=new Array(val,h.charAt(0),h.substring(3));$('.gif_cargando#shortname').css('display','none');switch(h.charAt(0)){case'0':$('#preview_shortname').removeClass('ok').addClass('error');$('#msg_crear_shortname').html(h.substring(3)).removeClass('ok').addClass('error');break;case'1':$('#preview_shortname').removeClass('error').addClass('ok');$('#msg_crear_shortname').html(h.substring(3)).removeClass('error').addClass('ok');break;}},error:function(){$('.gif_cargando#shortname').css('display','none');$('#msg_crear_shortname').html(lang['error procesar']).removeClass('ok').addClass('error');}});},get_subcategorias_cache:new Array(),get_subcategorias:function(catid){catid=$('.agregar_categoria').val();$('.agregar_subcategoria').html('').append('<option value="-1" selected>'+lang['Elegir una subcategor&iacute;a']+'</option>').attr('disabled','true').val(-1);if(catid==-1)return false;if(this.get_subcategorias_cache[catid]){$.each(this.get_subcategorias_cache[catid],function(i,val){$('.agregar_subcategoria').append('<option value="'+i+'">'+val+'</option>');});$('.agregar_subcategoria').removeAttr('disabled');return true;}$('.gif_cargando#subcategoria').css('display','block');$.ajax({type:'POST',dataType:'json',url:'/comunidades/get-subcategorias.php',data:'catid='+catid,success:function(h){com.get_subcategorias_cache[catid]=h;$.each(h,function(i,val){$('.agregar_subcategoria').append('<option value="'+i+'">'+val+'</option>');});$('.agregar_subcategoria').removeAttr('disabled');},error:function(){$('.agregar_subcategoria').attr('disabled','true').val(-1);mydialog.error_500("com.get_subcategorias('"+catid+"')");},complete:function(){$('.gif_cargando#subcategoria').css('display','none');}});},create_show_rango_def:function(show){if(show)$('#rango_default').slideDown('fast');else
$('#rango_default').slideUp('fast');},miembros_list_section_here:'act',miembros_list_pag_actual:0,miembros_list:function(section){if(!section)section=this.miembros_list_section_here;else if(this.miembros_list_section_here==section)return;if(this.miembros_list_section_here!=section||this.miembros_list_search)this.miembros_list_pag_actual=0;var params=gget('comid',true)+gget('key');var filename='/comunidades/';$('.filterBy #'+this.miembros_list_section_here).removeClass('here');this.miembros_list_section_here=section;$('.filterBy #'+section).addClass('here');switch(section){case'act':case'susp':filename+='miembros.php';params+='&ajax=1&section='+section+'&p='+com.miembros_list_pag_actual;break;case'history':filename+='miembros-history.php';break;}if(this.miembros_list_search)params+='&q='+this.miembros_list_search;$('.gif_cargando').css('display','block');$.ajax({type:'GET',url:filename,data:params,success:function(h){switch(h.charAt(0)){case'0':$('#showResult').html('<div class="warningData">'+h.substring(3)+'</div>');break;case'1':$('#showResult').html(h.substring(3));break;}},error:function(){$('#showResult').html('<div class="emptyData">'+lang['error procesar']+'. <a href="javascript:com.miembros_list()">Reintentar</a></div>');},complete:function(){$('.gif_cargando').css('display','none');}});},miembros_list_search:'',miembros_list_search_set:function(){this.miembros_list_search=$.trim($('#miembros_list_search').val());this.miembros_list();},miembros_list_sig:function(){this.miembros_list_pag_actual++;this.miembros_list();},miembros_list_ant:function(){this.miembros_list_pag_actual--;this.miembros_list();},admin_users:function(userid){$.ajax({type:'POST',url:'/comunidades/miembros-admin.php',cache:false,data:'userid='+userid+gget('comid')+gget('key'),success:function(h){nDialog_cfg.width=450;$('#action-dialogs .adminuser-dialog').dialog(nDialog_cfg);switch(h.charAt(0)){case'0':$('.adminuser-dialog').html(h.substring(3));$('.adminuser-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button box-shadow-soft floatL',click:function(){$(this).dialog("close");}}]);break;case'1':$('.adminuser-dialog').html(h.substring(3));$('.adminuser-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button box-shadow-soft floatL',click:function(){com.admin_users_save(userid);}},{text:lang['Cancelar'],"class":'ui-state-default floatR',click:function(){$(this).dialog('close');}}]);break;}$('.adminuser-dialog').dialog('open');},error:function(){$('.adminuser-dialog').html(h.substring(3));$('.adminuser-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button box-shadow-soft floatL',click:function(){$(this).dialog("close");}}]);},complete:function(){}});},admin_users_vermas:function(){if($('.suspendido_data #ver_mas').css('display')=='none'){$('.suspendido_data #ver_mas').show('slow');$('.suspendido_data #vermas').html('&laquo; Ver menos');}else{$('.suspendido_data #ver_mas').hide('slow');$('.suspendido_data #vermas').html('Ver m&aacute;s &raquo;');}},admin_users_check:function(){if(is_checked('r_suspender')){if($('#t_causa').val()==''||(!is_checked('r_suspender_dias1')&&!is_checked('r_suspender_dias2'))||(is_checked('r_suspender_dias2')&&$('#t_suspender').val()=='')){return false;}else{return true;}}else if(is_checked('r_rehabilitar')){if($('#t_causa').val()==''){return false;}else{return true;}}else if(is_checked('r_rango')){if(rango_actual==$('#s_rango').val()){return false;}else{return true;}}},admin_users_save:function(userid){if(!this.admin_users_check())return false;if(is_checked('r_suspender'))var action='suspender';else if(is_checked('r_rehabilitar'))var action='rehabilitar';else if(is_checked('r_rango'))var action='rango';var params='userid='+userid+gget('comid')+gget('key');params+='&action='+action;switch(action){case'suspender':params+='&causa='+encodeURIComponent($('#t_causa').val())+'&dias='+(is_checked('r_suspender_dias1')?'0':parseInt($('#t_suspender').val()));break;case'rehabilitar':params+='&causa='+encodeURIComponent($('#t_causa').val());break;case'rango':params+='&new_rango='+$('#s_rango').val();break;}$.ajax({type:'POST',url:'/comunidades/miembros-admin-save.php',cache:false,data:params,success:function(h){switch(h.charAt(0)){case'0':$('.adminuser-dialog').html(h.substring(3));$('.adminuser-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button box-shadow-soft floatL',click:function(){com.admin_users_save(userid);}}]);break;case'1':$('.adminuser-dialog').html(h.substring(3));$('.adminuser-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button box-shadow-soft floatL',click:function(){$(this).dialog('close');window.location.reload();}}]);if(action=='suspender')$('#cont_miembros').html(parseInt($('#cont_miembros').html())-parseInt(1));else if(action=='rehabilitar')$('#cont_miembros').html(parseInt($('#cont_miembros').html())+parseInt(1));if(action=='suspender'||action=='rehabilitar')$('#userid_'+userid).remove();break;}},error:function(){$('.adminuser-dialog').html('Error, intentalo de nuevo');$('.adminuser-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button box-shadow-soft floatL',click:function(){$(this).dialog('close');}}]);},complete:function(){}});},denuncia_publica:function(){nDialog_cfg.width='auto';$('#action-dialogs .comunidad-dialog').dialog(nDialog_cfg);$('.comunidad-dialog').html(lang['Cargando Formulario de denuncias']);$.ajax({type:'GET',url:'/comunidades/denuncia-publica-form.php',data:'',success:function(h){$('.comunidad-dialog').dialog({title:lang['Formulario de denuncias']});$('.comunidad-dialog').html(h);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Enviar Denuncia'],"class":'ui-button box-shadow-soft floatL',click:function(){com.denuncia_publica_send();}},{text:lang['Cancelar'],"class":'ui-button-neutral floatR',click:function(){$(this).dialog('close');}}]);$('#denuncia-publica #nombre').focus();$('.comunidad-dialog').dialog('open');},error:function(){$('.comunidad-dialog').html(lang['try-again']);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Enviar Denuncia'],"class":'ui-button box-shadow-soft floatL',click:function(){com.denuncia_publica();}},{text:lang['Cancelar'],"class":'ui-state-default floatR',click:function(){$(this).dialog('close');}}]);},complete:function(){}});},denuncia_publica_send:function(){if($('#denuncia-publica #nombre').val()==''){$('#denuncia-publica #error_data').html('El campo Nombre y Apellido es obligatorio').slideDown('fast');$('#denuncia-publica #nombre').focus();return;}else if($('#denuncia-publica #email').val()==''){$('#denuncia-publica #error_data').html('El campo Email es obligatorio').slideDown('fast');$('#denuncia-publica #email').focus();return;}else if($('#denuncia-publica #url').val()==''){$('#denuncia-publica #error_data').html('El campo URL de la Comunidad o Tema es obligatorio').slideDown('fast');$('#denuncia-publica #url').focus();return;}else if($('#denuncia-publica #email').val()==''){$('#denuncia-publica #error_data').html('El campo Email es obligatorio').slideDown('fast');$('#denuncia-publica #email').focus();return;}else if($('textarea[name="textarea_denuncia_publica"]').val()==''){$('#denuncia-publica #error_data').html('El campo Comentarios es obligatorio').slideDown('fast');$('#denuncia-publica #comentarios').focus();return;}nombre=encodeURIComponent($('#denuncia-publica #nombre').val());email=encodeURIComponent($('#denuncia-publica #email').val());telefono=encodeURIComponent($('#denuncia-publica #telefono').val());horario=encodeURIComponent($('#denuncia-publica #horario').val());empresa=encodeURIComponent($('#denuncia-publica #empresa').val());url=encodeURIComponent($('#denuncia-publica #url').val());comentarios=encodeURIComponent($('textarea[name="textarea_denuncia_publica"]').val());$('.comunidad-dialog').html('Enviando...');$.ajax({type:'POST',url:'/comunidades/denuncia-publica.php',data:'nombre='+nombre+'&email='+email+'&telefono='+telefono+'&horario='+horario+'&empresa='+empresa+'&url='+url+'&comentarios='+comentarios,success:function(h){$('.comunidad-dialog').html(h.substring(3));$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Aceptar'],"class":'ui-button floatL',click:function(){$(this).dialog('close');}}]);},error:function(){$('.comunidad-dialog').html(lang['try-again']);$('.comunidad-dialog').dialog("option","buttons",[{text:lang['Enviar Denuncia'],"class":'ui-button box-shadow-soft floatL',click:function(){com.denuncia_publica_send();}},{text:lang['Cancelar'],"class":'ui-state-default floatR',click:function(){$(this).dialog('close');}}]);},complete:function(){}});}}
function bloquear(user,bloqueado,lugar,aceptar,ObjectId){if(!aceptar&&bloqueado){var cfg=$.extend({},nDialog_cfg);cfg.width=315;cfg.dialogClass='bloquear-usuario';$('#action-dialogs .bloquear-dialog').dialog(cfg);$('.bloquear-dialog').dialog("option","buttons",[{text:'Bloquear',"class":' bt-bloquear ui-button-positive box-shadow-soft floatL',click:function(){$(this).dialog("close");bloquear(user,true,lugar,true);}},{text:lang['Cancelar'],"class":'ui-state-default floatR',click:function(){$(this).dialog('close');}}]);$('.bloquear-dialog').dialog('open');}else{$.ajax({type:'POST',url:'/ajax/user/block',data:'user='+user+(bloqueado?'&bloqueado=1':'')+gget('key'),success:function(h){switch(lugar){case'perfil':if(bloqueado)$('#bloquear_cambiar').html('Desbloquear').removeClass('bloquearU').addClass('desbloquearU').attr('href',"javascript:bloquear('"+user+"', false, '"+lugar+"')");else
$('#bloquear_cambiar').html('Bloquear').removeClass('desbloquearU').addClass('bloquearU').attr('href',"javascript:bloquear('"+user+"', true, '"+lugar+"')");break;case'shout':if(bloqueado){$('li.desbloquear_'+user).show();$('li.bloquear_'+user).hide();if(ObjectId){$('#div_shout_reply_'+ObjectId).fadeOut('normal',function(){$(this).remove();});}}else{mydialog.alert(getlang('Ocurrió un error al bloquear al usuario'));}break;case'respuestas':if(bloqueado){$('li.desbloquear_'+user).show();$('li.bloquear_'+user).hide();if(ObjectId){$('#id_'+ObjectId).fadeOut('normal',function(){$(this).remove();});}}else{mydialog.alert(getlang('Ocurrió un error al bloquear al usuario'));}break;case'comentarios':if(bloqueado){$('li.desbloquear_'+user).show();$('li.bloquear_'+user).hide();}else{$('li.bloquear_'+user).show();$('li.desbloquear_'+user).hide();}break;case'comentarios-suggest':if(bloqueado){$('li.desbloquear_'+user).show();$('li.bloquear_'+user).hide();if(ObjectId){$('.div_cmnt_'+ObjectId).fadeOut('normal',function(){$(this).remove();});}}else{mydialog.alert(getlang('Ocurrió un error al bloquear al usuario'));}break;case'mis_bloqueados':if(bloqueado)$('.bloquear_usuario_'+user).attr('title','Desbloquear Usuario').removeClass('bloqueadosU').addClass('desbloqueadosU').html('Desbloquear').attr('href',"javascript:bloquear('"+user+"', false, '"+lugar+"')");else
$('.bloquear_usuario_'+user).attr('title','Bloquear Usuario').removeClass('desbloqueadosU').addClass('bloqueadosU').html('Bloquear').attr('href',"javascript:bloquear('"+user+"', true, '"+lugar+"')");break;default:if(bloqueado){$('.desbloquear--'+user).show();$('.bloquear--'+user).hide();}else{$('.bloquear--'+user).show();$('.desbloquear--'+user).hide();}break;}},error:function(){$('.bloquear-dialog p').html("Error al procesar lo solicitado, por favor vuelve a intentarlo");},complete:function(){}});}}$.fn.isEmpty=function(){return!$.trim($(this).val())||$.trim($(this).val())==$(this).attr('data-default');}
jQuery.fn.autoGrow=function(){return this.each(function(){var colsDefault=this.cols;var rowsDefault=this.rows;var grow=function(){growByRef(this);}
var growByRef=function(obj){var linesCount=0;var lines=obj.value.split('\n');for(var i=lines.length-1;i>=0;--i){linesCount+=Math.floor((lines[i].length/colsDefault)+1);}if(linesCount>=rowsDefault)obj.rows=linesCount+1;else
obj.rows=rowsDefault;}
var characterWidth=function(obj){var characterWidth=0;var temp1=0;var temp2=0;var tempCols=obj.cols;obj.cols=1;temp1=obj.offsetWidth;obj.cols=2;temp2=obj.offsetWidth;characterWidth=temp2-temp1;obj.cols=tempCols;return characterWidth;}
this.style.width="auto";this.style.height="auto";this.style.overflow="hidden";this.style.width=((characterWidth(this)*this.cols)+6)+"px";this.onkeyup=grow;this.onfocus=grow;this.onblur=grow;growByRef(this);});};(function($){$.fn.tipsy=function(options){options=$.extend({},$.fn.tipsy.defaults,options);return this.each(function(){var opts=$.fn.tipsy.elementOptions(this,options);$(this).hover(function(){$.data(this,'cancel.tipsy',true);var tip=$.data(this,'active.tipsy');if(!tip){tip=$('<div class="tipsy"><div class="tipsy-inner"/></div>');tip.css({position:'absolute',zIndex:100000});$.data(this,'active.tipsy',tip);}if($(this).attr('title')||typeof($(this).attr('original-title'))!='string'){$(this).attr('original-title',$(this).attr('title')||'').removeAttr('title');}var title;if(typeof opts.title=='string'){title=$(this).attr(opts.title=='title'?'original-title':opts.title);}else if(typeof opts.title=='function'){title=opts.title.call(this);}tip.find('.tipsy-inner')[opts.html?'html':'text'](title||opts.fallback);var pos=$.extend({},$(this).offset(),{width:this.offsetWidth,height:this.offsetHeight});tip.get(0).className='tipsy';tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).appendTo(document.body);var actualWidth=tip[0].offsetWidth,actualHeight=tip[0].offsetHeight;var gravity=(typeof opts.gravity=='function')?opts.gravity.call(this):opts.gravity;switch(gravity.charAt(0)){case'n':tip.css({top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}).addClass('tipsy-north');break;case's':tip.css({top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}).addClass('tipsy-south');break;case'e':tip.css({top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}).addClass('tipsy-east');break;case'w':tip.css({top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}).addClass('tipsy-west');break;}if(opts.fade){tip.css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:0.8});}else{tip.css({visibility:'visible'});}},function(){$.data(this,'cancel.tipsy',false);var self=this;if($.data(this,'cancel.tipsy'))return;var tip=$.data(self,'active.tipsy');if(opts.fade){tip.stop().fadeOut(function(){$(this).remove();});}else if(tip){tip.remove();}});});};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.defaults={fade:false,fallback:'',gravity:'n',html:false,title:'title'};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};})(jQuery);function ajax(object,action,data,callback){callback=$.extend({success:function(){},error:function(){},complete:function(){}},callback||{});data.key=global_data.user_key;$.ajax({type:'post',url:'/ajax/'+object+'/'+action,data:data,dataType:'json',success:function(r){r.status=parseInt(r.status);if(r.status==1){callback.success(r);}else{callback.error(r);}},error:callback.error,complete:callback.complete});}var clientPC=navigator.userAgent.toLowerCase(),clientVer=parseInt(navigator.appVersion),is_ie=((clientPC.indexOf("msie")!=-1)&&(clientPC.indexOf("opera")==-1)),is_nav=((clientPC.indexOf('mozilla')!=-1)&&(clientPC.indexOf('spoofer')==-1)&&(clientPC.indexOf('compatible')==-1)&&(clientPC.indexOf('opera')==-1)&&(clientPC.indexOf('webtv')==-1)&&(clientPC.indexOf('hotjava')==-1)),is_win=((clientPC.indexOf("win")!=-1)||(clientPC.indexOf("16bit")!=-1)),is_mac=(clientPC.indexOf("mac")!=-1),is_moz=0;function get_html_translation_table(d,e){var a={},f={},b=0,c="";c={};var h={},g={},i={};c[0]="HTML_SPECIALCHARS";c[1]="HTML_ENTITIES";h[0]="ENT_NOQUOTES";h[2]="ENT_COMPAT";h[3]="ENT_QUOTES";g=!isNaN(d)?c[d]:d?d.toUpperCase():"HTML_SPECIALCHARS";i=!isNaN(e)?h[e]:e?e.toUpperCase():"ENT_COMPAT";if(g!=="HTML_SPECIALCHARS"&&g!=="HTML_ENTITIES")throw new Error("Table: "+g+" not supported");a["38"]="&amp;";if(g==="HTML_ENTITIES"){a["160"]="&nbsp;";a["161"]="&iexcl;";a["162"]="&cent;";a["163"]="&pound;";a["164"]="&curren;";a["165"]="&yen;";a["166"]="&brvbar;";a["167"]="&sect;";a["168"]="&uml;";a["169"]="&copy;";a["170"]="&ordf;";a["171"]="&laquo;";a["172"]="&not;";a["173"]="&shy;";a["174"]="&reg;";a["175"]="&macr;";a["176"]="&deg;";a["177"]="&plusmn;";a["178"]="&sup2;";a["179"]="&sup3;";a["180"]="&acute;";a["181"]="&micro;";a["182"]="&para;";a["183"]="&middot;";a["184"]="&cedil;";a["185"]="&sup1;";a["186"]="&ordm;";a["187"]="&raquo;";a["188"]="&frac14;";a["189"]="&frac12;";a["190"]="&frac34;";a["191"]="&iquest;";a["192"]="&Agrave;";a["193"]="&Aacute;";a["194"]="&Acirc;";a["195"]="&Atilde;";a["196"]="&Auml;";a["197"]="&Aring;";a["198"]="&AElig;";a["199"]="&Ccedil;";a["200"]="&Egrave;";a["201"]="&Eacute;";a["202"]="&Ecirc;";a["203"]="&Euml;";a["204"]="&Igrave;";a["205"]="&Iacute;";a["206"]="&Icirc;";a["207"]="&Iuml;";a["208"]="&ETH;";a["209"]="&Ntilde;";a["210"]="&Ograve;";a["211"]="&Oacute;";a["212"]="&Ocirc;";a["213"]="&Otilde;";a["214"]="&Ouml;";a["215"]="&times;";a["216"]="&Oslash;";a["217"]="&Ugrave;";a["218"]="&Uacute;";a["219"]="&Ucirc;";a["220"]="&Uuml;";a["221"]="&Yacute;";a["222"]="&THORN;";a["223"]="&szlig;";a["224"]="&agrave;";a["225"]="&aacute;";a["226"]="&acirc;";a["227"]="&atilde;";a["228"]="&auml;";a["229"]="&aring;";a["230"]="&aelig;";a["231"]="&ccedil;";a["232"]="&egrave;";a["233"]="&eacute;";a["234"]="&ecirc;";a["235"]="&euml;";a["236"]="&igrave;";a["237"]="&iacute;";a["238"]="&icirc;";a["239"]="&iuml;";a["240"]="&eth;";a["241"]="&ntilde;";a["242"]="&ograve;";a["243"]="&oacute;";a["244"]="&ocirc;";a["245"]="&otilde;";a["246"]="&ouml;";a["247"]="&divide;";a["248"]="&oslash;";a["249"]="&ugrave;";a["250"]="&uacute;";a["251"]="&ucirc;";a["252"]="&uuml;";a["253"]="&yacute;";a["254"]="&thorn;";a["255"]="&yuml;"}if(i!=="ENT_NOQUOTES")a["34"]="&quot;";if(i==="ENT_QUOTES")a["39"]="&#39;";a["60"]="&lt;";a["62"]="&gt;";for(b in a){c=String.fromCharCode(b);f[c]=a[b]}return f}function htmlspecialchars_decode(d,e){var a={},f="",b="",c="";b=d.toString();if(false===(a=this.get_html_translation_table("HTML_SPECIALCHARS",e)))return false;for(f in a){c=a[f];b=b.split(c).join(f)}return b=b.split("&#039;").join("'")};eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('(3($){$.2N.Z=3(X,28){p 6,u,A,I;u=A=I=d;6={D:\'\',1d:\'\',12:\'\',1x:\'\',1Y:l,2L:\'2M\',1r:\'~/3g/1H.27\',1m:\'\',2z:\'K\',1B:l,1G:\'\',1Z:\'\',23:{},26:{},25:{},1J:{},1n:[{}]};$.11(6,X,28);2(!6.12){$(\'3h\').1h(3(a,2l){1X=$(2l).1e(0).3i.1K(/(.*)3j\\.3f(\\.3e)?\\.3a$/);2(1X!==2p){6.12=1X[1]}})}7 L.1h(3(){p $$,c,18,16,o,F,Q,V,1g,1s,v,2B,O,1a;$$=$(L);c=L;18=[];1a=d;16=o=0;F=-1;6.1m=1j(6.1m);6.1r=1j(6.1r);3 1j(K,2i){2(2i){7 K.T(/("|\')~\\//g,"$1"+6.12)}7 K.T(/^~\\//,6.12)}3 2D(){D=\'\';1d=\'\';2(6.D){D=\'D="\'+6.D+\'"\'}f 2($$.1E("D")){D=\'D="Z\'+($$.1E("D").1o(0,1).3d())+($$.1E("D").1o(1))+\'"\'}2(6.1d){1d=\'R="\'+6.1d+\'"\'}$$.1I(\'<w \'+1d+\'></w>\');$$.1I(\'<w \'+D+\' R="Z"></w>\');$$.1I(\'<w R="3k"></w>\');$$.2b("2R");1g=$(\'<w R="3l"></w>\').2K($$);$(1P(6.1n)).24(1g);1s=$(\'<w R="3s"></w>\').1O($$);2(6.1B===l&&$.Y.3t!==l){1B=$(\'<w R="3u"></w>\').1O($$).1c("1R",3(e){p h=$$.2j(),y=e.2k,1C,1q;1C=3(e){$$.2d("2j",3r.3q(20,e.2k+h-y)+"3m");7 d};1q=3(e){$("27").1N("2h",1C).1N("2g",1q);7 d};$("27").1c("2h",1C).1c("2g",1q)});1s.2r(1B)}$$.2H(1V).3v(1V);$$.1c("21",3(e,X){2(X.1y!==d){1e()}2(c===$.Z.2c){14(X)}});$$.15(3(){$.Z.2c=L})}3 1P(1n){p C=$(\'<C></C>\'),i=0;$(\'B:2u > C\',C).2d(\'30\',\'k\');$.1h(1n,3(){p q=L,t=\'\',1D,B,j;1D=(q.17)?(q.1Q||\'\')+\' [32+\'+q.17+\']\':(q.1Q||\'\');17=(q.17)?\'2I="\'+q.17+\'"\':\'\';2(q.2e){B=$(\'<B R="36">\'+(q.2e||\'\')+\'</B>\').24(C)}f{i++;2w(j=18.8-1;j>=0;j--){t+=18[j]+"-"}B=$(\'<B R="2f 2f\'+t+(i)+\' \'+(q.34||\'\')+\'"><a 37="" \'+17+\' 1D="\'+1D+\'">\'+(q.1Q||\'\')+\'</a></B>\').1c("38",3(){7 d}).2v(3(){7 d}).1c("2Z",3(){$$.15()}).1R(3(){2(q.2t){3n(q.2t)()}2J(3(){14(q)},1);7 d}).2u(3(){$(\'> C\',L).3U();$(J).3w(\'2v\',3(){$(\'C C\',1g).2s()})},3(){$(\'> C\',L).2s()}).24(C);2(q.2n){18.3R(i);$(B).2b(\'3O\').2r(1P(q.2n))}}});18.3Q();7 C}3 2q(4){2(4){4=4.3X();4=4.T(/\\(\\!\\(([\\s\\S]*?)\\)\\!\\)/g,3(x,a){p b=a.1M(\'|!|\');2(I===l){7(b[1]!==2o)?b[1]:b[0]}f{7(b[1]===2o)?"":b[0]}});4=4.T(/\\[\\!\\[([\\s\\S]*?)\\]\\!\\]/g,3(x,a){p b=a.1M(\':!:\');2(1a===l){7 d}P=3Y(b[0],(b[1])?b[1]:\'\');2(P===2p){1a=l}7 P});7 4}7""}3 H(1i){2($.3M(1i)){1i=1i(V)}7 2q(1i)}3 1k(4){p E=H(Q.E);p 19=H(Q.19);p U=H(Q.U);p M=H(Q.M);2(U!==""){k=E+U+M}f 2(m===\'\'&&19!==\'\'){k=E+19+M}f{4=4||m;2(4.1K(/ $/)){k=E+4.T(/ $/,\'\')+M+\' \'}f{k=E+4+M}}7{k:k,E:E,U:U,19:19,M:M}}3 14(q){p z,j,n,i;V=Q=q;1e();$.11(V,{1u:"",12:6.12,c:c,m:(m||\'\'),o:o,u:u,A:A,I:I});H(6.1G);H(Q.1G);2(u===l&&A===l){H(Q.3B)}$.11(V,{1u:1});2(u===l&&A===l){W=m.1M(/\\r?\\n/);2w(j=0,n=W.8,i=0;i<n;i++){2($.3K(W[i])!==\'\'){$.11(V,{1u:++j,m:W[i]});W[i]=1k(W[i]).k}f{W[i]=""}}4={k:W.3I(\'\\n\')};G=o;z=4.k.8+(($.Y.1F)?n-1:0)}f 2(u===l){4=1k(m);G=o+4.E.8;z=4.k.8-4.E.8-4.M.8;z=z-(4.k.1K(/ $/)?1:0);z-=1v(4.k)}f 2(A===l){4=1k(m);G=o;z=4.k.8;z-=1v(4.k)}f{4=1k(m);G=o+4.k.8;z=0;G-=1v(4.k)}2((m===\'\'&&4.U===\'\')){F+=1T(4.k);G=o+4.E.8;z=4.k.8-4.E.8-4.M.8;F=$$.1f().1l(o,$$.1f().8).8;F-=1T($$.1f().1l(0,o))}$.11(V,{o:o,16:16});2(4.k!==m&&1a===d){2a(4.k);1L(G,z)}f{F=-1}1e();$.11(V,{1u:\'\',m:m});2(u===l&&A===l){H(Q.3L)}H(Q.1Z);H(6.1Z);2(v&&6.1Y){22()}A=I=u=1a=d}3 1T(4){2($.Y.1F){7 4.8-4.T(/\\n*/g,\'\').8}7 0}3 1v(4){2($.Y.2U){7 4.8-4.T(/\\r/g,\'\').8}7 0}3 2a(k){2(J.m){p 29=J.m.2x();29.1b=k}f{c.P=c.P.1l(0,o)+k+c.P.1l(o+m.8,c.P.8)}}3 1L(G,z){2(c.2m){2($.Y.1F&&$.Y.40>=9.5&&z==0){7 d}N=c.2m();N.3S(l);N.41(\'2Q\',G);N.3Z(\'2Q\',z);N.3V()}f 2(c.2P){c.2P(G,G+z)}c.1w=16;c.15()}3 1e(){c.15();16=c.1w;2(J.m){m=J.m;2($.Y.2U){p N=m.2x();p 1p=N.3y();1p.3z(c);1p.3E(\'3F\',N);p s=1p.1b.8-N.1b.8;o=s-(c.P.1o(0,s).8-c.P.1o(0,s).T(/\\r/g,\'\').8);m=N.1b}f{o=c.2O}}f{o=c.2O;m=c.P.1l(o,c.3H)}7 m}3 1H(){2(!v||v.3G){2(6.1x){v=2y.2W(\'\',\'1H\',6.1x);$(2y).3J(3(){v.1U()})}f{O=$(\'<2G R="3x"></2G>\');2(6.2L==\'2M\'){O.1O(1s)}f{O.2K(1g)}v=O[O.8-1].3D||3C[O.8-1]}}f 2(I===l){2(O){O.3N()}f{v.1U()}v=O=d}2(!6.1Y){22()}2(6.1x){v.15()}}3 22(){2E()}3 2E(){p 42;2(6.1m!==\'\'){$.2C({2F:\'3W\',2X:\'1b\',2V:d,2Y:6.1m,K:6.2z+\'=\'+3P($$.1f()),2T:3(K){1S(1j(K,1))}})}f{2(!2B){$.2C({2Y:6.1r,2X:\'1b\',2V:d,2T:3(K){1S(1j(K,1).T(/<!-- 3T -->/g,$$.1f()))}})}}7 d}3 1S(K){2(v.J){31{1W=v.J.2A.1w}33(e){1W=0}v.J.2W();v.J.35(K);v.J.1U();v.J.2A.1w=1W}}3 1V(e){A=e.A;I=e.I;u=(!(e.I&&e.u))?e.u:d;2(e.2F===\'2H\'){2(u===l){B=$("a[2I="+3p.3o(e.1z)+"]",1g).1A(\'B\');2(B.8!==0){u=d;2J(3(){B.39(\'1R\')},1);7 d}}2(e.1z===13||e.1z===10){2(u===l){u=d;14(6.25);7 6.25.1t}f 2(A===l){A=d;14(6.26);7 6.26.1t}f{14(6.23);7 6.23.1t}}2(e.1z===9){2(A==l||u==l||I==l){7 d}2(F!==-1){1e();F=$$.1f().8-F;1L(F,0);F=-1;7 d}f{14(6.1J);7 6.1J.1t}}}}2D()})};$.2N.3c=3(){7 L.1h(3(){p $$=$(L).1N().3b(\'2R\');$$.1A(\'w\').1A(\'w.Z\').1A(\'w\').U($$)})};$.Z=3(X){p 6={1y:d};$.11(6,X);2(6.1y){7 $(6.1y).1h(3(){$(L).15();$(L).2S(\'21\',[6])})}f{$(\'c\').2S(\'21\',[6])}}})(3A);',62,251,'||if|function|string||options|return|length||||textarea|false||else|||||block|true|selection||caretPosition|var|button||||ctrlKey|previewWindow|div|||len|shiftKey|li|ul|id|openWith|caretOffset|start|prepare|altKey|document|data|this|closeWith|range|iFrame|value|clicked|class||replace|replaceWith|hash|lines|settings|browser|markItUp||extend|root||markup|focus|scrollPosition|key|levels|placeHolder|abort|text|bind|nameSpace|get|val|header|each|action|localize|build|substring|previewParserPath|markupSet|substr|stored_range|mouseUp|previewTemplatePath|footer|keepDefault|line|fixIeBug|scrollTop|previewInWindow|target|keyCode|parent|resizeHandle|mouseMove|title|attr|opera|beforeInsert|preview|wrap|onTab|match|set|split|unbind|insertAfter|dropMenus|name|mousedown|writeInPreview|fixOperaBug|close|keyPressed|sp|miuScript|previewAutoRefresh|afterInsert||insertion|refreshPreview|onEnter|appendTo|onCtrlEnter|onShiftEnter|html|extraSettings|newSelection|insert|addClass|focused|css|separator|markItUpButton|mouseup|mousemove|inText|height|clientY|tag|createTextRange|dropMenu|undefined|null|magicMarkups|append|hide|call|hover|click|for|createRange|window|previewParserVar|documentElement|template|ajax|init|renderPreview|type|iframe|keydown|accesskey|setTimeout|insertBefore|previewPosition|after|fn|selectionStart|setSelectionRange|character|markItUpEditor|trigger|success|msie|global|open|dataType|url|focusin|display|try|Ctrl|catch|className|write|markItUpSeparator|href|contextmenu|triggerHandler|js|removeClass|markItUpRemove|toUpperCase|pack|markitup|templates|script|src|jquery|markItUpContainer|markItUpHeader|px|eval|fromCharCode|String|max|Math|markItUpFooter|safari|markItUpResizeHandle|keyup|one|markItUpPreviewFrame|duplicate|moveToElementText|jQuery|beforeMultiInsert|frame|contentWindow|setEndPoint|EndToEnd|closed|selectionEnd|join|unload|trim|afterMultiInsert|isFunction|remove|markItUpDropMenu|encodeURIComponent|pop|push|collapse|content|show|select|POST|toString|prompt|moveEnd|version|moveStart|phtml'.split('|'),0,{}))
var markButtons={emoji:function(h){$(h.textarea).emoticons('toggle');},youtube:function(h){var msg=prompt(lang['ingrese el id de yt'],'');if(msg!=null){h.replaceWith='[video]'+msg+'[/video]\nlink: [url]'+msg+'[/url]\n';h.openWith='';h.closeWith='';}else{h.replaceWith='';h.openWith='';h.closeWith='';}},flash:function(h){if(h.selection!=''&&h.selection.substring(0,7)=='http://'){h.replaceWith='[swf='+h.selection+']\nlink: [url]'+h.selection+'[/url]\n';h.openWith='';h.closeWith='';}else{var msg=prompt(lang['ingrese la url de swf'],'http://');if(msg!=null){h.replaceWith='[swf='+msg+']\nlink: [url]'+msg+'[/url]\n';h.openWith='';h.closeWith='';}else{h.replaceWith='';h.openWith='';h.closeWith='';}}},image:function(h){if(h.selection!=''&&h.selection.substring(0,7)=='http://'){h.replaceWith='';h.openWith='[img=';h.closeWith=']';}else{var msg=prompt(lang['ingrese la url de img'],'http://');if(msg!=null){h.replaceWith='[img='+msg+']';h.openWith='';h.closeWith='';}else{h.replaceWith='';h.openWith='';h.closeWith='';}}},link:function(h){if(h.selection==''){var msg=prompt(lang['Ingrese la URL que desea postear'],'http://');if(msg!=null){h.replaceWith='[url]'+msg+'[/url]';h.openWith='';h.closeWith='';}else{h.replaceWith='';h.openWith='';h.closeWith='';}}else if(h.selection.substring(0,7)=='http://'||h.selection.substring(0,8)=='https://'||h.selection.substring(0,6)=='ftp://'){h.replaceWith='';h.openWith='[url]';h.closeWith='[/url]';}else{var msg=prompt(lang['Ingrese la URL que desea postear'],'http://');if(msg!=null){h.replaceWith='';h.openWith='[url='+msg+']';h.closeWith='[/url]';}else{h.replaceWith='';h.openWith='';h.closeWith='';}}},quote:function(h){if(h.selection==''){var msg=prompt(lang['Ingrese el texto a citar'],'');if(msg!=null){h.replaceWith='[quote]'+msg+'[/quote]';h.openWith='';h.closeWith='';}else{h.replaceWith='';h.openWith='';h.closeWith='';}}else{h.replaceWith='';h.openWith='[quote]';h.closeWith='[/quote]';}}};var mySettings_comu={markupSet:[{name:lang['Negrita'],key:'B',openWith:'[b]',closeWith:'[/b]'},{name:lang['Cursiva'],key:'I',openWith:'[i]',closeWith:'[/i]'},{name:lang['Subrayado'],key:'U',openWith:'[u]',closeWith:'[/u]'},{separator:'-'},{name:lang['Alinear a la izquierda'],key:'',openWith:'[align=left]',closeWith:'[/align]'},{name:lang['Centrar'],key:'',openWith:'[align=center]',closeWith:'[/align]'},{name:lang['Alinear a la derecha'],key:'',openWith:'[align=right]',closeWith:'[/align]'},{separator:'-'},{name:lang['Color'],dropMenu:[{name:lang['Rojo oscuro'],openWith:'[color=darkred]',closeWith:'[/color]'},{name:lang['Rojo'],openWith:'[color=red]',closeWith:'[/color]'},{name:lang['Naranja'],openWith:'[color=orange]',closeWith:'[/color]'},{name:lang['Marron'],openWith:'[color=brown]',closeWith:'[/color]'},{name:lang['Amarillo'],openWith:'[color=yellow]',closeWith:'[/color]'},{name:lang['Verde'],openWith:'[color=green]',closeWith:'[/color]'},{name:lang['Oliva'],openWith:'[color=olive]',closeWith:'[/color]'},{name:lang['Cyan'],openWith:'[color=cyan]',closeWith:'[/color]'},{name:lang['Azul'],openWith:'[color=blue]',closeWith:'[/color]'},{name:lang['Azul oscuro'],openWith:'[color=darkblue]',closeWith:'[/color]'},{name:lang['Indigo'],openWith:'[color=indigo]',closeWith:'[/color]'},{name:lang['Violeta'],openWith:'[color=violet]',closeWith:'[/color]'},{name:lang['Negro'],openWith:'[color=black]',closeWith:'[/color]'}]},{name:lang['Tamano'],dropMenu:[{name:lang['Pequena'],openWith:'[size=9]',closeWith:'[/size]'},{name:lang['Normal'],openWith:'[size=12]',closeWith:'[/size]'},{name:lang['Grande'],openWith:'[size=18]',closeWith:'[/size]'},{name:lang['Enorme'],openWith:'[size=24]',closeWith:'[/size]'}]},{name:lang['Fuente'],dropMenu:[{name:'Arial',openWith:'[font=Arial]',closeWith:'[/font]'},{name:'Courier New',openWith:'[font="Courier New"]',closeWith:'[/font]'},{name:'Georgia',openWith:'[font=Georgia]',closeWith:'[/font]'},{name:'Times New Roman',openWith:'[font="Times New Roman"]',closeWith:'[/font]'},{name:'Verdana',openWith:'[font=Verdana]',closeWith:'[/font]'},{name:'Trebuchet MS',openWith:'[font="Trebuchet MS"]',closeWith:'[/font]'},{name:'Lucida Sans',openWith:'[font="Lucida Sans"]',closeWith:'[/font]'},{name:'Comic Sans MS',openWith:'[font="Comic Sans MS"]',closeWith:'[/font]'}]},{separator:'-'},{name:lang['Insertar video de YouTube'],beforeInsert:markButtons.youtube},{name:lang['Insertar archivo SWF'],beforeInsert:markButtons.flash},{name:lang['Insertar Imagen'],beforeInsert:markButtons.image},{name:lang['Insertar Link'],beforeInsert:markButtons.link}]};var mySettings_cmt={nameSpace:'markitcomment',resizeHandle:false,markupSet:[{name:lang['Negrita'],key:'B',openWith:'[b]',closeWith:'[/b]'},{name:lang['Cursiva'],key:'I',openWith:'[i]',closeWith:'[/i]'},{name:lang['Subrayado'],key:'U',openWith:'[u]',closeWith:'[/u]'},{name:lang['Insertar video de YouTube'],beforeInsert:markButtons.youtube},{name:lang['Insertar Imagen'],beforeInsert:markButtons.image},{name:lang['Insertar Emoticon'],beforeInsert:markButtons.emoji}]};var bbcodeReplyComment={nameSpace:'markitcomment',resizeHandle:false,markupSet:[{name:lang['Negrita'],key:'B',openWith:'[b]',closeWith:'[/b]'},{name:lang['Cursiva'],key:'I',openWith:'[i]',closeWith:'[/i]'},{name:lang['Subrayado'],key:'U',openWith:'[u]',closeWith:'[/u]'},{name:lang['Insertar video de YouTube'],beforeInsert:markButtons.youtube},{name:lang['Insertar Imagen'],beforeInsert:markButtons.image},{name:lang['Insertar Emoticon'],beforeInsert:markButtons.emoji}]};function print_editor(){if($('#markItUp')&&!$('#markItUpMarkItUp').length){$('#markItUp').richedit({markItUpSettings:mySettings});}if($('#body_comm')&&!$('#markItUpbody_comm').length){$('#body_comm').markItUp(mySettings_cmt);}}(function($){$.fn.emoticons=function(option){if(!this.length){return this;}if(option=='toggle'){$(this).parent().find('.emoji-toggle').toggle();setActive($(this).parent().find('.emoji-categories li:first'));return;}function getHistory(unsorted){var history=jQuery.parseJSON(localStorage['emoticons-history'])||[];if(unsorted){return history;}return history.sort(function(a,b){return b[3]-a[3]});}function setHistory(history){var html='';localStorage['emoticons-history']=JSON.stringify(history)||[];if(!$('#emoticon_item').length){return false;}if(history.length){var limit=history.length<=38?history.length:38;for(var i=0;i<limit;++i){html+=tmpl('emoticon_item',{name:history[i][0],hotkey:history[i][1],category:history[i][2]});}$('.emoticons-cont.latest').html(html);$('.emoji-categories li:first').show();}}function setActive(elem){var list=elem.parent().siblings('.emoji-list'),category=elem.data('category');if(category=='latest'){setHistory(getHistory(false));}list.find('.emoticons-cont:visible').css('marginLeft','0');elem.addClass('active').siblings('.active').removeClass('active');list.find('.emoticons-cont.'+category).show().siblings().hide();if(category=='latest'){list.siblings('.emoji-nav').addClass('disabled');}else{list.siblings('.emoji-nav').removeClass('disabled').filter('.left').addClass('disabled');}}return this.each(function(){var textarea=$(this),header=textarea.siblings('.markItUpHeader'),tmplList=$.trim($('#emoticons_html').html()),tmplItem=$.trim($('#emoticon_item').html()),list=textarea.siblings('.emoji-list'),request=false;if(textarea.hasClass('emoji-loaded')){return;}else{textarea.addClass('emoji-loaded');}if(!list.length){list=$(tmplList).insertAfter(header).filter('.emoji-list');}if(localStorage['emoticons-history']){var history=getHistory(false);setHistory(history);}else{list.siblings('.emoji-categories li:first').hide();}header.parent().on('click','.emoji-categories li',function(event){var elem=$(this),category=elem.data('category'),section=list.find('.emoticons-cont.'+category);if(!elem.hasClass('active')){setActive(elem);}if(!section.length){if(request===false){request=$.ajax({type:'post',url:'/ajax/emoticons/get',data:{category:category,sprite:true},success:function(html){list.append(html);var section=list.find('.emoticons-cont.'+category),length=section.children().length,iconWidth=section.children(':first').outerWidth();if(length%2){++length;}section.width(Math.round(length*iconWidth/2));setActive(elem);},complete:function(){request=false;}})}}}).on('click','.emoji-list .icon.emoji:visible',function(event){var emoticon=$(this),name=emoticon.data('name'),hotkey=emoticon.data('hotkey'),category=emoticon.data('category'),history=getHistory(true),founded=false;$.markItUp({replaceWith:' '+hotkey+' '});for(var i=0,c=history.length;i<c;++i){if(history[i][0]==name){founded=true;++history[i][3];}}if(!founded){history.push([name,hotkey,category,1]);}setHistory(history);}).on('click','.emoji-nav',function(){var arrow=$(this),direction=arrow.data('direction');if(arrow.hasClass('disabled')){return;}var list=arrow.siblings('.emoji-list'),section=list.find('.emoticons-cont:visible'),iconWidth=section.children(':first').outerWidth(),blockWidth=list.outerWidth()-(iconWidth*2),margin=parseInt(section.css('marginLeft'))||0,width=Math.round(section.data('size')/2)*iconWidth;if(section.is(':animated')||direction=='left'&&margin+blockWidth>0||direction=='right'&&margin<=-width+blockWidth){return;}section.animate({marginLeft:(direction=='left'?'+':'-')+'='+blockWidth},400,function(){var section=$('.emoticons-cont:visible'),arrows=section.parent().siblings('.emoji-nav'),iconWidth=section.children(':first').outerWidth(),blockWidth=list.outerWidth(),margin=parseInt(section.css('marginLeft'))||0,width=Math.round(section.data('size')/2)*iconWidth;if(margin>=-width&&margin<=-width+blockWidth){arrows.filter('.right').addClass('disabled');}else{arrows.filter('.right').removeClass('disabled');}if(margin==0){arrows.filter('.left').addClass('disabled');}else{arrows.filter('.left').removeClass('disabled');}});});});};})(jQuery);function px2fontSize(px){var size=7;if(px<11){size=1;}else if(px<14){size=2;}else if(px<17){size=3;}else if(px<21){size=4;}else if(px<28){size=5;}else if(px<40){size=6;}return size;}$.html2bbcode=function(data,callback){var parsedContent;$.ajax({type:'post',url:'/ajax/editor/html2bbcode',data:'cuerpo='+encodeURIComponent(data),async:false,dataType:'json',success:function(r){parsedContent=r.data;if(callback){callback(r.data);}}});return parsedContent;}
$.fn.richedit=function(opts){return this.each(function(){this.tagInsert=function(object,param){if(this.view=='html'){if(!param){param=null;}if(!object.original){object.original=[object.replaceWith,object.openWith,object.closeWith];}object.replaceWith='';object.openWith='';object.closeWith='';this.exec(object.action,param);}else{if(object.original){object.replaceWith=object.original[0];object.openWith=object.original[1];object.closeWith=object.original[2];delete object.original;}}}
this.editor=$('<iframe id="iframe-editor" border="0" style="position:absolute;top:0;left:0;width:100%!important;height:100%!important"></iframe>')[0];this.markItUp=$(this).markItUp(opts.markItUpSettings);this.refreshSwf=function(){function moveCursorToEnd(iframeEl){var win=iframeEl.contentWindow||iframeEl.contentDocument.defaultView;var doc=win.document;var lastEl=$($('#iframe-editor').get(0).contentWindow.document.body).contents().last()[0];var lastChild=lastEl.toString().indexOf('\<')!=-1?$(doc).find('body').children().last()[0]:$(doc).find('body')[0];if(win.getSelection&&doc.createRange){var sel=win.getSelection();var range=doc.createRange();range.selectNodeContents(lastChild);range.collapse(false);sel.removeAllRanges();sel.addRange(range);}else if(doc.selection&&doc.body.createTextRange){var textRange=lastChild.createTextRange();textRange.collapse(false);textRange.select();}}if(this.editor&&this.editor.contentWindow&&this.editor.contentWindow.document.designMode){var doc=this.editor.contentWindow.document,attr;doc.designMode='off';$(this.editor).contents().find('embed').each(function(){attr=$(this).attr('src');$(this).attr('src',attr);});setTimeout(function(){doc.designMode='on';moveCursorToEnd($('#iframe-editor').get(0));},250);}}
this.view=null;this.viewSource=function(init){eraseCookie('wysiwyg');if(!init){var data=$(this.editor.contentWindow.document.body).html();if(data.trim()==''){$(this).val('');}else{$(this).val($.html2bbcode(data)).trigger('input.charCount');}}$('.highlightTextarea').removeClass('hide');$(this.editor).parent().css({'top':'-9999px','visibility':'hidden','position':'absolute'});$('.markItUpButton13').removeClass('selected');$('.markItUpButton12').addClass('selected');this.view='source';}
this.viewHtml=function(init){this.view='html';if($.browser.msie){this.viewSource(true);return;}if(!init){createCookie('wysiwyg',1);}var parsedContent='';if($.trim($(this).val())){$.ajax({type:'post',url:'/ajax/editor/bbcode2html',data:'cuerpo='+encodeURIComponent($(this).val()),async:false,dataType:'json',success:function(r){parsedContent=r.data;}});}this.editor.contentWindow.document.open();var isIE11=!!navigator.userAgent.match(/Trident.*rv\:11\./);if(isIE11){var content=parsedContent.trim()?parsedContent:'<p><br></p>';}else{var content=parsedContent;}this.editor.contentWindow.document.write('\
				<!DOCTYPE html>\
				<html>\
					<head>\
						<link type="text/css" href="'+global_data.img+'/images/css/wysiwyg.css?2" rel="stylesheet" />\
					</head>\
					<body class="post-contenido">'+content+'</body>\
				</html>\
			');this.editor.contentWindow.document.close();if(isIE11){$(this.editor.contentWindow.document.body).html(content);}$('#markItUp').get(0).refreshSwf();if(this.editor.contentWindow.document.designMode){this.editor.contentWindow.document.designMode='on';}if(!$.browser.msie&&!$.browser.opera){this.editor.contentWindow.document.execCommand('enableObjectResizing',false,false);}$('.highlightTextarea').addClass('hide');$(this.editor).parent().css({'top':'0','visibility':'visible','position':'relative'});$('.markItUpButton13').addClass('selected');$('.markItUpButton12').removeClass('selected');function moveCursorToEnd(iframeEl){var win=iframeEl.contentWindow||iframeEl.contentDocument.defaultView;var doc=win.document;var lastChild=$(win.document.body).contents().last()[0].toString().indexOf('\<')!=-1?$(doc).find('body').children().last()[0]:$(doc).find('body')[0];if(win.getSelection&&doc.createRange){var sel=win.getSelection();var range=doc.createRange();range.selectNodeContents(lastChild);range.collapse(false);sel.removeAllRanges();sel.addRange(range);}else if(doc.selection&&doc.body.createTextRange){var textRange=lastChild.createTextRange();textRange.collapse(false);textRange.select();}}function moveCursorToP(iframeEl){var win=iframeEl.contentWindow||iframeEl.contentDocument.defaultView;var doc=win.document;var lastChild=$($('#iframe-editor').get(0).contentWindow.document.body).contents().last()[0].toString().indexOf('\<')!=-1?$(doc).find('body').children().last()[0]:$(doc).find('body')[0];if(win.getSelection&&doc.createRange){var sel=win.getSelection();var range=doc.createRange();range.selectNodeContents($(doc).find('br')[0]);range.collapse(true);sel.removeAllRanges();sel.addRange(range);}else if(doc.selection&&doc.body.createTextRange){var textRange=$(doc).find('br')[0].createTextRange();textRange.collapse(true);textRange.select();}}function moveCursorToBlockquote(iframeEl,quote){var win=iframeEl.contentWindow||iframeEl.contentDocument.defaultView;var doc=win.document;if(win.getSelection&&doc.createRange){var sel=win.getSelection();var range=doc.createRange();range.selectNodeContents($(doc).find('blockquote + div')[quote]);range.collapse(false);sel.removeAllRanges();sel.addRange(range);}else if(doc.selection&&doc.body.createTextRange){var textRange=$(doc).find('blockquote + div')[quote].createTextRange();textRange.collapse(false);textRange.select();}}$("iframe.post").ready(function(){var doc=$("iframe.post")[0].contentWindow.document;if(document.addEventListener){doc.addEventListener('dragenter',function(e){if(DndFileUploadManager.containsFiles(e)){if($('#markItUp').get(0).view=='html'&&$('#resizable_post').find('.file-upload-input-container').length==0){$('#resizable_post').append($('.file-upload-input-container'));}$('.file-upload-input-container').show();}},false);}var body=$(doc).find('body');body.bind("click",function(){_iFocus=true;});body.on('keyup',function(e){$('#markItUp.post').trigger(e);});body.on('keydown',function(e){$('#markItUp.post').trigger(e);});body.on("focus",function(){$('#iframe-editor').closest('.form-item').removeClass('error');$('#iframe-editor').addClass('focus');Form.resetTooltips();if(Tags.initialized){Tags.blur();}});body.on("blur",function(){$('#iframe-editor').removeClass('focus');});$(document).on("focus",function(){$('#iframe-editor').removeClass('focus');$('#iframe-editor').closest('.form-item').removeClass('error');});$(document).on("blur",function(){$('#iframe-editor').closest('.form-item').removeClass('error');$('#iframe-editor').addClass('focus');if(Tags.initialized){Tags.blur();}});body.on('drop',function(e){var file=[{files:e.dataTransfer.files}];if(DndFileUploadManager.containsFiles(e)){if(e.dataTransfer.files[0].name.match(/^.*\.(png|jpe?g|gif)/i)){ModalImage.startLoading();Kn3Client.upload({values:{temp:true},error:function(e){ModalImage.stopLoading();},file:file,success:function(data){ModalImage.stopLoading();ModalImage.confirm(data.url);}});}else{Form.error(this,'El formato de la imagen es incorrecto.');}}e.preventDefault();e.stopPropagation();return false;});body.on("DOMNodeInserted",function(e){var isIE11=!!navigator.userAgent.match(/Trident.*rv\:11\./);var openingTag=isIE11?'P':'BR';var closingTag=isIE11?'DIV':'P';var selector=isIE11?'p:empty':'p br';if(e.target.tagName==openingTag&&e.relatedNode.tagName==closingTag&&$(e.target).closest('.citacuerpo').find(selector).length>1){var blockquote=$(e.target).closest('blockquote');var quoteIndex=0;body.find('blockquote').each(function(index,element){if(element==blockquote[0]){quoteIndex=index;}});blockquote.after($('<div><br></div>'));if(isIE11){$(e.target).closest('.citacuerpo').find(selector).remove();}else{$(e.target).closest('.citacuerpo').find(selector).parent().remove();}$('#iframe-editor').get(0).contentWindow.postMessage('focusquote('+quoteIndex+')','*');}if(e.target.tagName=="IMG"){body.find(".loading img").appendTo(body.find(".loading").parent());body.find(".loading").remove();}if(e.target.tagName=="UL"){var align=$(e.target).find('li').css('text-align');$(e.target).removeAttr('style');$(e.target).find('li').removeAttr('style');if(align){$(e.target).find('li').css('text-align',align);}}});body.on("keydown",function(event){if(event.which==9){if(event.shiftKey){window.top.postMessage("tabback","*");}else{window.top.postMessage("tabforward","*");}event.preventDefault();}});body.focus();var isIE11=!!navigator.userAgent.match(/Trident.*rv\:11\./);if(content=='<p><br></p>'&&isIE11){moveCursorToP($('#iframe-editor').get(0));}else{moveCursorToEnd($('#iframe-editor').get(0));}$('#iframe-editor').get(0).contentWindow.focus();$('#iframe-editor').get(0).contentWindow.onmessage=function(e){if(e.data=="focuseditor"){body.focus();$('#iframe-editor').get(0).contentWindow.focus();}else if(e.data.indexOf("focusquote")!=-1){var quote=e.data.split('(')[1].split(')')[0];moveCursorToBlockquote($("iframe.post")[0],quote);}};});}
this.switchView=function(){if(this.view=='html'){this.viewSource();}else{this.viewHtml();}}
this.setFocus=function(){if(this.view=='html'){this.editor.contentWindow.focus();$('#iframe-editor').get(0).contentWindow.postMessage('focuseditor','*');}else{$(this).focus();}}
this.selected=function(){var r={start:0,end:0,text:''},objDocument,objWindow,object;if($.browser.msie){return r;}if(this.view=='html'){object=this.editor;objWindow=object.contentWindow;objDocument=object.contentWindow.document;}else{object=this;objDocument=document;objWindow=window;}if(this.view=='source'&&object.selectionStart){r.start=object.selectionStart;r.end=object.selectionEnd;r.text=$(object).val().substr(r.start,r.end-r.start);}else{var tmp;if(document.selection){if(objWindow.selection.rangeCount){tmp=objWindow.selection.getRangeAt(0);}else if(objDocument.selection.rangeCount){tmp=objDocument.selection.getRangeAt(0);}else if(objDocument.selection){tmp=objDocument.selection.createRange();}}else{if(objWindow.getSelection().rangeCount){tmp=objWindow.getSelection().getRangeAt(0);}else if(objDocument.getSelection().rangeCount){tmp=objDocument.getSelection().getRangeAt(0);}else if(objDocument.selection){tmp=objDocument.selection.createRange();}}if(tmp){r.start=tmp.startOffset;r.end=tmp.endOffset;r.text=getIframeSelectionText('#iframe-editor');}}return r;}
this.pasteHtmlAtCaret=function(html,selectPastedContent){var sel,range;var win=this.editor.contentWindow;var doc=win.document;if(window.getSelection){sel=win.getSelection();if(sel.getRangeAt&&sel.rangeCount){range=ModalImage.selectionRange||sel.getRangeAt(0);range.deleteContents();range.collapse(false);var el=doc.createElement("div");el.innerHTML=html;var frag=doc.createDocumentFragment(),node,lastNode;while((node=el.firstChild)){lastNode=frag.appendChild(node);}var firstNode=frag.firstChild;range.insertNode(frag);if(lastNode){range=range.cloneRange();range.setStartAfter(lastNode);if(selectPastedContent){range.setStartBefore(firstNode);}else{range.collapse(true);}sel.removeAllRanges();sel.addRange(range);}}}else if((sel=doc.selection)&&sel.type!="Control"){var originalRange=sel.createRange();originalRange.collapse(true);sel.createRange().pasteHTML(html);if(selectPastedContent){range=sel.createRange();range.setEndPoint("StartToStart",originalRange);range.select();}}}
this.exec=function(action,param){this.setFocus();if(!param){param=null;}var insertSupported=document.queryCommandSupported('insertHtml');var isBlockQuote=typeof param=='string'&&param.indexOf('blockquote')!=-1;if(isBlockQuote){param=param.split('\n').join('</p><p>');}if((!insertSupported&&action=='insertHtml')||isBlockQuote){this.pasteHtmlAtCaret(param,false);}else{this.editor.contentWindow.document.execCommand(action,false,param);}}
this.execPrompt=function(action,caption,text){var param=this.selected().text;if(!param){param=prompt(caption,text);}if(param){return this.exec(action,param);}}
var properties=['style','class'],property;for(property in properties){$(this.editor).attr(properties[property],$(this).attr(properties[property]));}$(this.editor).removeClass('required');if(!$.browser.msie){$(this.editor).appendTo('#resizable_post');}else{$('#resizable_post').remove();}var tmp=this;this.markItUp.ready(function(){if(!$.browser.msie){tmp.viewHtml(true);if(!readCookie('wysiwyg')){tmp.viewSource();}}if(lang['domain']=='poringa.net'){$('.markItUpButton10-1').hide();}$('.markItUpHeader ul li').on('click',function(e){e.preventDefault();});});});}
var mySettings={afterInsert:function(action){$('#markItUp').trigger('input.highlightTextarea');},beforeInsert:function(){},markupSet:[{action:'bold',name:lang['Negrita'],key:'B',openWith:'[b]',closeWith:'[/b]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r);}},{action:'italic',name:lang['Cursiva'],key:'I',openWith:'[i]',closeWith:'[/i]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r);}},{name:'Color',dropMenu:[{action:'foreColor',name:lang['Negro'],openWith:'[color=#000000]',closeWith:'[/color]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r,'#000000');}},{action:'foreColor',name:lang['Cyan'],openWith:'[color=#01AEF0]',closeWith:'[/color]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r,'#01AEF0');}},{action:'foreColor',name:lang['Oliva'],openWith:'[color=#C6DA2D]',closeWith:'[/color]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r,'#C6DA2D');}},{action:'foreColor',name:lang['Gris'],openWith:'[color=#A9A9A9]',closeWith:'[/color]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r,'#A9A9A9');}},{action:'foreColor',name:lang['Naranja'],openWith:'[color=#F7921E]',closeWith:'[/color]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r,'#F7921E');}}]},{name:lang['Fuente'],dropMenu:[{action:'fontSize',name:lang['Pequena'],openWith:'[size=9]',closeWith:'[/size]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r,px2fontSize(9));}},{action:'fontSize',name:lang['Normal'],openWith:'[size=12]',closeWith:'[/size]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r,px2fontSize(12));}},{action:'fontSize',name:lang['Grande'],openWith:'[size=18]',closeWith:'[/size]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r,px2fontSize(18));}}]},{action:'insertHtml',name:lang['Citar'],beforeInsert:function(r){var selection=r.selection||$('#markItUp').get(0).selected().text;r.replaceWith='';if(selection){r.replaceWith='[quote]'+selection+'[/quote]';var isIE11=!!navigator.userAgent.match(/Trident.*rv\:11\./);var startTag=isIE11?'<blockquote id="blockId">':'<blockquote>';$('#markItUp').get(0).tagInsert(r,startTag+'<div class="citacuerpo"><p>'+selection+'</p></div></blockquote>');if(isIE11){var insertedBlockquote=$($("iframe.post")[0].contentWindow.document).find('#blockId');var previousSibling=insertedBlockquote.prev();if(previousSibling.is('p')&&!previousSibling.text()){previousSibling.remove();}insertedBlockquote.removeAttr('id');}}},key:'Q'},{action:'insertHtml',name:lang['Lista'],beforeInsert:function(r){var selection=r.selection||$('#markItUp').get(0).selected().text;var items=selection.split('\n');var isIE11=!!navigator.userAgent.match(/Trident.*rv\:11\./);var startTagHtml=isIE11?'<div><ul id="listId">':'<div><ul>';var html=startTagHtml;var endTagHtml='</ul></div>';var startTag='[list]\n';var endTag='[/list]\n';r.replaceWith=startTag;for(index in items){if(items.hasOwnProperty(index)){r.replaceWith+='[*]'+items[index]+'\n';html+='<li>'+items[index]+'</li>';}}r.replaceWith+=endTag;html+=endTagHtml;$('#markItUp').get(0).tagInsert(r,html);if(isIE11){var insertedList=$($("iframe.post")[0].contentWindow.document).find('#listId');var previousSibling=insertedList.parent().prev();if(previousSibling.is('p')&&!previousSibling.text()){previousSibling.remove();}var lastLi=insertedList.find('li').last();if(!lastLi.text()){lastLi.remove();}insertedList.removeAttr('id');}},key:'L'},{separator:'-'},{name:lang['Alinear'],dropMenu:[{action:'justifyLeft',name:lang['Alinear a la izquierda'],openWith:'[align=left]',closeWith:'[/align]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r);}},{action:'justifyCenter',name:lang['Centrar'],openWith:'[align=center]',closeWith:'[/align]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r);}},{action:'justifyRight',name:lang['Alinear a la derecha'],openWith:'[align=right]',closeWith:'[/align]',beforeInsert:function(r){$('#markItUp').get(0).tagInsert(r);}}]},{separator:'-'},{action:'insertHtml',key:'Y',name:lang['Insertar video de YouTube'],beforeInsert:function(r){var selection=r.selection||$('#markItUp').get(0).selected().text;r.replaceWith='';var ytMatch=selection.match(/(?:v=|v\/|embed\/)([-_a-z0-9]+)/i);var vimeoMatch=selection.match(/vimeo.com\/([-_a-z0-9]+)/i);var videoId;var baseUrl;if(ytMatch){videoId=ytMatch[1];baseUrl='http://www.youtube.com/embed/';}else if(vimeoMatch){videoId=vimeoMatch[1];baseUrl='//player.vimeo.com/video/';}if(selection&&videoId){r.replaceWith='[video]'+selection+'[/video]\nlink: [url]'+selection+'[/url]\n';$('#markItUp').get(0).tagInsert(r,'<br /><iframe width="640" height="390" frameborder="0" src="'+baseUrl+videoId+'" allowfullscreen></iframe><br /><br />link: <a rel="nofollow" target="_blank" href="'+selection+'">'+selection+'</a>');$('#markItUp').get(0).refreshSwf();}else{ModalImage.saveSelectionRange();setTimeout(function(){$('.modal-video.choose').dialog({width:500,modal:true,resizable:false,draggable:false,dialogClass:'new-modal-dialog',open:ModalImage.onOpenModal,close:ModalImage.onCloseModal,buttons:[{text:lang['Cancelar'],"class":'floatL',click:function(){$(this).dialog('close');}},{text:lang['Agregar video'],"class":'btn a floatR',disabled:true,click:function(){var video=$(this).parent().find('.new-modal-dialog-url-input').val();var ytMatch=video.match(/(?:v=|v\/|embed\/)([-_a-z0-9]+)/i);var vimeoMatch=video.match(/vimeo.com\/([-_a-z0-9]+)/i);var videoId;var baseUrl;if(ytMatch){videoId=ytMatch[1];baseUrl='http://www.youtube.com/embed/';}else if(vimeoMatch){videoId=vimeoMatch[1];baseUrl='//player.vimeo.com/video/';}$(this).dialog('close');$.markItUp({target:'#markItUp',action:'insertHtml',name:lang['Insertar video de YouTube'],beforeInsert:function(r){r.replaceWith='[video]'+video+'[/video]\nlink: [url]'+video+'[/url]\n';$('#markItUp').get(0).tagInsert(r,'<br /><iframe width="640" height="390" frameborder="0" src="'+baseUrl+videoId+'" allowfullscreen></iframe><br /><br />link: <a rel="nofollow" target="_blank" href="'+video+'">'+video+'</a>');$('#markItUp').get(0).refreshSwf();}});}}]});},1)}}},{action:'insertHtml',name:lang['Insertar archivo SWF'],key:'H',beforeInsert:function(r){var selection=r.selection||$('#markItUp').get(0).selected().text,movie='';r.replaceWith='';var validUrl=/http:\/\/(?:\S+\.swf\b)/.test(selection);if(validUrl){movie=selection;r.replaceWith='[swf='+movie+']\nlink: [url]'+movie+'[/url]\n';$('#markItUp').get(0).tagInsert(r,'<br /><center><embed src="'+movie+'" quality=high width="425" height="350" TYPE="application/x-shockwave-flash" AllowNetworking="internal" AllowScriptAccess="never" autoplay="false" wmode="transparent"></embed></center><br /><br />link: <a rel="nofollow" target="_blank" href="'+movie+'">'+movie+'</a>');$('#markItUp').get(0).refreshSwf();}else{ModalImage.saveSelectionRange();setTimeout(function(){$('.modal-swf.choose').dialog({width:500,modal:true,resizable:false,draggable:false,dialogClass:'new-modal-dialog',open:ModalImage.onOpenModal,close:ModalImage.onCloseModal,buttons:[{text:lang['Cancelar'],"class":'floatL',click:function(){$(this).dialog('close');}},{text:lang['Agregar animacion'],"class":'floatR',disabled:true,click:function(){movie=$(this).parent().find('.new-modal-dialog-url-input').val();$.markItUp({target:'#markItUp',action:'insertHtml',beforeInsert:function(r){r.replaceWith='[swf='+movie+']\nlink: [url]'+movie+'[/url]\n';$('#markItUp').get(0).tagInsert(r,'<br /><center><embed src="'+movie+'" quality=high width="425" height="350" TYPE="application/x-shockwave-flash" AllowNetworking="internal" AllowScriptAccess="never" autoplay="false" wmode="transparent"></embed></center><br /><br />link: <a rel="nofollow" target="_blank" href="'+movie+'">'+movie+'</a>');$('#markItUp').get(0).refreshSwf();}});$(this).dialog('close');}}]});},1);}}},{name:lang['Insertar Imagen'],dropMenu:[{action:'insertHtml',name:lang['Desde computadora'],beforeInsert:function(r){ModalImage.markItUpObject=r;}},{action:'insertHtml',name:lang['Desde URL'],key:'U',beforeInsert:function(r){var selection=r.selection||$('#markItUp').get(0).selected().text,img='';r.replaceWith='';ModalImage.saveSelectionRange();if(selection){$('#markItUp').get(0).tagInsert(r,'<div class="loading" />');}else{selection='error';}var img=new Image();img.onload=function(){if(img.width){$.markItUp({target:'#markItUp',replaceWith:'[img='+img.src+']'});$('#markItUp').get(0).tagInsert(r,'<img class="imagen" border="0" src="'+img.src+'" onresizestart="return false" />');}};img.onerror=function(){if(!$.browser.msie){$($("iframe.post")[0].contentWindow.document).find('.loading').remove();}$('.modal-image-from-url.choose').dialog({width:500,modal:true,resizable:false,draggable:false,dialogClass:'new-modal-dialog',open:ModalImage.onOpenModal,close:ModalImage.onCloseModal,buttons:[{text:lang['Cancelar'],"class":'floatL',click:function(){$(this).dialog('close');}},{text:lang['Agregar imagen URL'],"class":'floatR',disabled:true,click:function(e){img=$(this).parent().find('.new-modal-dialog-url-input').val();if(gaTracker){gaTracker.trackEvent('Posts.CrearPost','AgregarImagen','DesdeURL');}var markItUp=$('#markItUp').get(0);if(markItUp.view=='html'){$('#markItUp').get(0).tagInsert(r,'<img class="imagen" border="0" src="'+img+'" onresizestart="return false" />');}else{$.markItUp({target:'#markItUp',replaceWith:'[img='+img+']'});}$(this).dialog('close');}}]});};if(selection!='error'){img.src=selection;}else{setTimeout(function(){img.onerror();},1);}}}]},{action:'createLink',name:lang['Insertar Link'],key:'K',beforeInsert:function(r){var selection=r.selection||$('#markItUp').get(0).selected().text,innerText='';r.replaceWith='';r.action='insertHtml';if(selection.match(/^(https?|ftp):\/\//)){r.replaceWith='[url]'+selection+'[/url]';$('#markItUp').get(0).tagInsert(r,'<a href="'+selection+'">'+selection+'</a>');}else{ModalImage.saveSelectionRange();setTimeout(function(){$('.modal-link.choose').dialog({width:500,modal:true,resizable:false,draggable:false,dialogClass:'new-modal-dialog',open:ModalImage.onOpenModal,close:ModalImage.onCloseModal,buttons:[{text:lang['Cancelar'],"class":'floatL',click:function(){$(this).dialog('close');}},{text:lang['Agregar link'],"class":'floatR',disabled:true,click:function(){var link=$(this).parent().find('.new-modal-dialog-url-input').val();$(this).dialog('close');if(!link.match(/^(https?|ftp):\/\//)){var httpLink='http://'+link;}else{var httpLink=link;}$.markItUp({target:'#markItUp',action:'insertHtml',beforeInsert:function(r){r.replaceWith='[url='+httpLink+']'+(selection||link)+'[/url]';r.action='insertHtml';if($('#markItUp').get(0).view=='html'){$('#markItUp').get(0).tagInsert(r,'<a href="'+httpLink+'">'+(selection||link)+'</a>');}}});}}]});},1);}if(gaTracker){gaTracker.trackEvent('Posts.CrearPost','AgregarLink');}}}]};var simpleView={name:lang['Simple'],key:'S',beforeInsert:function(r){var markItUp=$('#markItUp').get(0);if(markItUp.view=='source'){$('#markItUp').get(0).switchView();}}};var advancedView={name:lang['Advanced'],key:'D',beforeInsert:function(r){var markItUp=$('#markItUp').get(0);if(markItUp.view=='html'){$('#markItUp').get(0).switchView();}setTimeout(function(){moveCaretToEnd($('#markItUp').get(0));},100);}};if(!$.browser.msie){mySettings.markupSet.push(advancedView);mySettings.markupSet.push(simpleView);}function moveCaretToEnd(el){if(typeof el.selectionStart=="number"){el.selectionStart=el.selectionEnd=el.value.length;}else if(typeof el.createTextRange!="undefined"){el.focus();var range=el.createTextRange();range.collapse(false);range.select();}}var ModalImage={onOpenModal:function(event,ui){var dialogContainer=this;$('.ui-widget-overlay').click(function(event,ui){$(dialogContainer).dialog('close');});},onCloseModal:function(event,ui){$(this).find('.new-modal-dialog-url-input').val('');$('#markItUp').get(0).setFocus();if(ModalImage.selectionRange){$('#iframe-editor').get(0).contentWindow.getSelection().removeAllRanges();$('#iframe-editor').get(0).contentWindow.getSelection().addRange(ModalImage.selectionRange);}setTimeout(function(){moveCaretToEnd($('#markItUp').get(0));},100);},saveSelectionRange:function(){if($('#iframe-editor').get(0)&&$('#iframe-editor').get(0).contentWindow.getSelection().rangeCount){ModalImage.selectionRange=$('#iframe-editor').get(0).contentWindow.getSelection().getRangeAt(0);}},selectionRange:null,customCallback:null,markItUpObject:null,init:function(){$('#modal-image-upload').on('change',function(){if($('#modal-image-upload')[0].files){ModalImage.startLoading();var totalImages=$('#modal-image-upload')[0].files.length;var imagesLeft=$('#modal-image-upload')[0].files.length;var file;for(var i=0;i<totalImages;i++){if($('#modal-image-upload')[0].files[i].name.match(/^.*\.(png|jpe?g|gif)/i)){file=[{files:[$('#modal-image-upload')[0].files[i]]}];;Kn3Client.upload({values:{app:'images'},error:function(e){imagesLeft--;if(!imagesLeft){ModalImage.stopLoading();Form.error(this,'Terminado con errores.');}},file:file,success:function(data){imagesLeft--;if(!imagesLeft){ModalImage.stopLoading();}ModalImage.confirm(data.url);}});}}}else{ModalImage.startLoading();Kn3Client.upload({values:{app:'images'},error:function(e){Form.error(this,'Error al subir la imagen.');},file:$('#modal-image-upload'),success:function(data){ModalImage.stopLoading();ModalImage.confirm(data.url);}});}});},open:function(object,callback){if(callback){ModalImage.customCallback=callback;}this.markItUpObject=object;$('.modal-image.choose').dialog({width:570,modal:true,resizable:false,buttons:[{text:lang['Aceptar'],'class':'ui-button-positive floatL',disabled:true},{text:lang['Cancelar'],'class':'floatR',click:ModalImage.close}]}).dialog('open');},close:function(){ModalImage.errorHide();$('.modal-image.choose').dialog('close');},importx:function(){var elem=$('#modal-image-import-value'),image=$.trim(elem.val());if(image){elem.val('');ModalImage.confirm(image);}},upload:function(){ModalImage.startLoading();Kn3.upload($('#modal-image-upload'),function(response){ModalImage.stopLoading();if(response){switch(parseInt(response.no)){case 0:ModalImage.confirm(response.error);break;default:ModalImage.error(lang['error procesar']);}}else{ModalImage.error(lang['error procesar']);}});},error:function(message){$('.modal-image.choose').addClass('error');$('#modal-image-error').html(message).show();},errorHide:function(){$('#modal-image-error').hide();},center:function(){$('.modal-image.confirm').dialog({width:'auto'}).dialog({position:'center'});},startLoading:function(){var progressInterval=null;ImageThumb.helperChangeStep('progress');ImageThumb.modal.dialog({modal:true,resizable:false,draggable:false,dialogClass:'crop-dialog new-modal-dialog',width:500,height:210,title:'Subiendo imagen',position:'center',open:function(){var dialog=this;var value=0;progressInterval=setInterval(function(){value=value++<100?value:0;$(dialog).find('.progressbar div').css('width',value+'%');},25);},close:function(){clearInterval(progressInterval);},buttons:[{text:'Cancelar',"class":'ui-button-white box-shadow-soft floatL',click:function(){ImageThumb.helperCloseModal();}}]});},stopLoading:function(){ImageThumb.modal.dialog('close');},confirm:function(image){var img=image;$('#modal-image-preview').attr('src','');if(ModalImage.customCallback){ModalImage.customCallback(img);}else{if($('#markItUp').get(0).view=='html'){$('#markItUp').get(0).tagInsert(ModalImage.markItUpObject||{action:'insertHtml',name:lang['Desde computadora']},'<img class="imagen" border="0" src="'+img+'" onresizestart="return false" />');}else{$.markItUp({target:'#markItUp',replaceWith:'[img='+img+']'});}}}}
function ir_a_categoria(cat){if(cat){if(cat==-1){analytics_cat='Home';}else{analytics_cat=cat.substr(0,1).toUpperCase()+cat.substr(1);}gaTracker.trackEvent('Home.CambioCat',analytics_cat);if(cat==-1){document.location.href='/';}else{document.location.href='/'+lang['posts url categorias']+'/'+cat+'/';}}}function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires='; expires='+date.toGMTString();}else
var expires='';document.cookie=name+'='+value+expires+'; path=/;';}function readCookie(name){var nameEQ=name+'=';var ca=document.cookie.split(';');for(var i=0,s=ca.length;i<s;++i){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}return null;}function eraseCookie(name){createCookie(name,"",-1);}(function($){var baseClasses=/ui-checkbox|ui-radio/;$.widget('ui.checkBox',{options:{hideInput:true,addVisualElement:true,addLabel:true,_delegated:false},_create:function(){var that=this,opts=this.options;if(!this.element.is(':radio,:checkbox')){if($.nodeName(this.element[0],'input')){return false;}this._addDelegate();this.updateContainer();return false;}this.labels=$([]);this.checkedStatus=false;this.disabledStatus=false;this.hoverStatus=false;this.radio=(this.element.is(':radio'));this.visualElement=$([]);if(opts.hideInput){this.element.addClass('ui-helper-hidden-accessible');if(opts.addVisualElement){this.visualElement=$('<span />').addClass(this.radio?'ui-radio':'ui-checkbox');this.element.after(this.visualElement[0]);}}if(opts.addLabel){this.labels=$('label[for='+this.element.attr('id')+']').addClass(this.radio?'ui-radio':'ui-checkbox');}if(!opts._delegated){this._addEvents();}this.initialized=true;this.reflectUI({type:'initialReflect'});return undefined;},updateContainer:function(){if(!this.element.is(':radio,:checkbox')&&!$.nodeName(this.element[0],'input')){$('input',this.element[0]).filter(function(){return!($.data(this,'checkBox'));}).checkBox($.extend({},this.options,{_delegated:true}));}},_addDelegate:function(){var opts=this.options,toggleHover=function(e,that){if(!that){return;}that.hover=!!(e.type=='focus'||e.type=='mouseenter'||e.type=='focusin'||e.type=='mouseover');that._changeStateClassChain.call(that);return undefined;};this.element.bind('click',function(e){if(!$.nodeName(e.target,'input')){return;}var inst=($.data(e.target)||{}).checkBox;if(!inst){return;}inst.reflectUI.call(inst,e.target,e);}).bind('focusin.checkBox focusout.checkBox',function(e){if(!$.nodeName(e.target,'input')){return;}var inst=($.data(e.target)||{}).checkBox;toggleHover(e,inst);});if(opts.hideInput){this.element.bind('usermode',function(e){if(!e.enabled){return;}$('input',this).each(function(){var inst=($.data(this)||{}).checkBox;(inst&&inst.destroy.call(inst,true));});});}if(opts.addVisualElement){this.element.bind('mouseover.checkBox mouseout.checkBox',function(e){if(!$.nodeName(e.target,'span')){return;}var inst=($.data($(e.target).prev()[0])||{}).checkBox;toggleHover(e,inst);}).bind('click.checkBox',function(e){if(!$.nodeName(e.target,'span')||!baseClasses.test(e.target.className||'')){return;}$(e.target).prev()[0].click();return false;});}if(opts.addLabel){this.element.delegate('label.ui-radio, label.ui-checkbox','mouseenter.checkBox mouseleave.checkBox',function(e){var inst=($.data(document.getElementById($(this).attr('for')))||{}).checkBox;toggleHover(e,inst);});}},_addEvents:function(){var that=this,opts=this.options,toggleHover=function(e){if(that.disabledStatus){return false;}that.hover=(e.type=='focus'||e.type=='mouseenter');that._changeStateClassChain();return undefined;};this.element.bind('click.checkBox',$.proxy(this,'reflectUI')).bind('focus.checkBox blur.checkBox',toggleHover);if(opts.hideInput){this.element.bind('usermode',function(e){(e.enabled&&that.destroy.call(that,true));});}if(opts.addVisualElement){this.visualElement.bind('mouseenter.checkBox mouseleave.checkBox',toggleHover).bind('click.checkBox',function(e){that.element[0].click();return false;});}if(opts.addLabel){this.labels.bind('mouseenter.checkBox mouseleave.checkBox',toggleHover);}},_changeStateClassChain:function(){var allElements=this.labels.add(this.visualElement),stateClass='',baseClass='ui-'+((this.radio)?'radio':'checkbox');if(this.checkedStatus){stateClass+='-checked';allElements.addClass(baseClass+'-checked');}else{allElements.removeClass(baseClass+'-checked');}if(this.disabledStatus){stateClass+='-disabled';allElements.addClass(baseClass+'-disabled');}else{allElements.removeClass(baseClass+'-disabled');}if(this.hover){stateClass+='-hover';allElements.addClass(baseClass+'-hover');}else{allElements.removeClass(baseClass+'-hover');}baseClass+='-state';if(stateClass){stateClass=baseClass+stateClass;}function switchStateClass(){var classes=this.className.split(' '),found=false;$.each(classes,function(i,classN){if(classN.indexOf(baseClass)===0){found=true;classes[i]=stateClass;return false;}return undefined;});if(!found){classes.push(stateClass);}this.className=classes.join(' ');}this.labels.each(switchStateClass);this.visualElement.each(switchStateClass);},destroy:function(onlyCss){this.element.removeClass('ui-helper-hidden-accessible');this.visualElement.addClass('ui-helper-hidden');if(!onlyCss){var o=this.options;this.element.unbind('.checkBox');this.visualElement.remove();this.labels.unbind('.checkBox').removeClass('ui-state-hover ui-state-checked ui-state-disabled');}},disable:function(){this.element[0].disabled=true;this.reflectUI({type:'manuallyDisabled'});},enable:function(){this.element[0].disabled=false;this.reflectUI({type:'manuallyenabled'});},toggle:function(e){this.changeCheckStatus((this.element.is(':checked'))?false:true,e);},changeCheckStatus:function(status,e){if(e&&e.type=='click'&&this.element[0].disabled){return false;}this.element.attr({'checked':status});this.reflectUI(e||{type:'changeCheckStatus'});return undefined;},propagate:function(n,e,_noGroupReflect){if(!e||e.type!='initialReflect'){if(this.radio&&!_noGroupReflect){$(document.getElementsByName(this.element.attr('name'))).checkBox('reflectUI',e,true);}return this._trigger(n,e,{options:this.options,checked:this.checkedStatus,labels:this.labels,disabled:this.disabledStatus});}return undefined;},reflectUI:function(e){var oldChecked=this.checkedStatus,oldDisabledStatus=this.disabledStatus;this.disabledStatus=this.element.is(':disabled');this.checkedStatus=this.element.is(':checked');if(this.disabledStatus!=oldDisabledStatus||this.checkedStatus!==oldChecked){this._changeStateClassChain();(this.disabledStatus!=oldDisabledStatus&&this.propagate('disabledChange',e));(this.checkedStatus!==oldChecked&&this.propagate('change',e));}}});})(jQuery);var mydialog={error_500:function(fn){var buttons={};buttons[lang['Reintentar']]=function(){$(this).dialog('close').remove();return eval(fn);};buttons[lang['Cancelar']]=function(){$(this).dialog('close').remove();};$('<div><p>Ocurri&oacute; un error al procesar lo solicitado</p></div>').dialog({modal:true,resizable:false,title:'Ops',buttons:buttons});},alert:function(str,title,callback,dialogClass){if(typeof(title)=='undefined')title='Oops!';if(typeof(callback)=='undefined')callback=function(){};var buttons={};buttons[lang['Aceptar']]=function(){$(this).dialog('close').remove();callback();};var cfg={modal:true,resizable:false,title:title,buttons:buttons};if(dialogClass){cfg.dialogClass=dialogClass;}$('<div><p>'+str+'</p></div>').dialog(cfg);},confirm:function(str,title,callback,opts){var cfg={modal:true,resizable:false,title:title,buttons:[{text:getlang('Aceptar'),'class':'ui-button-positive floatL',click:function(){callback();$(this).dialog('close').remove();}},{text:getlang('Cancelar'),'class':'ui-button-negative floatR',click:function(){$(this).dialog('close').remove();}}]};$.extend(cfg,opts);$('<div><p>'+str+'</p></div>').dialog(cfg);}}
var Search={suggest:function(query){$.getScript('http://api.bing.net/json.aspx?AppId=86DD2D338759CA64E6D11491823F0F459F727460&Version=2.2&Query='+encodeURIComponent(query)+'&Sources=Spell&UILanguage=es&JsonType=callback&JsonCallback=Search.complete');},complete:function(data){if(typeof data.SearchResponse.Spell!=='undefined'){var suggest=data.SearchResponse.Spell.Results[0].Value,link=$('#search-suggest').children('a').attr('href');$('#search-suggest').show().children('a').html(suggest).attr('href',link+'&q='+suggest);$('.search-suggest-tags').show().children('a').html(suggest).attr('href','/tags/'+suggest);}}};var miLoadScript_loading=false;function miLoadScript(url){return;if(miLoadScript_loading)return;if(typeof mi==='undefined'){miLoadScript_loading=true;$.ajax({url:url,cache:true,dataType:'script',crossDomain:true,success:function(){if($('.my-shout-attach-image').length)mi.initUploadfy();},complete:function(){miLoadScript_loading=false;}});}else{if($('.my-shout-attach-image').length)mi.initUploadfy();}}function miToggleCompose(url){if($('#compose-box').hasClass('noHideForce'))return false;$('.navitem').removeClass('active');$('.navpanel').hide();$('#compose-navitem').toggleClass('active');$('#compose-box').toggle();if(typeof url!=='undefined')mi.initUploadfy();}function menuPopupAlert(id,value){var el=$('#'+id).find('.bubble');if($(el).find('a span').html()==value)return;if(value==0){$(el).animate({bottom:'+=5px'},100,null,function(){$(this).animate({bottom:'-=5px'},100,null,function(){$(this).slideUp(100);});});}else{$(el).find('a span').html(value);$(el).slideDown(100,function(){$(this).animate({bottom:'+=5px'},100,null,function(){$(this).animate({bottom:'-=5px'},100)});});}}$.fn.textlimit=function(opts){opts=$.extend({suffix:''},opts||{});return this.each(function(){var width=parseInt($(this).data('width'));if($(this).css('max-width')!='none'&&parseInt($(this).css('max-width'))==width)width--;var textOriginal=text=$.trim($(this).html());while($(this).width()>width&&text.length>1){text=text.substr(0,text.length-1);$(this).html(text+opts.suffix);}if(text.length==0)$(this).html(textOriginal);});};function supportLocalStorage(){try{return'localStorage'in window&&window['localStorage']!==null;}catch(e){return false;}}var ajaxCheck={time:60000,init:function(){if(typeof notifications!=='undefined'){return;}if(!global_data['user'])return false;if(!supportLocalStorage())return false;this.data.init();var self=this;$('body').mousemove(function(){self.setActivity();});},add:function(param,value){if(typeof notifications!=='undefined'){return;}if(!global_data['user'])return false;if(!supportLocalStorage())return false;var mili=new Date();mili=mili.getTime();this.data.set('lastCheck',mili);this.data.set(param,value);this.updateHtml(param);},setActivity:function(){if(typeof notifications!=='undefined'){return;}var mili=new Date();mili=mili.getTime();if(mili-this.data.dataActual['lastActivity']<1000)return;if(mili-this.data.dataActual['lastActivity']>this.time&&mili-this.data.dataActual['lastCheck']>this.time){this.data.set('lastActivity',mili);this.ajax();return;}this.data.set('lastActivity',mili);},ajax:function(){if(typeof notifications!=='undefined'){return;}return;if(this.data.get('ajaxProcessing2')==1)return;this.data.set('ajaxProcessing2',1);var mili=new Date();mili=mili.getTime();this.data.set('lastCheck',mili);var self=this;$.ajax({type:'POST',url:'/ajax/user/update',data:'',dataType:'json',success:function(data){switch(data['status']){case 1:data=data['data'];if(self.data.dataActual['notifications']!=data['notifications']){self.data.set('notifications',data['notifications']);self.updateHtml('notifications');}if(self.data.dataActual['mps']!=data['messages']){self.data.set('mps',data['messages']);self.updateHtml('mps');}if(self.data.dataActual['mi']!=data['newsfeed']){self.data.set('mi',data['newsfeed']);self.updateHtml('mi');}break;}},error:function(){},complete:function(){self.data.set('ajaxProcessing2',0);}});},data:{dataActual:{'lastActivity':0,'lastCheck':0,'ajaxProcessing2':0,'notifications':0,'mps':0,'mi':0},init:function(){if(typeof notifications!=='undefined'){return;}for(param in this.dataActual){if(this.get(param)===null)this.set(param,this.dataActual[param]);else
this.dataActual[param]=this.get(param);}var self=this;setInterval(function(){for(param in self.dataActual){var value=self.get(param);if(value!=self.dataActual[param]){self.dataActual[param]=value;if(param=='notifications'||param=='mps'||param=='mi'){ajaxCheck.updateHtml(param);}}}var mili=new Date();mili=mili.getTime();if(mili-self.dataActual['lastCheck']>ajaxCheck.time&&mili-self.dataActual['lastActivity']<ajaxCheck.time){ajaxCheck.ajax();}},1000);},get:function(param){if(typeof notifications!=='undefined'){return;}return localStorage['ajaxCheck.'+param];},set:function(param,value){if(typeof notifications!=='undefined'){return;}this.dataActual[param]=localStorage['ajaxCheck.'+param]=value;}},updateHtml:function(param){if(typeof notifications!=='undefined'){return;}switch(param){case'notifications':menuPopupAlert('notifications-navitem',(parseInt(this.data.dataActual['notifications'])>=100)?'+99':this.data.dataActual['notifications']);this.updateTitle();break;case'mps':menuPopupAlert('mensajes-navitem',(parseInt(this.data.dataActual['mps'])>=100)?'+99':this.data.dataActual['mps']);break;case'mi':menuPopupAlert('menu-section-mi',(parseInt(this.data.dataActual['mi'])>=100)?'+99':this.data.dataActual['mi']);this.updateTitle();if(this.data.dataActual['mi']&&document.location.pathname=='/mi'){$('.reload-ajax').css('display','block');}break;}},updateTitle:function(){if(typeof notifications!=='undefined'){return;}if(typeof this.titleOriginal==='undefined')this.titleOriginal=document.title;if(this.data.dataActual['notifications']+this.data.dataActual['mi']==0){document.title=this.titleOriginal;}else{var total=parseInt(this.data.dataActual['notifications'])+parseInt(this.data.dataActual['mi']);if(total>=100)total='+99';document.title='('+total+') '+this.titleOriginal;}}};(function($){$.fn.extend({autocompleteold:function(urlOrData,options){var isUrl=typeof urlOrData=="string";options=$.extend({},$.Autocompleter.defaults,{url:isUrl?urlOrData:null,data:isUrl?null:urlOrData,delay:isUrl?$.Autocompleter.defaults.delay:10,max:options&&!options.scroll?10:150},options);options.highlight=options.highlight||function(value){return value;};options.formatMatch=options.formatMatch||options.formatItem;return this.each(function(){new $.Autocompleter(this,options);});},result:function(handler){return this.bind("result",handler);},search:function(handler){return this.trigger("search",[handler]);},flushCache:function(){return this.trigger("flushCache");},setOptions:function(options){return this.trigger("setOptions",[options]);},unautocomplete:function(){return this.trigger("unautocomplete");}});$.Autocompleter=function(input,options){var KEY={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var $input=$(input).attr("autocomplete","off").addClass(options.inputClass);var timeout;var previousValue="";var cache=$.Autocompleter.Cache(options);var hasFocus=0;var lastKeyPressCode;var config={mouseDownOnSelect:false};var select=$.Autocompleter.Select(options,input,selectCurrent,config);var blockSubmit;$.browser.opera&&$(input.form).bind("submit.autocomplete",function(){if(blockSubmit){blockSubmit=false;return false;}});$input.bind(($.browser.opera?"keypress":"keydown")+".autocomplete",function(event){hasFocus=1;lastKeyPressCode=event.keyCode;switch(event.keyCode){case KEY.UP:event.preventDefault();if(select.visible()){select.prev();}else{onChange(0,true);}break;case KEY.DOWN:event.preventDefault();if(select.visible()){select.next();}else{onChange(0,true);}break;case KEY.PAGEUP:event.preventDefault();if(select.visible()){select.pageUp();}else{onChange(0,true);}break;case KEY.PAGEDOWN:event.preventDefault();if(select.visible()){select.pageDown();}else{onChange(0,true);}break;case options.multiple&&$.trim(options.multipleSeparator)==","&&KEY.COMMA:case KEY.TAB:case KEY.RETURN:if(selectCurrent()){event.preventDefault();blockSubmit=true;return false;}break;case KEY.ESC:select.hide();break;default:clearTimeout(timeout);timeout=setTimeout(onChange,options.delay);break;}}).focus(function(){hasFocus++;}).blur(function(){hasFocus=0;if(!config.mouseDownOnSelect){hideResults();}}).click(function(){if(hasFocus++>1&&!select.visible()){onChange(0,true);}}).bind("search",function(){var fn=(arguments.length>1)?arguments[1]:null;function findValueCallback(q,data){var result;if(data&&data.length){for(var i=0;i<data.length;i++){if(data[i].result.toLowerCase()==q.toLowerCase()){result=data[i];break;}}}if(typeof fn=="function")fn(result);else $input.trigger("result",result&&[result.data,result.value]);}$.each(trimWords($input.val()),function(i,value){request(value,findValueCallback,findValueCallback);});}).bind("flushCache",function(){cache.flush();}).bind("setOptions",function(){$.extend(options,arguments[1]);if("data"in arguments[1])cache.populate();}).bind("unautocomplete",function(){select.unbind();$input.unbind();$(input.form).unbind(".autocomplete");});function selectCurrent(){var selected=select.selected();if(!selected)return false;var v=selected.result;previousValue=v;if(options.multiple){var words=trimWords($input.val());if(words.length>1){var seperator=options.multipleSeparator.length;var cursorAt=$(input).selection().start;var wordAt,progress=0;$.each(words,function(i,word){progress+=word.length;if(cursorAt<=progress){wordAt=i;return false;}progress+=seperator;});words[wordAt]=v;v=words.join(options.multipleSeparator);}v+=options.multipleSeparator;}$input.val(v);hideResultsNow();$input.trigger("result",[selected.data,selected.value]);return true;}function onChange(crap,skipPrevCheck){if(lastKeyPressCode==KEY.DEL){select.hide();return;}var currentValue=$input.val();if(!skipPrevCheck&&currentValue==previousValue)return;previousValue=currentValue;currentValue=lastWord(currentValue);if(currentValue.length>=options.minChars){$input.addClass(options.loadingClass);if(!options.matchCase)currentValue=currentValue.toLowerCase();request(currentValue,receiveData,hideResultsNow);}else{stopLoading();select.hide();}};function trimWords(value){if(!value)return[""];if(!options.multiple)return[$.trim(value)];return $.map(value.split(options.multipleSeparator),function(word){return $.trim(value).length?$.trim(word):null;});}function lastWord(value){if(!options.multiple)return value;var words=trimWords(value);if(words.length==1)return words[0];var cursorAt=$(input).selection().start;if(cursorAt==value.length){words=trimWords(value)}else{words=trimWords(value.replace(value.substring(cursorAt),""));}return words[words.length-1];}function autoFill(q,sValue){if(options.autoFill&&(lastWord($input.val()).toLowerCase()==q.toLowerCase())&&lastKeyPressCode!=KEY.BACKSPACE){$input.val($input.val()+sValue.substring(lastWord(previousValue).length));$(input).selection(previousValue.length,previousValue.length+sValue.length);}};function hideResults(){clearTimeout(timeout);timeout=setTimeout(hideResultsNow,200);};function hideResultsNow(){var wasVisible=select.visible();select.hide();clearTimeout(timeout);stopLoading();if(options.mustMatch){$input.search(function(result){if(!result){if(options.multiple){var words=trimWords($input.val()).slice(0,-1);$input.val(words.join(options.multipleSeparator)+(words.length?options.multipleSeparator:""));}else{$input.val("");$input.trigger("result",null);}}});}};function receiveData(q,data){if(data&&data.length&&hasFocus){stopLoading();select.display(data,q);autoFill(q,data[0].value);select.show();}else{hideResultsNow();}};function request(term,success,failure){if(!options.matchCase)term=term.toLowerCase();var data=cache.load(term);if(data&&data.length){success(term,data);}else if((typeof options.url=="string")&&(options.url.length>0)){var extraParams={timestamp:+new Date()};$.each(options.extraParams,function(key,param){extraParams[key]=typeof param=="function"?param():param;});$.ajax({mode:"abort",port:"autocomplete"+input.name,dataType:options.dataType,url:options.url,data:$.extend({q:lastWord(term),limit:options.max},extraParams),success:function(data){var parsed=options.parse&&options.parse(data)||parse(data);cache.add(term,parsed);success(term,parsed);}});}else{select.emptyList();failure(term);}};function parse(data){var parsed=[];var rows=data.split("\n");for(var i=0;i<rows.length;i++){var row=$.trim(rows[i]);if(row){row=row.split("|");parsed[parsed.length]={data:row,value:row[0],result:options.formatResult&&options.formatResult(row,row[0])||row[0]};}}return parsed;};function stopLoading(){$input.removeClass(options.loadingClass);};};$.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(row){return row[0];},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:", ",highlight:function(value,term){return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");},scroll:true,scrollHeight:180};$.Autocompleter.Cache=function(options){var data={};var length=0;function matchSubset(s,sub){if(!options.matchCase)s=s.toLowerCase();var i=s.indexOf(sub);if(options.matchContains=="word"){i=s.toLowerCase().search("\\b"+sub.toLowerCase());}if(i==-1)return false;return i==0||options.matchContains;};function add(q,value){if(length>options.cacheLength){flush();}if(!data[q]){length++;}data[q]=value;}function populate(){if(!options.data)return false;var stMatchSets={},nullData=0;if(!options.url)options.cacheLength=1;stMatchSets[""]=[];for(var i=0,ol=options.data.length;i<ol;i++){var rawValue=options.data[i];rawValue=(typeof rawValue=="string")?[rawValue]:rawValue;var value=options.formatMatch(rawValue,i+1,options.data.length);if(value===false)continue;var firstChar=value.charAt(0).toLowerCase();if(!stMatchSets[firstChar])stMatchSets[firstChar]=[];var row={value:value,data:rawValue,result:options.formatResult&&options.formatResult(rawValue)||value};stMatchSets[firstChar].push(row);if(nullData++<options.max){stMatchSets[""].push(row);}};$.each(stMatchSets,function(i,value){options.cacheLength++;add(i,value);});}setTimeout(populate,25);function flush(){data={};length=0;}return{flush:flush,add:add,populate:populate,load:function(q){if(!options.cacheLength||!length)return null;if(!options.url&&options.matchContains){var csub=[];for(var k in data){if(k.length>0){var c=data[k];$.each(c,function(i,x){if(matchSubset(x.value,q)){csub.push(x);}});}}return csub;}else if(data[q]){return data[q];}else if(options.matchSubset){for(var i=q.length-1;i>=options.minChars;i--){var c=data[q.substr(0,i)];if(c){var csub=[];$.each(c,function(i,x){if(matchSubset(x.value,q)){csub[csub.length]=x;}});return csub;}}}return null;}};};$.Autocompleter.Select=function(options,input,select,config){var CLASSES={ACTIVE:"ac_over"};var listItems,active=-1,data,term="",needsInit=true,element,list;function init(){if(!needsInit)return;element=$("<div/>").hide().addClass(options.resultsClass).css("position","absolute").appendTo(document.body);list=$("<ul/>").appendTo(element).mouseover(function(event){if(target(event).nodeName&&target(event).nodeName.toUpperCase()=='LI'){active=$("li",list).removeClass(CLASSES.ACTIVE).index(target(event));$(target(event)).addClass(CLASSES.ACTIVE);}}).click(function(event){$(target(event)).addClass(CLASSES.ACTIVE);select();input.focus();return false;}).mousedown(function(){config.mouseDownOnSelect=true;}).mouseup(function(){config.mouseDownOnSelect=false;});if(options.width>0)element.css("width",options.width);needsInit=false;}function target(event){var element=event.target;while(element&&element.tagName!="LI")element=element.parentNode;if(!element)return[];return element;}function moveSelect(step){listItems.slice(active,active+1).removeClass(CLASSES.ACTIVE);movePosition(step);var activeItem=listItems.slice(active,active+1).addClass(CLASSES.ACTIVE);if(options.scroll){var offset=0;listItems.slice(0,active).each(function(){offset+=this.offsetHeight;});if((offset+activeItem[0].offsetHeight-list.scrollTop())>list[0].clientHeight){list.scrollTop(offset+activeItem[0].offsetHeight-list.innerHeight());}else if(offset<list.scrollTop()){list.scrollTop(offset);}}};function movePosition(step){active+=step;if(active<0){active=listItems.size()-1;}else if(active>=listItems.size()){active=0;}}function limitNumberOfItems(available){return options.max&&options.max<available?options.max:available;}function fillList(){list.empty();var max=limitNumberOfItems(data.length);for(var i=0;i<max;i++){if(!data[i])continue;var formatted=options.formatItem(data[i].data,i+1,max,data[i].value,term);if(formatted===false)continue;var li=$("<li/>").html(options.highlight(formatted,term)).addClass(i%2==0?"ac_even":"ac_odd").appendTo(list)[0];$.data(li,"ac_data",data[i]);}listItems=list.find("li");if(options.selectFirst){listItems.slice(0,1).addClass(CLASSES.ACTIVE);active=0;}if($.fn.bgiframe)list.bgiframe();}return{display:function(d,q){init();data=d;term=q;fillList();},next:function(){moveSelect(1);},prev:function(){moveSelect(-1);},pageUp:function(){if(active!=0&&active-8<0){moveSelect(-active);}else{moveSelect(-8);}},pageDown:function(){if(active!=listItems.size()-1&&active+8>listItems.size()){moveSelect(listItems.size()-1-active);}else{moveSelect(8);}},hide:function(){element&&element.hide();listItems&&listItems.removeClass(CLASSES.ACTIVE);active=-1;},visible:function(){return element&&element.is(":visible");},current:function(){return this.visible()&&(listItems.filter("."+CLASSES.ACTIVE)[0]||options.selectFirst&&listItems[0]);},show:function(){var offset=$(input).offset();element.css({width:typeof options.width=="string"||options.width>0?options.width:$(input).width(),top:offset.top+input.offsetHeight,left:offset.left}).show();if(options.scroll){list.scrollTop(0);list.css({maxHeight:options.scrollHeight,overflow:'auto'});if($.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var listHeight=0;listItems.each(function(){listHeight+=this.offsetHeight;});var scrollbarsVisible=listHeight>options.scrollHeight;list.css('height',scrollbarsVisible?options.scrollHeight:listHeight);if(!scrollbarsVisible){listItems.width(list.width()-parseInt(listItems.css("padding-left"))-parseInt(listItems.css("padding-right")));}}}},selected:function(){var selected=listItems&&listItems.filter("."+CLASSES.ACTIVE).removeClass(CLASSES.ACTIVE);return selected&&selected.length&&$.data(selected[0],"ac_data");},emptyList:function(){list&&list.empty();},unbind:function(){element&&element.remove();}};};$.fn.selection=function(start,end){if(start!==undefined){return this.each(function(){if(this.createTextRange){var selRange=this.createTextRange();if(end===undefined||start==end){selRange.move("character",start);selRange.select();}else{selRange.collapse(true);selRange.moveStart("character",start);selRange.moveEnd("character",end);selRange.select();}}else if(this.setSelectionRange){this.setSelectionRange(start,end);}else if(this.selectionStart){this.selectionStart=start;this.selectionEnd=end;}});}var field=this[0];if(field.createTextRange){var range=document.selection.createRange(),orig=field.value,teststring="<->",textLength=range.text.length;range.text=teststring;var caretAt=field.value.indexOf(teststring);field.value=orig;this.selection(caretAt,caretAt+textLength);return{start:caretAt,end:caretAt+textLength}}else if(field.selectionStart!==undefined){return{start:field.selectionStart,end:field.selectionEnd}}};})(jQuery);(function($){$.getCaret=function(element){if(element.selectionStart){return element.selectionStart;}else if(document.selection){if($(element).is(':visible')&&!$(element).attr('disabled')){element.focus();}var a=document.selection.createRange();if(a){var b=element.createTextRange(),c=a.duplicate();b.moveToBookmark(a.getBookmark());c.setEndPoint('EndToStart',a);return c.text.length;}}return 0;};$.fn.mention=function(settings){getCandidates=function(text){var text=text.toLowerCase(),length=text.length,nameRegex=new RegExp(text,'gi'),result=Array();if(length>=settings.minlength){for(i=0,c=Object.keys(settings.list).length;i<c;++i){matchName=settings.list[i].name.match(nameRegex);matchNick=text=settings.list[i].user.substr(0,length).toLowerCase();if((matchNick===true||matchName!==null)&&length!=settings.list[i].length){result.push(settings.list[i]);if(settings.limit&&settings.limit==result.length){break;}}}}return result;};settings=$.extend({key:'@',minlength:0,list:[],nicks:[],callback:function(){},limit:8},settings||{});return this.each(function(){$(this).bind('keydown',function(e){if(nav.hover===false&&nav.suggesting===true&&$.inArray(e.keyCode,[38,40,13])!==-1){if(e.keyCode===13){$('ul.mentionsuggest li.active a').trigger('click');}e.preventDefault();}}).bind('keyup',function(e){$(this).attr('rows',$(this).val().split('\n').length+1);var content=$('.my-shout-content-mi'),newHeight=parseInt($('#my-shout-body-mi').height())-20;content.css('margin-top',newHeight+'px');var text=$(this).val().substr(0,$.getCaret(this)),match=text.match(/(?:^|\s)@([-_a-z0-9]*)$/i),highlighter=$(this).prev(),result=[];if(match){result=getCandidates(match[1]);}settings.callback.call(this,result);if(nav.hover===false&&nav.suggesting===true){nav.menu=$('ul.mentionsuggest');nav.menu.find('li').removeClass('active');switch(e.keyCode){case 38:nav.go('up');break;case 40:nav.go('down');break;}}var newHTML=text.replace(/\n/g,'<br>').replace(/(^|\s)@([-_a-z0-9]{1,25})/ig,function($1,$2,$3){if($.inArray($3,settings.nicks)!==-1){return $2+'<x>@'+$3+'</x>';}else{return $2+'@'+$1;}});highlighter.css('height',$(this).height()+'px').html(strip_tags(newHTML,'<x><br>'));}).bind('blur',function(){setTimeout(function(obj){settings.callback.call(null,Array());},250);}).bind('focus resize onload',function(){$(this).trigger('click');});});};})(jQuery);var ls={get:function(options){if(!this._depencencies()){return false;}if(!global_data.user){if(options.callback){options.callback();}return false;}return this._readLocal(options)||this._readServer(options);},_depencencies:function(){return window.localStorage!==null&&window.jQuery!==null;},_readLocal:function(options){var name=options.object+'-'+options.action;if(localStorage[name]){var obj=jQuery.parseJSON(localStorage[name]);}else{return false;}if(!obj||obj==null){return false;}if(options.user!=obj.user){return false;}if(+new Date>obj.expiration){return false;}if(options.callback){options.callback(obj);return true;}else{return false;}},_writeLocal:function(options,data){localStorage[options.object+'-'+options.action]=JSON.stringify(data);},_readServer:function(options){var name=options.object+'-'+options.action;$.getJSON('/ajax/'+name+'.php?t='+options.expiration,function(response){ls._writeLocal(options,response);if(options.callback){options.callback(response);}});}};(function(fallback){fallback=fallback||function(){};var trap=function(){var args=Array.prototype.slice.call(arguments);console.raw.push(args);var message=args.join(' ');console.messages.push(message);fallback(message);};if(typeof console==='undefined'){console={messages:[],raw:[],dump:function(){return console.messages.join('\n');},log:trap,debug:trap,info:trap,warn:trap,error:trap,assert:trap,clear:function(){console.messages.length=0;console.raw.length=0;},dir:trap,dirxml:trap,trace:trap,group:trap,groupCollapsed:trap,groupEnd:trap,time:trap,timeEnd:trap,timeStamp:trap,profile:trap,profileEnd:trap,count:trap,exception:trap,table:trap};}})(null);var MusicPlayerClient={_playerUrl:'/audioplayer',checkPlayerState:function(){return top!=self;},open:function(url){if(!this.checkPlayerState()){if(url){location.href=this._playerUrl+'#'+url.replace(document.location.protocol+'//'+document.location.host,'');}else{location.href=this._playerUrl+'#'+location.pathname;}}},close:function(){if(this.checkPlayerState()){top.location.href=self.location;}},queue:function(tracklist,clear,url,autoload){if(!autoload){var autoload=false;}if(this.checkPlayerState()){parent.MusicPlayer.queue(tracklist,clear,url,autoload);}else{createCookie("playerQueue",tracklist,1);if(autoload){createCookie("playerAutoload",$.param(autoload),1);}if(!url){var url=false;}this.open(url);}},ready:function(){if(this.checkPlayerState()){var tracklist=readCookie("playerQueue");var autoload=readCookie("playerAutoload");if(tracklist||autoload){this.queue(tracklist,true,'',autoload);eraseCookie("playerQueue");eraseCookie("playerAutoload");}$("[data-play]").addClass("queue");$(window).bind("keydown",function(e){if(e.keyCode==116||(e.keyCode==82&&(e.metaKey||e.ctrlKey))){parent.MusicPlayer.refreshClient();if(e.preventDefault){e.preventDefault();}return false;}});}$("[data-play]").live('click',function(e){e.preventDefault();MusicPlayerClient.queue($(this).attr("data-play"),$(this).hasClass('clearFirst'));return false;});},setAutoLoad:function(){if(!type||!param){return false;}var data=type+"|"+param;createCookie("auload",data,1);}}
var camaraLibro={flagVar:false,addPost:function(postId,modBy){if(!this.flagVar){$('#action-dialogs .calPost-dialog').dialog(nDialog_cfg);$('.calPost-dialog').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button-positive box-shadow-soft floatL',click:function(){camaraLibro.flagVar=true;camaraLibro.addPost(postId,modBy);$(this).dialog("close");}},{text:lang['Cancelar'],"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.calPost-dialog').dialog('open');}else{$.ajax({type:'POST',url:'/lab/cal/addPost.php',cache:false,data:'post='+postId+'&modBy='+modBy,dataType:'json',success:function(r){$('#action-dialogs .calPost-dialog').dialog(nDialog_cfg);$('.calPost-dialog').html('<p>'+r.data+'</p>').dialog("option","buttons",[{text:lang["Aceptar"],"class":'ui-button box-shadow-soft floatL',click:function(){$(this).dialog('close');}}]);$('.calPost-dialog').dialog('open');}});camaraLibro.flagVar=false;}}}
var music={objectVote:function(obType,obId,score,obj){if($(obj).hasClass('ui-state-disabled')){return false;}$('#post-data-stats .votes-count > span').attr('data-val',function(i,val){var score=isNaN(val)?1:parseInt(val)+1;$(this).html(number_format(score));return score;});$(obj).addClass('ui-button-positive').button('option','disabled',true);$.ajax({type:'POST',url:'/ajax/music/object-vote',cache:false,data:'objectType='+obType+'&objectId='+obId+'&score='+score});},albumDelete:function(id,borrar){if(borrar==1){$('#action-dialogs .delete-dialog').dialog(nDialog_cfg);$('.delete-dialog').dialog('option','buttons',[{text:lang['Borrar'],'class':'ui-button-negative box-shadow-soft floatL',click:function(){music.albumDelete(id,2);}},{text:lang['Cancelar'],'class':'ui-button box-shadow-soft floatR',click:function(){$(this).dialog('close');}}]).dialog('open');}else{$.ajax({type:'POST',url:'/ajax/music/album-delete',cache:false,data:'albumId='+id,dataType:'json',success:function(r){if(r.status==1){$('.delete-dialog').dialog('option','buttons',[{text:'Aceptar','class':'ui-button box-shadow-soft floatL',click:function(){location.href='/musica';}}]).html(r.data).dialog('open');}else{$('.delete-dialog').dialog('option','buttons',[{text:lang['Borrar'],'class':'ui-button-negative box-shadow-soft floatL',click:function(){music.albumDelete(id,2);}},{text:lang['Cancelar'],'class':'ui-button box-shadow-soft floatR',click:function(){$(this).dialog('close');}}]).html(r.data).dialog('open');}}});}},updateLastComments:function(category){if(category==undefined){category='';}$('#lastCommentsBox-data').css('opacity',0.4);$.ajax({type:'POST',url:'/ajax/music/comment-last',cache:false,data:'category='+category,success:function(h){$('#lastCommentsBox-data').html(h);},complete:function(){$('#lastCommentsBox-data').css('opacity',1);}});}}
function toggleInterval(obj,hide,show){$(hide).hide();$(hide+show).show();$(obj).closest('ul').hide().prev().html($(obj).text());}var Pin={add:function(object,type,phrase){if($(object).hasClass("ui-state-disabled")){return false;}$(".pin-add *").attr("disabled","disabled").addClass("ui-state-disabled");ajax("pin","add",{type:type,phrase:$.trim(phrase)},{success:function(r){$("#pins .emptyData").hide();$(".pin-add input[type=text]").val("");$("#pins ul").append(tmpl("pin_item",r.data));if($("#pins ul li").length>=10){$(".pin-add").hide();}},error:function(r){if(r.data){mydialog.alert(r.data);}},complete:function(){$(".pin-add *").attr("disabled",false).removeClass("ui-state-disabled");}});},del:function(object,type,hash){$(object).parent("li").remove();if(!$("#pins ul li").length){$("#pins .emptyData").show();}$(".pin-add").show();ajax("pin","delete",{type:type,hash:hash});}}
var DomCache={_db:{},get:function(key){if(DomCache._db[key]){return DomCache._db[key];}DomCache.set(key);return $(key)},set:function(key){DomCache._db[key]=$(key);},'delete':function(key){delete DomCache._db[key];},flush:function(){DomCache._db={};}}
var ExternalClient={_intervalDelay:500,_intervalHandler:null,_lastUrl:null,_ready:false,updateUrl:true,_domCache:function(){},ready:function(){if(!ExternalClient._ready){ExternalClient._ready=true;if(location.hash.indexOf("#!")===0){}ExternalClient._intervalHandler=setInterval(ExternalClient._interval,ExternalClient._intervalDelay);DomCache.get(ExternalClient.client).bind("error",function(){var iframeDocument=DomCache.get(ExternalClient.client).contents()[0],iframeTitle=iframeDocument.title,iframeLocation=iframeDocument.location.href;if(!iframeTitle&&iframeLocation){DomCache.get(ExternalClient.client).attr("src",iframeLocation);}});}},_interval:function(){try{var iframeDocument=DomCache.get(ExternalClient.client).contents()[0];iframeTitle=iframeDocument.title,iframeLocation=iframeDocument.location.href,rootLocation=document.location.protocol+"//"+ExternalClient.baseDomain;if(ExternalClient.updateUrl&&document.title!=iframeTitle){document.title=iframeTitle;}if(iframeDocument.body){var newHeight=$(iframeDocument).height();}DomCache.get(ExternalClient.client).height(newHeight);if(ExternalClient.updateUrl){var url=iframeLocation.substr(rootLocation.length).replace(/(?:\?|&)tauth=.*$/,'');if(history&&history.pushState){url=ExternalClient.prefixUrl+url;if(url!=ExternalClient._lastUrl){history.replaceState({path:url},iframeTitle,url);}}else{if(url!=ExternalClient._lastUrl){location.href=location.href.split("#")[0]+"#!"+url;}}}ExternalClient._lastUrl=url;}catch(e){}}};jQuery.expr[":"].rcontains=function(object,index,meta){return!!jQuery.trim((object.textContent||object.innerText||jQuery(object).text()||"")).match(new RegExp(meta[3]));};var array_unique=function(a){for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j,1);}}}return a;};var saveListFromContext=function(s,k,l,f){if(typeof localStorage==="undefined"){return;}lS=localStorage||{};var a=lS[k]?lS[k]:"",o=a.split(","),c=$(s),f=f||function(){return this.textContent||this.innerText||$(this).text()||"";},s,t;for(var i=c.length-1;i>=0;--i){w=$.trim(f.apply(c[i]));if(w&&!a.match(new RegExp("(^|,)"+w+"(,|$)","i"))){o.push(w);a+=","+w;}}s=o.length;if(l&&s>l){o=o.splice(s-l);}lS[k]=o;return true;}
var saveListsFromContext=function(){saveListFromContext("a.hovercard","mention",500);saveListFromContext("a:rcontains(^#)","hashtag",100,function(){var m=$(this).attr("href").match(/(?:%23|#)([-_a-z0-9]+)/i);if(m){return m[1];}return false;});}
var suggest={requesting:false,ul:'<ul style="display:none" class="suggest-list" />',arrow:'<div class="suggest-arrow"></div>',tmpl:{'search':'<li class="item-search" data-suggest="$1">$1</li>','hashtag':'<li class="item-hashtag" data-suggest="$1">$1</li>','user':'<li class="item-user" data-suggest="$1">\
			<img src="/avatar.php?size=32&user=$1">\
			<span class="item-user-nick">@$1</span>\
		</li>'},complete:function(input,selected){var list=selected.parent('ul'),body=input.val(),suggested=selected.attr('data-suggest'),caret=$.getCaret(input[0]),word=body.substr(0,caret).split(' ').pop(),length=caret-word.length,before=body.substr(0,length),after=body.substr(caret);if(selected.hasClass('item-user')&&suggested[0]!='@'){suggested='@'+suggested;}if(selected.hasClass('item-hashtag')&&suggested[0]!='#'){suggested='#'+suggested;}input.val(before+suggested+' '+after).focus();},init:function(){$('.suggest').each(function(){if(typeof localStorage==='undefined'){return;}var input=$(this),list=$(suggest.ul).insertAfter(input);input.bind('keydown',function(event){var input=$(this),key=event.keyCode,list=input.siblings('.suggest-list'),items=list.children(),selected=list.find('.selected');if($.inArray(key,[13,38,40])===-1||!items.length){return;}switch(key){case 13:if(!selected.length){return;}suggest.complete(input,selected);break;case 38:if(!selected.length||list.find('li:first').hasClass('selected')){selected=list.find('li:last');}else{selected=selected.prevAll('li:first');}break;case 40:if(!selected.length||list.find('li:last').hasClass('selected')){selected=list.find('li:first');}else{selected=selected.nextAll('li:first');}break;default:return;break;}items.removeClass('selected');selected.addClass('selected');event.preventDefault();return false;}).bind('keyup',function(event){var input=$(this),list=input.siblings('.suggest-list'),searching=input.hasClass('searchq'),html=searching?suggest.arrow:'';key=event.keyCode;if($.inArray(key,[38,40])!==-1){return;}list.html(html);if(suggest.requesting){suggest.requesting.abort();suggest.requesting=false;}var value=input.val(),caret=$.getCaret(input[0]),query=value.substr(0,caret).split(' ').pop(),initial=query[0],count=0;if(!value||!query){list.hide();return;}if(initial=='#'){var source=localStorage.hashtag||'',word=query.substr(1);}else{var source=localStorage.mention||'';if(initial=='@'){var word=query.substr(1);}else if(searching&&!suggest.requesting){var word=query;suggest.requesting=$.ajax({url:'http://suggestqueries.google.com/complete/search?client=youtube&q='+encodeURIComponent(query)+'&hl=es',dataType:'jsonp',cache:true,success:function(response){var html='',len=response[1].length>4?4:response[1].length;for(i=0,c=len;i<c;++i){html+=suggest.tmpl.search.replace(/\$1/g,response[1][i][0]);}if(html){list.prepend(html).show();}suggest.requesting=false;}})}}if(word&&(searching||initial.match(/[\@\#]/))){var tmpl=initial=='#'?suggest.tmpl.hashtag:suggest.tmpl.user;(source.match(RegExp("(?:^|,)("+word+"[^,]*)","gi"))||[]).map(function(match){if(++count<5){var user=match.replace(',','');$(tmpl.replace(/\$1/g,user)).appendTo(list);list.show();}});}if(!list.children().length){list.hide();}}).bind('blur',function(){setTimeout(function(){list.hide();},150);}).bind('focus',function(){input.trigger("keyup");});});$('body').on('click','ul.suggest-list li',function(){var item=$(this),list=item.parent('ul'),input=list.siblings('.suggest'),button=input.siblings('.btn_search');suggest.complete(input,item);if(input.hasClass('searchq')){button.trigger('click');}list.hide();});}};function logout(privateChannel){$('.navitem.useritem .avatar').hide();$('.navitem.useritem .loading-icon').show();$.ajax({type:'POST',url:'/ajax/user/logout',complete:function(){if(window.location.pathname=="/cuenta"){window.location.href='/';}else{window.location.reload();}}});if(typeof Realtime!=='undefined'){Realtime.removeChannel(privateChannel);}}$(document).ready(function(){$('.slider-btn').unbind('click').bind('click',function(){var slider=$('#slider-inner-cont'),limit=-(slider.children('a').length-3)*70,pos=parseInt(slider.css('marginLeft')),newpos=$(this).is('.slider-next')?pos-70:pos+70;if(newpos<=0&&newpos>=limit){slider.animate({'marginLeft':newpos});}});$('#generos-vermas').click(function(event){event.preventDefault();$('.music-tag:gt(10)').toggle();$(this).text($('.music-tag:visible').length>10?'Ver menos':'Ver más');});$('#invitebeta').submit(function(event){event.preventDefault();var id=$(this).find('input[type=text]').val(),invi=$('#inviLeft').text();if($(this).hasClass('ui-state-disabled')||invi<=0){return false;}$(this).addClass('ui-state-disabled');$.ajax({type:'POST',dataType:'json',url:'/ajax/codes/invite',data:{id:id},success:function(response){switch(response.status){case 1:$('#inviLeft').text(response.data);mydialog.alert('Has enviado una invitación a '+id,'Invitación enviada');break;case 0:mydialog.alert(response.data);break;}$('#invitebeta').removeClass('ui-state-disabled').find('input[type=text]').val('');}});});$("form[name=askbeta]").submit(function(e){e.preventDefault();var form=$(this),params=form.serialize();form.children("*").attr("disabled",true);$.ajax({type:form.attr("method"),url:form.attr("action"),data:params,dataType:'json',success:function(r){var code=parseInt(r.status),data=r.data;if(code==1){location.href=location.href;}else{mydialog.alert(data);}},error:function(){mydialog.alert("Ocurri&oacute; un error al procesar lo solicitado, intentanlo nuevamente");},complete:function(){form.children("*").attr("disabled",false);}});return false;});$('.navitem.useritem').hover(function(){if($('#compose-box').hasClass('noHideForce'))return false;$(this).addClass('try-hover');setTimeout(function(){if($('.navitem.useritem.try-hover').length){$('.navitem').removeClass('active');$('.navpanel').hide();$('.navitem.useritem').removeClass('try-hover').addClass('hover').children('ul').show();}},100);},function(){$(this).removeClass('try-hover hover').children('ul').hide();});$('#prevArt').click(function(event){event.preventDefault();artNav(false);})
$('#nextArt').click(function(event){event.preventDefault();artNav(true);})
$('input.sizeLimit, textarea.sizeLimit').sizeLimit({size:255,sizeShow:200});$('.hastipsy[title]').tipsy({gravity:'s'});$('.hastipsy-w[title]').tipsy({gravity:'w'});$('.hastipsy-e[title]').tipsy({gravity:'e'});$('.comment-bt-acciones li a').tipsy({gravity:'s'});$('button:not(.btn), input:submit:not(.btn), .ui-button').button();$('.autogrow').autoGrow();$('strong[data-users]').one('click',function(){var obj=$(this);ajax('user','get',{ids:obj.attr('data-users')},{success:function(r){if(r.data){var container=obj.closest('.user-data-target'),html='<div class="clearfix"></div>'+r.data;container.append(html);}}});});$('.btn_search').bind('click',function(){if(typeof search_base=='undefined'){search_base=lang['buscar_url'];}var val=encodeURIComponent($.trim($(this).siblings('input[type=text]').val()));val+='&'+$("form[name=filters]").serialize();if(val){location.href=search_base+'?q='+val;}})
$('input.searchq').keyup(function(e){if(e.keyCode===13){$(this).siblings('.btn_search').click();return;}});$('#show-paises-lista, .show-paises-lista').click(function(){$('#paises-lista li a img[data-lazy]').each(function(){$(this).attr('src',$(this).attr('data-lazy'));});$('#paises-lista').toggle();});$('.show-ads-list').click(function(){$('.ads-dropdown').toggle();});$("[data-country]").click(function(){var pais=$(this).attr('data-country');eraseCookie("pais_home");createCookie("pais_home",pais,1);pais=readCookie("pais_home");if(pais){location.reload();}});var location_box_more=true;$('.location-box-more').click(function(){if(location_box_more){$('#comunidades-dir').css('height','170%');$(this).html(lang["ver_menos"]);location_box_more=false;}else{$('#comunidades-dir').css('height','170px');$(this).html(lang["ver_mas"]);location_box_more=true;}});$('.searchq').bind('keyup',function(){var obj=this;$('.searchq').each(function(){if(this!=obj){$(this).val($(obj).val());}});});$('div.time-tops-filter').hover(function(){$(this).children('ul.time-box').show();},function(){$(this).children('ul.time-box').hide();});if(global_data.img){(function($,w,img){$('img.lazy').lazyload({placeHolder:global_data.img+'images/space.gif',sensitivity:300});var timer=setInterval(function(){var imgs=$('img.lazy');if(!imgs.length){clearInterval(timer);return;}for(var i=0;i<imgs.length;i++){var img=$(imgs[i]);if(img.attr('orig')==img.attr('src')){clearInterval(timer);break;}}$(w).trigger('scroll');},500);})(jQuery,window,global_data.img);}var ntoHideElements=new Array();var ntoRemoveClassElements=new Array();$('body').click(function(e){if(!$(e.target).closest('.nohide').length){$('.navitem').not('.noHideForce').removeClass('active');$('.navpanel').not('.noHideForce').hide();}});$('#mensajes-box, #notifications-box').click(function(){return true;});$('#body_comm').markItUp(mySettings_cmt);nDialog_cfg={autoOpen:false,width:300,modal:true,resizable:false,draggable:false,buttons:[{text:"Ok",click:function(){$(this).dialog("close");}}]};$('.hovercard').tooltip({content:Hovercard.callback,offset:[0,10]});$('div.tooltip-c div.view-more a').live('click',function(){$(this).closest('.tooltip-c.compact').hide().next('.tooltip-c.extended').show();});$('div.activity-element a.feed-hide').live('click',function(){var obj=$(this),container=obj.closest('div.activity-element'),id=container.attr('data-feed'),unfollow='';if(obj.hasClass('feed-unfollow')){unfollow=container.attr('data-unfollow')}ajax('newsfeed','hide',{id:id,unfollow:unfollow});container.fadeOut('fast');});$('#markItUp.post').richedit({markItUpSettings:mySettings});if(!readCookie('wysiwyg')){$('.markItUpButton16 a').trigger('mouseenter');setTimeout(function(){$('.markItUpButton16 a').trigger('mouseleave');},5000);}$('a.following-button').mouseenter(function(){var unfollow_button=$(this).children('.ui-button-text').children('.unfollow-button-text:not(.disabled)');if(unfollow_button.length>0){unfollow_button.show();$(this).children('.ui-button-text').children('.following-button-text').hide();}}).mouseleave(function(){var unfollow_button=$(this).children('.ui-button-text').children('.unfollow-button-text:not(.disabled)');if(unfollow_button.length>0){unfollow_button.hide();$(this).children('.ui-button-text').children('.following-button-text').show();}});$('a.follow-perfil').mouseenter(function(){var unfollow_button=$(this).children('.ui-button-text').children('.unfollow-button-text:not(.disabled)');if(unfollow_button.length>0){unfollow_button.show();$(this).children('.ui-button-text').children('.following-button-text').hide();}}).mouseleave(function(){var unfollow_button=$(this).children('.ui-button-text').children('.unfollow-button-text:not(.disabled)');if(unfollow_button.length>0){unfollow_button.hide();$(this).children('.ui-button-text').children('.following-button-text').show();}});$('#last-activity-container div.list-element').hover(function(){$(this).children('i.remove').show();$(this).children('span.time').hide();},function(){$(this).children('i.remove').hide();$(this).children('span.time').show();});$('#last-activity-container div.activity-element, #last-activity-container div.shout-element').hover(function(){$(this).children('i.remove').show();},function(){$(this).children('i.remove').hide();});$('.action-vote.pointer').live('click',function(){var list=$(this).closest('.shout-footer').nextAll('.quick-reply');list.toggle();list.find('textarea').focus();if($(this).hasClass('ui-state-disabled')||!global_data.user_key){return false;}var object=$(this),parent=object.closest('div.s-action-list'),nlabel=object.find('div.action-number span'),id=parent.attr('data-id'),owner=parent.attr('data-owner');object.addClass('done ui-state-disabled');object.find('i').addClass('s-like-color');nlabel.html(parseInt(nlabel.html())+1);ajax('shout','vote',{uuid:id,owner:owner,score:1},{});});$('.action-comment.pointer').live('click',function(){if($('#body_comm').length){$('#body_comm').focus();}});function getShoutActivity(list,shoutId,shoutOwner,page){var data={id:shoutId,owner:shoutOwner,page:!page?1:page};list.css('paddingBottom','30px').show().children('.activity-spinner').css('display','block');$.ajax({url:'/ajax/shout/activity-get',type:'post',data:data,dataType:'json',success:function(shouts){list.css('paddingBottom','0px');list.children('.activity-spinner').hide();var len=shouts.length;if(len>0){var html='';for(i=0;i<len;++i){html+=tmpl('action_log_item',shouts[i]);}list.append(html).show();if(len==50){list.css('paddingBottom','30px');list.children('.activity-see-more').css('display','block');}else{list.css('paddingBottom','0px');list.children('.activity-spinner').hide();}}else{list.css('paddingBottom','0px');list.children('.activity-see-more').hide();list.children('.emptyData').show();}}});}$(".action-activity").live("click",function(){var list=$(this).closest(".shout-footer").next(".list");if(list.is(":visible")){list.hide();}else{if(!list.children('.list-element').length){var parentObject=$(this).closest(".s-action-list");list.children('.emptyData').hide();getShoutActivity(list,parentObject.attr("data-id"),parentObject.attr("data-owner"),1);}else{list.show();}}});$('.action-quick-reply').live('click',function(){var parent_id=$(this).attr('data-parentid'),parent_owner=$(this).attr('data-parentowner'),list=$(this).closest('.activity-element').children('.quick-reply'),counter=list.prevAll('.shout-footer').find('.action-quick-reply-toggle .action-number span'),text=list.children('textarea').val(),spinner=list.children('.shout-spinner');spinner.show().siblings().hide();$.ajax({type:'POST',url:'/ajax/shout-reply-add.php',data:'body='+encodeURIComponent(text)+'&parent_id='+parent_id+'&parent_owner='+parent_owner,complete:function(){spinner.hide().siblings().show().filter('textarea').val('');list.hide();counter.text(+counter.text()+1);list.children('textarea').val('');}});});$('.activity-see-more').live('click',function(event){event.preventDefault();var button=$(this),spinner=$(this).next('.activity-spinner'),list=button.parent(),page=+button.attr('page'),parentObject=list.prev().children('.s-action-list');button.hide();spinner.show();getShoutActivity(list,parentObject.attr("data-id"),parentObject.attr("data-owner"),page+1);button.attr('page',page+1)});$('.action-favorite.pointer').live('click',function(){if($(this).hasClass('ui-state-disabled')||!global_data.user_key){return false;}var object=$(this),parent=object.closest('div.s-action-list'),nlabel=object.find('div.action-number span'),id=parent.attr('data-id'),owner=parent.attr('data-owner');if(object.hasClass('done')){object.removeClass('done');object.children('i.icon.favorite').removeClass('favorite-color');nlabel.html(parseInt(nlabel.html())-1);ajax('shout','favorite-del',{uuid:id,owner:owner});}else{object.addClass('done');object.children('i.icon.favorite').addClass('favorite-color');nlabel.html(parseInt(nlabel.html())+1);ajax('shout','favorite-add',{uuid:id,owner:owner});}});$('.action-reshout.pointer').live('click',function(){if($(this).hasClass('ui-state-disabled')||!global_data.user_key){return false;}var object=$(this),parent=object.closest('div.s-action-list'),nlabel=object.find('div.action-number span'),id=parent.attr('data-id'),owner=parent.attr('data-owner');$('#action-dialogs .forward-dialog').dialog(nDialog_cfg);$('.forward-dialog').dialog('option','buttons',[{text:lang['Aceptar'],'class':'ui-button-positive box-shadow-soft floatL',click:function(){object.addClass('done');nlabel.html(parseInt(nlabel.html())+1);ajax('shout','add',{parent_id:id,parent_owner:owner},{success:function(r){if(location.href.match(new RegExp(lang['regex_mi'])))if(r.status==0){mydialog.alert('Ops!',r.data);}$(r.responseText).prependTo('#shouts, #newsfeed').hide().slideDown('fast');}});object.addClass('ui-state-disabled');$(this).dialog("close");}},{text:lang['Cancelar'],'class':'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.forward-dialog').dialog('open');});$('#shout-add').click(function(){if($(this).hasClass('ui-state-disabled')){return false;}$('#shout-add-loading').show();var object=$(this),body=$.trim($('#shout-body').val()),attachment_type=0,attachment='',template='feed_shout_text',privacy=parseInt($('input[name=privacy]').val());switch($('.shout-attach-link.active').attr('data-attach')){case'image':case'image-import':attachment_type=1;attachment=$('#shout-attach-input-image').val();template='feed_shout_image';break;case'video':attachment_type=2;attachment=$('#shout-attach-input-video').val();template='feed_shout_video';break;case'link':attachment_type=3;attachment=$('#shout-attach-input-link').val();template='feed_shout_link';}if(body||attachment_type){object.button('disable');ajax('shout','add',{attachment_type:attachment_type,attachment:attachment,body:body,privacy:privacy},{success:function(r){$('#shout-add-loading').hide();$(r.responseText).prependTo('#shouts, #newsfeed').hide().slideDown('fast');$('#shout-body, #shout-attach-input-image, #shout-attach-input-video, #shout-attach-input-link').val('');$('#imgpreview').hide().attr('src','');$('a.shout-attach-link:first').click();$.scrollTo($('#shouts, #newsfeed'));},complete:function(){$('#shout-add-loading').hide();object.button('enable');}});}});$('a.shout-reply').click(function(){$(this).parentsUntil('div.shout-element').parent().children('div.shout-comments').show();});$('li.make-comment input').keyup(function(event){if(event.keyCode==13){var link=$(this),body=$.trim(link.val()),object=link.parentsUntil('div.shout-element').parent().attr('id').split('_');if(body){ajax('shout','reply-add',{id:object[1],owner:object[2],body:body},{success:function(r){$(tmpl('tmpl_shout_reply_add',r.data)).insertBefore(link.parent());link.val('');},complete:function(){link.attr('disabled','');}});}}});$('a.shout-attach-link').click(function(){$('a.shout-attach-link').removeClass('active');$('div.shout-attach').hide();$(this).addClass('active');if($(this).attr('data-attach')){$('#shout-attach-'+$(this).attr('data-attach')).show();}});$('#imgupload').live('change',function(){$('#imgupload-loading').show();$('#shout-add').button('disable');Kn3.upload($('#imgupload'),function(imgObj){if(imgObj.no==0){$('#imgpreview').show().attr('src',imgObj.error);$('#shout-attach-input-image').val(imgObj.error);}$('#imgupload-loading').hide();$('#shout-add').button('enable');});});if(false&&$.browser.msie){var zIndexNumber=10000;$('div').each(function(){$(this).css('zIndex',zIndexNumber);zIndexNumber-=10;});}$('.ui-btn').button();$('.custom-check').checkBox();$('.object-disable').addClass('ui-button-disable ui-state-disabled');if($('.tooltip-anonimo').length){$('.require-login').removeAttr('href').removeAttr('onclick').unbind('click').bind('click',function(){var obj=this;$('.tooltip-anonimo').show().position({my:'left top',at:'left bottom',of:obj,offset:'-13 5',collision:'flip'});var className=['at'],rel=$(obj).offset(),self=$('.tooltip-anonimo').offset();if(rel.top<=self.top-5){className.push('bottom');}else{className.push('top');}if(rel.left<=self.left+14){className.push('right');}else{className.push('left');}$('.tooltip-anonimo').removeClass('at-bottom-right at-bottom-left at-top-right at-top-left').addClass(className.join('-'));$('.tooltip-anonimo').data('rel',$(obj));});}if($('#location-select').length){var locationCache={};$('#location-select').autocomplete({minLength:3,source:function(request,callback){if(locationCache[request.term]){return callback(locationCache[request.term]);}$.ajax({type:'post',url:'/ajax/location/search',dataType:'json',data:'q='+request.term,success:function(r){locationCache[request.term]=r.data;callback(r.data);}});},select:function(event,ui){$('#location-select').val(ui.item.caption).css('background-image','url('+ui.item.flag+')');$('input[name=location]').val(ui.item.id);$('input[name=location-challenge]').val(ui.item.crc);return false;}}).data('autocomplete')._renderItem=function(ul,item){return $('<li></li>').data('item.autocomplete',item).append('<a>'+item.caption+'</a>').appendTo(ul);};}$(window).scroll(function(){if(window.pageYOffset>=1500){$('#scroll-up:not(:visible)').fadeIn();}else{$('#scroll-up:visible').fadeOut();}});$('#comments.in-shout .comment-content > img, .expandOnClick').live('click',function(){var originalWidth=$(this).css('width');$(this).css({maxWidth:'520px',maxHeight:'600px'});if(!$(this).hasClass('expandOnClick')){$(this).css('cursor','default');}if($(this).css('width')!=originalWidth){return false;}});hide_untrusted_swf();$('img.playeroverlay.playHere').live('click',function(){var obj=$(this),next=obj.next('div'),player=next.children('iframe');obj.hide();next.show();if(player){player.attr('src',player.attr('src')+'&autoplay=1');}return false;});$('.textlimit').textlimit({suffix:'...'});$('textarea.markItUpEditor').emoticons();ajaxCheck.init();ajaxCheck.updateTitle();$(".n2see img").error(function(){$(this).remove();if(!$(".n2see img").length){$(".n2see").remove();}});$("textarea.autoresize").autoResize({extraSpace:0});MusicPlayerClient.ready();$(".music-widget-slider").each(function(){$(this).slider({min:0,max:$(this).attr("data-steps")-1,slide:function(event,ui){$(this).parent().siblings(".segment").hide().filter(".step-"+(ui.value>=0?ui.value:0)).show();}});});$("img.open-modal").click(function(){var image=$('<img src="'+$(this).attr("src")+'" />').css({maxWidth:parseInt($(window).width())-75+"px",maxHeight:parseInt($(window).height())-75+"px"});image.dialog({dialogClass:" chromeless",modal:true,width:"auto",height:"auto"})});$(function(){if($.browser.msie&&$.browser.version=='7.0'){var zIndexNumber=1000;$('#header div').each(function(){$(this).css('zIndex',zIndexNumber);zIndexNumber-=10;});}});$('.follow-buttons .btn').live('mouseenter',function(){var btn=$(this);if(!btn.is('.wait')){if(btn.is('.following')){btn.hide().siblings('.unfollowing').show();}}}).live('mouseleave',function(){var btn=$(this);if(btn.is('.unfollowing')&&!btn.is('.wait')){btn.hide().siblings('.following').show();}if(btn.is('.wait')){btn.removeClass('wait');}}).live('click',function(event){event.preventDefault();var btn=$(this),dad=btn.parent(),obj=btn.attr('obj'),objId=btn.attr('objid'),errorContainer=btn.attr('errorContainer');if(btn.is('.not-following')){follow(true,{type:obj,obj:objId,errorContainer:errorContainer});dad.children('.btn').hide();dad.children('.following').addClass('wait').show();}if(btn.is('.unfollowing')){follow(false,{type:obj,obj:objId,errorContainer:errorContainer});btn.addClass('wait');dad.children('.btn').hide();dad.children('.not-following').show();}});$('.join-community .btn').click(function(){var btn=$(this),comid=btn.attr('comid');if(btn.is('.join')){comm.joinCommunity(comid);btn.hide().siblings().show();}else if(btn.is('.leave')){comm.leaveCommunity(comid);btn.hide().siblings().show();}});$('.dropdown-dropper').click(function(event){event.preventDefault();$(this).addClass('active');$(this).next('.dropdown-list').show();});$(document).click(function(event){if(!$(event.target).hasClass('dropdown-dropper active')){$('.musthide').hide();$('.dropdown-dropper').removeClass('active');}});var hoverDelay={interval:true,obj:false,timer:0,miDelay:function(){this.interval=true;var objImg=this.obj,inter=this.interval;this.timer=setTimeout(function(objImg,inter){return function(){if(inter){var obj=objImg,link=obj.attr("href"),img=obj.children("img"),title=$.trim(img.attr("alt").substr(0,56))+(img.attr("alt").length>56?"...":""),imgSource=img.attr("src");$(".image-search-preview").remove();$('<a href="'+link+'" class="image-search-preview"><img src="'+imgSource+'" /><span>'+title+'</span></a>').appendTo('body').children("img").animate({width:'+=50'},0).parent('a').css("width",$(".image-search-preview img").width()).position({my:"center",at:"center",of:obj});}}}(objImg,inter),200);},stopDelay:function(){if(this.interval){clearTimeout(this.timer);this.interval=false;}}}
$(".images-result a").hover(function(){hoverDelay.obj=$(this);hoverDelay.stopDelay();hoverDelay.miDelay();});$(".images-result a").live("mouseout",function(){hoverDelay.stopDelay();hoverDelay.interval=false;});$(".image-search-preview").live("mouseout",function(){$(this).remove();hoverDelay.stopDelay();hoverDelay.interval=true;});$('.my-shout-attach-options a').live('click',function(){var type=$(this).data('type');if(type=='image'&&$('.my-shout-attach-image').length){return false;}mi.attach.input($(this).closest('.shout-box'),type);});$('.my-shout-attach .remove-attach').live('click',function(){mi.attach.remove($(this).closest('.shout-box'));});$('.my-shout-attach .cancel-attach').live('click',function(){mi.attach.cancel($(this).closest('.shout-box'));});$('.privacy-shout .privacy').live('click',function(event){var el_list=$(this).parent().next();if($(el_list).is(':visible')){$('body').click();return;}$(el_list).show().position({my:'right top',at:'left top',of:this,offset:'0',collision:'none'});});$('.privacy-shout + ul li a').live('click',function(){$(this).closest('ul').find('li').removeClass('selected');$(this).closest('li').addClass('selected');$(this).closest('ul').prev().data('privacy',$(this).data('value'));});$('body').click(function(event){if(!$(event.target).is('.privacy-shout .privacy'))$('.privacy-shout').next().hide();});$('.my-shout-attach-options .image a[data-type="image"]').live('click',function(event){var el=$(this).closest('.shout-box');var el_list=$(el).find('.my-shout-attach-image');if(!el_list.length){return;}else if($(el_list).is(':visible')){$('body').click();return;}$(el).find('.my-shout-attach-options a[data-type="image"]').addClass('hover');$(el_list).show().position({my:'center top',at:'center bottom',of:this,offset:'0 8',collision:'none'});$(el_list).find('.tail.up').position({my:'center bottom',at:'center top',of:el_list,offset:'0 1',collision:'none'});var width=$(el_list).find('a[data-method="upload"]').parent().innerWidth();var height=$(el_list).find('a[data-method="upload"]').parent().innerHeight();$(el).find('object').attr({'width':width,'height':height}).position({my:'center center',at:'center center',of:$(el_list).find('a[data-method="upload"]'),offset:'0',collision:'none'});});$('body').click(function(event){if(!$(event.target).is('.my-shout-attach-options .image a[data-type="image"]')){$('.shout-box object').css('top','-1000px');$('.my-shout-attach-image.select-list').hide();$('.my-shout-attach-options a[data-type="image"]').removeClass('hover');}});$('.shout-box object').live({mouseenter:function(){var el=$(this).closest('.shout-box');$(el).find('a[data-method="upload"]').parent().addClass('hover');},mouseleave:function(){var el=$(this).closest('.shout-box');$(el).find('a[data-method="upload"]').parent().removeClass('hover');}});$('.my-shout-attach-image a').live('click',function(){if($(this).data('method')=='upload')return false;mi.attach.input($(this).closest('.shout-box'),'image');});$('.my-shout-add').live('click',function(event){event.preventDefault();mi.submit($(this).closest('.shout-box'));});$('.s-action-list i.select-list').live('click',function(event){var el_list=$(this).next();if($(el_list).is(':visible')){$('body').click();return;}$(el_list).css('position','relative').show().position({my:'right top',at:'left top',of:this,offset:'3 5',collision:'none'}).css('position','absolute');});$('body').click(function(event){if(!$(event.target).is('.s-action-list i.select-list'))$('.s-action-list i.select-list + .select-list').hide();});$(window).keyup(function(e){if($.inArray(e.target.tagName.toLowerCase(),['input','textarea','select'])==-1){if(!e.ctrlKey&&!e.altKey){switch(e.which){case 80:$.elemScroll('div.activity-element','p');break;case 78:$.elemScroll('div.activity-element','n');break;case 67:$('#my-shout-body-mi').focus();break;case 83:$('form[name=search-mi] input').focus();break;}}}});$('ul.mentionsuggest li').hover(function(){nav.hover=true;$('.mentionsuggest li').removeClass('active');$(this).addClass('active');},function(){nav.hover=false;$('.mentionsuggest li').removeClass('active');});$('.mentionsuggest li a').live('click',function(event){var obj=$('#my-shout-body-mi')[0];$(obj).focus();var caret=$.getCaret(obj),val=$(obj).val(),nick=$(this).attr('data-nick'),pre=val.substr(0,caret),post=val.substr(caret),pre=pre.replace(/(^|\s)@([-_a-z0-9]*)$/i,function(match,$1,$2){return $1+'@'+nick+' ';});$(obj).val(pre+post).trigger('keyup');});if(global_data.user){$('p a[data-uid='+global_data.user+']').closest('.activity-element').addClass('mention');}if($('.my-shout-attach-image').length){mi.initUploadfy();}suggest.init();$('.action-quick-reply-toggle').live('click',function(){var list=$(this).closest('.shout-footer').nextAll('.quick-reply');list.toggle();list.find('textarea').focus();});$('.content-tabs.perfil #mensaje').uberText({limit:255,block:true,autogrow:true,lines:4});$('.content-tabs.perfil textarea[id!=mensaje]').uberText({limit:400,block:true,autogrow:true,lines:14});$('.content-tabs.mis-fotos textarea').uberText({limit:255,block:true,autogrow:true,lines:2});$('#nbody_fastreply.ubertext-me').uberText({limit:5000,block:true,autogrow:true,lines:5});$('.shout-quick-reply.ubertext-me').uberText({limit:5000,block:true,autogrow:true,show:-50,onPositive:function(counter,elem,params){$(counter).css('color','#999');},onNegative:function(counter,elem,params){$(counter).css('color','red');}});$('.shout-box .ubertext-me, my-shout-textarea-wall .ubertext-me').uberText({limit:255,block:false,autogrow:true,show:-50,onPositive:function(counter,elem,params){$(counter).css('color','#999');},onNegative:function(counter,elem,params){$(counter).css('color','red');}});if(Comments.objectType){var page=location.hash.match(/^#pagina\-([0-9]+)$/)||false,actual=+$('.nav-pages li.active:first a').text();if(actual==0)++actual;if(page[1]&&!isNaN(actual)&&actual!=+page[1]){Comments.page(+page[1]);}if(location.hash==='#last'){var lastPage=+$('.nav-pages li:last a').html();if(lastPage>1){Comments.page(lastPage);}$('#comment-linked').html('');}var match=location.hash.match(/#comment-([0-9]+)/);if(match){$.ajax({type:'post',url:'/ajax/comments/get',data:{commentId:+match[1],objectType:Comments.objectType,objectId:Comments.objectId,objectOwner:Comments.objectOwner},success:function(html){$('#comment-linked').prepend(html);$('.hastipsy[title]').tipsy({gravity:'s'});$('.hastipsy-w[title]').tipsy({gravity:'w'});$('.hastipsy-e[title]').tipsy({gravity:'e'});$.scrollTo('#comment-linked',500);}});}}$('a.editar-post.disabled').on('click',function(event){event.preventDefault();});Sharer.init();$(function(){var input=document.createElement("input");if(('placeholder'in input)==false){$('[placeholder]').focus(function(){var i=$(this);if(i.val()==i.attr('placeholder')){i.val('').removeClass('placeholder');if(i.hasClass('password')){i.removeClass('password');this.type='password';}}}).blur(function(){var i=$(this);if(i.val()==''||i.val()==i.attr('placeholder')){if(this.type=='password'){i.addClass('password');this.type='text';}i.addClass('placeholder').val(i.attr('placeholder'));}}).blur().parents('form').submit(function(){$(this).find('[placeholder]').each(function(){var i=$(this);if(i.val()==i.attr('placeholder'))i.val('');})});}});});var Sharer={init:function(){$('.sharer-button.taringa').click(function(event){event.preventDefault();nDialog_cfg={autoOpen:false,width:300,modal:true,resizable:false,draggable:false};$('#action-dialogs .sharePost-dialog').dialog(nDialog_cfg);$('.sharePost-dialog').dialog("option","buttons",[{text:'Aceptar',"class":'ui-button-positive box-shadow-soft floatL',click:function(){notifica.spam(global_data.postid);$('.sharer-counter.taringa').text(+$('.sharer-counter.taringa:first').text()+1);$(this).dialog("close");}},{text:'Cancelar',"class":'ui-button-cancel floatR',click:function(){$(this).dialog('close');}}]);$('.sharePost-dialog').dialog('open');});$('.sharer-button.facebook').click(function(event){event.preventDefault();if(!Facebook._initialized){return;}FB.ui({method:'feed',name:$('meta[property="og:title"]').attr('content')||document.title,link:$('meta[property="og:url"]').attr('content')||window.location.href,picture:$('meta[property="og:image"]').attr('content'),description:$('meta[property="og:description"]').attr('content')},function(response){if(response&&response.post_id){$('.sharer-counter.facebook').text(+$('.sharer-counter.facebook:first').text()+1);}});});$('.sharer-button.twitter').click(function(event){event.preventDefault();var title=$('meta[property="og:title"]').attr('content')||document.title;window.open('https://twitter.com/intent/tweet?'+(/poringa/.test(document.domain)?'':'via=Taringa&related=Taringa&')+'text='+encodeURIComponent(title)+'&url='+encodeURIComponent(window.location.href),'sharer','toolbar=0,status=0,width=650,height=250,left='+(screen.width/2-650/2)+',top='+(screen.height/2-285/2));Sharer.updateCounters();});$('.sharer-button.google').click(function(event){event.preventDefault();window.open('https://plus.google.com/share?hl=es_ES&url='+escape(window.location.href),'sharer','toolbar=0,status=0,width=450,height=470,left='+(screen.width/2-450/2)+',top='+(screen.height/2-505/2));Sharer.updateCounters();});$('.sharer-button.email, .shareByEmail').click(function(event){event.preventDefault();var elem=$(this),object=elem.attr('object'),objectid=elem.attr('objectid');$.ajax({url:'/ajax/email/share',type:'post',data:{object:object,objectid:objectid},success:function(html){var dialog=$('#shareContainer');dialog.html(html).dialog({autoOpen:false,width:640,title:lang['Recomendar '+(object=='post'?'post':'tema')],modal:true,resizable:false,draggable:false,dialogClass:'recomendar-post',buttons:[{text:lang['Recomendar Compartir'],'class':'floatL btn ui-button-positive',click:function(){var thisDialog=$(this);var emails=$('#shareEmails').val().split(',');var send=true;$.each(emails,function(index,email){email=$.trim(email);if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)){$('#shareEmails').addClass('error');$('#emailShareMessage').html('Error en una o mas direcciones de email, revisa y vuelve a intentar').css('color','red');send=false;}})
if(send){$.ajax({url:'/ajax/email/share',type:'post',dataType:'json',data:{object:object,objectid:objectid,name:$('#shareName').val(),emails:$('#shareEmails').val(),message:$('#shareText').val()},success:function(response){if(elem.is('.sharer-button')){$('.sharer-counter.email').text(+$('.sharer-counter.email').text()+1);}else{$('.number-email-t').html(parseInt($('.number-email-t').html())+1);}thisDialog.dialog('close');}});}}},{text:lang['Cancelar'],'class':'floatR btn g',click:function(){$(this).dialog("close");}}]}).dialog('open');}});});},updateCounters:function(){$.ajax({dataType:'jsonp',url:'http://graph.facebook.com/?id='+escape(window.location.href),async:true,cache:true,crossDomain:true,contentType:'text/json; charset=utf-8',success:function(response){if(response.shares){$('.sharer-counter.facebook').text(response.shares);}}});$.ajax({dataType:'jsonp',url:'http://urls.api.twitter.com/1/urls/count.json?url='+escape(window.location.href),async:true,cache:true,crossDomain:true,contentType:'text/json; charset=utf-8',success:function(response){if(response.count){$('.sharer-counter.twitter').text(response.count);}}});}}
if(typeof String.prototype.trim!=='function'){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'');}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++){if(from in this&&this[from]===elt)return from;}return-1;};}(function(w){w['dataLayer']=w['dataLayer']||[];w['optimizely']=w['optimizely']||[];function _TagManagerPush(name,value){var obj={};obj[name]=value;dataLayer.push(obj);}function _OptimizelyPush(tag,name,value){var data=[tag];if(typeof name!=='undefined'){data.push(name);if(typeof value!=='undefined'){data.push(value);}}optimizely.push(data);}function pushCustomTag(name,value){_TagManagerPush(name,value);_OptimizelyPush('customTag',name,value);}function pushEvent(name){_TagManagerPush('event',name);}function pushData(name,value){_TagManagerPush(name,value);}w.tracker={pushCustomTag:pushCustomTag,pushEvent:pushEvent,pushData:pushData};})(window);$(document).ready(function(){$(".container-post .comments-box .bt-cargar-mas").click(function(e){e.preventDefault();$(this).parent().find('.comment-respuestas .comentarios-ocultos').fadeIn();$(this).hide();});});